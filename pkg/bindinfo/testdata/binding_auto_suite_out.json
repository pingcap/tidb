[
  {
    "Name": "TestPlanGeneration",
    "Cases": [
      {
        "SQL": "explain explore select count(1) from t",
        "Plan": [
          [
            "HashAgg  1.00  root    funcs:count(Column#7)->Column#5",
            "└─IndexReader  1.00  root    index:HashAgg",
            "  └─HashAgg  1.00  cop[tikv]    funcs:count(1)->Column#7",
            "    └─IndexFullScan  10000.00  cop[tikv]  table:t, index:a(a)  keep order:false, stats:pseudo"
          ],
          [
            "HashAgg  1.00  root    funcs:count(1)->Column#5",
            "└─IndexReader  10000.00  root    index:IndexFullScan",
            "  └─IndexFullScan  10000.00  cop[tikv]  table:t, index:a(a)  keep order:false, stats:pseudo"
          ],
          [
            "StreamAgg  1.00  root    funcs:count(Column#10)->Column#5",
            "└─IndexReader  1.00  root    index:StreamAgg",
            "  └─StreamAgg  1.00  cop[tikv]    funcs:count(1)->Column#10",
            "    └─IndexFullScan  10000.00  cop[tikv]  table:t, index:a(a)  keep order:false, stats:pseudo"
          ],
          [
            "StreamAgg  1.00  root    funcs:count(1)->Column#5",
            "└─TableReader  10000.00  root    data:TableFullScan",
            "  └─TableFullScan  10000.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ],
          [
            "StreamAgg  1.00  root    funcs:count(Column#10)->Column#5",
            "└─TableReader  1.00  root    data:StreamAgg",
            "  └─StreamAgg  1.00  cop[tikv]    funcs:count(1)->Column#10",
            "    └─TableFullScan  10000.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ],
          [
            "HashAgg  1.00  root    funcs:count(1)->Column#5",
            "└─TableReader  10000.00  root    data:TableFullScan",
            "  └─TableFullScan  10000.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ],
          [
            "StreamAgg  1.00  root    funcs:count(1)->Column#5",
            "└─IndexReader  10000.00  root    index:IndexFullScan",
            "  └─IndexFullScan  10000.00  cop[tikv]  table:t, index:a(a)  keep order:false, stats:pseudo"
          ],
          [
            "HashAgg  1.00  root    funcs:count(Column#7)->Column#5",
            "└─TableReader  1.00  root    data:HashAgg",
            "  └─HashAgg  1.00  cop[tikv]    funcs:count(1)->Column#7",
            "    └─TableFullScan  10000.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ]
        ]
      },
      {
        "SQL": "explain explore select max(b) from t where a=1",
        "Plan": [
          [
            "StreamAgg  1.00  root    funcs:max(test.t.b)->Column#5",
            "└─TopN  1.00  root    test.t.b:desc, offset:0, count:1",
            "  └─TableReader  1.00  root    data:TopN",
            "    └─TopN  1.00  cop[tikv]    test.t.b:desc, offset:0, count:1",
            "      └─Selection  9.99  cop[tikv]    eq(test.t.a, 1), not(isnull(test.t.b))",
            "        └─TableFullScan  10000.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ],
          [
            "StreamAgg  1.00  root    funcs:max(test.t.b)->Column#5",
            "└─TopN  1.00  root    test.t.b:desc, offset:0, count:1",
            "  └─IndexLookUp  1.00  root    ",
            "    ├─IndexRangeScan(Build)  10.00  cop[tikv]  table:t, index:a(a)  range:[1,1], keep order:false, stats:pseudo",
            "    └─TopN(Probe)  1.00  cop[tikv]    test.t.b:desc, offset:0, count:1",
            "      └─Selection  9.99  cop[tikv]    not(isnull(test.t.b))",
            "        └─TableRowIDScan  10.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ],
          [
            "HashAgg  1.00  root    funcs:max(test.t.b)->Column#5",
            "└─TopN  1.00  root    test.t.b:desc, offset:0, count:1",
            "  └─TableReader  1.00  root    data:TopN",
            "    └─TopN  1.00  cop[tikv]    test.t.b:desc, offset:0, count:1",
            "      └─Selection  9.99  cop[tikv]    eq(test.t.a, 1), not(isnull(test.t.b))",
            "        └─TableFullScan  10000.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ],
          [
            "HashAgg  1.00  root    funcs:max(test.t.b)->Column#5",
            "└─TopN  1.00  root    test.t.b:desc, offset:0, count:1",
            "  └─IndexLookUp  1.00  root    ",
            "    ├─IndexRangeScan(Build)  10.00  cop[tikv]  table:t, index:a(a)  range:[1,1], keep order:false, stats:pseudo",
            "    └─TopN(Probe)  1.00  cop[tikv]    test.t.b:desc, offset:0, count:1",
            "      └─Selection  9.99  cop[tikv]    not(isnull(test.t.b))",
            "        └─TableRowIDScan  10.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ]
        ]
      },
      {
        "SQL": "explain explore select * from t where a=1",
        "Plan": [
          [
            "TableReader  10.00  root    data:Selection",
            "└─Selection  10.00  cop[tikv]    eq(test.t.a, 1)",
            "  └─TableFullScan  10000.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ],
          [
            "IndexLookUp  10.00  root    ",
            "├─IndexRangeScan(Build)  10.00  cop[tikv]  table:t, index:a(a)  range:[1,1], keep order:false, stats:pseudo",
            "└─TableRowIDScan(Probe)  10.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ]
        ]
      },
      {
        "SQL": "explain explore select * from t where b=1",
        "Plan": [
          [
            "TableReader  10.00  root    data:Selection",
            "└─Selection  10.00  cop[tikv]    eq(test.t.b, 1)",
            "  └─TableFullScan  10000.00  cop[tikv]  table:t  keep order:false, stats:pseudo"
          ]
        ]
      }
    ]
  },
  {
    "Name": "TestRelevantOptVarsAndFixes",
    "Cases": [
      {
        "Vars": "[tidb_opt_index_reader_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_prefer_range_scan tidb_opt_table_full_scan_cost_factor tidb_opt_table_reader_cost_factor]",
        "Fixes": "[45132 52869]"
      },
      {
        "Vars": "[tidb_opt_index_reader_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_prefer_range_scan]",
        "Fixes": "[52869]"
      },
      {
        "Vars": "[tidb_opt_index_lookup_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_prefer_range_scan tidb_opt_table_rowid_scan_cost_factor]",
        "Fixes": "[52869]"
      },
      {
        "Vars": "[tidb_opt_index_lookup_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_prefer_range_scan tidb_opt_table_full_scan_cost_factor tidb_opt_table_reader_cost_factor tidb_opt_table_rowid_scan_cost_factor]",
        "Fixes": "[45132 52869]"
      },
      {
        "Vars": "[tidb_opt_index_reader_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_prefer_range_scan]",
        "Fixes": "[52869]"
      },
      {
        "Vars": "[tidb_opt_hash_agg_cost_factor tidb_opt_index_reader_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_ordering_index_selectivity_ratio tidb_opt_prefer_range_scan tidb_opt_stream_agg_cost_factor tidb_opt_topn_cost_factor]",
        "Fixes": "[52869]"
      },
      {
        "Vars": "[tidb_opt_hash_agg_cost_factor tidb_opt_index_lookup_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_prefer_range_scan tidb_opt_stream_agg_cost_factor tidb_opt_table_rowid_scan_cost_factor]",
        "Fixes": "[52869]"
      },
      {
        "Vars": "[tidb_opt_index_lookup_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_prefer_range_scan tidb_opt_sort_cost_factor tidb_opt_table_rowid_scan_cost_factor]",
        "Fixes": "[45132 52869]"
      },
      {
        "Vars": "[tidb_opt_index_lookup_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_prefer_range_scan tidb_opt_table_range_scan_cost_factor tidb_opt_table_rowid_scan_cost_factor tidb_opt_topn_cost_factor]",
        "Fixes": "[52869]"
      },
      {
        "Vars": "[tidb_opt_hash_join_cost_factor tidb_opt_index_join_cost_factor tidb_opt_index_reader_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_merge_join_cost_factor tidb_opt_prefer_range_scan]",
        "Fixes": "[44855 45132 52869]"
      },
      {
        "Vars": "[tidb_opt_hash_join_cost_factor tidb_opt_index_join_cost_factor tidb_opt_index_reader_cost_factor tidb_opt_index_scan_cost_factor tidb_opt_merge_join_cost_factor tidb_opt_prefer_range_scan]",
        "Fixes": "[44855 45132 52869]"
      },
      {
        "Vars": "[tidb_opt_hash_join_cost_factor tidb_opt_prefer_range_scan tidb_opt_table_full_scan_cost_factor tidb_opt_table_reader_cost_factor]",
        "Fixes": "[52869]"
      }
    ]
  }
]
