[
  {
    "Name": "TestLogicalExpandBuildKeyInfo",
    "Cases": [
      {
        "SQL": "SELECT * FROM (   SELECT     SUM(IFNULL(pay.payamt, 0)) AS payamt,     SUM(IFNULL(ret.retamt, 0)) AS retamt,     GROUPING(org.org_type) AS grouptype,     org.org_type,     GROUPING(org.org_id) AS groupid,     org.org_id,     org.org_name   FROM testorg org   LEFT JOIN (     SELECT       SUM(IFNULL(amt, 0)) AS payamt,       org_id     FROM testpay tp     WHERE tp.pay_date BETWEEN '2024-06-01' AND '2024-07-31'     GROUP BY org_id   ) pay ON pay.org_id = org.org_id   LEFT JOIN (     SELECT       SUM(IFNULL(amt, 0)) AS retamt,       org_id     FROM testreturn tr     WHERE tr.ret_date BETWEEN '2024-06-01' AND '2024-07-31'     GROUP BY org_id   ) ret ON ret.org_id = org.org_id   GROUP BY org.org_type, org.org_id WITH ROLLUP ) t WHERE groupid = 1 AND grouptype = 1;",
        "Plan": [
          "Projection 6400.00 root  Column#21->Column#25, Column#22->Column#26, grouping(gid)->Column#27, Column#18->Column#28, grouping(gid)->Column#29, Column#19->Column#30, test.testorg.org_name",
          "└─HashAgg 6400.00 root  group by:Column#48, Column#49, Column#50, funcs:sum(Column#45)->Column#21, funcs:sum(Column#46)->Column#22, funcs:firstrow(Column#47)->test.testorg.org_name, funcs:firstrow(Column#48)->Column#18, funcs:firstrow(Column#49)->Column#19, funcs:firstrow(Column#50)->gid",
          "  └─Projection 8000.00 root  ifnull(Column#11, 0.00)->Column#45, ifnull(Column#17, 0.00)->Column#46, test.testorg.org_name->Column#47, Column#18->Column#48, Column#19->Column#49, gid->Column#50",
          "    └─Selection 8000.00 root  eq(grouping(gid), 1), eq(grouping(gid), 1)",
          "      └─Expand 10000.00 root  level-projection:[test.testorg.org_name, Column#11, Column#17, <nil>->Column#18, <nil>->Column#19, 0->gid],[test.testorg.org_name, Column#11, Column#17, Column#18, <nil>->Column#19, 1->gid],[test.testorg.org_name, Column#11, Column#17, Column#18, Column#19, 3->gid]; schema: [test.testorg.org_name,Column#11,Column#17,Column#18,Column#19,gid]",
          "        └─Projection 10000.00 root  test.testorg.org_name, Column#11, Column#17, test.testorg.org_type->Column#18, test.testorg.org_id->Column#19",
          "          └─HashJoin 10000.00 root  left outer join, equal:[eq(test.testorg.org_id, test.testreturn.org_id)]",
          "            ├─HashAgg(Build) 199.80 root  group by:test.testreturn.org_id, funcs:sum(Column#43)->Column#17, funcs:firstrow(test.testreturn.org_id)->test.testreturn.org_id",
          "            │ └─TableReader 199.80 root  data:HashAgg",
          "            │   └─HashAgg 199.80 cop[tikv]  group by:test.testreturn.org_id, funcs:sum(ifnull(test.testreturn.amt, 0.00))->Column#43",
          "            │     └─Selection 249.75 cop[tikv]  ge(test.testreturn.ret_date, \"2024-06-01\"), le(test.testreturn.ret_date, \"2024-07-31\"), not(isnull(test.testreturn.org_id))",
          "            │       └─TableFullScan 10000.00 cop[tikv] table:tr keep order:false, stats:pseudo",
          "            └─HashJoin(Probe) 10000.00 root  left outer join, equal:[eq(test.testorg.org_id, test.testpay.org_id)]",
          "              ├─HashAgg(Build) 199.80 root  group by:test.testpay.org_id, funcs:sum(Column#41)->Column#11, funcs:firstrow(test.testpay.org_id)->test.testpay.org_id",
          "              │ └─TableReader 199.80 root  data:HashAgg",
          "              │   └─HashAgg 199.80 cop[tikv]  group by:test.testpay.org_id, funcs:sum(ifnull(test.testpay.amt, 0.00))->Column#41",
          "              │     └─Selection 249.75 cop[tikv]  ge(test.testpay.pay_date, \"2024-06-01\"), le(test.testpay.pay_date, \"2024-07-31\"), not(isnull(test.testpay.org_id))",
          "              │       └─TableFullScan 10000.00 cop[tikv] table:tp keep order:false, stats:pseudo",
          "              └─TableReader(Probe) 10000.00 root  data:TableFullScan",
          "                └─TableFullScan 10000.00 cop[tikv] table:org keep order:false, stats:pseudo"
        ]
      },
      {
        "SQL": "SELECT SUM(IFNULL(pay.payamt, 0)) AS payamt,     SUM(IFNULL(ret.retamt, 0)) AS retamt,     GROUPING(org.org_type) AS grouptype,     org.org_type,     GROUPING(org.org_id) AS groupid,     org.org_id,     org.org_name   FROM testorg org   LEFT JOIN (     SELECT       SUM(IFNULL(amt, 0)) AS payamt,       org_id     FROM testpay tp     WHERE tp.pay_date BETWEEN '2024-06-01' AND '2024-07-31'     GROUP BY org_id   ) pay ON pay.org_id = org.org_id   LEFT JOIN (     SELECT       SUM(IFNULL(amt, 0)) AS retamt,       org_id     FROM testreturn tr     WHERE tr.ret_date BETWEEN '2024-06-01' AND '2024-07-31'     GROUP BY org_id   ) ret ON ret.org_id = org.org_id   GROUP BY org.org_type, org.org_id WITH ROLLUP having  groupid = 1 AND grouptype = 1;",
        "Plan": [
          "Projection 6400.00 root  Column#21->Column#25, Column#22->Column#26, grouping(gid)->Column#27, Column#18->Column#28, grouping(gid)->Column#29, Column#19->Column#30, test.testorg.org_name",
          "└─HashAgg 6400.00 root  group by:Column#41, Column#42, Column#43, funcs:sum(Column#38)->Column#21, funcs:sum(Column#39)->Column#22, funcs:firstrow(Column#40)->test.testorg.org_name, funcs:firstrow(Column#41)->Column#18, funcs:firstrow(Column#42)->Column#19, funcs:firstrow(Column#43)->gid",
          "  └─Projection 8000.00 root  ifnull(Column#11, 0.00)->Column#38, ifnull(Column#17, 0.00)->Column#39, test.testorg.org_name->Column#40, Column#18->Column#41, Column#19->Column#42, gid->Column#43",
          "    └─Selection 8000.00 root  eq(grouping(gid), 1), eq(grouping(gid), 1)",
          "      └─Expand 10000.00 root  level-projection:[test.testorg.org_name, Column#11, Column#17, <nil>->Column#18, <nil>->Column#19, 0->gid],[test.testorg.org_name, Column#11, Column#17, Column#18, <nil>->Column#19, 1->gid],[test.testorg.org_name, Column#11, Column#17, Column#18, Column#19, 3->gid]; schema: [test.testorg.org_name,Column#11,Column#17,Column#18,Column#19,gid]",
          "        └─Projection 10000.00 root  test.testorg.org_name, Column#11, Column#17, test.testorg.org_type->Column#18, test.testorg.org_id->Column#19",
          "          └─HashJoin 10000.00 root  left outer join, equal:[eq(test.testorg.org_id, test.testreturn.org_id)]",
          "            ├─HashAgg(Build) 199.80 root  group by:test.testreturn.org_id, funcs:sum(Column#36)->Column#17, funcs:firstrow(test.testreturn.org_id)->test.testreturn.org_id",
          "            │ └─TableReader 199.80 root  data:HashAgg",
          "            │   └─HashAgg 199.80 cop[tikv]  group by:test.testreturn.org_id, funcs:sum(ifnull(test.testreturn.amt, 0.00))->Column#36",
          "            │     └─Selection 249.75 cop[tikv]  ge(test.testreturn.ret_date, \"2024-06-01\"), le(test.testreturn.ret_date, \"2024-07-31\"), not(isnull(test.testreturn.org_id))",
          "            │       └─TableFullScan 10000.00 cop[tikv] table:tr keep order:false, stats:pseudo",
          "            └─HashJoin(Probe) 10000.00 root  left outer join, equal:[eq(test.testorg.org_id, test.testpay.org_id)]",
          "              ├─HashAgg(Build) 199.80 root  group by:test.testpay.org_id, funcs:sum(Column#34)->Column#11, funcs:firstrow(test.testpay.org_id)->test.testpay.org_id",
          "              │ └─TableReader 199.80 root  data:HashAgg",
          "              │   └─HashAgg 199.80 cop[tikv]  group by:test.testpay.org_id, funcs:sum(ifnull(test.testpay.amt, 0.00))->Column#34",
          "              │     └─Selection 249.75 cop[tikv]  ge(test.testpay.pay_date, \"2024-06-01\"), le(test.testpay.pay_date, \"2024-07-31\"), not(isnull(test.testpay.org_id))",
          "              │       └─TableFullScan 10000.00 cop[tikv] table:tp keep order:false, stats:pseudo",
          "              └─TableReader(Probe) 10000.00 root  data:TableFullScan",
          "                └─TableFullScan 10000.00 cop[tikv] table:org keep order:false, stats:pseudo"
        ]
      }
    ]
  }
]
