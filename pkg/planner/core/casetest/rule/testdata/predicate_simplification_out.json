[
  {
    "Name": "TestPredicateSimplification",
    "Cases": [
      {
        "SQL": "SELECT i.id, ip_products.products FROM t1 AS i LEFT JOIN t4 ON i.id = t4.c3 LEFT JOIN (SELECT t4.c3, GROUP_CONCAT(DISTINCT t2.c3 ORDER BY t2.c3 ASC) AS products FROM t4 JOIN t3 ON t4.c1 = t3.c1 AND t4.c2 = t3.c2 LEFT JOIN t2 ON t4.c1 = t2.c1 AND t4.c2 = t2.c2 WHERE t3.c3 = 'production' AND t4.state = 'ACTIVE' GROUP BY t4.c3, t4.c1, t4.c2) AS ip_products ON t4.c3 = ip_products.c3 LEFT JOIN t5 ON i.id = t5.c1 AND t5.c2 = 'production' WHERE t4.state = 'ACTIVE' AND t5.c1 IS NULL GROUP BY i.id, ip_products.products HAVING FIND_IN_SET('info', products) ORDER BY i.id ASC LIMIT 500 OFFSET 5500;",
        "Plan": [
          "TopN 8.00 root  test.t1.id, offset:5500, count:500",
          "└─HashAgg 8.00 root  group by:Column#18, test.t1.id, funcs:firstrow(test.t1.id)->test.t1.id, funcs:firstrow(Column#18)->Column#18",
          "  └─Selection 8.00 root  isnull(test.t5.c1)",
          "    └─Projection 10.00 root  test.t1.id, Column#18, test.t5.c1",
          "      └─HashJoin 10.00 root  inner join, equal:[eq(test.t4.c3, test.t4.c3)]",
          "        ├─Selection(Build) 6.40 root  find_in_set(\"info\", Column#18)",
          "        │ └─HashAgg 8.00 root  group by:test.t4.c1, test.t4.c2, test.t4.c3, funcs:group_concat(distinct test.t2.c3 order by test.t2.c3 separator \",\")->Column#18, funcs:firstrow(test.t4.c3)->test.t4.c3",
          "        │   └─IndexHashJoin 15.62 root  left outer join, inner:TableReader, left side:IndexHashJoin, outer key:test.t4.c1, test.t4.c2, inner key:test.t2.c1, test.t2.c2, equal cond:eq(test.t4.c1, test.t2.c1), eq(test.t4.c2, test.t2.c2)",
          "        │     ├─IndexHashJoin(Build) 12.50 root  inner join, inner:TableReader, outer key:test.t3.c1, test.t3.c2, inner key:test.t4.c1, test.t4.c2, equal cond:eq(test.t3.c1, test.t4.c1), eq(test.t3.c2, test.t4.c2)",
          "        │     │ ├─IndexReader(Build) 10.00 root  index:IndexRangeScan",
          "        │     │ │ └─IndexRangeScan 10.00 cop[tikv] table:t3, index:c3(c3) range:[\"production\",\"production\"], keep order:false, stats:pseudo",
          "        │     │ └─TableReader(Probe) 12.50 root  data:Selection",
          "        │     │   └─Selection 12.50 cop[tikv]  eq(test.t4.state, \"ACTIVE\")",
          "        │     │     └─TableRangeScan 12500.00 cop[tikv] table:t4 range: decided by [eq(test.t4.c1, test.t3.c1) eq(test.t4.c2, test.t3.c2)], keep order:false, stats:pseudo",
          "        │     └─TableReader(Probe) 15.62 root  data:TableRangeScan",
          "        │       └─TableRangeScan 15.62 cop[tikv] table:t2 range: decided by [eq(test.t2.c1, test.t4.c1) eq(test.t2.c2, test.t4.c2)], keep order:false, stats:pseudo",
          "        └─IndexJoin(Probe) 12.50 root  left outer join, inner:TableReader, left side:IndexJoin, outer key:test.t1.id, inner key:test.t5.c1, equal cond:eq(test.t1.id, test.t5.c1)",
          "          ├─IndexJoin(Build) 12.50 root  inner join, inner:TableReader, outer key:test.t4.c3, inner key:test.t1.id, equal cond:eq(test.t4.c3, test.t1.id)",
          "          │ ├─TableReader(Build) 10.00 root  data:Selection",
          "          │ │ └─Selection 10.00 cop[tikv]  eq(test.t4.state, \"ACTIVE\")",
          "          │ │   └─TableFullScan 10000.00 cop[tikv] table:t4 keep order:false, stats:pseudo",
          "          │ └─TableReader(Probe) 10.00 root  data:TableRangeScan",
          "          │   └─TableRangeScan 10.00 cop[tikv] table:i range: decided by [eq(test.t1.id, test.t4.c3)], keep order:false, stats:pseudo",
          "          └─TableReader(Probe) 0.01 root  data:Selection",
          "            └─Selection 0.01 cop[tikv]  eq(test.t5.c2, \"production\")",
          "              └─TableRangeScan 12.50 cop[tikv] table:t5 range: decided by [eq(test.t5.c1, test.t1.id) eq(test.t5.c2, production)], keep order:false, stats:pseudo"
        ],
        "Result": null,
        "LastPlanFromCache": [
          "0"
        ],
        "Warning": [
          "Warning 1105 Scalar function 'find_in_set'(signature: FindInSet, return type: bigint(3)) is not supported to push down to tiflash now.",
          "Warning 1105 Scalar function 'find_in_set'(signature: FindInSet, return type: bigint(3)) is not supported to push down to tiflash now.",
          "Warning 1105 Scalar function 'find_in_set'(signature: FindInSet, return type: bigint(3)) is not supported to push down to tiflash now."
        ]
      },
      {
        "SQL": "with cte_81 ( col_108 ) AS ( select    space( 2 ) as r0 from t7c899916 where t7c899916.col_44 = '[17764220206423580415]' and t7c899916.col_44 != '[5725396597060626308,5860284933591136807,11766074999769332834,11879855656810383243]' order by r0 limit 385374223 ) ( select 1,col_108 from cte_81 where cte_81.col_108 = null or cte_81.col_108 in ( '^w#txObGH*=J*Jn5kq' ,'+PzzjiWQ7y&PQV' ,'=%4C7Oain' )   )",
        "Plan": [
          "Projection 6400.00 root  1->Column#28, Column#27",
          "└─Selection 6400.00 root  in(Column#27, \"^w#txObGH*=J*Jn5kq\", \"+PzzjiWQ7y&PQV\", \"=%4C7Oain\")",
          "  └─Projection 8000.00 root    ->Column#27",
          "    └─Limit 8000.00 root  offset:0, count:385374223",
          "      └─TableReader 8000.00 root  data:Limit",
          "        └─Limit 8000.00 cop[tikv]  offset:0, count:385374223",
          "          └─Selection 8000.00 cop[tikv]  eq(test.t7c899916.col_44, cast(\"[17764220206423580415]\", json BINARY)), ne(test.t7c899916.col_44, cast(\"[5725396597060626308,5860284933591136807,11766074999769332834,11...(len:83)\", json BINARY))",
          "            └─TableFullScan 10000.00 cop[tikv] table:t7c899916 keep order:false, stats:pseudo"
        ],
        "Result": null,
        "LastPlanFromCache": [
          "0"
        ],
        "Warning": null
      },
      {
        "SQL": "select * from (select col_47 from t7c899916 limit 1) t where col_47 in ('2034-05-27', '2001-06-27') and col_47 in (null, '1996-06-27');",
        "Plan": [
          "TableDual 0.00 root  rows:0"
        ],
        "Result": null,
        "LastPlanFromCache": [
          "0"
        ],
        "Warning": null
      },
      {
        "SQL": "with cte_263 ( col_1350,col_1351,col_1352 ) AS ( select /*+ read_from_storage(tiflash[ tad03b424,tlfdfece63 ]) */ /*+ use_index_merge( tlfdfece63,tad03b424 ) */ /*+ merge_join( tlfdfece63 , tad03b424 */ rpad( tad03b424.col_44 , 6 , tad03b424.col_48 ) as r0 , insert( tlfdfece63.col_44 , 0 , 10 , tlfdfece63.col_43 ) as r1 , tad03b424.col_41 as r2 from tlfdfece63 , tad03b424 where not( tlfdfece63.col_42 = '[\"Sl9DRlDnSdIOxbfequ02VeikDWiphuDO6suBf0F7esJeCWrRJWQbd3BK3vT58Coz\",\"MmC5saHdTUqosY50IrxprAR52oD08XgGhqJCcYeoaDJKrYxBdbi0QuVDDArCghyL\"]' ) order by r0,r1,r2 limit 348170821 ) ( select 1,col_1350,col_1351,col_1352 from cte_263 where not( cte_263.col_1352 != '2020-06-30' ) and cte_263.col_1352 in ( null ,'1983-08-09' ) order by 1,2,3,4  );",
        "Plan": [
          "Projection 0.00 root  1->Column#48, Column#46, Column#47, test.tad03b424.col_41",
          "└─TableDual 0.00 root  rows:0"
        ],
        "Result": null,
        "LastPlanFromCache": [
          "0"
        ],
        "Warning": [
          "Warning 1815 No available path for table test.tlfdfece63 with the store type tiflash of the hint /*+ read_from_storage */, please check the status of the table replica and variable value of tidb_isolation_read_engines(map[0:{} 1:{} 2:{}])",
          "Warning 1815 No available path for table test.tad03b424 with the store type tiflash of the hint /*+ read_from_storage */, please check the status of the table replica and variable value of tidb_isolation_read_engines(map[0:{} 1:{} 2:{}])",
          "Warning 1815 No available path for table test.tlfdfece63 with the store type tiflash of the hint /*+ read_from_storage */, please check the status of the table replica and variable value of tidb_isolation_read_engines(map[0:{} 1:{} 2:{}])",
          "Warning 1815 No available path for table test.tad03b424 with the store type tiflash of the hint /*+ read_from_storage */, please check the status of the table replica and variable value of tidb_isolation_read_engines(map[0:{} 1:{} 2:{}])",
          "Warning 8066 Optimizer hint can only be followed by certain keywords like SELECT, INSERT, etc.",
          "Warning 8066 Optimizer hint can only be followed by certain keywords like SELECT, INSERT, etc."
        ]
      },
      {
        "SQL": "select * from t6 where  (a, b, c) in ((1, 1, 1), (2, 2, 2))",
        "Plan": [
          "IndexLookUp 1.00 root  ",
          "├─IndexRangeScan(Build) 1.25 cop[tikv] table:t6, index:a(a, b) range:[1 1,1 1], [2 2,2 2], keep order:false, stats:pseudo",
          "└─Selection(Probe) 1.00 cop[tikv]  or(and(eq(test.t6.a, 1), and(eq(test.t6.b, 1), eq(test.t6.c, 1))), and(eq(test.t6.a, 2), and(eq(test.t6.b, 2), eq(test.t6.c, 2))))",
          "  └─TableRowIDScan 1.25 cop[tikv] table:t6 keep order:false, stats:pseudo"
        ],
        "Result": [
          "1 1 1 1"
        ],
        "LastPlanFromCache": [
          "1"
        ],
        "Warning": null
      },
      {
        "SQL": "SELECT column_1, column_2, column_3, column_4, column_5, column_6 FROM ISSUE64263 WHERE column_3 = 'M 5 9 2 9 2 5 4 6 8 4 9' AND (column_2 IN (1) OR column_4 = 121092106) ORDER BY column_6 DESC, column_1 DESC LIMIT 1000;",
        "Plan": [
          "TopN 1.00 root  test.issue64263.column_6:desc, test.issue64263.column_1:desc, offset:0, count:1000",
          "└─IndexLookUp 1.00 root  ",
          "  ├─IndexRangeScan(Build) 10.00 cop[tikv] table:ISSUE64263, index:idx_3_2(column_3, column_2) range:[\"\\x00M\\x00 \\x005\\x00 \\x009\\x00 \\x002\\x00 \\x009\\x00 \\x002\\x00 \\x005\\x00 \\x004\\x00 \\x006\\x00 \\x008\\x00 \\x004\\x00 \\x009\",\"\\x00M\\x00 \\x005\\x00 \\x009\\x00 \\x002\\x00 \\x009\\x00 \\x002\\x00 \\x005\\x00 \\x004\\x00 \\x006\\x00 \\x008\\x00 \\x004\\x00 \\x009\"], keep order:false, stats:pseudo",
          "  └─TopN(Probe) 1.00 cop[tikv]  test.issue64263.column_6:desc, test.issue64263.column_1:desc, offset:0, count:1000",
          "    └─Selection 1.00 cop[tikv]  or(eq(test.issue64263.column_2, 1), eq(test.issue64263.column_4, 121092106))",
          "      └─TableRowIDScan 10.00 cop[tikv] table:ISSUE64263 keep order:false, stats:pseudo"
        ],
        "Result": null,
        "LastPlanFromCache": [
          "1"
        ],
        "Warning": null
      },
      {
        "SQL": "SELECT STRAIGHT_JOIN * FROM t1 LEFT JOIN t0 ON t1.a = t0.a WHERE t1.a = t0.a OR t1.a = t0.b;",
        "Plan": [
          "HashJoin 12487.50 root  inner join, equal:[eq(test.t1.a, test.t0.a)]",
          "├─TableReader(Build) 9990.00 root  data:Selection",
          "│ └─Selection 9990.00 cop[tikv]  not(isnull(test.t0.a))",
          "│   └─TableFullScan 10000.00 cop[tikv] table:t0 keep order:false, stats:pseudo",
          "└─TableReader(Probe) 9990.00 root  data:Selection",
          "  └─Selection 9990.00 cop[tikv]  not(isnull(test.t1.a))",
          "    └─TableFullScan 10000.00 cop[tikv] table:t1 keep order:false, stats:pseudo"
        ],
        "Result": null,
        "LastPlanFromCache": [
          "1"
        ],
        "Warning": null
      },
      {
        "SQL": "select * from t6 where (a > 1) is null",
        "Plan": [
          "IndexLookUp 10.00 root  ",
          "├─IndexRangeScan(Build) 10.00 cop[tikv] table:t6, index:a(a, b) range:[NULL,NULL], keep order:false, stats:pseudo",
          "└─TableRowIDScan(Probe) 10.00 cop[tikv] table:t6 keep order:false, stats:pseudo"
        ],
        "Result": null,
        "LastPlanFromCache": [
          "0"
        ],
        "Warning": null
      },
      {
        "SQL": "select count(*) from (select ps_t1.id from ps_t2 right join ps_t1 using(id) left join ps_t3 on (ps_t2.c0 = ps_t3.c1)) q",
        "Plan": [
          "HashAgg 1.00 root  funcs:count(1)->Column#13",
          "└─HashJoin 15609.38 root  right outer join, left side:HashJoin, equal:[eq(test.ps_t2.id, test.ps_t1.id)]",
          "  ├─TableReader(Build) 10000.00 root  data:TableFullScan",
          "  │ └─TableFullScan 10000.00 cop[tikv] table:ps_t1 keep order:false, stats:pseudo",
          "  └─HashJoin(Probe) 12487.50 root  left outer join, left side:TableReader, equal:[eq(test.ps_t2.c0, test.ps_t3.c1)]",
          "    ├─TableReader(Build) 9990.00 root  data:Selection",
          "    │ └─Selection 9990.00 cop[tikv]  not(isnull(test.ps_t3.c1))",
          "    │   └─TableFullScan 10000.00 cop[tikv] table:ps_t3 keep order:false, stats:pseudo",
          "    └─TableReader(Probe) 10000.00 root  data:TableFullScan",
          "      └─TableFullScan 10000.00 cop[tikv] table:ps_t2 keep order:false, stats:pseudo"
        ],
        "Result": [
          "1"
        ],
        "LastPlanFromCache": [
          "0"
        ],
        "Warning": null
      },
      {
        "SQL": "select count(*) from (select ps_t1.id from ps_t2 right join ps_t1 using(id) left join ps_t3 on (ps_t2.c0 = ps_t3.c1) where (ps_t2.c2 >= '2024-01-12 08:50:00') union all select ps_t1.id from ps_t2 right join ps_t1 using(id) left join ps_t3 on (ps_t2.c0 = ps_t3.c1) where not (ps_t2.c2 >= '2024-01-12 08:50:00') union all select ps_t1.id from ps_t2 right join ps_t1 using(id) left join ps_t3 on (ps_t2.c0 = ps_t3.c1) where ((ps_t2.c2 >= '2024-01-12 08:50:00') is null)) u",
        "Plan": [
          "HashAgg 1.00 root  funcs:count(1)->Column#38",
          "└─Union 22901.04 root  ",
          "  ├─HashJoin 5208.33 root  inner join, equal:[eq(test.ps_t2.id, test.ps_t1.id)]",
          "  │ ├─HashJoin(Build) 4166.67 root  left outer join, left side:TableReader, equal:[eq(test.ps_t2.c0, test.ps_t3.c1)]",
          "  │ │ ├─TableReader(Build) 3333.33 root  data:Selection",
          "  │ │ │ └─Selection 3333.33 cop[tikv]  ge(test.ps_t2.c2, 2024-01-12 08:50:00.000000)",
          "  │ │ │   └─TableFullScan 10000.00 cop[tikv] table:ps_t2 keep order:false, stats:pseudo",
          "  │ │ └─TableReader(Probe) 9990.00 root  data:Selection",
          "  │ │   └─Selection 9990.00 cop[tikv]  not(isnull(test.ps_t3.c1))",
          "  │ │     └─TableFullScan 10000.00 cop[tikv] table:ps_t3 keep order:false, stats:pseudo",
          "  │ └─TableReader(Probe) 10000.00 root  data:TableFullScan",
          "  │   └─TableFullScan 10000.00 cop[tikv] table:ps_t1 keep order:false, stats:pseudo",
          "  ├─HashJoin 5192.71 root  inner join, equal:[eq(test.ps_t2.id, test.ps_t1.id)]",
          "  │ ├─HashJoin(Build) 4154.17 root  left outer join, left side:TableReader, equal:[eq(test.ps_t2.c0, test.ps_t3.c1)]",
          "  │ │ ├─TableReader(Build) 3323.33 root  data:Selection",
          "  │ │ │ └─Selection 3323.33 cop[tikv]  lt(test.ps_t2.c2, 2024-01-12 08:50:00.000000)",
          "  │ │ │   └─TableFullScan 10000.00 cop[tikv] table:ps_t2 keep order:false, stats:pseudo",
          "  │ │ └─TableReader(Probe) 9990.00 root  data:Selection",
          "  │ │   └─Selection 9990.00 cop[tikv]  not(isnull(test.ps_t3.c1))",
          "  │ │     └─TableFullScan 10000.00 cop[tikv] table:ps_t3 keep order:false, stats:pseudo",
          "  │ └─TableReader(Probe) 10000.00 root  data:TableFullScan",
          "  │   └─TableFullScan 10000.00 cop[tikv] table:ps_t1 keep order:false, stats:pseudo",
          "  └─HashJoin 12500.00 root  left outer join, left side:Selection, equal:[eq(test.ps_t2.c0, test.ps_t3.c1)]",
          "    ├─TableReader(Build) 9990.00 root  data:Selection",
          "    │ └─Selection 9990.00 cop[tikv]  not(isnull(test.ps_t3.c1))",
          "    │   └─TableFullScan 10000.00 cop[tikv] table:ps_t3 keep order:false, stats:pseudo",
          "    └─Selection(Probe) 10000.00 root  isnull(test.ps_t2.c2)",
          "      └─MergeJoin 12500.00 root  right outer join, left side:TableReader, left key:test.ps_t2.id, right key:test.ps_t1.id",
          "        ├─TableReader(Build) 10000.00 root  data:TableFullScan",
          "        │ └─TableFullScan 10000.00 cop[tikv] table:ps_t2 keep order:true, stats:pseudo",
          "        └─TableReader(Probe) 10000.00 root  data:TableFullScan",
          "          └─TableFullScan 10000.00 cop[tikv] table:ps_t1 keep order:true, stats:pseudo"
        ],
        "Result": [
          "1"
        ],
        "LastPlanFromCache": [
          "0"
        ],
        "Warning": null
      }
    ]
  }
]
