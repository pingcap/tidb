[
  {
    "Name": "TestWindowPushDownPlans",
    "Cases": [
      {
        "SQL": "set @@tidb_enforce_mpp=1",
        "Plan": null,
        "Warn": null
      },
      {
        "SQL": "explain select *, row_number() over () FROM employee -- 1. empty partition",
        "Plan": [
          "TableReader_14 10000.00 root  data:ExchangeSender_13",
          "└─ExchangeSender_13 10000.00 cop[tiflash]  ExchangeType: PassThrough",
          "  └─Window_8 10000.00 cop[tiflash]  row_number()->Column#6 over(rows between current row and current row)",
          "    └─ExchangeReceiver_12 10000.00 cop[tiflash]  ",
          "      └─ExchangeSender_11 10000.00 cop[tiflash]  ExchangeType: PassThrough",
          "        └─TableFullScan_10 10000.00 cop[tiflash] table:employee keep order:false, stats:pseudo"
        ],
        "Warn": null
      },
      {
        "SQL": "explain select *, row_number() over (partition by deptid) FROM employee -- 2. column partition key",
        "Plan": [
          "Shuffle_16 10000.00 root  execution info: concurrency:5, data sources:[TableReader_14]",
          "└─Window_9 10000.00 root  row_number()->Column#6 over(partition by test.employee.deptid rows between current row and current row)",
          "  └─Sort_15 10000.00 root  test.employee.deptid",
          "    └─TableReader_14 10000.00 root  data:TableFullScan_13",
          "      └─TableFullScan_13 10000.00 cop[tiflash] table:employee keep order:false, stats:pseudo"
        ],
        "Warn": [
          "MPP mode may be blocked because operator `Sort` is not supported now."
        ]
      },
      {
        "SQL": "explain select *, row_number() over (partition by deptid+1) FROM employee -- 3. expression partition key",
        "Plan": [
          "Projection_6 10000.00 root  test.employee.empid, test.employee.deptid, test.employee.salary, Column#7",
          "└─TableReader_16 10000.00 root  data:ExchangeSender_15",
          "  └─ExchangeSender_15 10000.00 cop[tiflash]  ExchangeType: PassThrough",
          "    └─Window_8 10000.00 cop[tiflash]  row_number()->Column#7 over(partition by Column#6 rows between current row and current row)",
          "      └─Sort_14 10000.00 cop[tiflash]  Column#6",
          "        └─ExchangeReceiver_13 10000.00 cop[tiflash]  ",
          "          └─ExchangeSender_12 10000.00 cop[tiflash]  ExchangeType: HashPartition, Hash Cols: [name: Column#6, collate: N/A]",
          "            └─Projection_10 10000.00 cop[tiflash]  test.employee.empid, test.employee.deptid, test.employee.salary, plus(test.employee.deptid, 1)->Column#6",
          "              └─TableFullScan_11 10000.00 cop[tiflash] table:employee keep order:false, stats:pseudo"
        ],
        "Warn": null
      },
      {
        "SQL": "explain select *, row_number() over (partition by deptid ORDER BY salary desc) FROM employee -- 4. with sort key",
        "Plan": [
          "Shuffle_16 10000.00 root  execution info: concurrency:5, data sources:[TableReader_14]",
          "└─Window_9 10000.00 root  row_number()->Column#6 over(partition by test.employee.deptid order by test.employee.salary desc rows between current row and current row)",
          "  └─Sort_15 10000.00 root  test.employee.deptid, test.employee.salary:desc",
          "    └─TableReader_14 10000.00 root  data:TableFullScan_13",
          "      └─TableFullScan_13 10000.00 cop[tiflash] table:employee keep order:false, stats:pseudo"
        ],
        "Warn": [
          "MPP mode may be blocked because operator `Sort` is not supported now."
        ]
      },
      {
        "SQL": "explain select *, min(deptid) over w, max(deptid) over w from employee window w as (partition by deptid) -- 5. same kinds, multi function, same window",
        "Plan": [
          "Shuffle_16 10000.00 root  execution info: concurrency:5, data sources:[TableReader_14]",
          "└─Window_9 10000.00 root  min(test.employee.deptid)->Column#7, max(test.employee.deptid)->Column#8 over(partition by test.employee.deptid)",
          "  └─Sort_15 10000.00 root  test.employee.deptid",
          "    └─TableReader_14 10000.00 root  data:TableFullScan_13",
          "      └─TableFullScan_13 10000.00 cop[tiflash] table:employee keep order:false, stats:pseudo"
        ],
        "Warn": [
          "MPP mode may be blocked because operator `Sort` is not supported now."
        ]
      },
      {
        "SQL": "explain select *, row_number() over w, max(deptid) over w from employee window w as (partition by deptid) -- 6. different kinds, multi funcitons, same window",
        "Plan": [
          "Projection_8 10000.00 root  test.employee.empid, test.employee.deptid, test.employee.salary, Column#8, Column#7",
          "└─Window_11 10000.00 root  row_number()->Column#8 over(partition by test.employee.deptid rows between current row and current row)",
          "  └─Window_21 10000.00 root  max(test.employee.deptid)->Column#7 over(partition by test.employee.deptid)",
          "    └─Sort_19 10000.00 root  test.employee.deptid",
          "      └─TableReader_18 10000.00 root  data:TableFullScan_17",
          "        └─TableFullScan_17 10000.00 cop[tiflash] table:employee keep order:false, stats:pseudo"
        ],
        "Warn": [
          "MPP mode may be blocked because operator `Sort` is not supported now."
        ]
      }
    ]
  }
]
