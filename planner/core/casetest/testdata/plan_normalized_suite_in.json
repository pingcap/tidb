[
	{
		"name": "TestNormalizedPlan",
		"cases": [
			"select * from t1;",
			"select * from t1 where a<1;",
			"select * from t1 where a>1",
			"select * from t1 where a=1",
			"select * from t1 where a in (1,2,3)",
			"select * from t1 where b=1",
			"select a+1,b+2 from t1 use index(b) where b=3",
			"select * from t1 where t1.b > 1 and  t1.a in (select sum(t2.b) from t2 where t2.a=t1.a and t2.b is not null)",
			"SELECT * from t1 where a!=1 order by c limit 1",
			"SELECT /*+ TIDB_SMJ(t1, t2) */ * from t1, t2 where t1.a = t2.a and t1.c>1;",
			"SELECT /*+ TIDB_INLJ(t1, t2) */ * from t1, t2 where t1.a = t2.a and t1.c>1;",
			"SELECT /*+ TIDB_HJ(t1, t2) */ * from t1, t2 where t1.a = t2.a and t1.c>1;",
			"SELECT /*+ TIDB_HJ(t1, t2) */ * from t1, t2 where t1.a = t2.a and t1.c>1;",
			"SELECT /*+ TIDB_INLJ(t1, t2) */ * from t1, t2 where t1.a = t2.a and t1.c>1;",
			"select count(1) as num,a from t1 where a=1 group by a union select count(1) as num,a from t1 where a=3 group by a;",
			"insert into t1 values (1,1,1)",
			"insert into t1 select * from t2 where t2.a>0 and t2.b!=0",
			"update t1 set a=a+1",
			"update t1 set a=a+1 where a>0",
			"delete from t1",
			"delete from t1 where a>0 and b=1 and c!=2",
			"create table t1_tmp (a int)",
			"alter table t1_tmp add column c int",
			"insert into t3 values (4,20),(30,30)",
			"select * from t3 where a=4",
			"select * from t3 where a=30",
			"select * from t4 where a=10",
			"select * from t4 where a=20",
			"update t6 set id=id+1, id3=id2+1 where id = 1",
			"insert into t6 values (1,1,1)",
			"delete from t6",
			"delete from t5 where id > 1",
			"update t5 set id=id+1, id2=id2+1 where id = 1",
			"update t5 set id=id+1, id2=id2+1, id3=id3+1 where id = 1",
			"insert into t5 values (1,1,1) on duplicate key update id = 100, id3=100"
		]
	},
	{
		"name": "TestPreferRangeScan",
		"cases": [
			"select * from test where age=5;",
			"select * from test where age=5;"
		]
	},
	{
		"name": "TestNormalizedPlanForDiffStore",
		"cases": [
			"explain format = 'brief' select /*+ read_from_storage(tiflash[t1]) */ * from t1",
			"explain format = 'brief' select /*+ read_from_storage(tikv[t1]) */ * from t1",
			"explain format = 'brief' select /*+ read_from_storage(tiflash[t1]) */ a+b from t1 where a+b < 1",
			"explain format = 'brief' select /*+ read_from_storage(tikv[t1]) */ a+b from t1 where a+b < 1"
		]
	},
	{
		"name": "TestTiFlashLateMaterialization",
		"cases": [
			"explain select * from t1;",
			"explain select * from t1 where a<1;",
			"explain select * from t1 where a>1",
			"explain select * from t1 where a=1",
			"explain select * from t1 where a in (1,2,3)",
			"explain select * from t1 where b=1",
			"explain select * from t1 where a!=1 order by c limit 1",
			"explain select a from t1 where a>1",
			"explain select a from t1 where a>1 and b>1",
			"explain select * from t1 where a>1 and b>1 and c>1",
			"explain select * from t1 where a<1 or b<2",
			"explain select * from t1 where (a<1 or b<2) and (a>3 and b>3)",
			"explain select * from t1 where (a<1 or b<2) and (a>3 and b>3) and c>1",
			"explain select * from t1 where (a>2 or b<2) and (a>3 and b>3) and c>2"
		]
	},
	{
		"Name": "TestTiFlashLateMaterialization",
		"Cases": [
			{
				"_comment": "No predicate, no predicate push down",
				"SQL": "explain select * from t1;",
				"Plan": [
					" TableReader       root         ",
					" └─ExchangeSender  cop[tiflash] ",
					"   └─TableFullScan cop[tiflash] table:t1, range:[?,?], keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a<1` is 0, so it will be pushed down",
				"SQL": "explain select * from t1 where a<1;",
				"Plan": [
					" TableReader       root         ",
					" └─ExchangeSender  cop[tiflash] ",
					"   └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:lt(test.t1.a, ?), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a>1` is 0.66(< 0.7), so it will be pushed down",
				"SQL": "explain select * from t1 where a>1",
				"Plan": [
					" TableReader       root         ",
					" └─ExchangeSender  cop[tiflash] ",
					"   └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:gt(test.t1.a, ?), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a=1` is 0.33(< 0.7), so it will be pushed down",
				"SQL": "explain select * from t1 where a=1",
				"Plan": [
					" TableReader       root         ",
					" └─ExchangeSender  cop[tiflash] ",
					"   └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:eq(test.t1.a, ?), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a in (1,2,3)` is 1(> 0.7), so it will not be pushed down",
				"SQL": "explain select * from t1 where a in (1,2,3)",
				"Plan": [
					" TableReader         root         ",
					" └─ExchangeSender    cop[tiflash] ",
					"   └─Selection       cop[tiflash] in(test.t1.a, ?, ?, ?)",
					"     └─TableFullScan cop[tiflash] table:t1, range:[?,?], keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `b=1` is 0.33(< 0.7), so it will be pushed down",
				"SQL": "explain select * from t1 where b=1",
				"Plan": [
					" TableReader       root         ",
					" └─ExchangeSender  cop[tiflash] ",
					"   └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:eq(test.t1.b, ?), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a!=1` is 0.66(< 0.7), so it will be pushed down",
				"SQL": "explain select * from t1 where a!=1 order by c limit 1",
				"Plan": [
					" TopN                  root         test.t1.c",
					" └─TableReader         root         ",
					"   └─ExchangeSender    cop[tiflash] ",
					"     └─TopN            cop[tiflash] test.t1.c",
					"       └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:ne(test.t1.a, ?), keep order:false"
				]
			},
			{
				"_comment": "The `a>1` applied columns eaual to the columns of table scan, so it will be not pushed down",
				"SQL": "explain select a from t1 where a>1",
				"Plan": [
					" TableReader         root         ",
					" └─ExchangeSender    cop[tiflash] ",
					"   └─Selection       cop[tiflash] gt(test.t1.a, ?)",
					"     └─TableFullScan cop[tiflash] table:t1, range:[?,?], keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a>1` and `b>1` both are 0.66(< 0.7), so push one of them down",
				"SQL": "explain select a from t1 where a>1 and b>1",
				"Plan": [
					" TableReader           root         ",
					" └─ExchangeSender      cop[tiflash] ",
					"   └─Projection        cop[tiflash] test.t1.a",
					"     └─Selection       cop[tiflash] gt(test.t1.b, ?)",
					"       └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:gt(test.t1.a, ?), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a>1`, `b>1` and `c>1` all are 0.66(< 0.7), so push one of them down",
				"SQL": "explain select * from t1 where a>1 and b>1 and c>1",
				"Plan": [
					" TableReader         root         ",
					" └─ExchangeSender    cop[tiflash] ",
					"   └─Selection       cop[tiflash] gt(test.t1.a, ?), gt(test.t1.b, ?)",
					"     └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:gt(test.t1.c, ?), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a<1 or b<2` is 0.66(< 0.7), so push it down",
				"SQL": "explain select * from t1 where a<1 or b<2",
				"Plan": [
					" TableReader       root         ",
					" └─ExchangeSender  cop[tiflash] ",
					"   └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:or(lt(test.t1.a, ?), lt(test.t1.b, ?)), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a>3` is 0(< 0.7), so push it down",
				"SQL": "explain select * from t1 where (a<1 or b<2) and (a>3 and b>3)",
				"Plan": [
					" TableReader         root         ",
					" └─ExchangeSender    cop[tiflash] ",
					"   └─Selection       cop[tiflash] gt(test.t1.b, ?), or(lt(test.t1.a, ?), lt(test.t1.b, ?))",
					"     └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:gt(test.t1.a, ?), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a>3` is 0(< 0.7), so push it down",
				"SQL": "explain select * from t1 where (a<1 or b<2) and (a>3 and b>3) and c>1",
				"Plan": [
					" TableReader         root         ",
					" └─ExchangeSender    cop[tiflash] ",
					"   └─Selection       cop[tiflash] gt(test.t1.b, ?), or(lt(test.t1.a, ?), lt(test.t1.b, ?)), gt(test.t1.c, ?)",
					"     └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:gt(test.t1.a, ?), keep order:false"
				]
			},
			{
				"_comment": "The selectivity of `a>3` is 0(< 0.7), so push it down",
				"SQL": "explain select * from t1 where (a>2 or b<2) and (a>3 and b>3) and c>2",
				"Plan": [
					" TableReader         root         ",
					" └─ExchangeSender    cop[tiflash] ",
					"   └─Selection       cop[tiflash] gt(test.t1.b, ?), gt(test.t1.c, ?), or(gt(test.t1.a, ?), lt(test.t1.b, ?))",
					"     └─TableFullScan cop[tiflash] table:t1, range:[?,?], pushed down filter:gt(test.t1.a, ?), keep order:false"
				]
			}
		]
	}
]