# prepare database
create database collation_diff;
use collation_diff;

create table t1(a varchar(20) charset utf8);
insert into t1 values ("t1_value");
alter table t1 collate uTf8mB4_uNiCoDe_Ci charset Utf8mB4 charset uTF8Mb4 collate UTF8MB4_BiN;
alter table t1 modify column a varchar(20) charset utf8mb4;
select * from t1;
create table t(a varchar(20) charset latin1);
insert into t values ("t_value");
alter table t modify column a varchar(20) charset latin1;
select * from t;
--error 8200
alter table t modify column a varchar(20) charset utf8;
--error 8200
alter table t modify column a varchar(20) charset utf8mb4;
--error 8200
alter table t modify column a varchar(20) charset utf8 collate utf8_bin;
--error 8200
alter table t modify column a varchar(20) charset utf8mb4 collate utf8mb4_general_ci;
--error 1273
alter table t modify column a varchar(20) charset utf8mb4 collate utf8bin;
--error 1302, 1273
alter table t collate LATIN1_GENERAL_CI charset utf8 collate utf8_bin;
--error 1253, 1273
alter table t collate LATIN1_GENERAL_CI collate UTF8MB4_UNICODE_ci collate utf8_bin;

# pointGet
drop table if exists t;
create table t(a char(2), b char(2), index idx_1(a));
insert into t values("aa", "bb");
set @@sql_mode="";
select * from t where a = "aa";
select * from t where a = "aab";
# Test query with table alias
select * from t tmp where a = "aa";
select * from t tmp where a = "aab";
truncate table t;
insert into t values("a ", "b ");
set @@sql_mode="";
select * from t where a = "a";
select * from t where a = "a ";
select * from t where a = "a  ";
drop table if exists t;
create table t(a char(2) binary, b char(2), index idx_1(a));
insert into t values("  ", "  ");
insert into t values("a ", "b ");
set @@sql_mode="";
select * from t where a = "a";
select * from t where a = "a ";
select * from t where a = "a  ";
select * from t where a = "";
select * from t where a = " ";
select * from t where a = "  ";
select * from t where a = "   ";

# pointGet PK
drop table if exists t;
create table t(a char(2) primary key, b char(2));
insert into t values("aa", "bb");
set @@sql_mode="";
select * from t tmp where a = "aa";
select * from t tmp where a = "aab";
truncate table t;
insert into t values("a ", "b ");
set @@sql_mode="";
select * from t tmp where a = "a";
select * from t tmp where a = "a ";
select * from t tmp where a = "a  ";
# Test CHAR BINARY.
drop table if exists t;
create table t(a char(2) binary primary key, b char(2));
insert into t values("  ", "  ");
insert into t values("a ", "b ");
set @@sql_mode="";
select * from t tmp where a = "a";
select * from t tmp where a = "a ";
select * from t tmp where a = "a  ";
select * from t tmp where a = "";
select * from t tmp where a = "  ";
select * from t tmp where a = "   ";
# Test both wildcard and column name exist in select field list
set @@sql_mode="";
drop table if exists t;
create table t(a char(2) primary key, b char(2));
insert into t values("aa", "bb");
select *, a from t tmp where a = "aa";
# Test using table alias in field list
select tmp.* from t tmp where a = "aa";
select tmp.a, tmp.b from t tmp where a = "aa";
select tmp.*, tmp.a, tmp.b from t tmp where a = "aa";
select tmp.* from t tmp where a = "aab";
select tmp.a, tmp.b from t tmp where a = "aab";
select tmp.*, tmp.a, tmp.b from t tmp where a = "aab";
select tmp.*, tmp.a, tmp.b from t tmp where a = "aab";
# Test using table alias in where clause
select * from t tmp where tmp.a = "aa";
select a, b from t tmp where tmp.a = "aa";
select *, a, b from t tmp where tmp.a = "aa";
# Unknown table name in where clause and field list
--error 1054
select a from t where xxxxx.a = "aa";
--error 1054
select xxxxx.a from t where a = "aa";
# When an alias is provided, it completely hides the actual name of the table.
--error 1054
select a from t tmp where t.a = "aa";
--error 1054
select t.a from t tmp where a = "aa";
--error 1051
select t.* from t tmp where a = "aa";


# TestCharsetDatabase
create database if not exists cd_test_utf8 CHARACTER SET utf8 COLLATE utf8_bin;
--error 1273
create database if not exists cd_test_latin1 CHARACTER SET latin1 COLLATE latin1_swedish_ci;
use cd_test_utf8;
select @@character_set_database;
select @@collation_database;
--error 1049
use cd_test_latin1;
select @@character_set_database;
select @@collation_database;

use test
