CREATE TABLE `t0` (
  `id` bigint NOT NULL,
  `k0` varchar(64) NOT NULL,
  `k1` varchar(64) NOT NULL,
  `k2` date NOT NULL,
  `k3` bigint NOT NULL,
  `p0` double NOT NULL,
  `p1` tinyint(1) NOT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */,
  KEY `idx_k2_4` (`k2`),
  KEY `idx_k1_14` (`k1`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
CREATE TABLE `t1` (
  `id` bigint NOT NULL,
  `k0` varchar(64) NOT NULL,
  `d0` datetime NOT NULL,
  `d1` varchar(64) NOT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
CREATE TABLE `t3` (
  `id` bigint NOT NULL,
  `k2` date NOT NULL,
  `k0` varchar(64) NOT NULL,
  `d0` date NOT NULL,
  `d1` double NOT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */,
  KEY `idx_k2_7` (`k2`),
  KEY `idx_id_15` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
INSERT INTO `t3` (`id`, `k2`, `k0`, `d0`, `d1`) VALUES (1, '2023-12-13', 's137', '2026-08-01', 98.26), (2, '2025-12-24', 's175', '2026-06-17', 53.6), (3, '2026-12-14', 's295', '2023-04-27', 28.78), (5, '2024-12-16', 's807', '2025-09-01', 99.04), (7, '2024-06-05', 's295', '2024-03-31', 36.59), (9, '2026-11-25', 's113', '2026-11-03', 60.48), (10, '2023-09-11', 's643', '2023-12-14', 15.19), (4, '2025-02-04', 's175', '2026-01-17', 18.54), (6, '2024-01-16', 's4', '2024-12-04', 43.46), (8, '2024-11-13', 's137', '2024-02-13', 65.4);
INSERT INTO `t0` (`id`, `k0`, `k1`, `k2`, `k3`, `p0`, `p1`) VALUES (1, 's897', 's903', '2023-12-13', 319, 78.52, 0), (2, 's137', 's71', '2025-12-24', 271, 89.6, 0), (3, 's807', 's903', '2026-12-14', 271, 68.15, 0), (4, 's137', 's775', '2025-02-04', 588, 96.6, 1), (5, 's137', 's580', '2025-02-04', 882, 18.26, 0), (6, 's643', 's432', '2023-12-13', 271, 57.59, 0), (7, 's571', 's71', '2025-02-04', 768, 14.09, 1), (8, 's897', 's223', '2024-12-16', 882, 61.54, 0), (9, 's113', 's384', '2023-12-13', 319, 12.17, 1), (10, 's113', 's903', '2026-12-14', 882, 78.12, 0), (11, 's113', 's223', '2024-01-16', 621, 0.21, 0), (12, 's807', 's252', '2024-06-05', 319, 4.48, 1), (13, 's137', 's252', '2024-06-05', 319, 3.51, 0), (14, 's807', 's618', '2026-12-14', 319, 24.61, 1), (15, 's295', 's903', '2025-02-04', 588, 65.14, 1), (16, 's807', 's415', '2024-12-16', 621, 5.3, 1), (17, 's137', 's432', '2023-12-13', 311, 20.22, 0), (18, 's137', 's618', '2024-06-05', 621, 6.14, 1), (19, 's643', 's71', '2024-11-13', 588, 2.07, 0), (20, 's4', 's252', '2024-01-16', 789, 21.17, 1), (21, 's137', 's618', '2024-11-13', 789, 70.9, 0), (22, 's175', 's580', '2025-12-24', 172, 76.62, 1), (23, 's807', 's71', '2024-11-13', 882, 54.34, 0), (24, 's643', 's384', '2024-11-13', 172, 60.75, 1), (25, 's113', 's71', '2024-11-13', 621, 78.76, 1), (26, 's807', 's618', '2024-01-16', 271, 94.8, 0), (27, 's4', 's252', '2026-11-25', 319, 70.53, 1), (28, 's295', 's252', '2026-12-14', 768, 21.62, 0), (29, 's175', 's775', '2024-01-16', 789, 81.86, 0), (30, 's113', 's71', '2024-11-13', 311, 55.32, 1), (31, 's295', 's252', '2025-12-24', 271, 3.26, 1), (32, 's175', 's775', '2026-11-25', 271, 23.62, 0), (33, 's4', 's580', '2024-01-16', 768, 93.9, 0), (34, 's295', 's775', '2025-02-04', 882, 62.9, 1), (35, 's113', 's618', '2026-12-14', 172, 87.22, 0), (36, 's113', 's415', '2023-09-11', 319, 18.14, 0), (37, 's897', 's432', '2024-06-05', 588, 6.1, 0), (38, 's571', 's618', '2024-06-05', 692, 72.07, 0), (39, 's295', 's618', '2024-12-16', 621, 17.06, 0), (40, 's175', 's432', '2024-12-16', 588, 64.33, 1), (41, 's113', 's252', '2024-06-05', 271, 16.28, 1), (42, 's137', 's384', '2026-12-14', 319, 69.87, 0), (43, 's113', 's384', '2026-11-25', 882, 12.49, 1), (44, 's137', 's580', '2023-12-13', 172, 35.42, 1), (45, 's643', 's252', '2023-09-11', 692, 46.15, 0), (46, 's137', 's618', '2026-12-14', 588, 89.36, 1), (47, 's807', 's223', '2025-02-04', 172, 19.71, 0), (48, 's897', 's432', '2024-06-05', 621, 94.07, 1), (49, 's137', 's384', '2025-12-24', 621, 22.81, 0), (50, 's780', 's580', '2023-09-11', 789, 37.44, 1), (51, 's175', 's618', '2024-01-16', 588, 41.89, 1), (52, 's113', 's252', '2025-12-24', 319, 24.37, 0), (53, 's175', 's432', '2024-12-16', 271, 56.51, 1), (54, 's807', 's903', '2026-11-25', 621, 76.34, 0), (55, 's137', 's415', '2024-11-13', 621, 13.85, 0), (56, 's807', 's223', '2024-11-13', 311, 2.91, 1), (57, 's780', 's384', '2024-01-16', 621, 36.69, 0), (58, 's780', 's223', '2024-12-16', 271, 40.79, 0), (59, 's295', 's580', '2024-01-16', 319, 64.37, 1), (60, 's807', 's252', '2026-11-25', 692, 60.17, 0), (61, 's807', 's415', '2024-01-16', 319, 95.83, 0), (62, 's137', 's580', '2025-02-04', 621, 14.37, 1), (63, 's113', 's71', '2025-02-04', 588, 94.59, 0), (64, 's113', 's415', '2024-11-13', 271, 9.47, 0), (65, 's113', 's415', '2023-09-11', 692, 47.4, 1), (66, 's807', 's71', '2026-12-14', 588, 60.82, 0), (67, 's643', 's580', '2026-12-14', 311, 73.03, 1), (68, 's643', 's775', '2024-12-16', 319, 7.91, 0), (69, 's137', 's618', '2025-02-04', 311, 16.67, 1), (70, 's4', 's71', '2025-12-24', 621, 93.35, 1), (71, 's4', 's618', '2026-11-25', 271, 94.86, 0), (72, 's113', 's223', '2024-11-13', 311, 80.02, 1), (73, 's4', 's903', '2026-12-14', 621, 34.31, 0), (74, 's807', 's432', '2023-12-13', 311, 33.56, 1), (75, 's643', 's903', '2024-11-13', 271, 74.23, 1), (76, 's807', 's618', '2026-11-25', 172, 37.93, 0), (77, 's295', 's71', '2024-11-13', 319, 64.68, 1), (78, 's4', 's432', '2024-01-16', 789, 69.43, 0), (79, 's137', 's415', '2026-11-25', 692, 28.07, 0), (80, 's295', 's432', '2024-12-16', 172, 99.68, 0);
INSERT INTO `t1` (`id`, `k0`, `d0`, `d1`) VALUES (6, 's113', '2023-09-13 14:56:36', 's235'), (8, 's4', '2025-03-29 17:48:45', 's837'), (10, 's780', '2023-03-31 13:49:50', 's244'), (1, 's897', '2024-09-13 05:11:12', 's52'), (4, 's643', '2024-04-14 17:29:28', 's107'), (5, 's571', '2024-03-17 16:19:14', 's89'), (7, 's295', '2026-12-19 00:03:06', 's261'), (9, 's175', '2025-07-18 10:03:25', 's558'), (2, 's137', '2024-08-24 07:30:01', 's998'), (3, 's807', '2025-04-02 00:51:58', 's213');
SELECT DISTINCT AVG(v2.g0) OVER (PARTITION BY t1.d0 ORDER BY v1.c0 DESC, t1.d1 DESC) AS c0 FROM t3 RIGHT JOIN v4 ON (1 = 0) LEFT JOIN v2 ON (1 = 0) LEFT JOIN v3 ON (1 = 0) LEFT JOIN t1 ON ((t3.k0 = t1.k0) AND NOT (v4.c1 IN ('s15', 's68'))) JOIN v1 ON (1 = 0) WHERE NOT EXISTS (SELECT v2.g0 AS c0 FROM v2 WHERE (v2.g1 IN ((SELECT t0.k0 AS c0 FROM t0 WHERE (t0.id = v2.cnt))))) ORDER BY AVG(v2.g0) OVER (PARTITION BY t1.d0 ORDER BY v1.c0 DESC, t1.d1 DESC) DESC;
