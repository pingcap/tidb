WITH cte_0 AS (SELECT t0.k3 AS c0, t0.k1 AS c1, t0.k2 AS c2 FROM t0 WHERE (t0.k0 >= t0.p1) ORDER BY t0.id LIMIT 2), cte_1 AS (SELECT t0.p1 AS c0, t0.k0 AS c1, t0.p0 AS c2 FROM t0 WHERE ((t0.k0 <= t0.p1) OR ((t0.k2 <=> t0.p1) AND (t0.k1 >= t0.p0))) ORDER BY t0.id LIMIT 7), cte_2 AS (SELECT cte_0.c2 AS c0, cte_0.c1 AS c1, cte_0.c0 AS c2 FROM cte_0 WHERE NOT (cte_0.c2 IN (83, 7)) ORDER BY cte_0.c0 LIMIT 6) SELECT SUM(cte_1.c0) OVER (PARTITION BY t4.d0 ORDER BY cte_1.c0) AS c0, ROW_NUMBER() OVER (ORDER BY t2.k1) AS c1 FROM t0 LEFT JOIN t1 ON ((t0.k0 = t1.k0) AND ((t0.k0 > t1.k0) AND (t0.k0 > t1.k0))) LEFT JOIN t4 ON ((t0.k0 = t4.k0) AND ((t0.k0 > t4.k0) AND (t1.k0 <=> t4.k0))) RIGHT JOIN t2 ON ((t0.k0 = t2.k0) AND NOT (t0.k0 IN (71, 67, 77))) LEFT JOIN cte_0 ON (1 = 0) JOIN cte_1 ON (1 = 0) RIGHT JOIN cte_2 ON (1 = 0) WHERE NOT EXISTS (SELECT COUNT(1) AS cnt FROM t4 WHERE ((t4.k0 = t0.k0) AND (t4.k0 != t0.k0)) ORDER BY COUNT(1) DESC LIMIT 8) ORDER BY t2.id, cte_1.c1;
