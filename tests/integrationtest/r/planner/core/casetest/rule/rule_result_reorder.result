set tidb_cost_model_version=2;
set tidb_opt_limit_push_down_threshold=0;
set tidb_enable_ordered_result_mode=1;
drop table if exists t;
create table t (a int primary key, b int, c int, d int, key(b));
explain format='plan_tree' select * from t use index(primary);
id	task	access object	operator info
TableReader	root		data:TableFullScan
└─TableFullScan	cop[tikv]	table:t	keep order:true, stats:pseudo
explain format='plan_tree' select b from t use index(b);
id	task	access object	operator info
IndexReader	root		index:IndexFullScan
└─IndexFullScan	cop[tikv]	table:t, index:b(b)	keep order:true, stats:pseudo
explain format='plan_tree' select a, b from t use index(b);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t.a
└─IndexReader	root		index:IndexFullScan
  └─IndexFullScan	cop[tikv]	table:t, index:b(b)	keep order:false, stats:pseudo
explain format='plan_tree' select b, c from t use index(b);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t.b, planner__core__casetest__rule__rule_result_reorder.t.c
└─IndexLookUp	root		
  ├─IndexFullScan(Build)	cop[tikv]	table:t, index:b(b)	keep order:false, stats:pseudo
  └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' select b, c from t use index(primary);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t.b, planner__core__casetest__rule__rule_result_reorder.t.c
└─TableReader	root		data:TableFullScan
  └─TableFullScan	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' select min(b), max(c) from t use index(primary) group by d;
id	task	access object	operator info
Sort	root		Column, Column
└─HashAgg	root		group by:planner__core__casetest__rule__rule_result_reorder.t.d, funcs:min(Column)->Column, funcs:max(Column)->Column
  └─TableReader	root		data:HashAgg
    └─HashAgg	cop[tikv]		group by:planner__core__casetest__rule__rule_result_reorder.t.d, funcs:min(planner__core__casetest__rule__rule_result_reorder.t.b)->Column, funcs:max(planner__core__casetest__rule__rule_result_reorder.t.c)->Column
      └─TableFullScan	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' select min(b), max(c) from t use index(primary) group by a;
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t.b, planner__core__casetest__rule__rule_result_reorder.t.c
└─TableReader	root		data:TableFullScan
  └─TableFullScan	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' select * from t use index(b) limit 10;
id	task	access object	operator info
TopN	root		planner__core__casetest__rule__rule_result_reorder.t.a, offset:0, count:10
└─IndexLookUp	root		
  ├─TopN(Build)	cop[tikv]		planner__core__casetest__rule__rule_result_reorder.t.a, offset:0, count:10
  │ └─IndexFullScan	cop[tikv]	table:t, index:b(b)	keep order:false, stats:pseudo
  └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' select * from t use index(primary) limit 10;
id	task	access object	operator info
Limit	root		offset:0, count:10
└─TableReader	root		data:Limit
  └─Limit	cop[tikv]		offset:0, count:10
    └─TableFullScan	cop[tikv]	table:t	keep order:true, stats:pseudo
explain format='plan_tree' select b from t use index(b) order by b;
id	task	access object	operator info
IndexReader	root		index:IndexFullScan
└─IndexFullScan	cop[tikv]	table:t, index:b(b)	keep order:true, stats:pseudo
explain format='plan_tree' select b, c, d from t use index(b) order by b;
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t.b, planner__core__casetest__rule__rule_result_reorder.t.c, planner__core__casetest__rule__rule_result_reorder.t.d
└─IndexLookUp	root		
  ├─IndexFullScan(Build)	cop[tikv]	table:t, index:b(b)	keep order:false, stats:pseudo
  └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' select t1.a, t2.a from t t1, t t2 where t1.a=t2.a;
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t.a, planner__core__casetest__rule__rule_result_reorder.t.a
└─MergeJoin	root		inner join, left key:planner__core__casetest__rule__rule_result_reorder.t.a, right key:planner__core__casetest__rule__rule_result_reorder.t.a
  ├─TableReader(Build)	root		data:TableFullScan
  │ └─TableFullScan	cop[tikv]	table:t2	keep order:true, stats:pseudo
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:true, stats:pseudo
explain format='plan_tree' select b from t where a>0;
id	task	access object	operator info
Projection	root		planner__core__casetest__rule__rule_result_reorder.t.b
└─TableReader	root		data:TableRangeScan
  └─TableRangeScan	cop[tikv]	table:t	range:(0,+inf], keep order:true, stats:pseudo
explain format='plan_tree' select b from t where a>0 limit 1;
id	task	access object	operator info
Limit	root		offset:0, count:1
└─TableReader	root		data:Limit
  └─Limit	cop[tikv]		offset:0, count:1
    └─TableRangeScan	cop[tikv]	table:t	range:(0,+inf], keep order:true, stats:pseudo
set tidb_enable_ordered_result_mode=1;
drop table if exists t;
create table t (a int primary key, b int, c int, key(b));
explain format='plan_tree' insert into t select * from t;
id	task	access object	operator info
Insert	root		N/A
└─TableReader	root		data:TableFullScan
  └─TableFullScan	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' insert into t select * from t where a>1;
id	task	access object	operator info
Insert	root		N/A
└─TableReader	root		data:TableRangeScan
  └─TableRangeScan	cop[tikv]	table:t	range:(1,+inf], keep order:false, stats:pseudo
explain format='plan_tree' insert into t select t1.a, t2.b, t1.c+t2.c from t t1, t t2 where t1.a=t2.a;
id	task	access object	operator info
Insert	root		N/A
└─Projection	root		planner__core__casetest__rule__rule_result_reorder.t.a, planner__core__casetest__rule__rule_result_reorder.t.b, plus(planner__core__casetest__rule__rule_result_reorder.t.c, planner__core__casetest__rule__rule_result_reorder.t.c)->Column
  └─MergeJoin	root		inner join, left key:planner__core__casetest__rule__rule_result_reorder.t.a, right key:planner__core__casetest__rule__rule_result_reorder.t.a
    ├─TableReader(Build)	root		data:TableFullScan
    │ └─TableFullScan	cop[tikv]	table:t2	keep order:true, stats:pseudo
    └─TableReader(Probe)	root		data:TableFullScan
      └─TableFullScan	cop[tikv]	table:t1	keep order:true, stats:pseudo
explain format='plan_tree' insert into t select min(a), max(b), sum(c) from t group by a;
id	task	access object	operator info
Insert	root		N/A
└─Projection	root		planner__core__casetest__rule__rule_result_reorder.t.a->Column, planner__core__casetest__rule__rule_result_reorder.t.b->Column, cast(planner__core__casetest__rule__rule_result_reorder.t.c, decimal(32,0) BINARY)->Column
  └─TableReader	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' delete from t;
id	task	access object	operator info
Delete	root		N/A
└─IndexReader	root		index:IndexFullScan
  └─IndexFullScan	cop[tikv]	table:t, index:b(b)	keep order:false, stats:pseudo
explain format='plan_tree' delete from t where a>1;
id	task	access object	operator info
Delete	root		N/A
└─TableReader	root		data:TableRangeScan
  └─TableRangeScan	cop[tikv]	table:t	range:(1,+inf], keep order:false, stats:pseudo
explain format='plan_tree' update t set a=a+1;
id	task	access object	operator info
Update	root		N/A
└─TableReader	root		data:TableFullScan
  └─TableFullScan	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='plan_tree' update t set a=a+1 where a>1;
id	task	access object	operator info
Update	root		N/A
└─TableReader	root		data:TableRangeScan
  └─TableRangeScan	cop[tikv]	table:t	range:(1,+inf], keep order:false, stats:pseudo
set tidb_cost_model_version=2;
set tidb_enable_ordered_result_mode=1;
drop table if exists t1;
drop table if exists t2;
create table t1 (a int primary key, b int, c int, d int, key(b));
create table t2 (a int primary key, b int, c int, d int, key(b));
explain format='plan_tree' select * from t1 where t1.a in (select b from t2);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─MergeJoin	root		inner join, left key:planner__core__casetest__rule__rule_result_reorder.t1.a, right key:planner__core__casetest__rule__rule_result_reorder.t2.b
  ├─StreamAgg(Build)	root		group by:planner__core__casetest__rule__rule_result_reorder.t2.b, funcs:firstrow(planner__core__casetest__rule__rule_result_reorder.t2.b)->planner__core__casetest__rule__rule_result_reorder.t2.b
  │ └─IndexReader	root		index:StreamAgg
  │   └─StreamAgg	cop[tikv]		group by:planner__core__casetest__rule__rule_result_reorder.t2.b, 
  │     └─IndexFullScan	cop[tikv]	table:t2, index:b(b)	keep order:true, stats:pseudo
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:true, stats:pseudo
explain format='plan_tree' select * from t1 where t1.a not in (select b from t2);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		Null-aware anti semi join, left side:TableReader, equal:[eq(planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t2.b)]
  ├─IndexReader(Build)	root		index:IndexFullScan
  │ └─IndexFullScan	cop[tikv]	table:t2, index:b(b)	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where t1.a in (select b from t2 where t2.c>t1.c);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		semi join, left side:TableReader, equal:[eq(planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t2.b)], other cond:gt(planner__core__casetest__rule__rule_result_reorder.t2.c, planner__core__casetest__rule__rule_result_reorder.t1.c)
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t2.b)), not(isnull(planner__core__casetest__rule__rule_result_reorder.t2.c))
  │   └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:Selection
    └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t1.c))
      └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where t1.a not in (select b from t2 where t2.c>t1.c);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		Null-aware anti semi join, left side:TableReader, equal:[eq(planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t2.b)], other cond:gt(planner__core__casetest__rule__rule_result_reorder.t2.c, planner__core__casetest__rule__rule_result_reorder.t1.c)
  ├─TableReader(Build)	root		data:TableFullScan
  │ └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where exists (select 1 from t2 where t2.c>t1.c);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		CARTESIAN semi join, left side:TableReader, other cond:gt(planner__core__casetest__rule__rule_result_reorder.t2.c, planner__core__casetest__rule__rule_result_reorder.t1.c)
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t2.c))
  │   └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:Selection
    └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t1.c))
      └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where not exists (select 1 from t2 where t2.c>t1.c);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		CARTESIAN anti semi join, left side:TableReader, other cond:gt(planner__core__casetest__rule__rule_result_reorder.t2.c, planner__core__casetest__rule__rule_result_reorder.t1.c)
  ├─TableReader(Build)	root		data:TableFullScan
  │ └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where exists (select 1 from t2 where t2.c=t1.c);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		semi join, left side:TableReader, equal:[eq(planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t2.c)]
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t2.c))
  │   └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:Selection
    └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t1.c))
      └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where not exists (select 1 from t2 where t2.c=t1.c);
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		anti semi join, left side:TableReader, equal:[eq(planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t2.c)]
  ├─TableReader(Build)	root		data:TableFullScan
  │ └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select t1.* from t1, (select b from t2) tb where t1.b=tb.b;
id	task	access object	operator info
Projection	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d, planner__core__casetest__rule__rule_result_reorder.t2.b
  └─HashJoin	root		inner join, equal:[eq(planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t2.b)]
    ├─IndexReader(Build)	root		index:IndexFullScan
    │ └─IndexFullScan	cop[tikv]	table:t2, index:b(b)	keep order:false, stats:pseudo
    └─TableReader(Probe)	root		data:Selection
      └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t1.b))
        └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
set tidb_cost_model_version=2;
set tidb_enable_ordered_result_mode=1;
drop table if exists t1;
drop table if exists t2;
create table t1 (a int primary key, b int, c int, d int, key(b));
create table t2 (a int primary key, b int, c int, d int, key(b));
set @@tidb_enable_outer_join_reorder=true;
explain format='plan_tree' select * from t1, t2 where t1.a = t2.a;
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d, planner__core__casetest__rule__rule_result_reorder.t2.a, planner__core__casetest__rule__rule_result_reorder.t2.b, planner__core__casetest__rule__rule_result_reorder.t2.c, planner__core__casetest__rule__rule_result_reorder.t2.d
└─MergeJoin	root		inner join, left key:planner__core__casetest__rule__rule_result_reorder.t1.a, right key:planner__core__casetest__rule__rule_result_reorder.t2.a
  ├─TableReader(Build)	root		data:TableFullScan
  │ └─TableFullScan	cop[tikv]	table:t2	keep order:true, stats:pseudo
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:true, stats:pseudo
explain format='plan_tree' select * from t1, t2 where t1.a > t2.a and t1.b = t2.b and t1.c < t2.c;
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d, planner__core__casetest__rule__rule_result_reorder.t2.a, planner__core__casetest__rule__rule_result_reorder.t2.b, planner__core__casetest__rule__rule_result_reorder.t2.c, planner__core__casetest__rule__rule_result_reorder.t2.d
└─HashJoin	root		inner join, equal:[eq(planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t2.b)], other cond:gt(planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t2.a), lt(planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t2.c)
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t2.b)), not(isnull(planner__core__casetest__rule__rule_result_reorder.t2.c))
  │   └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:Selection
    └─Selection	cop[tikv]		not(isnull(planner__core__casetest__rule__rule_result_reorder.t1.b)), not(isnull(planner__core__casetest__rule__rule_result_reorder.t1.c))
      └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select t1.* from t1 left outer join t2 on t1.a=t2.a;
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─TableReader	root		data:TableFullScan
  └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select t1.* from t1 join t2 on t1.a!=t2.a;
id	task	access object	operator info
Projection	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d, planner__core__casetest__rule__rule_result_reorder.t2.a
  └─HashJoin	root		CARTESIAN inner join, other cond:ne(planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t2.a)
    ├─IndexReader(Build)	root		index:IndexFullScan
    │ └─IndexFullScan	cop[tikv]	table:t2, index:b(b)	keep order:false, stats:pseudo
    └─TableReader(Probe)	root		data:TableFullScan
      └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
set tidb_cost_model_version=2;
set tidb_enable_ordered_result_mode=1;
drop table if exists t1;
drop table if exists t2;
create table t1 (a int primary key, b int, c int, d int, unique key(b));
create table t2 (a int primary key, b int, c int, d int, unique key(b));
explain format='plan_tree' select * from t1 where a = 1 or a = 222 or a = 33333;
id	task	access object	operator info
Batch_Point_Get	root	table:t1	handle:[1 222 33333], keep order:true, desc:false
explain format='plan_tree' select * from t1 where a in (1, 2, 3, 4);
id	task	access object	operator info
Batch_Point_Get	root	table:t1	handle:[1 2 3 4], keep order:true, desc:false
explain format='plan_tree' select b from t1 where b = 1 or b = 222 or b = 33333;
id	task	access object	operator info
Batch_Point_Get	root	table:t1, index:b(b)	keep order:true, desc:false
explain format='plan_tree' select b from t1 where b in (1, 2, 3, 4);
id	task	access object	operator info
Batch_Point_Get	root	table:t1, index:b(b)	keep order:true, desc:false
explain format='plan_tree' select * from t1 where a > 10 union all select * from t2 where b > 20;
id	task	access object	operator info
Sort	root		Column, Column, Column, Column
└─Union	root		
  ├─TableReader	root		data:TableRangeScan
  │ └─TableRangeScan	cop[tikv]	table:t1	range:(10,+inf], keep order:false, stats:pseudo
  └─TableReader	root		data:Selection
    └─Selection	cop[tikv]		gt(planner__core__casetest__rule__rule_result_reorder.t2.b, 20)
      └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where a > 10 union distinct select * from t2 where b > 20;
id	task	access object	operator info
Sort	root		Column, Column, Column, Column
└─HashAgg	root		group by:Column, Column, Column, Column, funcs:firstrow(Column)->Column, funcs:firstrow(Column)->Column, funcs:firstrow(Column)->Column, funcs:firstrow(Column)->Column
  └─Union	root		
    ├─TableReader	root		data:TableRangeScan
    │ └─TableRangeScan	cop[tikv]	table:t1	range:(10,+inf], keep order:false, stats:pseudo
    └─TableReader	root		data:Selection
      └─Selection	cop[tikv]		gt(planner__core__casetest__rule__rule_result_reorder.t2.b, 20)
        └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where a > 10 intersect select * from t2 where b > 20;
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		semi join, left side:TableReader, equal:[nulleq(planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t2.a) nulleq(planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t2.b) nulleq(planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t2.c) nulleq(planner__core__casetest__rule__rule_result_reorder.t1.d, planner__core__casetest__rule__rule_result_reorder.t2.d)]
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		gt(planner__core__casetest__rule__rule_result_reorder.t2.b, 20)
  │   └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:TableRangeScan
    └─TableRangeScan	cop[tikv]	table:t1	range:(10,+inf], keep order:false, stats:pseudo
explain format='plan_tree' select * from t1 where a > 10 except select * from t2 where b > 20;
id	task	access object	operator info
Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t1.d
└─HashJoin	root		anti semi join, left side:TableReader, equal:[nulleq(planner__core__casetest__rule__rule_result_reorder.t1.a, planner__core__casetest__rule__rule_result_reorder.t2.a) nulleq(planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t2.b) nulleq(planner__core__casetest__rule__rule_result_reorder.t1.c, planner__core__casetest__rule__rule_result_reorder.t2.c) nulleq(planner__core__casetest__rule__rule_result_reorder.t1.d, planner__core__casetest__rule__rule_result_reorder.t2.d)]
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		gt(planner__core__casetest__rule__rule_result_reorder.t2.b, 20)
  │   └─TableFullScan	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─TableReader(Probe)	root		data:TableRangeScan
    └─TableRangeScan	cop[tikv]	table:t1	range:(10,+inf], keep order:false, stats:pseudo
explain format='plan_tree' select sum(b) over(partition by a) as sum_b from t1;
id	task	access object	operator info
Projection	root		Column
└─Sort	root		planner__core__casetest__rule__rule_result_reorder.t1.b, planner__core__casetest__rule__rule_result_reorder.t1.a, Column
  └─Window	root		sum(cast(planner__core__casetest__rule__rule_result_reorder.t1.b, decimal(10,0) BINARY))->Column#6 over(partition by planner__core__casetest__rule__rule_result_reorder.t1.a)
    └─TableReader	root		data:TableFullScan
      └─TableFullScan	cop[tikv]	table:t1	keep order:true, stats:pseudo
explain format='plan_tree' select min(a), max(b), sum(c) from t1 group by d;
id	task	access object	operator info
Sort	root		Column, Column, Column
└─HashAgg	root		group by:planner__core__casetest__rule__rule_result_reorder.t1.d, funcs:min(Column)->Column, funcs:max(Column)->Column, funcs:sum(Column)->Column
  └─TableReader	root		data:HashAgg
    └─HashAgg	cop[tikv]		group by:planner__core__casetest__rule__rule_result_reorder.t1.d, funcs:min(planner__core__casetest__rule__rule_result_reorder.t1.a)->Column, funcs:max(planner__core__casetest__rule__rule_result_reorder.t1.b)->Column, funcs:sum(planner__core__casetest__rule__rule_result_reorder.t1.c)->Column
      └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select min(a), max(b), sum(c) from t1 group by d having max(b) < 20;
id	task	access object	operator info
Sort	root		Column, Column, Column
└─Selection	root		lt(Column, 20)
  └─HashAgg	root		group by:planner__core__casetest__rule__rule_result_reorder.t1.d, funcs:min(Column)->Column, funcs:max(Column)->Column, funcs:sum(Column)->Column
    └─TableReader	root		data:HashAgg
      └─HashAgg	cop[tikv]		group by:planner__core__casetest__rule__rule_result_reorder.t1.d, funcs:min(planner__core__casetest__rule__rule_result_reorder.t1.a)->Column, funcs:max(planner__core__casetest__rule__rule_result_reorder.t1.b)->Column, funcs:sum(planner__core__casetest__rule__rule_result_reorder.t1.c)->Column
        └─TableFullScan	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format='plan_tree' select case when a=1 then 'a1' when a=2 then 'a2' else 'ax' end from t1 ;
id	task	access object	operator info
Projection	root		case(eq(planner__core__casetest__rule__rule_result_reorder.t1.a, 1), a1, eq(planner__core__casetest__rule__rule_result_reorder.t1.a, 2), a2, ax)->Column
└─TableReader	root		data:TableFullScan
  └─TableFullScan	cop[tikv]	table:t1	keep order:true, stats:pseudo
set tidb_partition_prune_mode='dynamic';
set tidb_enable_ordered_result_mode=1;
drop table if exists thash;
drop table if exists trange;
create table thash (a int primary key, b int, c int, d int) partition by hash(a) partitions 4;
create table trange (a int primary key, b int, c int, d int) partition by range(a) (
partition p0 values less than (100),
partition p1 values less than (200),
partition p2 values less than (300),
partition p3 values less than (400));
analyze table thash;
analyze table trange;
select @@tidb_partition_prune_mode;
@@tidb_partition_prune_mode
dynamic
explain format='plan_tree' select * from thash where a in (1, 200);
id	task	access object	operator info
TableReader	root	partition:p0,p1	data:TableRangeScan
└─TableRangeScan	cop[tikv]	table:thash	range:[1,1], [200,200], keep order:true, stats:pseudo
explain format='plan_tree' select * from thash where a >= 50 and a <= 150;
id	task	access object	operator info
TableReader	root	partition:all	data:TableRangeScan
└─TableRangeScan	cop[tikv]	table:thash	range:[50,150], keep order:true, stats:pseudo
explain format='plan_tree' select * from trange where a in (1, 200);
id	task	access object	operator info
TableReader	root	partition:p0,p2	data:TableRangeScan
└─TableRangeScan	cop[tikv]	table:trange	range:[1,1], [200,200], keep order:true, stats:pseudo
explain format='plan_tree' select * from trange where a >= 50 and a <= 150;
id	task	access object	operator info
TableReader	root	partition:p0,p1	data:TableRangeScan
└─TableRangeScan	cop[tikv]	table:trange	range:[50,150], keep order:true, stats:pseudo
