drop table if exists t;
create table t(a int, b int, c int, d int, index iabc(a,b,c));
insert into t values
(1, 1, 1, 10), (1, 1, 2, 20), (1, 1, 3, 30), (1, 1, 4, 31),
(1, 2, 1, 32), (1, 2, 2, 33), (1, 2, 5, 34),
(1, 3, 1, 40), (1, 3, 2, 50), (1, 3, 3, 60), (1, 3, 6, 61),
(1, 4, 1, 62), (1, 4, 3, 63), (1, 4, 7, 64),
(1, 5, 1, 70), (1, 5, 2, 80), (1, 5, 3, 90), (1, 5, 8, 91),
(1, 6, 2, 92), (1, 6, 4, 93),
(2, 1, 1, 100), (2, 1, 2, 110), (2, 1, 3, 120), (2, 1, 5, 121),
(2, 2, 1, 122), (2, 2, 3, 123), (2, 2, 6, 124),
(2, 3, 1, 130), (2, 3, 2, 140), (2, 3, 3, 150), (2, 3, 7, 151),
(2, 4, 2, 152), (2, 4, 4, 153), (2, 4, 8, 154),
(2, 5, 1, 160), (2, 5, 2, 170), (2, 5, 3, 180), (2, 5, 9, 181),
(2, 7, 1, 182), (2, 7, 5, 183),
(3, 1, 1, 190), (3, 1, 2, 200), (3, 1, 3, 210), (3, 1, 6, 211),
(3, 2, 2, 212), (3, 2, 4, 213), (3, 2, 7, 214),
(3, 3, 1, 220), (3, 3, 2, 230), (3, 3, 3, 240), (3, 3, 8, 241),
(3, 4, 1, 242), (3, 4, 5, 243), (3, 4, 9, 244),
(3, 5, 1, 250), (3, 5, 2, 260), (3, 5, 3, 270), (3, 5, 10, 271),
(3, 6, 3, 272), (3, 6, 6, 273),
(4, 1, 2, 280), (4, 1, 4, 281), (4, 1, 7, 282),
(4, 2, 1, 283), (4, 2, 5, 284), (4, 2, 8, 285),
(4, 3, 3, 290), (4, 3, 6, 291), (4, 3, 9, 292),
(4, 4, 2, 293), (4, 4, 4, 294), (4, 4, 10, 295),
(4, 5, 1, 300), (4, 5, 5, 301), (4, 5, 11, 302),
(4, 8, 1, 303), (4, 8, 3, 304),
(5, 1, 1, 310), (5, 1, 3, 311), (5, 1, 8, 312),
(5, 3, 2, 320), (5, 3, 4, 321), (5, 3, 9, 322),
(5, 5, 1, 330), (5, 5, 5, 331), (5, 5, 12, 332),
(5, 7, 2, 340), (5, 7, 6, 341), (5, 7, 10, 342);
explain format = 'brief' select * from t where b in (1, 3, 5) and d > 100 order by a, b, c;
id	estRows	task	access object	operator info
Projection	10.00	root		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.b, planner__core__grouped_ranges_order_by.t.c, planner__core__grouped_ranges_order_by.t.d
└─IndexLookUp	10.00	root		
  ├─Selection(Build)	30.00	cop[tikv]		in(planner__core__grouped_ranges_order_by.t.b, 1, 3, 5)
  │ └─IndexFullScan	10000.00	cop[tikv]	table:t, index:iabc(a, b, c)	keep order:true, stats:pseudo
  └─Selection(Probe)	10.00	cop[tikv]		gt(planner__core__grouped_ranges_order_by.t.d, 100)
    └─TableRowIDScan	30.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t where b in (1, 3, 5) and d > 100 order by a, b, c;
a	b	c	d
2	1	2	110
2	1	3	120
2	1	5	121
2	3	1	130
2	3	2	140
2	3	3	150
2	3	7	151
2	5	1	160
2	5	2	170
2	5	3	180
2	5	9	181
3	1	1	190
3	1	2	200
3	1	3	210
3	1	6	211
3	3	1	220
3	3	2	230
3	3	3	240
3	3	8	241
3	5	1	250
3	5	2	260
3	5	3	270
3	5	10	271
4	1	2	280
4	1	4	281
4	1	7	282
4	3	3	290
4	3	6	291
4	3	9	292
4	5	1	300
4	5	5	301
4	5	11	302
5	1	1	310
5	1	3	311
5	1	8	312
5	3	2	320
5	3	4	321
5	3	9	322
5	5	1	330
5	5	5	331
5	5	12	332
explain format = 'brief' select a,c from t where b in (1, 3, 5) and d > 100 order by a, c;
id	estRows	task	access object	operator info
Sort	10.00	root		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.c
└─TableReader	10.00	root		data:Projection
  └─Projection	10.00	cop[tikv]		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.c
    └─Selection	10.00	cop[tikv]		gt(planner__core__grouped_ranges_order_by.t.d, 100), in(planner__core__grouped_ranges_order_by.t.b, 1, 3, 5)
      └─TableFullScan	10000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select a,c from t where b in (1, 3, 5) and d > 100 order by a, c;
a	c
2	1
2	1
2	2
2	2
2	2
2	3
2	3
2	3
2	5
2	7
2	9
3	1
3	1
3	1
3	2
3	2
3	2
3	3
3	3
3	3
3	6
3	8
3	10
4	1
4	2
4	3
4	4
4	5
4	6
4	7
4	9
4	11
5	1
5	1
5	2
5	3
5	4
5	5
5	8
5	9
5	12
explain format = 'brief' select c from t where a = 1 and b in (1, 3, 5) and d < 200 order by c;
id	estRows	task	access object	operator info
Projection	1.00	root		planner__core__grouped_ranges_order_by.t.c
└─Projection	1.00	root		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.b, planner__core__grouped_ranges_order_by.t.c, planner__core__grouped_ranges_order_by.t.d
  └─IndexLookUp	1.00	root		
    ├─IndexRangeScan(Build)	1.25	cop[tikv]	table:t, index:iabc(a, b, c)	range:[1 1,1 1], [1 3,1 3], [1 5,1 5], keep order:true, stats:pseudo
    └─Selection(Probe)	1.00	cop[tikv]		lt(planner__core__grouped_ranges_order_by.t.d, 200)
      └─TableRowIDScan	1.25	cop[tikv]	table:t	keep order:false, stats:pseudo
select c from t where a = 1 and b in (1, 3, 5) and d < 200 order by c;
c
1
1
1
2
2
2
3
3
3
4
6
8
drop table if exists t2;
create table t2(a int, b int, c int, d int, index iabc(a,b,c));
insert into t2 values
(1, 1, 1, 10), (1, 1, 2, 15), (1, 1, 3, 30), (1, 1, 4, 35),
(1, 2, 1, 25), (1, 2, 3, 45), (1, 2, 5, 55),
(1, 3, 1, 40), (1, 3, 2, 45), (1, 3, 3, 60), (1, 3, 6, 65),
(1, 4, 2, 70), (1, 4, 4, 75),
(2, 1, 1, 100), (2, 1, 2, 105), (2, 1, 3, 120), (2, 1, 5, 125),
(2, 2, 1, 110), (2, 2, 4, 115), (2, 2, 6, 135),
(2, 3, 1, 130), (2, 3, 3, 150), (2, 3, 7, 155),
(2, 5, 2, 165), (2, 5, 4, 175),
(3, 1, 1, 190), (3, 1, 3, 210), (3, 1, 8, 215),
(3, 2, 2, 200), (3, 2, 5, 205), (3, 2, 9, 225),
(3, 3, 1, 220), (3, 3, 3, 240), (3, 3, 10, 245),
(3, 4, 1, 230), (3, 4, 6, 235),
(4, 1, 2, 250), (4, 1, 4, 255), (4, 1, 7, 265),
(4, 3, 1, 260), (4, 3, 5, 275), (4, 3, 11, 285);
explain format = 'brief' select c from t2 where a in (1, 3) and b in (1, 3) and d < 150 order by c;
id	estRows	task	access object	operator info
Projection	1.00	root		planner__core__grouped_ranges_order_by.t2.c
└─Projection	1.00	root		planner__core__grouped_ranges_order_by.t2.a, planner__core__grouped_ranges_order_by.t2.b, planner__core__grouped_ranges_order_by.t2.c, planner__core__grouped_ranges_order_by.t2.d
  └─IndexLookUp	1.00	root		
    ├─IndexRangeScan(Build)	1.25	cop[tikv]	table:t2, index:iabc(a, b, c)	range:[1 1,1 1], [1 3,1 3], [3 1,3 1], [3 3,3 3], keep order:true, stats:pseudo
    └─Selection(Probe)	1.00	cop[tikv]		lt(planner__core__grouped_ranges_order_by.t2.d, 150)
      └─TableRowIDScan	1.25	cop[tikv]	table:t2	keep order:false, stats:pseudo
select c from t2 where a in (1, 3) and b in (1, 3) and d < 150 order by c;
c
1
1
2
2
3
3
4
6
explain format = 'brief' select a,c from t where a = 3 and b in (1, 3, 5) order by a desc, c desc;
id	estRows	task	access object	operator info
Sort	1.00	root		planner__core__grouped_ranges_order_by.t.a:desc, planner__core__grouped_ranges_order_by.t.c:desc
└─IndexReader	1.00	root		index:Projection
  └─Projection	1.00	cop[tikv]		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.c
    └─IndexRangeScan	1.25	cop[tikv]	table:t, index:iabc(a, b, c)	range:[3 1,3 1], [3 3,3 3], [3 5,3 5], keep order:false, stats:pseudo
select a,c from t where a = 3 and b in (1, 3, 5) order by a desc, c desc;
a	c
3	10
3	8
3	6
3	3
3	3
3	3
3	2
3	2
3	2
3	1
3	1
3	1
explain format = 'brief' select a,c from t where a = 2 and b in (1, 3, 5) and d > 60 order by a desc, c desc;
id	estRows	task	access object	operator info
Sort	1.00	root		planner__core__grouped_ranges_order_by.t.a:desc, planner__core__grouped_ranges_order_by.t.c:desc
└─Projection	1.00	root		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.c
  └─IndexLookUp	1.00	root		
    ├─IndexRangeScan(Build)	1.25	cop[tikv]	table:t, index:iabc(a, b, c)	range:[2 1,2 1], [2 3,2 3], [2 5,2 5], keep order:false, stats:pseudo
    └─Selection(Probe)	1.00	cop[tikv]		gt(planner__core__grouped_ranges_order_by.t.d, 60)
      └─TableRowIDScan	1.25	cop[tikv]	table:t	keep order:false, stats:pseudo
select a,c from t where a = 2 and b in (1, 3, 5) and d > 60 order by a desc, c desc;
a	c
2	9
2	7
2	5
2	3
2	3
2	3
2	2
2	2
2	2
2	1
2	1
2	1
explain format = 'brief' select b,c from t where a = 1 and b in (1, 3, 5) and c > 1 order by b, c;
id	estRows	task	access object	operator info
IndexReader	1.00	root		index:Projection
└─Projection	1.00	cop[tikv]		planner__core__grouped_ranges_order_by.t.b, planner__core__grouped_ranges_order_by.t.c
  └─IndexRangeScan	1.00	cop[tikv]	table:t, index:iabc(a, b, c)	range:(1 1 1,1 1 +inf], (1 3 1,1 3 +inf], (1 5 1,1 5 +inf], keep order:true, stats:pseudo
select b,c from t where a = 1 and b in (1, 3, 5) and c > 1 order by b, c;
b	c
1	2
1	3
1	4
3	2
3	3
3	6
5	2
5	3
5	8
drop table if exists tp;
CREATE TABLE tp (
a int,
b int,
c int,
d int,
primary key (a,b,d) /*T![clustered_index] CLUSTERED */
) PARTITION BY RANGE(d) (
PARTITION p0 VALUES LESS THAN (100),
PARTITION p1 VALUES LESS THAN (200),
PARTITION p2 VALUES LESS THAN (300)
);
insert into tp values
(1, 1, 1, 10), (1, 1, 2, 20), (1, 1, 3, 30), (1, 1, 4, 35),
(1, 2, 1, 25), (1, 2, 5, 45), (1, 2, 8, 55),
(1, 3, 1, 40), (1, 3, 2, 50), (1, 3, 3, 60), (1, 3, 6, 65),
(1, 4, 2, 75), (1, 4, 7, 85),
(1, 5, 1, 70), (1, 5, 2, 80), (1, 5, 3, 90), (1, 5, 9, 95),
(1, 6, 4, 77), (1, 7, 1, 82),
(2, 1, 2, 15), (2, 1, 4, 25), (2, 1, 7, 45),
(2, 2, 1, 35), (2, 2, 5, 55), (2, 2, 10, 75),
(2, 3, 3, 65), (2, 3, 6, 85), (2, 3, 11, 95),
(2, 4, 1, 27), (2, 4, 8, 67),
(2, 5, 2, 37), (2, 5, 4, 57), (2, 5, 12, 87),
(3, 1, 1, 17), (3, 1, 5, 47), (3, 1, 9, 77),
(3, 2, 2, 22), (3, 2, 6, 52), (3, 2, 13, 92),
(3, 3, 3, 32), (3, 3, 7, 62), (3, 3, 14, 97),
(3, 5, 1, 42), (3, 5, 8, 72),
(2, 1, 1, 110), (2, 1, 2, 120), (2, 1, 3, 130), (2, 1, 5, 135),
(2, 2, 1, 115), (2, 2, 4, 125), (2, 2, 8, 145),
(2, 3, 1, 140), (2, 3, 2, 150), (2, 3, 3, 160), (2, 3, 6, 165),
(2, 4, 2, 155), (2, 4, 7, 175), (2, 4, 10, 185),
(2, 5, 1, 170), (2, 5, 2, 180), (2, 5, 3, 190), (2, 5, 9, 195),
(2, 6, 4, 177), (2, 7, 1, 182), (2, 8, 5, 187),
(3, 1, 2, 105), (3, 1, 4, 125), (3, 1, 7, 145),
(3, 2, 1, 115), (3, 2, 5, 135), (3, 2, 11, 175),
(3, 3, 3, 155), (3, 3, 6, 175), (3, 3, 12, 195),
(3, 4, 1, 127), (3, 4, 8, 167),
(3, 5, 2, 137), (3, 5, 4, 157), (3, 5, 13, 187),
(4, 1, 1, 107), (4, 1, 3, 147), (4, 1, 9, 167),
(4, 3, 2, 117), (4, 3, 5, 157), (4, 3, 14, 197),
(4, 5, 1, 127), (4, 5, 6, 147), (4, 5, 15, 177),
(3, 1, 1, 210), (3, 1, 2, 220), (3, 1, 3, 230), (3, 1, 5, 235),
(3, 2, 1, 215), (3, 2, 4, 225), (3, 2, 8, 245),
(3, 3, 1, 240), (3, 3, 2, 250), (3, 3, 3, 260), (3, 3, 6, 265),
(3, 4, 2, 255), (3, 4, 7, 275), (3, 4, 10, 285),
(3, 5, 1, 270), (3, 5, 2, 280), (3, 5, 3, 290), (3, 5, 9, 295),
(3, 6, 4, 277), (3, 7, 1, 282), (3, 8, 5, 287),
(4, 1, 2, 205), (4, 1, 4, 225), (4, 1, 7, 245),
(4, 2, 1, 215), (4, 2, 5, 235), (4, 2, 11, 275),
(4, 3, 3, 255), (4, 3, 6, 275), (4, 3, 12, 295),
(4, 4, 1, 227), (4, 4, 8, 267),
(4, 5, 2, 237), (4, 5, 4, 257), (4, 5, 13, 287),
(5, 1, 1, 207), (5, 1, 3, 247), (5, 1, 9, 267),
(5, 3, 2, 217), (5, 3, 5, 257), (5, 3, 14, 297),
(5, 5, 1, 227), (5, 5, 6, 247), (5, 5, 15, 277);
explain format = 'brief' select a,d from tp where a in (1,4) and b in (1, 3, 5) order by a, d;
id	estRows	task	access object	operator info
TableReader	1.00	root	partition:all	data:Projection
└─Projection	1.00	cop[tikv]		planner__core__grouped_ranges_order_by.tp.a, planner__core__grouped_ranges_order_by.tp.d
  └─TableRangeScan	1.25	cop[tikv]	table:tp	range:[1 1,1 1], [1 3,1 3], [1 5,1 5], [4 1,4 1], [4 3,4 3], [4 5,4 5], keep order:true, stats:pseudo
select a,d from tp where a in (1,4) and b in (1, 3, 5) order by a, d;
a	d
1	10
1	20
1	30
1	35
1	40
1	50
1	60
1	65
1	70
1	80
1	90
1	95
4	107
4	117
4	127
4	147
4	147
4	157
4	167
4	177
4	197
4	205
4	225
4	237
4	245
4	255
4	257
4	275
4	287
4	295
explain format = 'brief' select d from tp where a = 1 and b in (1, 3, 5) order by d;
id	estRows	task	access object	operator info
TableReader	1.00	root	partition:all	data:Projection
└─Projection	1.00	cop[tikv]		planner__core__grouped_ranges_order_by.tp.d
  └─TableRangeScan	1.25	cop[tikv]	table:tp	range:[1 1,1 1], [1 3,1 3], [1 5,1 5], keep order:true, stats:pseudo
select d from tp where a = 1 and b in (1, 3, 5) order by d;
d
10
20
30
35
40
50
60
65
70
80
90
95
explain format = 'brief' select a,d from tp where a = 3 and b in (1, 3, 5) and d < 200 order by a, d;
id	estRows	task	access object	operator info
TableReader	1.00	root	partition:p0,p1	data:Projection
└─Projection	1.00	cop[tikv]		planner__core__grouped_ranges_order_by.tp.a, planner__core__grouped_ranges_order_by.tp.d
  └─TableRangeScan	1.25	cop[tikv]	table:tp	range:[3 1 -inf,3 1 200), [3 3 -inf,3 3 200), [3 5 -inf,3 5 200), keep order:true, stats:pseudo
select a,d from tp where a = 3 and b in (1, 3, 5) and d < 200 order by a, d;
a	d
3	17
3	32
3	42
3	47
3	62
3	72
3	77
3	97
3	105
3	125
3	137
3	145
3	155
3	157
3	175
3	187
3	195
drop table if exists tp;
CREATE TABLE tp (
a int,
b int,
c int,
d int,
index iabc(a,b,c)
) PARTITION BY RANGE(d) (
PARTITION p0 VALUES LESS THAN (100),
PARTITION p1 VALUES LESS THAN (200),
PARTITION p2 VALUES LESS THAN (300)
);
insert into tp values
(1, 1, 1, 10), (1, 1, 2, 20), (1, 1, 3, 30), (1, 1, 4, 35),
(1, 2, 1, 25), (1, 2, 5, 45), (1, 2, 8, 55),
(1, 3, 1, 40), (1, 3, 2, 50), (1, 3, 3, 60), (1, 3, 6, 65),
(1, 4, 2, 75), (1, 4, 7, 85),
(1, 5, 1, 70), (1, 5, 2, 80), (1, 5, 3, 90), (1, 5, 9, 95),
(1, 6, 4, 77), (1, 7, 1, 82),
(2, 1, 2, 15), (2, 1, 4, 25), (2, 1, 7, 45),
(2, 2, 1, 35), (2, 2, 5, 55), (2, 2, 10, 75),
(2, 3, 3, 65), (2, 3, 6, 85), (2, 3, 11, 95),
(2, 4, 1, 27), (2, 4, 8, 67),
(2, 5, 2, 37), (2, 5, 4, 57), (2, 5, 12, 87),
(3, 1, 1, 17), (3, 1, 5, 47), (3, 1, 9, 77),
(3, 2, 2, 22), (3, 2, 6, 52), (3, 2, 13, 92),
(3, 3, 3, 32), (3, 3, 7, 62), (3, 3, 14, 97),
(3, 5, 1, 42), (3, 5, 8, 72),
(2, 1, 1, 110), (2, 1, 2, 120), (2, 1, 3, 130), (2, 1, 5, 135),
(2, 2, 1, 115), (2, 2, 4, 125), (2, 2, 8, 145),
(2, 3, 1, 140), (2, 3, 2, 150), (2, 3, 3, 160), (2, 3, 6, 165),
(2, 4, 2, 155), (2, 4, 7, 175), (2, 4, 10, 185),
(2, 5, 1, 170), (2, 5, 2, 180), (2, 5, 3, 190), (2, 5, 9, 195),
(2, 6, 4, 177), (2, 7, 1, 182), (2, 8, 5, 187),
(3, 1, 2, 105), (3, 1, 4, 125), (3, 1, 7, 145),
(3, 2, 1, 115), (3, 2, 5, 135), (3, 2, 11, 175),
(3, 3, 3, 155), (3, 3, 6, 175), (3, 3, 12, 195),
(3, 4, 1, 127), (3, 4, 8, 167),
(3, 5, 2, 137), (3, 5, 4, 157), (3, 5, 13, 187),
(4, 1, 1, 107), (4, 1, 3, 147), (4, 1, 9, 167),
(4, 3, 2, 117), (4, 3, 5, 157), (4, 3, 14, 197),
(4, 5, 1, 127), (4, 5, 6, 147), (4, 5, 15, 177),
(3, 1, 1, 210), (3, 1, 2, 220), (3, 1, 3, 230), (3, 1, 5, 235),
(3, 2, 1, 215), (3, 2, 4, 225), (3, 2, 8, 245),
(3, 3, 1, 240), (3, 3, 2, 250), (3, 3, 3, 260), (3, 3, 6, 265),
(3, 4, 2, 255), (3, 4, 7, 275), (3, 4, 10, 285),
(3, 5, 1, 270), (3, 5, 2, 280), (3, 5, 3, 290), (3, 5, 9, 295),
(3, 6, 4, 277), (3, 7, 1, 282), (3, 8, 5, 287),
(4, 1, 2, 205), (4, 1, 4, 225), (4, 1, 7, 245),
(4, 2, 1, 215), (4, 2, 5, 235), (4, 2, 11, 275),
(4, 3, 3, 255), (4, 3, 6, 275), (4, 3, 12, 295),
(4, 4, 1, 227), (4, 4, 8, 267),
(4, 5, 2, 237), (4, 5, 4, 257), (4, 5, 13, 287),
(5, 1, 1, 207), (5, 1, 3, 247), (5, 1, 9, 267),
(5, 3, 2, 217), (5, 3, 5, 257), (5, 3, 14, 297),
(5, 5, 1, 227), (5, 5, 6, 247), (5, 5, 15, 277);
explain format = 'brief' select a,c from tp where a in (3,5) and b in (1, 3, 5) order by a, c;
id	estRows	task	access object	operator info
IndexReader	1.00	root	partition:all	index:Projection
└─Projection	1.00	cop[tikv]		planner__core__grouped_ranges_order_by.tp.a, planner__core__grouped_ranges_order_by.tp.c
  └─IndexRangeScan	1.25	cop[tikv]	table:tp, index:iabc(a, b, c)	range:[3 1,3 1], [3 3,3 3], [3 5,3 5], [5 1,5 1], [5 3,5 3], [5 5,5 5], keep order:true, stats:pseudo
select a,c from tp where a in (3,5) and b in (1, 3, 5) order by a, c;
a	c
3	1
3	1
3	1
3	1
3	1
3	2
3	2
3	2
3	2
3	2
3	3
3	3
3	3
3	3
3	3
3	4
3	4
3	5
3	5
3	6
3	6
3	7
3	7
3	8
3	9
3	9
3	12
3	13
3	14
5	1
5	1
5	2
5	3
5	5
5	6
5	9
5	14
5	15
explain format = 'brief' select /*+ order_index(tp, iabc) */ c from tp where a = 1 and b in (1, 3, 5) and d < 200 order by c;
id	estRows	task	access object	operator info
Projection	1.00	root		planner__core__grouped_ranges_order_by.tp.c
└─Projection	1.00	root		planner__core__grouped_ranges_order_by.tp.a, planner__core__grouped_ranges_order_by.tp.b, planner__core__grouped_ranges_order_by.tp.c, planner__core__grouped_ranges_order_by.tp.d
  └─IndexLookUp	1.00	root	partition:p0,p1	
    ├─IndexRangeScan(Build)	1.25	cop[tikv]	table:tp, index:iabc(a, b, c)	range:[1 1,1 1], [1 3,1 3], [1 5,1 5], keep order:true, stats:pseudo
    └─Selection(Probe)	1.00	cop[tikv]		lt(planner__core__grouped_ranges_order_by.tp.d, 200)
      └─TableRowIDScan	1.25	cop[tikv]	table:tp	keep order:false, stats:pseudo
select /*+ order_index(tp, iabc) */ c from tp where a = 1 and b in (1, 3, 5) and d < 200 order by c;
c
1
1
1
2
2
2
3
3
3
4
6
9
explain format = 'brief' select a,c from tp where a = 2 and b in (1, 3, 5) and d < 200 order by a, c;
id	estRows	task	access object	operator info
Sort	1.00	root		planner__core__grouped_ranges_order_by.tp.a, planner__core__grouped_ranges_order_by.tp.c
└─Projection	1.00	root		planner__core__grouped_ranges_order_by.tp.a, planner__core__grouped_ranges_order_by.tp.c
  └─IndexLookUp	1.00	root	partition:p0,p1	
    ├─IndexRangeScan(Build)	1.25	cop[tikv]	table:tp, index:iabc(a, b, c)	range:[2 1,2 1], [2 3,2 3], [2 5,2 5], keep order:false, stats:pseudo
    └─Selection(Probe)	1.00	cop[tikv]		lt(planner__core__grouped_ranges_order_by.tp.d, 200)
      └─TableRowIDScan	1.25	cop[tikv]	table:tp	keep order:false, stats:pseudo
select a,c from tp where a = 2 and b in (1, 3, 5) and d < 200 order by a, c;
a	c
2	1
2	1
2	1
2	2
2	2
2	2
2	2
2	2
2	3
2	3
2	3
2	3
2	4
2	4
2	5
2	6
2	6
2	7
2	9
2	11
2	12
prepare stmt1 from 'select a,c from t where b in (?, ?, ?) order by a, c';
set @v1 = 1, @v2 = 3, @v3 = 5;
execute stmt1 using @v1, @v2, @v3;
a	c
1	1
1	1
1	1
1	2
1	2
1	2
1	3
1	3
1	3
1	4
1	6
1	8
2	1
2	1
2	1
2	2
2	2
2	2
2	3
2	3
2	3
2	5
2	7
2	9
3	1
3	1
3	1
3	2
3	2
3	2
3	3
3	3
3	3
3	6
3	8
3	10
4	1
4	2
4	3
4	4
4	5
4	6
4	7
4	9
4	11
5	1
5	1
5	2
5	3
5	4
5	5
5	8
5	9
5	12
execute stmt1 using @v1, @v2, @v3;
a	c
1	1
1	1
1	1
1	2
1	2
1	2
1	3
1	3
1	3
1	4
1	6
1	8
2	1
2	1
2	1
2	2
2	2
2	2
2	3
2	3
2	3
2	5
2	7
2	9
3	1
3	1
3	1
3	2
3	2
3	2
3	3
3	3
3	3
3	6
3	8
3	10
4	1
4	2
4	3
4	4
4	5
4	6
4	7
4	9
4	11
5	1
5	1
5	2
5	3
5	4
5	5
5	8
5	9
5	12
set @v1 = 1, @v2 = 2, @v3 = 4;
execute stmt1 using @v1, @v2, @v3;
a	c
1	1
1	1
1	1
1	2
1	2
1	3
1	3
1	4
1	5
1	7
2	1
2	1
2	2
2	2
2	3
2	3
2	4
2	5
2	6
2	8
3	1
3	1
3	2
3	2
3	3
3	4
3	5
3	6
3	7
3	9
4	1
4	2
4	2
4	4
4	4
4	5
4	7
4	8
4	10
5	1
5	3
5	8
prepare stmt2 from 'select a,c from tp where b in (?, ?, ?) order by a, c';
set @v1 = 1, @v2 = 3, @v3 = 5;
execute stmt2 using @v1, @v2, @v3;
a	c
1	1
1	1
1	1
1	2
1	2
1	2
1	3
1	3
1	3
1	4
1	6
1	9
2	1
2	1
2	1
2	2
2	2
2	2
2	2
2	2
2	3
2	3
2	3
2	3
2	4
2	4
2	5
2	6
2	6
2	7
2	9
2	11
2	12
3	1
3	1
3	1
3	1
3	1
3	2
3	2
3	2
3	2
3	2
3	3
3	3
3	3
3	3
3	3
3	4
3	4
3	5
3	5
3	6
3	6
3	7
3	7
3	8
3	9
3	9
3	12
3	13
3	14
4	1
4	1
4	2
4	2
4	2
4	3
4	3
4	4
4	4
4	5
4	6
4	6
4	7
4	9
4	12
4	13
4	14
4	15
5	1
5	1
5	2
5	3
5	5
5	6
5	9
5	14
5	15
execute stmt2 using @v1, @v2, @v3;
a	c
1	1
1	1
1	1
1	2
1	2
1	2
1	3
1	3
1	3
1	4
1	6
1	9
2	1
2	1
2	1
2	2
2	2
2	2
2	2
2	2
2	3
2	3
2	3
2	3
2	4
2	4
2	5
2	6
2	6
2	7
2	9
2	11
2	12
3	1
3	1
3	1
3	1
3	1
3	2
3	2
3	2
3	2
3	2
3	3
3	3
3	3
3	3
3	3
3	4
3	4
3	5
3	5
3	6
3	6
3	7
3	7
3	8
3	9
3	9
3	12
3	13
3	14
4	1
4	1
4	2
4	2
4	2
4	3
4	3
4	4
4	4
4	5
4	6
4	6
4	7
4	9
4	12
4	13
4	14
4	15
5	1
5	1
5	2
5	3
5	5
5	6
5	9
5	14
5	15
set @v1 = 1, @v2 = 2, @v3 = 4;
execute stmt2 using @v1, @v2, @v3;
a	c
1	1
1	1
1	2
1	2
1	3
1	4
1	5
1	7
1	8
2	1
2	1
2	1
2	1
2	2
2	2
2	2
2	3
2	4
2	4
2	5
2	5
2	7
2	7
2	8
2	8
2	10
2	10
3	1
3	1
3	1
3	1
3	1
3	2
3	2
3	2
3	2
3	3
3	4
3	4
3	5
3	5
3	5
3	6
3	7
3	7
3	8
3	8
3	9
3	10
3	11
3	13
4	1
4	1
4	1
4	2
4	3
4	4
4	5
4	7
4	8
4	9
4	11
5	1
5	3
5	9
drop table if exists t_outer, t_inner;
create table t_outer(a int, b int, index idx_a(a));
create table t_inner(x int, y int, z int, index ixy(x,y,z));
insert into t_outer values (1, 10), (2, 20), (3, 30), (4, 40);
insert into t_inner values
(1, 1, 100), (1, 2, 200), (1, 3, 300), (1, 4, 350), (1, 5, 400),
(1, 6, 450), (1, 7, 500), (1, 8, 550),
(2, 1, 400), (2, 2, 500), (2, 3, 600), (2, 4, 650), (2, 5, 700),
(2, 6, 750), (2, 7, 800), (2, 9, 850),
(3, 1, 700), (3, 2, 800), (3, 3, 900), (3, 4, 950), (3, 5, 1000),
(3, 8, 1050), (3, 9, 1100), (3, 10, 1150),
(4, 1, 1200), (4, 2, 1250), (4, 3, 1300), (4, 6, 1350), (4, 7, 1400);
explain format = 'brief'
select * from t_outer o
where exists (
select /*+ no_decorrelate() */ 1 from t_inner i
where i.x = o.a and i.y in (1, 2, 3)
order by i.x, i.z limit 1
);
id	estRows	task	access object	operator info
Apply	10000.00	root		CARTESIAN semi join, left side:TableReader
├─TableReader(Build)	10000.00	root		data:TableFullScan
│ └─TableFullScan	10000.00	cop[tikv]	table:o	keep order:false, stats:pseudo
└─TopN(Probe)	10000.00	root		planner__core__grouped_ranges_order_by.t_inner.x, planner__core__grouped_ranges_order_by.t_inner.z, offset:0, count:1
  └─IndexReader	10000.00	root		index:TopN
    └─TopN	10000.00	cop[tikv]		planner__core__grouped_ranges_order_by.t_inner.x, planner__core__grouped_ranges_order_by.t_inner.z, offset:0, count:1
      └─Selection	10000.00	cop[tikv]		in(planner__core__grouped_ranges_order_by.t_inner.y, 1, 2, 3)
        └─IndexRangeScan	100000.00	cop[tikv]	table:i, index:ixy(x, y, z)	range: decided by [eq(planner__core__grouped_ranges_order_by.t_inner.x, planner__core__grouped_ranges_order_by.t_outer.a)], keep order:false, stats:pseudo
select * from t_outer o
where exists (
select /*+ no_decorrelate() */ 1 from t_inner i
where i.x = o.a and i.y in (1, 2, 3)
order by i.x, i.z limit 1
);
a	b
1	10
2	20
3	30
4	40
explain format = 'brief'
select *, (
select z from t_inner i
where i.x = o.a and i.y in (1, 2)
order by i.z
limit 1
) as max_z
from t_outer o;
id	estRows	task	access object	operator info
Apply	10000.00	root		CARTESIAN left outer join, left side:TableReader
├─TableReader(Build)	10000.00	root		data:TableFullScan
│ └─TableFullScan	10000.00	cop[tikv]	table:o	keep order:false, stats:pseudo
└─TopN(Probe)	10000.00	root		planner__core__grouped_ranges_order_by.t_inner.z, offset:0, count:1
  └─IndexReader	10000.00	root		index:TopN
    └─TopN	10000.00	cop[tikv]		planner__core__grouped_ranges_order_by.t_inner.z, offset:0, count:1
      └─Selection	10000.00	cop[tikv]		in(planner__core__grouped_ranges_order_by.t_inner.y, 1, 2)
        └─IndexRangeScan	100000.00	cop[tikv]	table:i, index:ixy(x, y, z)	range: decided by [eq(planner__core__grouped_ranges_order_by.t_inner.x, planner__core__grouped_ranges_order_by.t_outer.a)], keep order:false, stats:pseudo
select *, (
select z from t_inner i
where i.x = o.a and i.y in (1, 2)
order by i.z
limit 1
) as max_z
from t_outer o;
a	b	max_z
1	10	100
2	20	400
3	30	700
4	40	1200
explain format = 'brief' select a,b,c from t where b in (1) order by a, b, c;
id	estRows	task	access object	operator info
IndexReader	10.00	root		index:Selection
└─Selection	10.00	cop[tikv]		eq(planner__core__grouped_ranges_order_by.t.b, 1)
  └─IndexFullScan	10000.00	cop[tikv]	table:t, index:iabc(a, b, c)	keep order:true, stats:pseudo
select a,b,c from t where b in (1) order by a, b, c;
a	b	c
1	1	1
1	1	2
1	1	3
1	1	4
2	1	1
2	1	2
2	1	3
2	1	5
3	1	1
3	1	2
3	1	3
3	1	6
4	1	2
4	1	4
4	1	7
5	1	1
5	1	3
5	1	8
explain format = 'brief' select a,b,c from t where c in (1, 2, 3) order by a, b, c;
id	estRows	task	access object	operator info
IndexReader	30.00	root		index:Selection
└─Selection	30.00	cop[tikv]		in(planner__core__grouped_ranges_order_by.t.c, 1, 2, 3)
  └─IndexFullScan	10000.00	cop[tikv]	table:t, index:iabc(a, b, c)	keep order:true, stats:pseudo
select a,b,c from t where c in (1, 2, 3) order by a, b, c;
a	b	c
1	1	1
1	1	2
1	1	3
1	2	1
1	2	2
1	3	1
1	3	2
1	3	3
1	4	1
1	4	3
1	5	1
1	5	2
1	5	3
1	6	2
2	1	1
2	1	2
2	1	3
2	2	1
2	2	3
2	3	1
2	3	2
2	3	3
2	4	2
2	5	1
2	5	2
2	5	3
2	7	1
3	1	1
3	1	2
3	1	3
3	2	2
3	3	1
3	3	2
3	3	3
3	4	1
3	5	1
3	5	2
3	5	3
3	6	3
4	1	2
4	2	1
4	3	3
4	4	2
4	5	1
4	8	1
4	8	3
5	1	1
5	1	3
5	3	2
5	5	1
5	7	2
insert into t values (4, null, 1, 400), (4, null, 2, 410), (4, 2, null, 420), (4, 4, 1, 430), (4, 6, 3, 440);
explain format = 'brief' select a,c from t where b in (1, 3, null) order by a, c;
id	estRows	task	access object	operator info
Sort	20.00	root		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.c
└─IndexReader	20.00	root		index:Projection
  └─Projection	20.00	cop[tikv]		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.c
    └─Selection	20.00	cop[tikv]		in(planner__core__grouped_ranges_order_by.t.b, 1, 3, NULL)
      └─IndexFullScan	10000.00	cop[tikv]	table:t, index:iabc(a, b, c)	keep order:false, stats:pseudo
select a,c from t where b in (1, 3, null) order by a, c;
a	c
1	1
1	1
1	2
1	2
1	3
1	3
1	4
1	6
2	1
2	1
2	2
2	2
2	3
2	3
2	5
2	7
3	1
3	1
3	2
3	2
3	3
3	3
3	6
3	8
4	2
4	3
4	4
4	6
4	7
4	9
5	1
5	2
5	3
5	4
5	8
5	9
deallocate prepare stmt1;
deallocate prepare stmt2;
drop table if exists t, t3;
create table t(a int, b int, c int, d int, index iabc(a,b,c));
explain format = 'brief' select * from t where a in (10,20,30,40,50) and b in (1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35) and d > 100 order by a, c;
id	estRows	task	access object	operator info
Projection	2.00	root		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.b, planner__core__grouped_ranges_order_by.t.c, planner__core__grouped_ranges_order_by.t.d
└─IndexLookUp	2.00	root		
  ├─IndexRangeScan(Build)	6.00	cop[tikv]	table:t, index:iabc(a, b, c)	range:[10 1,10 1], [10 3,10 3], [10 5,10 5], [10 11,10 11], [10 13,10 13], [10 15,10 15], [10 21,10 21], [10 23,10 23], [10 25,10 25], [10 31,10 31], [10 33,10 33], [10 35,10 35], [20 1,20 1], [20 3,20 3], [20 5,20 5], [20 11,20 11], [20 13,20 13], [20 15,20 15], [20 21,20 21], [20 23,20 23], [20 25,20 25], [20 31,20 31], [20 33,20 33], [20 35,20 35], [30 1,30 1], [30 3,30 3], [30 5,30 5], [30 11,30 11], [30 13,30 13], [30 15,30 15], [30 21,30 21], [30 23,30 23], [30 25,30 25], [30 31,30 31], [30 33,30 33], [30 35,30 35], [40 1,40 1], [40 3,40 3], [40 5,40 5], [40 11,40 11], [40 13,40 13], [40 15,40 15], [40 21,40 21], [40 23,40 23], [40 25,40 25], [40 31,40 31], [40 33,40 33], [40 35,40 35], [50 1,50 1], [50 3,50 3], [50 5,50 5], [50 11,50 11], [50 13,50 13], [50 15,50 15], [50 21,50 21], [50 23,50 23], [50 25,50 25], [50 31,50 31], [50 33,50 33], [50 35,50 35], keep order:true, stats:pseudo
  └─Selection(Probe)	2.00	cop[tikv]		gt(planner__core__grouped_ranges_order_by.t.d, 100)
    └─TableRowIDScan	6.00	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format = 'brief' select b,c from t where a in (10,20,30,40,50) and b in (1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35) and c > 1 order by b, c;
id	estRows	task	access object	operator info
IndexReader	20.00	root		index:Projection
└─Projection	20.00	cop[tikv]		planner__core__grouped_ranges_order_by.t.b, planner__core__grouped_ranges_order_by.t.c
  └─IndexRangeScan	20.00	cop[tikv]	table:t, index:iabc(a, b, c)	range:(10 1 1,10 1 +inf], (10 3 1,10 3 +inf], (10 5 1,10 5 +inf], (10 11 1,10 11 +inf], (10 13 1,10 13 +inf], (10 15 1,10 15 +inf], (10 21 1,10 21 +inf], (10 23 1,10 23 +inf], (10 25 1,10 25 +inf], (10 31 1,10 31 +inf], (10 33 1,10 33 +inf], (10 35 1,10 35 +inf], (20 1 1,20 1 +inf], (20 3 1,20 3 +inf], (20 5 1,20 5 +inf], (20 11 1,20 11 +inf], (20 13 1,20 13 +inf], (20 15 1,20 15 +inf], (20 21 1,20 21 +inf], (20 23 1,20 23 +inf], (20 25 1,20 25 +inf], (20 31 1,20 31 +inf], (20 33 1,20 33 +inf], (20 35 1,20 35 +inf], (30 1 1,30 1 +inf], (30 3 1,30 3 +inf], (30 5 1,30 5 +inf], (30 11 1,30 11 +inf], (30 13 1,30 13 +inf], (30 15 1,30 15 +inf], (30 21 1,30 21 +inf], (30 23 1,30 23 +inf], (30 25 1,30 25 +inf], (30 31 1,30 31 +inf], (30 33 1,30 33 +inf], (30 35 1,30 35 +inf], (40 1 1,40 1 +inf], (40 3 1,40 3 +inf], (40 5 1,40 5 +inf], (40 11 1,40 11 +inf], (40 13 1,40 13 +inf], (40 15 1,40 15 +inf], (40 21 1,40 21 +inf], (40 23 1,40 23 +inf], (40 25 1,40 25 +inf], (40 31 1,40 31 +inf], (40 33 1,40 33 +inf], (40 35 1,40 35 +inf], (50 1 1,50 1 +inf], (50 3 1,50 3 +inf], (50 5 1,50 5 +inf], (50 11 1,50 11 +inf], (50 13 1,50 13 +inf], (50 15 1,50 15 +inf], (50 21 1,50 21 +inf], (50 23 1,50 23 +inf], (50 25 1,50 25 +inf], (50 31 1,50 31 +inf], (50 33 1,50 33 +inf], (50 35 1,50 35 +inf], keep order:true, stats:pseudo
insert into t values
(10, 35, 9, 230), (10, 31, 10, 240), (10, 23, 11, 250), (10, 35, 12, 260),
(20, 13, 5, 190), (20, 15, 6, 200), (20, 21, 7, 210), (20, 23, 8, 220),
(30, 1, 1, 150), (30, 3, 2, 160), (30, 5, 3, 170), (30, 11, 4, 180),
(40, 21, 13, 270), (40, 3, 14, 280), (40, 5, 15, 290), (50, 11, 16, 300);
begin pessimistic;
insert into t values
(10, 1, 25, 390), (10, 3, 26, 400), (10, 5, 27, 410), (10, 11, 28, 420),
(20, 1, 21, 350), (20, 31, 22, 360), (20, 33, 23, 370), (20, 35, 24, 380),
(30, 13, 17, 310), (30, 35, 18, 320), (30, 2, 19, 330), (40, 23, 20, 340),
(40, 13, 29, 430), (50, 15, 30, 440), (50, 3, 31, 450), (50, 23, 32, 460);
explain format = 'brief' select * from t where a in (10,20,30,40,50) and b in (1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35) and d > 100 order by a, c;
id	estRows	task	access object	operator info
Projection	2.00	root		planner__core__grouped_ranges_order_by.t.a, planner__core__grouped_ranges_order_by.t.b, planner__core__grouped_ranges_order_by.t.c, planner__core__grouped_ranges_order_by.t.d
└─UnionScan	2.00	root		gt(planner__core__grouped_ranges_order_by.t.d, 100), in(planner__core__grouped_ranges_order_by.t.a, 10, 20, 30, 40, 50), in(planner__core__grouped_ranges_order_by.t.b, 1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35)
  └─IndexLookUp	2.00	root		
    ├─IndexRangeScan(Build)	6.00	cop[tikv]	table:t, index:iabc(a, b, c)	range:[10 1,10 1], [10 3,10 3], [10 5,10 5], [10 11,10 11], [10 13,10 13], [10 15,10 15], [10 21,10 21], [10 23,10 23], [10 25,10 25], [10 31,10 31], [10 33,10 33], [10 35,10 35], [20 1,20 1], [20 3,20 3], [20 5,20 5], [20 11,20 11], [20 13,20 13], [20 15,20 15], [20 21,20 21], [20 23,20 23], [20 25,20 25], [20 31,20 31], [20 33,20 33], [20 35,20 35], [30 1,30 1], [30 3,30 3], [30 5,30 5], [30 11,30 11], [30 13,30 13], [30 15,30 15], [30 21,30 21], [30 23,30 23], [30 25,30 25], [30 31,30 31], [30 33,30 33], [30 35,30 35], [40 1,40 1], [40 3,40 3], [40 5,40 5], [40 11,40 11], [40 13,40 13], [40 15,40 15], [40 21,40 21], [40 23,40 23], [40 25,40 25], [40 31,40 31], [40 33,40 33], [40 35,40 35], [50 1,50 1], [50 3,50 3], [50 5,50 5], [50 11,50 11], [50 13,50 13], [50 15,50 15], [50 21,50 21], [50 23,50 23], [50 25,50 25], [50 31,50 31], [50 33,50 33], [50 35,50 35], keep order:true, stats:pseudo
    └─Selection(Probe)	2.00	cop[tikv]		gt(planner__core__grouped_ranges_order_by.t.d, 100)
      └─TableRowIDScan	6.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t where a in (10,20,30,40,50) and b in (1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35) and d > 100 order by a, c;
a	b	c	d
10	35	9	230
10	31	10	240
10	23	11	250
10	35	12	260
10	1	25	390
10	3	26	400
10	5	27	410
10	11	28	420
20	13	5	190
20	15	6	200
20	21	7	210
20	23	8	220
20	1	21	350
20	31	22	360
20	33	23	370
20	35	24	380
30	1	1	150
30	3	2	160
30	5	3	170
30	11	4	180
30	13	17	310
30	35	18	320
40	21	13	270
40	3	14	280
40	5	15	290
40	23	20	340
40	13	29	430
50	11	16	300
50	15	30	440
50	3	31	450
50	23	32	460
explain format = 'brief' select b,c from t where a in (10,20,30,40,50) and b in (1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35) and c > 1 order by b, c;
id	estRows	task	access object	operator info
Projection	20.00	root		planner__core__grouped_ranges_order_by.t.b, planner__core__grouped_ranges_order_by.t.c
└─UnionScan	20.00	root		gt(planner__core__grouped_ranges_order_by.t.c, 1), in(planner__core__grouped_ranges_order_by.t.a, 10, 20, 30, 40, 50), in(planner__core__grouped_ranges_order_by.t.b, 1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35)
  └─IndexReader	20.00	root		index:IndexRangeScan
    └─IndexRangeScan	20.00	cop[tikv]	table:t, index:iabc(a, b, c)	range:(10 1 1,10 1 +inf], (10 3 1,10 3 +inf], (10 5 1,10 5 +inf], (10 11 1,10 11 +inf], (10 13 1,10 13 +inf], (10 15 1,10 15 +inf], (10 21 1,10 21 +inf], (10 23 1,10 23 +inf], (10 25 1,10 25 +inf], (10 31 1,10 31 +inf], (10 33 1,10 33 +inf], (10 35 1,10 35 +inf], (20 1 1,20 1 +inf], (20 3 1,20 3 +inf], (20 5 1,20 5 +inf], (20 11 1,20 11 +inf], (20 13 1,20 13 +inf], (20 15 1,20 15 +inf], (20 21 1,20 21 +inf], (20 23 1,20 23 +inf], (20 25 1,20 25 +inf], (20 31 1,20 31 +inf], (20 33 1,20 33 +inf], (20 35 1,20 35 +inf], (30 1 1,30 1 +inf], (30 3 1,30 3 +inf], (30 5 1,30 5 +inf], (30 11 1,30 11 +inf], (30 13 1,30 13 +inf], (30 15 1,30 15 +inf], (30 21 1,30 21 +inf], (30 23 1,30 23 +inf], (30 25 1,30 25 +inf], (30 31 1,30 31 +inf], (30 33 1,30 33 +inf], (30 35 1,30 35 +inf], (40 1 1,40 1 +inf], (40 3 1,40 3 +inf], (40 5 1,40 5 +inf], (40 11 1,40 11 +inf], (40 13 1,40 13 +inf], (40 15 1,40 15 +inf], (40 21 1,40 21 +inf], (40 23 1,40 23 +inf], (40 25 1,40 25 +inf], (40 31 1,40 31 +inf], (40 33 1,40 33 +inf], (40 35 1,40 35 +inf], (50 1 1,50 1 +inf], (50 3 1,50 3 +inf], (50 5 1,50 5 +inf], (50 11 1,50 11 +inf], (50 13 1,50 13 +inf], (50 15 1,50 15 +inf], (50 21 1,50 21 +inf], (50 23 1,50 23 +inf], (50 25 1,50 25 +inf], (50 31 1,50 31 +inf], (50 33 1,50 33 +inf], (50 35 1,50 35 +inf], keep order:true, stats:pseudo
select b,c from t where a in (10,20,30,40,50) and b in (1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35) and c > 1 order by b, c;
b	c
1	21
1	25
3	2
3	14
3	26
3	31
5	3
5	15
5	27
11	4
11	16
11	28
13	5
13	17
13	29
15	6
15	30
21	7
21	13
23	8
23	11
23	20
23	32
31	10
31	22
33	23
35	9
35	12
35	18
35	24
commit;
select * from t where a in (10,20,30,40,50) and b in (1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35) and d > 100 order by a, c;
a	b	c	d
10	35	9	230
10	31	10	240
10	23	11	250
10	35	12	260
10	1	25	390
10	3	26	400
10	5	27	410
10	11	28	420
20	13	5	190
20	15	6	200
20	21	7	210
20	23	8	220
20	1	21	350
20	31	22	360
20	33	23	370
20	35	24	380
30	1	1	150
30	3	2	160
30	5	3	170
30	11	4	180
30	13	17	310
30	35	18	320
40	21	13	270
40	3	14	280
40	5	15	290
40	23	20	340
40	13	29	430
50	11	16	300
50	15	30	440
50	3	31	450
50	23	32	460
select b,c from t where a in (10,20,30,40,50) and b in (1, 3, 5, 11, 13, 15, 21, 23, 25, 31, 33, 35) and c > 1 order by b, c;
b	c
1	21
1	25
3	2
3	14
3	26
3	31
5	3
5	15
5	27
11	4
11	16
11	28
13	5
13	17
13	29
15	6
15	30
21	7
21	13
23	8
23	11
23	20
23	32
31	10
31	22
33	23
35	9
35	12
35	18
35	24
create table t3(a int, b int, primary key(a,b) clustered);
insert into t3 value(1,1),(7,3),(5,5),(2,4),(4,6),(5,8);
select * from t3 where a in (1,2,3,4,5,6,7) and b > 1 order by b;
a	b
7	3
2	4
5	5
4	6
5	8
begin pessimistic;
insert into t3 value(6,7),(3,2),(4,0),(6,9),(3,10);
explain format = 'brief' select * from t3 where a in (1,2,3,4,5,6,7) and b > 1 order by b;
id	estRows	task	access object	operator info
UnionScan	233.33	root		gt(planner__core__grouped_ranges_order_by.t3.b, 1), in(planner__core__grouped_ranges_order_by.t3.a, 1, 2, 3, 4, 5, 6, 7)
└─TableReader	233.33	root		data:TableRangeScan
  └─TableRangeScan	233.33	cop[tikv]	table:t3	range:(1 1,1 +inf], (2 1,2 +inf], (3 1,3 +inf], (4 1,4 +inf], (5 1,5 +inf], (6 1,6 +inf], (7 1,7 +inf], keep order:true, stats:pseudo
select * from t3 where a in (1,2,3,4,5,6,7) and b > 1 order by b;
a	b
3	2
7	3
2	4
5	5
4	6
6	7
5	8
6	9
3	10
commit;
select * from t3 where a in (1,2,3,4,5,6,7) and b > 1 order by b;
a	b
3	2
7	3
2	4
5	5
4	6
6	7
5	8
6	9
3	10
