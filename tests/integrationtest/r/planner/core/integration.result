set tidb_cost_model_version=2;
drop table if exists t;
create table t(a varchar(10), b int, c int);
show columns from t where true;
Field	Type	Null	Key	Default	Extra
a	varchar(10)	YES		NULL	
b	int(11)	YES		NULL	
c	int(11)	YES		NULL	
show columns from t where field = 'b';
Field	Type	Null	Key	Default	Extra
b	int(11)	YES		NULL	
show columns from t where field in (select 'b');
Field	Type	Null	Key	Default	Extra
b	int(11)	YES		NULL	
show columns from t where field in (select 'b') and true;
Field	Type	Null	Key	Default	Extra
b	int(11)	YES		NULL	
show columns from t where field in (select 'b') and false;
Field	Type	Null	Key	Default	Extra
insert into t values('c', 0, 0);
show columns from t where field < all (select a from t);
Field	Type	Null	Key	Default	Extra
b	int(11)	YES		NULL	
a	varchar(10)	YES		NULL	
insert into t values('b', 0, 0);
show columns from t where field < all (select a from t);
Field	Type	Null	Key	Default	Extra
a	varchar(10)	YES		NULL	
drop table if exists t;
create table t(a int, b int);
insert into t values(1,10),(2,20);
select t1.* from t t0 cross join (t t1 join t t2 on 100=t0.a);
Error 1054 (42S22): Unknown column 't0.a' in 'on clause'
drop table if exists t;
create table t(c1 int, c2 varchar(255));
insert into t values(1,'a'),(2,'d'),(3,'c');
select t01.c1,t01.c2,t01.c3 from (select t1.*,@c3:=@c3+1 as c3 from (select t.*,@c3:=0 from t order by t.c1)t1)t01 where t01.c3=1 and t01.c2='d';
c1	c2	c3
select t01.c1,t01.c2,t01.c3 from (select t1.*,@c3:=@c3+1 as c3 from (select t.*,@c3:=0 from t order by t.c1)t1)t01 where t01.c3=2 and t01.c2='d';
c1	c2	c3
2	d	2
drop table if exists bit_col_t;
create table bit_col_t (a bit(64));
drop table bit_col_t;
create table bit_col_t (a bit(1));
drop table bit_col_t;
create table bit_col_t (a bit(0));
Error 3013 (HY000): Invalid size for column 'a'.
create table bit_col_t (a bit(65));
Error 1439 (42000): Display width out of range for column 'a' (max = 64)
set tidb_cost_model_version=2;
drop table if exists customer;
create table customer (C_CUSTKEY bigint(20) NOT NULL, C_NAME varchar(25) NOT NULL, C_ADDRESS varchar(25) NOT NULL, PRIMARY KEY (`C_CUSTKEY`) /*T![clustered_index] CLUSTERED */);
drop table if exists orders;
create table orders (O_ORDERKEY bigint(20) NOT NULL, O_CUSTKEY bigint(20) NOT NULL, O_TOTALPRICE decimal(15,2) NOT NULL, PRIMARY KEY (`O_ORDERKEY`) /*T![clustered_index] CLUSTERED */);
insert into customer values (6, "xiao zhang", "address1");
set @@tidb_opt_agg_push_down=1;
select c_custkey, count(o_orderkey) as c_count from customer left outer join orders on c_custkey = o_custkey group by c_custkey;
c_custkey	c_count
6	0
explain format='brief' select c_custkey, count(o_orderkey) as c_count from customer left outer join orders on c_custkey = o_custkey group by c_custkey;
id	estRows	task	access object	operator info
Projection	8000.00	root		planner__core__integration.customer.c_custkey, Column#7
â””â”€HashAgg	8000.00	root		group by:planner__core__integration.customer.c_custkey, funcs:count(Column#8)->Column#7, funcs:firstrow(planner__core__integration.customer.c_custkey)->planner__core__integration.customer.c_custkey
  â””â”€HashJoin	10000.00	root		left outer join, equal:[eq(planner__core__integration.customer.c_custkey, planner__core__integration.orders.o_custkey)]
    â”œâ”€HashAgg(Build)	8000.00	root		group by:planner__core__integration.orders.o_custkey, funcs:count(Column#9)->Column#8, funcs:firstrow(planner__core__integration.orders.o_custkey)->planner__core__integration.orders.o_custkey
    â”‚ â””â”€TableReader	8000.00	root		data:HashAgg
    â”‚   â””â”€HashAgg	8000.00	cop[tikv]		group by:planner__core__integration.orders.o_custkey, funcs:count(planner__core__integration.orders.o_orderkey)->Column#9
    â”‚     â””â”€TableFullScan	10000.00	cop[tikv]	table:orders	keep order:false, stats:pseudo
    â””â”€TableReader(Probe)	10000.00	root		data:TableFullScan
      â””â”€TableFullScan	10000.00	cop[tikv]	table:customer	keep order:false, stats:pseudo
select c_custkey, count(o_orderkey) as c_count from orders right outer join customer on c_custkey = o_custkey group by c_custkey;
c_custkey	c_count
6	0
explain format='brief' select c_custkey, count(o_orderkey) as c_count from orders right outer join customer on c_custkey = o_custkey group by c_custkey;
id	estRows	task	access object	operator info
Projection	8000.00	root		planner__core__integration.customer.c_custkey, Column#7
â””â”€HashAgg	8000.00	root		group by:planner__core__integration.customer.c_custkey, funcs:count(Column#8)->Column#7, funcs:firstrow(planner__core__integration.customer.c_custkey)->planner__core__integration.customer.c_custkey
  â””â”€HashJoin	10000.00	root		right outer join, equal:[eq(planner__core__integration.orders.o_custkey, planner__core__integration.customer.c_custkey)]
    â”œâ”€HashAgg(Build)	8000.00	root		group by:planner__core__integration.orders.o_custkey, funcs:count(Column#9)->Column#8, funcs:firstrow(planner__core__integration.orders.o_custkey)->planner__core__integration.orders.o_custkey
    â”‚ â””â”€TableReader	8000.00	root		data:HashAgg
    â”‚   â””â”€HashAgg	8000.00	cop[tikv]		group by:planner__core__integration.orders.o_custkey, funcs:count(planner__core__integration.orders.o_orderkey)->Column#9
    â”‚     â””â”€TableFullScan	10000.00	cop[tikv]	table:orders	keep order:false, stats:pseudo
    â””â”€TableReader(Probe)	10000.00	root		data:TableFullScan
      â””â”€TableFullScan	10000.00	cop[tikv]	table:customer	keep order:false, stats:pseudo
drop table if exists t;
create table t(a int, b int);
select * from t where 0 and c = 10;
Error 1054 (42S22): Unknown column 'c' in 'where clause'
create view v as select 1 as b;
drop table if exists t;
create table t (a int);
update v, t set a=2;
update v, t set b=2;
Error 1288 (HY000): The target table v of the UPDATE is not updatable
create database db1;
use db1;
update planner__core__integration.t, (select 1 as a) as t set planner__core__integration.t.a=1;
update (select 1 as a) as t, planner__core__integration.t set planner__core__integration.t.a=1;
drop table if exists t;
drop table if exists t1;
create table t(a int);
create table t1(b int);
update (select 1 as a) as t set a=1;
Error 1288 (HY000): The target table t of the UPDATE is not updatable
update (select 1 as a) as t, t1 set a=1;
Error 1288 (HY000): The target table t of the UPDATE is not updatable
drop table if exists t;
drop table if exists t1;
create table t(a int default -1, c int as (a+10) stored);
insert into t(a) values(1);
update planner__core__integration.t, (select 1 as b) as t set planner__core__integration.t.a=default;
select * from t;
a	c
1	11
drop table if exists t;
drop table if exists t1;
create table t (c int);
select group_concat((select concat(c,group_concat(c)) FROM t where xxx=xxx)) FROM t;
Error 1054 (42S22): Unknown column 'xxx' in 'where clause'
drop table if exists t1;
drop view if exists v1;
CREATE TABLE t1(c0 INT UNIQUE);
CREATE definer='root'@'localhost' VIEW v1(c0) AS SELECT 1 FROM t1;
SELECT v1.c0 FROM v1 WHERE (true)LIKE(v1.c0);
c0
SELECT v2.c0 FROM (select 1 as c0 from t1) v2 WHERE (v2.c0)like(True);
c0
drop table if exists t3;
CREATE TABLE t3(c0 INT, primary key(c0));
SELECT v2.c0 FROM (select 1 as c0 from t3) v2 WHERE (v2.c0)like(True);
c0
drop table if exists t1, t2;
create table t1(x int not null);
create table t2(x int);
insert into t2 values (1);
select IFNULL((select t1.x from t1 where t1.x = t2.x), 'xxx') as col1 from t2;
col1
xxx
select ifnull(t1.x, 'xxx') from t2 left join t1 using(x);
ifnull(t1.x, 'xxx')
xxx
select ifnull(t1.x, 'xxx') from t2 natural left join t1;
ifnull(t1.x, 'xxx')
xxx
drop table if exists t1, t2;
create table t1(a int not null, b int not null);
insert into t1 values (1,1);
create table t2(a int not null, b int not null);
insert into t2 values (2,2);
select * from t1 where t1.a not in (select a from t2 where t2.a = t1.a and t2.a > 1);
a	b
1	1
select * from t1 where t1.a not in (select a from t2 where t2.b = t1.b and t2.a > 1);
a	b
1	1
select * from t1 where t1.a not in (select a from t2 where t2.b = t1.b and t2.b > 1);
a	b
1	1
select q.a in (select count(*) from t1 s where not exists (select 1 from t1 p where q.a > 1 and p.a = s.a)) from t1 q;
q.a in (select count(*) from t1 s where not exists (select 1 from t1 p where q.a > 1 and p.a = s.a))
1
select q.a in (select not exists (select 1 from t1 p where q.a > 1 and p.a = s.a) from t1 s) from t1 q;
q.a in (select not exists (select 1 from t1 p where q.a > 1 and p.a = s.a) from t1 s)
1
drop table t1, t2;
create table t1(a int not null, b int);
insert into t1 values (1,null);
create table t2(a int not null, b int);
insert into t2 values (2,2);
select * from t1 where t1.a not in (select a from t2 where t2.b > t1.b);
a	b
1	NULL
select * from t1 where t1.a not in (select a from t2 where t1.a = 2);
a	b
1	NULL
create database test_new_collation;
use test_new_collation;
set @@tidb_partition_prune_mode = 'dynamic';
CREATE TABLE thash (a int, c varchar(20) charset utf8mb4 collate utf8mb4_general_ci, key(a)) partition by hash(a) partitions 4;
CREATE TABLE trange (a int, c varchar(20) charset utf8mb4 collate utf8mb4_general_ci, key(a)) partition by range(a) (
partition p0 values less than (10),
partition p1 values less than (20),
partition p2 values less than (30),
partition p3 values less than (40));
insert into thash values (1, 'a'), (1, 'A'), (11, 'a'), (11, 'A'), (21, 'a'), (21, 'A'), (31, 'a'), (31, 'A');
insert into trange values (1, 'a'), (1, 'A'), (11, 'a'), (11, 'A'), (21, 'a'), (21, 'A'), (31, 'a'), (31, 'A');
select * from thash use index(a) where a in (1, 11, 31) and c='a';
a	c
1	A
1	a
11	A
11	a
31	A
31	a
select * from thash ignore index(a) where a in (1, 11, 31) and c='a';
a	c
1	A
1	a
11	A
11	a
31	A
31	a
select * from trange use index(a) where a in (1, 11, 31) and c='a';
a	c
1	A
1	a
11	A
11	a
31	A
31	a
select * from trange ignore index(a) where a in (1, 11, 31) and c='a';
a	c
1	A
1	a
11	A
11	a
31	A
31	a
create table strrange(a varchar(10) charset utf8mb4 collate utf8mb4_general_ci, b int) partition by range columns(a) (
partition p0 values less than ('a'),
partition p1 values less than ('k'),
partition p2 values less than ('z'));
insert into strrange values ('a', 1), ('A', 1), ('y', 1), ('Y', 1), ('q', 1);
select * from strrange where a in ('a', 'y');
a	b
A	1
Y	1
a	1
y	1
create table strlist(a varchar(10) charset utf8mb4 collate utf8mb4_general_ci, b int) partition by list columns (a) (
partition p0 values in ('a', 'b'),
partition p1 values in ('c', 'd'),
partition p2 values in ('e', 'f'));
insert into strlist values ('a', 1), ('A', 1), ('d', 1), ('D', 1), ('e', 1);
select * from strlist where a='a';
a	b
A	1
a	1
select * from strlist where a in ('D', 'e');
a	b
D	1
d	1
e	1
use planner__core__integration;
drop table if exists t;
create table t(a int, b int, index idx_a(a), index idx_b(b));
select * from t where a > 1 and a < 10 order by b;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
0
create session binding for select * from t where a > 1 and a < 10 order by b using select /*+ use_index(t, idx_a) */ * from t where a > 1 and a < 10 order by b;
select * from t where a > 1 and a < 10 order by b;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
1
select /*+ use_index(t, idx_b) */ * from t where a > 1 and a < 10 order by b;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
1
select /*+ use_index(t, idx_b) */ * from t where a > 1 and a < 10 order by b;
a	b
Level	Code	Message
Warning	1105	The system ignores the hints in the current query and uses the hints specified in the bindSQL: SELECT /*+ use_index(`t` `idx_a`)*/ * FROM `planner__core__integration`.`t` WHERE `a` > 1 AND `a` < 10 ORDER BY `b`
drop table if exists t;
create table t(a int, b int, index idx_a(a), index idx_b(b));
set @@tidb_opt_advanced_join_hint=0;
select /*+ hash_join(t1) merge_join(t2) */ * from t t1 join t t2 join t t3 where t1.a = t2.a and t2.a=t3.a;
a	b	a	b	a	b
Level	Code	Message
Warning	1815	Join hints are conflict, you can only specify one type of join
set @@tidb_opt_advanced_join_hint=1;
select /*+ hash_join(t1) merge_join(t2) */ * from t t1 join t t2 join t t3 where t1.a = t2.a and t2.a=t3.a;
a	b	a	b	a	b
Level	Code	Message
Warning	1815	Join hints conflict after join reorder phase, you can only specify one type of join
set @@tidb_opt_advanced_join_hint=DEFAULT;
drop table if exists t1, t2;
create table t1(a int not null, b int, key(a));
insert into t1 values(1,1),(2,2);
create table t2(a int not null, b int, key(a));
insert into t2 values(1,1),(2,2),(3,3),(4,4),(5,5);
analyze table t1, t2;
explain format = 'brief' select /*+ TIDB_INLJ(t1) */ * from t1 join t2 on t1.a = t2.a;
id	estRows	task	access object	operator info
IndexJoin	2.00	root		inner join, inner:IndexLookUp, outer key:planner__core__integration.t2.a, inner key:planner__core__integration.t1.a, equal cond:eq(planner__core__integration.t2.a, planner__core__integration.t1.a)
â”œâ”€TableReader(Build)	5.00	root		data:TableFullScan
â”‚ â””â”€TableFullScan	5.00	cop[tikv]	table:t2	keep order:false
â””â”€IndexLookUp(Probe)	2.00	root		
  â”œâ”€IndexRangeScan(Build)	2.00	cop[tikv]	table:t1, index:a(a)	range: decided by [eq(planner__core__integration.t1.a, planner__core__integration.t2.a)], keep order:false
  â””â”€TableRowIDScan(Probe)	2.00	cop[tikv]	table:t1	keep order:false
drop table if exists t0,t1;
CREATE TABLE t0(c0 INT);
CREATE TABLE t1(c0 BOOL, c1 BOOL);
INSERT INTO t1 VALUES (false, true);
INSERT INTO t1 VALUES (true, true);
CREATE definer='root'@'localhost'  VIEW v0(c0, c1, c2) AS SELECT t1.c0, LOG10(t0.c0), t1.c0 FROM t0, t1;
INSERT INTO t0(c0) VALUES (3);
SELECT /*+ MERGE_JOIN(t1, t0, v0)*/v0.c2, t1.c0 FROM v0,  t0 CROSS JOIN t1 ORDER BY -v0.c1;
c2	c0
1	0
0	0
1	1
0	1
select max(t.col) from (select 'a' as col union all select '' as col) as t;
max(t.col)
a
drop table if exists t;
create table t(a int);
explain format='verbose' select /*+ stream_agg() */ count(*) from t;
id	estRows	estCost	task	access object	operator info
StreamAgg_14	1.00	168985.35	root		funcs:count(Column#4)->Column#3
â””â”€TableReader_15	1.00	168935.45	root		data:StreamAgg_8
  â””â”€StreamAgg_8	1.00	2534000.00	cop[tikv]		funcs:count(1)->Column#4
    â””â”€TableFullScan_13	10000.00	2035000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
explain format='verbose' select /*+ hash_agg() */ count(*) from t;
id	estRows	estCost	task	access object	operator info
HashAgg_9	1.00	150603.19	root		funcs:count(Column#4)->Column#3
â””â”€TableReader_10	1.00	149075.93	root		data:HashAgg_5
  â””â”€HashAgg_5	1.00	2236107.30	cop[tikv]		funcs:count(1)->Column#4
    â””â”€TableFullScan_8	10000.00	2035000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
drop table if exists t, pt, vt;
create table t(a int, b int);
insert into t values(1, 1);
create table pt(a int primary key, b int) partition by range(a) (PARTITION `p0` VALUES LESS THAN (10), PARTITION `p1` VALUES LESS THAN (20), PARTITION `p2` VALUES LESS THAN (30));
insert into pt values(1, 1), (11, 11), (21, 21);
create definer='root'@'localhost' view vt(a, b) as select a, b from t;
select * from pt, vt where pt.a = vt.a;
a	b	a	b
1	1	1	1
drop table if exists t;
create table t(a int(11), b int) partition by range (a) (partition p0 values less than (3), partition p1 values less than maxvalue);
insert into t values(1, 1), (2, 1), (3, 1), (4, 2), (4, 2);
set session tidb_opt_agg_push_down=1;
set @@tidb_partition_prune_mode='static';
explain format = 'brief' select approx_count_distinct(a), b from t group by b order by b desc;
id	estRows	task	access object	operator info
Sort	16000.00	root		planner__core__integration.t.b:desc
â””â”€HashAgg	16000.00	root		group by:planner__core__integration.t.b, funcs:approx_count_distinct(Column#5)->Column#4, funcs:firstrow(Column#6)->planner__core__integration.t.b
  â””â”€PartitionUnion	16000.00	root		
    â”œâ”€HashAgg	8000.00	root		group by:planner__core__integration.t.b, funcs:approx_count_distinct(planner__core__integration.t.a)->Column#5, funcs:firstrow(planner__core__integration.t.b)->Column#6, funcs:firstrow(planner__core__integration.t.b)->planner__core__integration.t.b
    â”‚ â””â”€TableReader	10000.00	root		data:TableFullScan
    â”‚   â””â”€TableFullScan	10000.00	cop[tikv]	table:t, partition:p0	keep order:false, stats:pseudo
    â””â”€HashAgg	8000.00	root		group by:planner__core__integration.t.b, funcs:approx_count_distinct(planner__core__integration.t.a)->Column#5, funcs:firstrow(planner__core__integration.t.b)->Column#6, funcs:firstrow(planner__core__integration.t.b)->planner__core__integration.t.b
      â””â”€TableReader	10000.00	root		data:TableFullScan
        â””â”€TableFullScan	10000.00	cop[tikv]	table:t, partition:p1	keep order:false, stats:pseudo
select approx_count_distinct(a), b from t group by b order by b desc;
approx_count_distinct(a)	b
1	2
3	1
drop table if exists hash_partition_overflow;
create table hash_partition_overflow (c0 bigint unsigned) partition by hash(c0) partitions 3;
insert into hash_partition_overflow values (9223372036854775808);
select * from hash_partition_overflow where c0 = 9223372036854775808;
c0
9223372036854775808
select * from hash_partition_overflow where c0 in (1, 9223372036854775808);
c0
9223372036854775808
drop table if exists t0, t1;
create table t0(c0 int primary key);
create table t1(c0 int primary key);
CREATE INDEX i0 ON t0(c0);
CREATE INDEX i0 ON t1(c0);
select /*+ MERGE_JOIN(t0, t1) */ * from t0, t1 where t0.c0 = t1.c0;
c0	c0
drop table if exists PK_MULTI_COL_5177;
CREATE TABLE PK_MULTI_COL_5177 (
COL1 binary(10) NOT NULL,
COL2 varbinary(10) NOT NULL,
COL3 smallint(45) NOT NULL,
PRIMARY KEY (COL1(5),COL2,COL3),
UNIQUE KEY UIDXM (COL1(5),COL2),
UNIQUE KEY UIDX (COL2),
KEY IDX3 (COL3),
KEY IDXM (COL3,COL2));
insert into PK_MULTI_COL_5177(col1, col2, col3) values(0x00000000000000000000, 0x002B200DF5BA03E59F82, 1);
select col1, col2 from PK_MULTI_COL_5177 where col1 = 0x00000000000000000000 and col2 in (0x002B200DF5BA03E59F82, 0x002B200DF5BA03E59F82, 0x002B200DF5BA03E59F82);
col1	col2
          	 + õºåŸ‚
select col1, col2 from PK_MULTI_COL_5177 where col1 = 0x00000000000000000000 and col2 = 0x002B200DF5BA03E59F82;
col1	col2
          	 + õºåŸ‚
drop table if exists t;
create table t(a int, b int);
select count(a) as b from t group by a order by b;
b
select count(a) as cnt from t group by a order by b;
Error 1055 (42000): Expression #1 of ORDER BY is not in GROUP BY clause and contains nonaggregated column '' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
drop table if exists t;
create table t(a int primary key);
select * from t t1, (select a from t order by a+1) t2 where t1.a = t2.a;
a	a
drop table if exists t0, t1;
CREATE TABLE t0(t0 INT UNIQUE);
CREATE TABLE t1(c0 FLOAT);
INSERT INTO t1(c0) VALUES (0);
INSERT INTO t0(t0) VALUES (NULL), (NULL);
SELECT t1.c0 FROM t1 LEFT JOIN t0 ON 1;
c0
0
0
drop table if exists t0, t1;
CREATE TABLE t0(t0 INT);
CREATE TABLE t1(c0 FLOAT);
INSERT INTO t1(c0) VALUES (0);
INSERT INTO t0(t0) VALUES (NULL), (NULL);
SELECT t1.c0 FROM t1 LEFT JOIN t0 ON 1;
c0
0
0
drop table if exists t0, t1;
CREATE TABLE t0(t0 INT);
CREATE TABLE t1(c0 FLOAT);
create unique index idx on t0(t0);
INSERT INTO t1(c0) VALUES (0);
INSERT INTO t0(t0) VALUES (NULL), (NULL);
SELECT t1.c0 FROM t1 LEFT JOIN t0 ON 1;
c0
0
0
drop table if exists floor_unix_timestamp;
create table floor_unix_timestamp (ts timestamp(3))
partition by range (floor(unix_timestamp(ts))) (
partition p0 values less than (unix_timestamp('2020-04-05 00:00:00')),
partition p1 values less than (unix_timestamp('2020-04-12 00:00:00')),
partition p2 values less than (unix_timestamp('2020-04-15 00:00:00')));
insert into floor_unix_timestamp values ('2020-04-04 00:00:00');
insert into floor_unix_timestamp values ('2020-04-04 23:59:59.999');
insert into floor_unix_timestamp values ('2020-04-05 00:00:00');
insert into floor_unix_timestamp values ('2020-04-05 00:00:00.001');
insert into floor_unix_timestamp values ('2020-04-12 01:02:03.456');
insert into floor_unix_timestamp values ('2020-04-14 00:00:42');
select count(*) from floor_unix_timestamp where '2020-04-05 00:00:00.001' = ts;
count(*)
1
select * from floor_unix_timestamp where ts > '2020-04-05 00:00:00' order by ts;
ts
2020-04-05 00:00:00.001
2020-04-12 01:02:03.456
2020-04-14 00:00:42.000
select count(*) from floor_unix_timestamp where ts <= '2020-04-05 23:00:00';
count(*)
4
select * from floor_unix_timestamp partition(p1, p2) where ts > '2020-04-14 00:00:00';
ts
2020-04-14 00:00:42.000
drop table if exists t;
create table t(a int, b int, primary key(a));
insert into t values(1, 1);
set session tidb_opt_agg_push_down = 0;
select avg(a) from (select * from t ta union all select * from t tb) t;
avg(a)
1.0000
select avg(b) from (select * from t ta union all select * from t tb) t;
avg(b)
1.0000
select count(distinct a) from (select * from t ta union all select * from t tb) t;
count(distinct a)
1
select count(distinct b) from (select * from t ta union all select * from t tb) t;
count(distinct b)
1
set session tidb_opt_agg_push_down = 1;
select avg(a) from (select * from t ta union all select * from t tb) t;
avg(a)
1.0000
select avg(b) from (select * from t ta union all select * from t tb) t;
avg(b)
1.0000
select count(distinct a) from (select * from t ta union all select * from t tb) t;
count(distinct a)
1
select count(distinct b) from (select * from t ta union all select * from t tb) t;
count(distinct b)
1
drop table if exists t1, t2;
create table t1 (a int, b int) partition by range(a) (partition p0 values less than(10), partition p1 values less than MAXVALUE);
create table t2 (a int, b int);
select /*+ MERGE_JOIN(t1, t2) */ * from t1 partition (p0), t2  where t1.a > 100 and t1.a = t2.a;
a	b	a	b
drop table if exists t;
create table t(a int,b int,c int,d int,e int,unique key idx_ab(a,b),unique key(c),unique key(d));
explain format = 'brief' select /*+ use_index_merge(t,c,idx_ab) */ * from t where a = 1 or (e = 1 and c = 1);
id	estRows	task	access object	operator info
IndexMerge	0.01	root		type: union
â”œâ”€IndexRangeScan(Build)	10.00	cop[tikv]	table:t, index:idx_ab(a, b)	range:[1,1], keep order:false, stats:pseudo
â”œâ”€IndexRangeScan(Build)	1.00	cop[tikv]	table:t, index:c(c)	range:[1,1], keep order:false, stats:pseudo
â””â”€Selection(Probe)	0.01	cop[tikv]		or(eq(planner__core__integration.t.a, 1), and(eq(planner__core__integration.t.e, 1), eq(planner__core__integration.t.c, 1)))
  â””â”€TableRowIDScan	11.00	cop[tikv]	table:t	keep order:false, stats:pseudo
insert into t values (2, 1, 1, 1, 2);
select /*+ use_index_merge(t,c,idx_ab) */ * from t where a = 1 or (e = 1 and c = 1);
a	b	c	d	e
drop table if exists t;
create table t (a int, b int, c int, primary key (a, b) clustered, key idx_c(c));
insert into t values (1, 1, 1), (10, 10, 10), (100, 100, 100);
explain select /*+ use_index_merge(t) */ a from t where a < 2 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	5548.89	root		planner__core__integration.t.a
â””â”€Sort_7	5548.89	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_12	5548.89	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	5548.89	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where a < 2 or c > 10000 order by a, b;
a
1
explain select /*+ use_index_merge(t) */ a from t where a < 2 or a > 88 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	7771.11	root		planner__core__integration.t.a
â””â”€Sort_7	7771.11	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_13	7771.11	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:(88,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.11	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where a < 2 or a > 88 or c > 10000 order by a, b;
a
1
100
explain select /*+ use_index_merge(t) */ a from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8015.79	root		planner__core__integration.t.a
â””â”€Sort_7	8015.79	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_16	7119.80	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_15(Probe)	7119.80	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1)))
      â””â”€TableRowIDScan_14	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
a
1
10
100
explain select /*+ use_index_merge(t) */ a from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8235.60	root		planner__core__integration.t.a
â””â”€Sort_7	8235.60	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_18	7315.03	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_13(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_12	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_15(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_17(Probe)	7315.03	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(and(ge(planner__core__integration.t.a, 20), lt(planner__core__integration.t.b, 10)), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1))))
      â””â”€TableRowIDScan_16	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
a
1
10
100
explain select /*+ use_index_merge(t) */ b from t where a < 2 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	5548.89	root		planner__core__integration.t.b
â””â”€Sort_7	5548.89	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_12	5548.89	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	5548.89	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where a < 2 or c > 10000 order by a, b;
b
1
explain select /*+ use_index_merge(t) */ b from t where a < 2 or a > 88 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	7771.11	root		planner__core__integration.t.b
â””â”€Sort_7	7771.11	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_13	7771.11	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:(88,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.11	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where a < 2 or a > 88 or c > 10000 order by a, b;
b
1
100
explain select /*+ use_index_merge(t) */ b from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8015.79	root		planner__core__integration.t.b
â””â”€Sort_7	8015.79	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_16	7119.80	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_15(Probe)	7119.80	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1)))
      â””â”€TableRowIDScan_14	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
b
1
10
100
explain select /*+ use_index_merge(t) */ b from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8235.60	root		planner__core__integration.t.b
â””â”€Sort_7	8235.60	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_18	7315.03	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_13(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_12	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_15(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_17(Probe)	7315.03	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(and(ge(planner__core__integration.t.a, 20), lt(planner__core__integration.t.b, 10)), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1))))
      â””â”€TableRowIDScan_16	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
b
1
10
100
explain select /*+ use_index_merge(t) */ c from t where a < 2 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	5548.89	root		planner__core__integration.t.c
â””â”€Sort_7	5548.89	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_12	5548.89	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	5548.89	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where a < 2 or c > 10000 order by a, b;
c
1
explain select /*+ use_index_merge(t) */ c from t where a < 2 or a > 88 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	7771.11	root		planner__core__integration.t.c
â””â”€Sort_7	7771.11	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_13	7771.11	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:(88,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.11	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where a < 2 or a > 88 or c > 10000 order by a, b;
c
1
100
explain select /*+ use_index_merge(t) */ c from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8015.79	root		planner__core__integration.t.c
â””â”€Sort_7	8015.79	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_16	7119.80	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_15(Probe)	7119.80	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1)))
      â””â”€TableRowIDScan_14	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
c
1
10
100
explain select /*+ use_index_merge(t) */ c from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8235.60	root		planner__core__integration.t.c
â””â”€Sort_7	8235.60	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_18	7315.03	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_13(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_12	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_15(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_17(Probe)	7315.03	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(and(ge(planner__core__integration.t.a, 20), lt(planner__core__integration.t.b, 10)), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1))))
      â””â”€TableRowIDScan_16	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
c
1
10
100
explain select /*+ use_index_merge(t) */ a,b from t where a < 2 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Sort_5	5548.89	root		planner__core__integration.t.a, planner__core__integration.t.b
â””â”€Projection_7	5548.89	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_11	5548.89	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	5548.89	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where a < 2 or c > 10000 order by a, b;
a	b
1	1
explain select /*+ use_index_merge(t) */ a,b from t where a < 2 or a > 88 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Sort_5	7771.11	root		planner__core__integration.t.a, planner__core__integration.t.b
â””â”€Projection_7	7771.11	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_12	7771.11	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:(88,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	7771.11	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where a < 2 or a > 88 or c > 10000 order by a, b;
a	b
1	1
100	100
explain select /*+ use_index_merge(t) */ a,b from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Sort_5	8015.79	root		planner__core__integration.t.a, planner__core__integration.t.b
â””â”€Projection_7	8015.79	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_15	7119.80	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_9	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_14(Probe)	7119.80	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1)))
      â””â”€TableRowIDScan_13	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
a	b
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ a,b from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Sort_5	8235.60	root		planner__core__integration.t.a, planner__core__integration.t.b
â””â”€Projection_7	8235.60	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_17	7315.03	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_9	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_12(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_11	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_16(Probe)	7315.03	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(and(ge(planner__core__integration.t.a, 20), lt(planner__core__integration.t.b, 10)), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1))))
      â””â”€TableRowIDScan_15	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
a	b
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,c from t where a < 2 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	5548.89	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	5548.89	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_12	5548.89	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	5548.89	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where a < 2 or c > 10000 order by a, b;
b	c
1	1
explain select /*+ use_index_merge(t) */ b,c from t where a < 2 or a > 88 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	7771.11	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	7771.11	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_13	7771.11	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:(88,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.11	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where a < 2 or a > 88 or c > 10000 order by a, b;
b	c
1	1
100	100
explain select /*+ use_index_merge(t) */ b,c from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8015.79	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	8015.79	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_16	7119.80	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_15(Probe)	7119.80	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1)))
      â””â”€TableRowIDScan_14	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
b	c
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,c from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8235.60	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	8235.60	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_18	7315.03	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_13(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_12	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_15(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_17(Probe)	7315.03	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(and(ge(planner__core__integration.t.a, 20), lt(planner__core__integration.t.b, 10)), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1))))
      â””â”€TableRowIDScan_16	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
b	c
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ c,a from t where a < 2 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	5548.89	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	5548.89	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_12	5548.89	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	5548.89	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where a < 2 or c > 10000 order by a, b;
c	a
1	1
explain select /*+ use_index_merge(t) */ c,a from t where a < 2 or a > 88 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Projection_6	7771.11	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	7771.11	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_13	7771.11	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:(88,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.11	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where a < 2 or a > 88 or c > 10000 order by a, b;
c	a
1	1
100	100
explain select /*+ use_index_merge(t) */ c,a from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8015.79	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	8015.79	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_16	7119.80	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_15(Probe)	7119.80	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1)))
      â””â”€TableRowIDScan_14	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
c	a
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ c,a from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Projection_6	8235.60	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	8235.60	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_18	7315.03	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_10	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_13(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_12	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_15(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_17(Probe)	7315.03	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(and(ge(planner__core__integration.t.a, 20), lt(planner__core__integration.t.b, 10)), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1))))
      â””â”€TableRowIDScan_16	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
c	a
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Sort_5	5548.89	root		planner__core__integration.t.a, planner__core__integration.t.b
â””â”€Projection_7	5548.89	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_11	5548.89	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	5548.89	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or c > 10000 order by a, b;
b	a	c
1	1	1
explain select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or a > 88 or c > 10000 order by a, b;
id	estRows	task	access object	operator info
Sort_5	7771.11	root		planner__core__integration.t.a, planner__core__integration.t.b
â””â”€Projection_7	7771.11	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_12	7771.11	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:(88,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	7771.11	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or a > 88 or c > 10000 order by a, b;
b	a	c
1	1	1
100	100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Sort_5	8015.79	root		planner__core__integration.t.a, planner__core__integration.t.b
â””â”€Projection_7	8015.79	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_15	7119.80	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_9	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_14(Probe)	7119.80	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1)))
      â””â”€TableRowIDScan_13	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a, b;
b	a	c
1	1	1
10	10	10
100	100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
id	estRows	task	access object	operator info
Sort_5	8235.60	root		planner__core__integration.t.a, planner__core__integration.t.b
â””â”€Projection_7	8235.60	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_17	7315.03	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3323.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_9	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_12(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€TableRangeScan_11	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€Selection_16(Probe)	7315.03	cop[tikv]		or(or(lt(planner__core__integration.t.a, 2), and(ge(planner__core__integration.t.a, 10), ge(planner__core__integration.t.b, 10))), or(and(ge(planner__core__integration.t.a, 20), lt(planner__core__integration.t.b, 10)), or(gt(planner__core__integration.t.c, 100), lt(planner__core__integration.t.c, 1))))
      â””â”€TableRowIDScan_15	8882.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a, b;
b	a	c
1	1	1
10	10	10
100	100	100
drop table if exists t;
create table t (a int, b int, c int, unique key (a, b), key idx_c(c));
insert into t values (1, 1, 1), (10, 10, 10), (100, 100, 100);
explain select /*+ use_index_merge(t) */ a from t where c < 10 or a < 2 order by a;
id	estRows	task	access object	operator info
Sort_5	5542.21	root		planner__core__integration.t.a
â””â”€Projection_7	5542.21	root		planner__core__integration.t.a
  â””â”€IndexMerge_11	5542.21	root		type: union
    â”œâ”€IndexRangeScan_8(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:a(a, b)	range:[-inf,2), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	5542.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where c < 10 or a < 2 order by a;
a
1
explain select /*+ use_index_merge(t) */ a from t where _tidb_rowid < 2 or c > 10000 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_11	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where _tidb_rowid < 2 or c > 10000 order by a;
a
1
explain select /*+ use_index_merge(t) */ a from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_12	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
a
1
10
100
explain select /*+ use_index_merge(t) */ a from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_14	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_9	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
a
1
10
100
explain select /*+ use_index_merge(t) */ a from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_16	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_9	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_12(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_11	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_15(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
a
1
10
100
explain select /*+ use_index_merge(t) */ b from t where c < 10 or a < 2 order by a;
id	estRows	task	access object	operator info
Projection_6	5542.21	root		planner__core__integration.t.b
â””â”€Sort_7	5542.21	root		planner__core__integration.t.a
  â””â”€IndexMerge_12	5542.21	root		type: union
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3323.33	cop[tikv]	table:t, index:a(a, b)	range:[-inf,2), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	5542.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where c < 10 or a < 2 order by a;
b
1
explain select /*+ use_index_merge(t) */ b from t where _tidb_rowid < 2 or c > 10000 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.b
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_12	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where _tidb_rowid < 2 or c > 10000 order by a;
b
1
explain select /*+ use_index_merge(t) */ b from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.b
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_13	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
b
1
10
100
explain select /*+ use_index_merge(t) */ b from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.b
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_15	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_10	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_14(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
b
1
10
100
explain select /*+ use_index_merge(t) */ b from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.b
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_17	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_10	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_13(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_12	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_15(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_16(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
b
1
10
100
explain select /*+ use_index_merge(t) */ c from t where c < 10 or a < 2 order by a;
id	estRows	task	access object	operator info
Projection_6	5542.21	root		planner__core__integration.t.c
â””â”€Sort_7	5542.21	root		planner__core__integration.t.a
  â””â”€IndexMerge_12	5542.21	root		type: union
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3323.33	cop[tikv]	table:t, index:a(a, b)	range:[-inf,2), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	5542.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where c < 10 or a < 2 order by a;
c
1
explain select /*+ use_index_merge(t) */ c from t where _tidb_rowid < 2 or c > 10000 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.c
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_12	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where _tidb_rowid < 2 or c > 10000 order by a;
c
1
explain select /*+ use_index_merge(t) */ c from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.c
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_13	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
c
1
10
100
explain select /*+ use_index_merge(t) */ c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.c
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_15	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_10	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_14(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
c
1
10
100
explain select /*+ use_index_merge(t) */ c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.c
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_17	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_10	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_13(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_12	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_15(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_16(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
c
1
10
100
explain select /*+ use_index_merge(t) */ a,b from t where c < 10 or a < 2 order by a;
id	estRows	task	access object	operator info
Sort_5	5542.21	root		planner__core__integration.t.a
â””â”€Projection_7	5542.21	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_11	5542.21	root		type: union
    â”œâ”€IndexRangeScan_8(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:a(a, b)	range:[-inf,2), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	5542.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where c < 10 or a < 2 order by a;
a	b
1	1
explain select /*+ use_index_merge(t) */ a,b from t where _tidb_rowid < 2 or c > 10000 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_11	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where _tidb_rowid < 2 or c > 10000 order by a;
a	b
1	1
explain select /*+ use_index_merge(t) */ a,b from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_12	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
a	b
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ a,b from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_14	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_9	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
a	b
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ a,b from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_16	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_9	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_12(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_11	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_15(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
a	b
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,c from t where c < 10 or a < 2 order by a;
id	estRows	task	access object	operator info
Projection_6	5542.21	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	5542.21	root		planner__core__integration.t.a
  â””â”€IndexMerge_12	5542.21	root		type: union
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3323.33	cop[tikv]	table:t, index:a(a, b)	range:[-inf,2), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	5542.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where c < 10 or a < 2 order by a;
b	c
1	1
explain select /*+ use_index_merge(t) */ b,c from t where _tidb_rowid < 2 or c > 10000 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_12	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where _tidb_rowid < 2 or c > 10000 order by a;
b	c
1	1
explain select /*+ use_index_merge(t) */ b,c from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_13	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
b	c
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_15	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_10	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_14(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
b	c
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Projection_6	8000.00	root		planner__core__integration.t.b, planner__core__integration.t.c
â””â”€Sort_7	8000.00	root		planner__core__integration.t.a
  â””â”€IndexMerge_17	8000.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_11(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_10	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_13(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_12	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_15(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_16(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
b	c
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ c,a from t where c < 10 or a < 2 order by a;
id	estRows	task	access object	operator info
Sort_5	5542.21	root		planner__core__integration.t.a
â””â”€Projection_7	5542.21	root		planner__core__integration.t.c, planner__core__integration.t.a
  â””â”€IndexMerge_11	5542.21	root		type: union
    â”œâ”€IndexRangeScan_8(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:a(a, b)	range:[-inf,2), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	5542.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where c < 10 or a < 2 order by a;
c	a
1	1
explain select /*+ use_index_merge(t) */ c,a from t where _tidb_rowid < 2 or c > 10000 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.c, planner__core__integration.t.a
  â””â”€IndexMerge_11	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where _tidb_rowid < 2 or c > 10000 order by a;
c	a
1	1
explain select /*+ use_index_merge(t) */ c,a from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.c, planner__core__integration.t.a
  â””â”€IndexMerge_12	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
c	a
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ c,a from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.c, planner__core__integration.t.a
  â””â”€IndexMerge_14	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_9	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
c	a
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ c,a from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.c, planner__core__integration.t.a
  â””â”€IndexMerge_16	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_9	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_12(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_11	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_15(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
c	a
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where c < 10 or a < 2 order by a;
id	estRows	task	access object	operator info
Sort_5	5542.21	root		planner__core__integration.t.a
â””â”€Projection_7	5542.21	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_11	5542.21	root		type: union
    â”œâ”€IndexRangeScan_8(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:a(a, b)	range:[-inf,2), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	5542.21	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where c < 10 or a < 2 order by a;
b	a	c
1	1	1
explain select /*+ use_index_merge(t) */ b,a,c from t where _tidb_rowid < 2 or c > 10000 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_11	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where _tidb_rowid < 2 or c > 10000 order by a;
b	a	c
1	1	1
explain select /*+ use_index_merge(t) */ b,a,c from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_12	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where _tidb_rowid < 2 or _tidb_rowid < 10 or c > 11 order by a;
b	a	c
1	1	1
10	10	10
100	100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_14	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_9	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or c > 100 or c < 1 order by a;
b	a	c
1	1	1
10	10	10
100	100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
id	estRows	task	access object	operator info
Sort_5	8000.00	root		planner__core__integration.t.a
â””â”€Projection_7	8000.00	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_16	8000.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€Selection_10(Build)	1111.11	cop[tikv]		ge(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_9	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€Selection_12(Build)	1107.78	cop[tikv]		lt(planner__core__integration.t.b, 10)
    â”‚ â””â”€IndexRangeScan_11	3333.33	cop[tikv]	table:t, index:a(a, b)	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_14(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_15(Probe)	8000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where _tidb_rowid < 2 or (a >= 10 and b >= 10) or (a >= 20 and b < 10) or c > 100 or c < 1 order by a;
b	a	c
1	1	1
10	10	10
100	100	100
drop table if exists t;
create table t (a int, b int, c int, primary key (a), unique key (b), key idx_c(c));
insert into t values (1, 1, 1), (10, 10, 10), (100, 100, 100);
explain select /*+ use_index_merge(t) */ a from t where b < 10 or c < 11 or c > 50 order by b;
id	estRows	task	access object	operator info
Projection_6	7767.77	root		planner__core__integration.t.a
â””â”€Sort_7	7767.77	root		planner__core__integration.t.b
  â””â”€IndexMerge_13	7767.77	root		type: union
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,11), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(50,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7767.77	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where b < 10 or c < 11 or c > 50 order by b;
a
1
10
100
explain select /*+ use_index_merge(t) */ a from t where a < 2 or c > 10000 order by b;
id	estRows	task	access object	operator info
Projection_6	3334.67	root		planner__core__integration.t.a
â””â”€Sort_7	3334.67	root		planner__core__integration.t.b
  â””â”€IndexMerge_12	3334.67	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	3334.67	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where a < 2 or c > 10000 order by b;
a
1
explain select /*+ use_index_merge(t) */ a from t where a < 2 or a < 10 or b > 11 order by b;
id	estRows	task	access object	operator info
Projection_6	3340.00	root		planner__core__integration.t.a
â””â”€Sort_7	3340.00	root		planner__core__integration.t.b
  â””â”€IndexMerge_13	3340.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	3340.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where a < 2 or a < 10 or b > 11 order by b;
a
1
100
explain select /*+ use_index_merge(t) */ a from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
id	estRows	task	access object	operator info
Projection_6	7771.56	root		planner__core__integration.t.a
â””â”€Sort_7	7771.56	root		planner__core__integration.t.b
  â””â”€IndexMerge_14	7771.56	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	7771.56	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
a
1
10
100
explain select /*+ use_index_merge(t) */ a from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
id	estRows	task	access object	operator info
Projection_6	7033.48	root		planner__core__integration.t.a
â””â”€Sort_7	7033.48	root		planner__core__integration.t.b
  â””â”€IndexMerge_15	7033.48	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_11(Build)	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_14(Probe)	7033.48	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
a
1
10
100
explain select /*+ use_index_merge(t) */ b from t where b < 10 or c < 11 or c > 50 order by b;
id	estRows	task	access object	operator info
Sort_5	7767.77	root		planner__core__integration.t.b
â””â”€Projection_7	7767.77	root		planner__core__integration.t.b
  â””â”€IndexMerge_12	7767.77	root		type: union
    â”œâ”€IndexRangeScan_8(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,11), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(50,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	7767.77	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where b < 10 or c < 11 or c > 50 order by b;
b
1
10
100
explain select /*+ use_index_merge(t) */ b from t where a < 2 or c > 10000 order by b;
id	estRows	task	access object	operator info
Sort_5	3334.67	root		planner__core__integration.t.b
â””â”€Projection_7	3334.67	root		planner__core__integration.t.b
  â””â”€IndexMerge_11	3334.67	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	3334.67	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where a < 2 or c > 10000 order by b;
b
1
explain select /*+ use_index_merge(t) */ b from t where a < 2 or a < 10 or b > 11 order by b;
id	estRows	task	access object	operator info
Sort_5	3340.00	root		planner__core__integration.t.b
â””â”€Projection_7	3340.00	root		planner__core__integration.t.b
  â””â”€IndexMerge_12	3340.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	3340.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where a < 2 or a < 10 or b > 11 order by b;
b
1
100
explain select /*+ use_index_merge(t) */ b from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
id	estRows	task	access object	operator info
Sort_5	7771.56	root		planner__core__integration.t.b
â””â”€Projection_7	7771.56	root		planner__core__integration.t.b
  â””â”€IndexMerge_13	7771.56	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.56	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
b
1
10
100
explain select /*+ use_index_merge(t) */ b from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
id	estRows	task	access object	operator info
Sort_5	7033.48	root		planner__core__integration.t.b
â””â”€Projection_7	7033.48	root		planner__core__integration.t.b
  â””â”€IndexMerge_14	7033.48	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	7033.48	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
b
1
10
100
explain select /*+ use_index_merge(t) */ c from t where b < 10 or c < 11 or c > 50 order by b;
id	estRows	task	access object	operator info
Projection_6	7767.77	root		planner__core__integration.t.c
â””â”€Sort_7	7767.77	root		planner__core__integration.t.b
  â””â”€IndexMerge_13	7767.77	root		type: union
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,11), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(50,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7767.77	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where b < 10 or c < 11 or c > 50 order by b;
c
1
10
100
explain select /*+ use_index_merge(t) */ c from t where a < 2 or c > 10000 order by b;
id	estRows	task	access object	operator info
Projection_6	3334.67	root		planner__core__integration.t.c
â””â”€Sort_7	3334.67	root		planner__core__integration.t.b
  â””â”€IndexMerge_12	3334.67	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	3334.67	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where a < 2 or c > 10000 order by b;
c
1
explain select /*+ use_index_merge(t) */ c from t where a < 2 or a < 10 or b > 11 order by b;
id	estRows	task	access object	operator info
Projection_6	3340.00	root		planner__core__integration.t.c
â””â”€Sort_7	3340.00	root		planner__core__integration.t.b
  â””â”€IndexMerge_13	3340.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	3340.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where a < 2 or a < 10 or b > 11 order by b;
c
1
100
explain select /*+ use_index_merge(t) */ c from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
id	estRows	task	access object	operator info
Projection_6	7771.56	root		planner__core__integration.t.c
â””â”€Sort_7	7771.56	root		planner__core__integration.t.b
  â””â”€IndexMerge_14	7771.56	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	7771.56	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
c
1
10
100
explain select /*+ use_index_merge(t) */ c from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
id	estRows	task	access object	operator info
Projection_6	7033.48	root		planner__core__integration.t.c
â””â”€Sort_7	7033.48	root		planner__core__integration.t.b
  â””â”€IndexMerge_15	7033.48	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_11(Build)	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_14(Probe)	7033.48	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
c
1
10
100
explain select /*+ use_index_merge(t) */ a,b from t where b < 10 or c < 11 or c > 50 order by b;
id	estRows	task	access object	operator info
Sort_5	7767.77	root		planner__core__integration.t.b
â””â”€Projection_7	7767.77	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_12	7767.77	root		type: union
    â”œâ”€IndexRangeScan_8(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,11), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(50,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	7767.77	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where b < 10 or c < 11 or c > 50 order by b;
a	b
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ a,b from t where a < 2 or c > 10000 order by b;
id	estRows	task	access object	operator info
Sort_5	3334.67	root		planner__core__integration.t.b
â””â”€Projection_7	3334.67	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_11	3334.67	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	3334.67	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where a < 2 or c > 10000 order by b;
a	b
1	1
explain select /*+ use_index_merge(t) */ a,b from t where a < 2 or a < 10 or b > 11 order by b;
id	estRows	task	access object	operator info
Sort_5	3340.00	root		planner__core__integration.t.b
â””â”€IndexMerge_12	3340.00	root		type: union
  â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
  â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
  â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:(11,+inf], keep order:false, stats:pseudo
  â””â”€TableRowIDScan_11(Probe)	3340.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where a < 2 or a < 10 or b > 11 order by b;
a	b
1	1
100	100
explain select /*+ use_index_merge(t) */ a,b from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
id	estRows	task	access object	operator info
Sort_5	7771.56	root		planner__core__integration.t.b
â””â”€Projection_7	7771.56	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_13	7771.56	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.56	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
a	b
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ a,b from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
id	estRows	task	access object	operator info
Sort_5	7033.48	root		planner__core__integration.t.b
â””â”€Projection_7	7033.48	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexMerge_14	7033.48	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	7033.48	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ a,b from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
a	b
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,c from t where b < 10 or c < 11 or c > 50 order by b;
id	estRows	task	access object	operator info
Sort_5	7767.77	root		planner__core__integration.t.b
â””â”€IndexMerge_12	7767.77	root		type: union
  â”œâ”€IndexRangeScan_8(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,10), keep order:false, stats:pseudo
  â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,11), keep order:false, stats:pseudo
  â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(50,+inf], keep order:false, stats:pseudo
  â””â”€TableRowIDScan_11(Probe)	7767.77	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where b < 10 or c < 11 or c > 50 order by b;
b	c
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,c from t where a < 2 or c > 10000 order by b;
id	estRows	task	access object	operator info
Sort_5	3334.67	root		planner__core__integration.t.b
â””â”€Projection_7	3334.67	root		planner__core__integration.t.b, planner__core__integration.t.c
  â””â”€IndexMerge_11	3334.67	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	3334.67	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where a < 2 or c > 10000 order by b;
b	c
1	1
explain select /*+ use_index_merge(t) */ b,c from t where a < 2 or a < 10 or b > 11 order by b;
id	estRows	task	access object	operator info
Sort_5	3340.00	root		planner__core__integration.t.b
â””â”€Projection_7	3340.00	root		planner__core__integration.t.b, planner__core__integration.t.c
  â””â”€IndexMerge_12	3340.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	3340.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where a < 2 or a < 10 or b > 11 order by b;
b	c
1	1
100	100
explain select /*+ use_index_merge(t) */ b,c from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
id	estRows	task	access object	operator info
Sort_5	7771.56	root		planner__core__integration.t.b
â””â”€Projection_7	7771.56	root		planner__core__integration.t.b, planner__core__integration.t.c
  â””â”€IndexMerge_13	7771.56	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.56	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
b	c
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,c from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
id	estRows	task	access object	operator info
Sort_5	7033.48	root		planner__core__integration.t.b
â””â”€Projection_7	7033.48	root		planner__core__integration.t.b, planner__core__integration.t.c
  â””â”€IndexMerge_14	7033.48	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	7033.48	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,c from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
b	c
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ c,a from t where b < 10 or c < 11 or c > 50 order by b;
id	estRows	task	access object	operator info
Projection_6	7767.77	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	7767.77	root		planner__core__integration.t.b
  â””â”€IndexMerge_13	7767.77	root		type: union
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,11), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(50,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7767.77	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where b < 10 or c < 11 or c > 50 order by b;
c	a
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ c,a from t where a < 2 or c > 10000 order by b;
id	estRows	task	access object	operator info
Projection_6	3334.67	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	3334.67	root		planner__core__integration.t.b
  â””â”€IndexMerge_12	3334.67	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	3334.67	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where a < 2 or c > 10000 order by b;
c	a
1	1
explain select /*+ use_index_merge(t) */ c,a from t where a < 2 or a < 10 or b > 11 order by b;
id	estRows	task	access object	operator info
Projection_6	3340.00	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	3340.00	root		planner__core__integration.t.b
  â””â”€IndexMerge_13	3340.00	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	3340.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where a < 2 or a < 10 or b > 11 order by b;
c	a
1	1
100	100
explain select /*+ use_index_merge(t) */ c,a from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
id	estRows	task	access object	operator info
Projection_6	7771.56	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	7771.56	root		planner__core__integration.t.b
  â””â”€IndexMerge_14	7771.56	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	7771.56	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
c	a
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ c,a from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
id	estRows	task	access object	operator info
Projection_6	7033.48	root		planner__core__integration.t.c, planner__core__integration.t.a
â””â”€Sort_7	7033.48	root		planner__core__integration.t.b
  â””â”€IndexMerge_15	7033.48	root		type: union
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_11(Build)	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_13(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_14(Probe)	7033.48	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ c,a from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
c	a
1	1
10	10
100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where b < 10 or c < 11 or c > 50 order by b;
id	estRows	task	access object	operator info
Sort_5	7767.77	root		planner__core__integration.t.b
â””â”€Projection_7	7767.77	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_12	7767.77	root		type: union
    â”œâ”€IndexRangeScan_8(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,11), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(50,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	7767.77	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where b < 10 or c < 11 or c > 50 order by b;
b	a	c
1	1	1
10	10	10
100	100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or c > 10000 order by b;
id	estRows	task	access object	operator info
Sort_5	3334.67	root		planner__core__integration.t.b
â””â”€Projection_7	3334.67	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_11	3334.67	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(10000,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_10(Probe)	3334.67	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or c > 10000 order by b;
b	a	c
1	1	1
explain select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or a < 10 or b > 11 order by b;
id	estRows	task	access object	operator info
Sort_5	3340.00	root		planner__core__integration.t.b
â””â”€Projection_7	3340.00	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_12	3340.00	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[-inf,10), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:(11,+inf], keep order:false, stats:pseudo
    â””â”€TableRowIDScan_11(Probe)	3340.00	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or a < 10 or b > 11 order by b;
b	a	c
1	1	1
100	100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
id	estRows	task	access object	operator info
Sort_5	7771.56	root		planner__core__integration.t.b
â””â”€Projection_7	7771.56	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_13	7771.56	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_9(Build)	3333.33	cop[tikv]	table:t, index:b(b)	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_10(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3323.33	cop[tikv]	table:t, index:idx_c(c)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_12(Probe)	7771.56	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or b >= 10 or c > 100 or c < 1 order by b;
b	a	c
1	1	1
10	10	10
100	100	100
explain select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
id	estRows	task	access object	operator info
Sort_5	7033.48	root		planner__core__integration.t.b
â””â”€Projection_7	7033.48	root		planner__core__integration.t.b, planner__core__integration.t.a, planner__core__integration.t.c
  â””â”€IndexMerge_14	7033.48	root		type: union
    â”œâ”€TableRangeScan_8(Build)	3333.33	cop[tikv]	table:t	range:[-inf,2), keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_9(Build)	3333.33	cop[tikv]	table:t	range:[10,+inf], keep order:false, stats:pseudo
    â”œâ”€TableRangeScan_10(Build)	3333.33	cop[tikv]	table:t	range:[20,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_11(Build)	3333.33	cop[tikv]	table:t, index:idx_c(c)	range:(100,+inf], keep order:false, stats:pseudo
    â”œâ”€IndexRangeScan_12(Build)	3323.33	cop[tikv]	table:t, index:b(b)	range:[-inf,1), keep order:false, stats:pseudo
    â””â”€TableRowIDScan_13(Probe)	7033.48	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ b,a,c from t where a < 2 or a >= 10 or a >= 20 or c > 100 or b < 1 order by b;
b	a	c
1	1	1
10	10	10
100	100	100
drop table if exists t;
create table t (a int, b int, index(a), index(b)) partition by hash (a) partitions 2;
insert into t values (1, 5);
select /*+ use_index_merge( t ) */ * from t where a in (3) or b in (5) order by a;
a	b
1	5
drop table if exists t;
CREATE TABLE t (
col_5 text NOT NULL,
col_6 tinyint(3) unsigned DEFAULT NULL,
col_7 float DEFAULT '4779.165058537128',
col_8 smallint(6) NOT NULL DEFAULT '-24790',
col_9 date DEFAULT '2031-01-15',
col_37 int(11) DEFAULT '1350204687',
PRIMARY KEY (col_5(6),col_8) /*T![clustered_index] NONCLUSTERED */,
UNIQUE KEY idx_6 (col_9,col_7,col_8),
KEY idx_8 (col_8,col_6,col_5(6),col_9,col_7),
KEY idx_9 (col_9,col_7,col_8)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
PARTITION BY RANGE ( col_8 ) (
PARTITION p0 VALUES LESS THAN (-17650),
PARTITION p1 VALUES LESS THAN (-13033),
PARTITION p2 VALUES LESS THAN (2521),
PARTITION p3 VALUES LESS THAN (7510)
);
insert into t values ('', NULL, 6304.0146, -24790, '2031-01-15', 1350204687);
select  var_samp(col_7) aggCol from (select  /*+ use_index_merge( t ) */ * from t where t.col_9 in ( '2002-06-22' ) or t.col_5 in ( 'PkfzI'  ) or t.col_8 in ( -24874 ) and t.col_6 > null and t.col_5 > 'r' and t.col_9 in ( '1979-09-04' ) and t.col_7 < 8143.667552769195 or t.col_5 in ( 'iZhfEjRWci' , 'T' , ''  ) or t.col_9 <> '1976-09-11' and t.col_7 = 8796.436181615773 and t.col_8 = 7372 order by col_5,col_8  ) ordered_tbl group by col_6;
aggCol
NULL
drop table if exists t;
create table t(a int,b char(100),key(a),key(b(10)));
explain format = 'brief' select /*+ use_index_merge(t) */ * from t where a=10 or b='x';
id	estRows	task	access object	operator info
IndexMerge	0.04	root		type: union
â”œâ”€IndexRangeScan(Build)	10.00	cop[tikv]	table:t, index:a(a)	range:[10,10], keep order:false, stats:pseudo
â”œâ”€IndexRangeScan(Build)	10.00	cop[tikv]	table:t, index:b(b)	range:["x","x"], keep order:false, stats:pseudo
â””â”€Selection(Probe)	0.04	cop[tikv]		or(eq(planner__core__integration.t.a, 10), eq(planner__core__integration.t.b, "x"))
  â””â”€TableRowIDScan	19.99	cop[tikv]	table:t	keep order:false, stats:pseudo
insert into t values (1, 'xx');
select /*+ use_index_merge(t) */ * from t where a=10 or b='x';
a	b
set tidb_cost_model_version=2;
drop table if exists t;
create table t(a int);
insert into t values(1),(1),(2);
set @@session.sql_select_limit=1;
select * from t order by a;
a
1
select * from t order by a limit 2;
a
1
1
set @@session.sql_select_limit=default;
select * from t order by a;
a
1
1
2
set @@session.sql_select_limit=1;
select * from (select * from t) s order by a;
a
1
select * from (select * from t limit 2) s order by a;
a
1
select (select * from t limit 1) s;
s
1
select * from t where t.a in (select * from t) limit 3;
a
1
1
2
select * from (select * from t) s limit 3;
a
1
1
2
select * from t union all select * from t limit 2;
a
1
1
select * from t union all (select * from t limit 2);
a
1
prepare s1 from 'select * from t where a = ?';
set @a = 1;
execute s1 using @a;
a
1
set @@session.sql_select_limit=default;
execute s1 using @a;
a
1
1
set @@session.sql_select_limit=1;
prepare s2 from 'select * from t where a = ? limit 3';
execute s2 using @a;
a
1
1
set @@session.sql_select_limit=1;
create definer='root'@'localhost' view s as select * from t;
select * from s;
a
1
set @@session.sql_select_limit=default;
select * from s;
a
1
1
2
set @@session.sql_select_limit=1;
create table b (a int);
insert into b select * from t;
select * from b limit 3;
a
1
1
2
update b set a = 2 where a = 1;
select * from b limit 3;
a
2
2
2
select * from b;
a
2
delete from b where a = 2;
select * from b;
a
set @@session.sql_select_limit=DEFAULT;
drop table if exists t;
create table t(a int, b int, key(a), key(b));
select /*+ use_index_merge() */ * from t where a = 1 or b = 1;
a	b
Level	Code	Message
Warning	1064	Optimizer hint syntax error at line 1 column 28 near ") */" 
drop table if exists t0;
drop view if exists v0;
CREATE TABLE t0(c0 INT);
INSERT INTO t0(c0) VALUES (1), (1), (1), (1), (1), (1);
CREATE definer='root'@'localhost' VIEW v0(c0) AS SELECT NULL FROM t0;
SELECT * FROM t0 LEFT JOIN v0 ON TRUE WHERE v0.c0 IS NULL;
c0	c0
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
1	NULL
create database cluster_idx_unique_double_read;
use cluster_idx_unique_double_read;
set @@tidb_enable_clustered_index = 'ON';
drop table if exists t;
create table t (a varchar(64), b varchar(64), uk int, v int, primary key(a, b), unique key uuk(uk));
insert t values ('a', 'a1', 1, 11), ('b', 'b1', 2, 22), ('c', 'c1', 3, 33);
select * from t use index (uuk);
a	b	uk	v
a	a1	1	11
b	b1	2	22
c	c1	3	33
drop database cluster_idx_unique_double_read;
set @@tidb_enable_clustered_index = DEFAULT;
use planner__core__integration
drop table if exists t, t2;
set @@tidb_enable_clustered_index = 'ON';
create table t(a int, b int, c int, primary key(a, b));
create table t2(a int, b int, c int, d int, primary key(a,b), index idx(c));
insert into t values(1,1,1), (2,2,2), (3,3,3);
insert into t2 values(1,2,3,4), (2,4,3,5), (1,3,1,1);
select /*+ INL_MERGE_JOIN(t) */ * from t right outer join t2 on t.a=t2.c;
a	b	c	a	b	c	d
1	1	1	1	3	1	1
3	3	3	1	2	3	4
3	3	3	2	4	3	5
select /*+ INL_MERGE_JOIN(t2) */ * from t left outer join t2 on t.a=t2.c;
a	b	c	a	b	c	d
1	1	1	1	3	1	1
2	2	2	NULL	NULL	NULL	NULL
3	3	3	1	2	3	4
3	3	3	2	4	3	5
set @@tidb_enable_clustered_index = DEFAULT;
drop table if exists t;
create table t (a int not null, b int not null, c int not null, primary key (a,c)) partition by range (c) (partition p0 values less than (5), partition p1 values less than (10));
insert into t values(1,1,1),(2,2,2),(3,1,3),(7,1,7),(8,2,8),(9,2,9);
select count(distinct b+1) as col from t;
col
2
drop table if exists t;
create table t (c_int int, c_str varchar(40), primary key(c_int, c_str));
insert into t values (3, 'bose');
select * from t where c_int in (3);
c_int	c_str
3	bose
select * from t where c_int in (3) or c_str in ('yalow') and c_int in (1, 2);
c_int	c_str
3	bose
drop table if exists ta;
drop table if exists tb;
drop table if exists tc;
drop view if exists v;
CREATE TABLE `ta`  (
`id` varchar(36) NOT NULL ,
`status` varchar(1) NOT NULL
);
CREATE TABLE `tb`  (
`id` varchar(36) NOT NULL ,
`status` varchar(1) NOT NULL
);
CREATE TABLE `tc`  (
`id` varchar(36) NOT NULL ,
`status` varchar(1) NOT NULL
);
insert into ta values('1','1');
insert into tb values('1','1');
insert into tc values('1','1');
create definer='root'@'localhost' view v as
select
concat(`ta`.`status`,`tb`.`status`) AS `status`,
`ta`.`id` AS `id`  from (`ta` join `tb`)
where (`ta`.`id` = `tb`.`id`);
SELECT tc.status,v.id FROM tc, v WHERE tc.id = v.id AND v.status = '11';
status	id
1	1
drop table if exists t1, t2;
create table t1(a int primary key, b int);
create table t2(a int primary key, b int);
insert into t1 values(1,1),(2,2);
insert into t2 values(2,2);
delete t1.* from t1 join t2 using (a);
select * from t1;
a	b
1	1
select * from t2;
a	b
2	2
drop table if exists t;
set @@tidb_enable_clustered_index = 'ON';
CREATE TABLE planner__core__integration.`t` (  `a` int(11) NOT NULL,  `b` varchar(10) COLLATE utf8_general_ci NOT NULL,  `c` varchar(50) COLLATE utf8_general_ci NOT NULL,  `d` char(10) NOT NULL,  PRIMARY KEY (`c`),  UNIQUE KEY `a_uniq` (`a`),  UNIQUE KEY `b_uniq` (`b`),  UNIQUE KEY `d_uniq` (`d`),  KEY `a_idx` (`a`),  KEY `b_idx` (`b`),  KEY `d_idx` (`d`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
INSERT INTO planner__core__integration.t (a, b, c, d) VALUES (1, '1', '0', '1');
INSERT INTO planner__core__integration.t (a, b, c, d) VALUES (2, ' 2', ' 0', ' 2');
INSERT INTO planner__core__integration.t (a, b, c, d) VALUES (3, '  3 ', '  3 ', '  3 ');
INSERT INTO planner__core__integration.t (a, b, c, d) VALUES (4, 'a', 'a   ', 'a');
INSERT INTO planner__core__integration.t (a, b, c, d) VALUES (5, ' A  ', ' A   ', ' A  ');
INSERT INTO planner__core__integration.t (a, b, c, d) VALUES (6, ' E', 'Ã©        ', ' E');
SELECT * FROM `planner__core__integration`.`t` FORCE INDEX(`a_uniq`);
a	b	c	d
3	  3 	  3 	  3
2	 2	 0	 2
5	 A  	 A   	 A
1	1	0	1
4	a	a   	a
6	 E	Ã©        	 E
SELECT * FROM `planner__core__integration`.`t` FORCE INDEX(`b_uniq`);
a	b	c	d
3	  3 	  3 	  3
2	 2	 0	 2
5	 A  	 A   	 A
1	1	0	1
4	a	a   	a
6	 E	Ã©        	 E
SELECT * FROM `planner__core__integration`.`t` FORCE INDEX(`d_uniq`);
a	b	c	d
3	  3 	  3 	  3
2	 2	 0	 2
5	 A  	 A   	 A
1	1	0	1
4	a	a   	a
6	 E	Ã©        	 E
SELECT * FROM `planner__core__integration`.`t` FORCE INDEX(`a_idx`);
a	b	c	d
3	  3 	  3 	  3
2	 2	 0	 2
5	 A  	 A   	 A
1	1	0	1
4	a	a   	a
6	 E	Ã©        	 E
SELECT * FROM `planner__core__integration`.`t` FORCE INDEX(`b_idx`);
a	b	c	d
3	  3 	  3 	  3
2	 2	 0	 2
5	 A  	 A   	 A
1	1	0	1
4	a	a   	a
6	 E	Ã©        	 E
SELECT * FROM `planner__core__integration`.`t` FORCE INDEX(`d_idx`);
a	b	c	d
3	  3 	  3 	  3
2	 2	 0	 2
5	 A  	 A   	 A
1	1	0	1
4	a	a   	a
6	 E	Ã©        	 E
admin check table t;
set @@tidb_enable_clustered_index = DEFAULT;
drop table if exists t;
CREATE TABLE `t` (
`fid` bigint(36) NOT NULL,
`oty` varchar(30) DEFAULT NULL,
`oid` int(11) DEFAULT NULL,
`pid` bigint(20) DEFAULT NULL,
`bid` int(11) DEFAULT NULL,
`r5` varchar(240) DEFAULT '',
PRIMARY KEY (`fid`)
)PARTITION BY HASH( `fid` ) PARTITIONS 4;
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (59, 'm',  441, 1,  2143,  'LE1264_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (135, 'm',  1121, 1,  2423,  'LE2008_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (139, 'm',  1125, 1,  2432, 'LE2005_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (143, 'm',  1129, 1,  2438,  'LE2006_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (147, 'm',  1133, 1,  2446,  'LE2014_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (167, 'm',  1178, 1,  2512,  'LE2055_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (171, 'm',  1321, 1,  2542,  'LE1006_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (179, 'm',  1466, 1,  2648,  'LE2171_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (187, 'm',  1567, 1,  2690,  'LE1293_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (57, 'm',  341, 1,  2102,  'LE1001_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (137, 'm',  1123, 1,  2427,  'LE2003_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (145, 'm',  1131, 1,  2442,  'LE2048_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (138, 'm',  1124, 1,  2429,  'LE2004_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (142, 'm',  1128, 1,  2436,  'LE2049_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (174, 'm',  1381, 1,  2602,  'LE2170_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (28, 'm',  81, 1,  2023,  'LE1009_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (60, 'm',  442, 1,  2145,  'LE1263_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (136, 'm',  1122, 1,  2425,  'LE2002_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (140, 'm',  1126, 1,  2434,  'LE2001_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (168, 'm',  1179, 1,  2514,  'LE2052_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (196, 'm',  3380, 1,  2890,  'LE1300_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (208, 'm',  3861, 1,  3150,  'LE1323_r5');
INSERT INTO t (fid, oty, oid, pid, bid, r5) VALUES (432, 'm',  4060, 1,  3290,  'LE1327_r5');
SELECT DISTINCT t.bid, t.r5 FROM t left join t parent on parent.oid = t.pid WHERE t.oty = 'm';
bid	r5
2023	LE1009_r5
2102	LE1001_r5
2143	LE1264_r5
2145	LE1263_r5
2423	LE2008_r5
2425	LE2002_r5
2427	LE2003_r5
2429	LE2004_r5
2432	LE2005_r5
2434	LE2001_r5
2436	LE2049_r5
2438	LE2006_r5
2442	LE2048_r5
2446	LE2014_r5
2512	LE2055_r5
2514	LE2052_r5
2542	LE1006_r5
2602	LE2170_r5
2648	LE2171_r5
2690	LE1293_r5
2890	LE1300_r5
3150	LE1323_r5
3290	LE1327_r5
drop table if exists t;
create table t(a int default null, b int default null, c int default null);
explain format = 'brief' select * from t where a = 1 and a = 2;
id	estRows	task	access object	operator info
TableDual	0.00	root		rows:0
drop table t;
explain select /*+ HASH_JOIN(@sel_1 t2) */ * FROM (select 1) t1 NATURAL LEFT JOIN (select 2) t2;
id	estRows	task	access object	operator info
HashJoin_8	1.00	root		CARTESIAN left outer join
â”œâ”€Projection_12(Build)	1.00	root		2->Column#2
â”‚ â””â”€TableDual_13	1.00	root		rows:1
â””â”€Projection_10(Probe)	1.00	root		1->Column#1
  â””â”€TableDual_11	1.00	root		rows:1
select /*+ HASH_JOIN(@sel_1 t2) */ * FROM (select 1) t1 NATURAL LEFT JOIN (select 2) t2;
1	2
1	2
drop table if exists t;
create table t(pk int(11) primary key);
insert into t values(1),(2),(3);
select a from (select pk as a from t) t1 where a = 18446744073709551615;
a
drop table if exists t;
create table t (a int not null primary key);
insert into t values (1);
UPDATE t m, t n SET m.a = m.a + 10, n.a = n.a + 10;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'm' and 'n'.
drop table if exists t;
create table t (a varchar(10) not null primary key);
insert into t values ('abc');
UPDATE t m, t n SET m.a = 'def', n.a = 'xyz';
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'm' and 'n'.
drop table if exists t;
create table t (a int, b int, primary key (a, b));
insert into t values (1, 2);
UPDATE t m, t n SET m.a = m.a + 10, n.b = n.b + 10;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'm' and 'n'.
drop table if exists t;
create table t (a int primary key, b int);
insert into t values (1, 2);
UPDATE t m, t n SET m.a = m.a + 10, n.a = n.a + 10;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'm' and 'n'.
UPDATE t m, t n SET m.b = m.b + 10, n.b = n.b + 10;
SELECT * FROM t;
a	b
1	12
UPDATE t m, t n SET m.a = m.a + 1, n.b = n.b + 10;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'm' and 'n'.
UPDATE t m, t n, t q SET m.a = m.a + 1, n.b = n.b + 10, q.b = q.b - 10;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'm' and 'n'.
UPDATE t m, t n, t q SET m.b = m.b + 1, n.a = n.a + 10, q.b = q.b - 10;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'm' and 'n'.
UPDATE t m, t n, t q SET m.b = m.b + 1, n.b = n.b + 10, q.a = q.a - 10;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'm' and 'q'.
UPDATE t q, t n, t m SET m.b = m.b + 1, n.b = n.b + 10, q.a = q.a - 10;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'q' and 'n'.
update t m, t n set m.a = n.a+10 where m.a=n.a;
select * from t;
a	b
11	12
drop table if exists ttest;
create table ttest (v1 int, v2 int);
insert into ttest values(1, 2), (4,6), (1, 7);
select v1 from ttest order by count(v2);
Error 3029 (HY000): Expression #1 of ORDER BY contains aggregate function and applies to the result of a non-aggregated query
select v1 from ttest having count(v2);
Error 8123 (HY000): In aggregated query without GROUP BY, expression #1 of SELECT list contains nonaggregated column 'v1'; this is incompatible with sql_mode=only_full_group_by
select v2, v1 from (select * from ttest) t1 join (select 1, 2) t2 group by v1;
Error 1055 (42000): Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'planner__core__integration.t1.v2' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
select v2, v1 from (select t1.v1, t2.v2 from ttest t1 join ttest t2) t3 join (select 1, 2) t2 group by v1;
Error 1055 (42000): Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'planner__core__integration.t3.v2' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
create table tt (x int, z int as (x+10) stored);
insert into tt(x) values (1);
update tt set x=2, z = default;
update tt set x=2, z = default(z);
select * from tt;
x	z
2	12
update tt set x=2, z = default(x);
Error 3105 (HY000): The value specified for generated column 'z' in table 'tt' is not allowed.
update tt set z = 123;
Error 3105 (HY000): The value specified for generated column 'z' in table 'tt' is not allowed.
update tt as ss set z = 123;
Error 3105 (HY000): The value specified for generated column 'z' in table 'tt' is not allowed.
update tt as ss set x = 3, z = 13;
Error 3105 (HY000): The value specified for generated column 'z' in table 'tt' is not allowed.
update tt as s1, tt as s2 set s1.z = default, s2.z = 456;
Error 3105 (HY000): The value specified for generated column 'z' in table 'tt' is not allowed.
drop table if exists t;
create table t(a int not null, b int not null, key(a), key(b));
insert into t values(1,1),(2,2),(3,3),(4,4),(5,5),(6,6);
set session tidb_enable_extended_stats = off;
alter table t add stats_extended s1 correlation(a,b);
Error 1105 (HY000): Extended statistics feature is not generally available now, and tidb_enable_extended_stats is OFF
alter table t drop stats_extended s1;
Error 1105 (HY000): Extended statistics feature is not generally available now, and tidb_enable_extended_stats is OFF
admin reload stats_extended;
Error 1105 (HY000): Extended statistics feature is not generally available now, and tidb_enable_extended_stats is OFF
set session tidb_enable_extended_stats = on;
alter table t add stats_extended s1 correlation(a,b);
select stats, status from mysql.stats_extended where name = 's1';
stats	status
NULL	0
set session tidb_enable_extended_stats = off;
analyze table t;
select stats, status from mysql.stats_extended where name = 's1';
stats	status
NULL	0
set session tidb_enable_extended_stats = on;
analyze table t;
select stats, status from mysql.stats_extended where name = 's1';
stats	status
1.000000	1
explain format = 'brief' select * from t use index(b) where a > 3 order by b limit 1;
id	estRows	task	access object	operator info
Limit	1.00	root		offset:0, count:1
â””â”€Projection	1.00	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexLookUp	1.00	root		
    â”œâ”€IndexFullScan(Build)	4.00	cop[tikv]	table:t, index:b(b)	keep order:true
    â””â”€Selection(Probe)	1.00	cop[tikv]		gt(planner__core__integration.t.a, 3)
      â””â”€TableRowIDScan	4.00	cop[tikv]	table:t	keep order:false
set session tidb_enable_extended_stats = off;
explain format = 'brief' select * from t use index(b) where a > 3 order by b limit 1;
id	estRows	task	access object	operator info
Limit	1.00	root		offset:0, count:1
â””â”€Projection	1.00	root		planner__core__integration.t.a, planner__core__integration.t.b
  â””â”€IndexLookUp	1.00	root		
    â”œâ”€IndexFullScan(Build)	2.00	cop[tikv]	table:t, index:b(b)	keep order:true
    â””â”€Selection(Probe)	1.00	cop[tikv]		gt(planner__core__integration.t.a, 3)
      â””â”€TableRowIDScan	2.00	cop[tikv]	table:t	keep order:false
drop table if exists ttest;
create table ttest (v1 int, v2 int);
insert into ttest values(1, 2), (4,6), (1, 7);
select distinct v1 from ttest order by v2;
Error 3065 (HY000): Expression #1 of ORDER BY clause is not in SELECT list, references column 'planner__core__integration.ttest.v2' which is not in SELECT list; this is incompatible with DISTINCT
select distinct v1+1 from ttest order by v1;
Error 3065 (HY000): Expression #1 of ORDER BY clause is not in SELECT list, references column 'planner__core__integration.ttest.v1' which is not in SELECT list; this is incompatible with DISTINCT
select distinct v1+1 from ttest order by 1+v1;
Error 3065 (HY000): Expression #1 of ORDER BY clause is not in SELECT list, references column 'planner__core__integration.ttest.v1' which is not in SELECT list; this is incompatible with DISTINCT
select distinct v1+1 from ttest order by v1+2;
Error 3065 (HY000): Expression #1 of ORDER BY clause is not in SELECT list, references column 'planner__core__integration.ttest.v1' which is not in SELECT list; this is incompatible with DISTINCT
select distinct count(v1) from ttest group by v2 order by sum(v1);
Error 3066 (HY000): Expression #1 of ORDER BY clause is not in SELECT list, contains aggregate function; this is incompatible with DISTINCT
select distinct sum(v1)+1 from ttest group by v2 order by sum(v1);
Error 3066 (HY000): Expression #1 of ORDER BY clause is not in SELECT list, contains aggregate function; this is incompatible with DISTINCT
select distinct v1+1 from ttest order by v1+1;
v1+1
2
5
select distinct count(v1) from ttest order by count(v1);
count(v1)
3
select distinct count(v1) from ttest group by v2 order by count(v1);
count(v1)
1
select distinct sum(v1) from ttest group by v2 order by sum(v1);
sum(v1)
1
4
select distinct v1, v2 from ttest order by 1, 2;
v1	v2
1	2
1	7
4	6
select distinct v1, v2 from ttest order by 2, 1;
v1	v2
1	2
4	6
1	7
select distinct v1 from ttest order by v1+1;
v1
1
4
select distinct v1, v2 from ttest order by v1+1, v2;
v1	v2
1	2
1	7
4	6
select distinct v1+1 as z, v2 from ttest order by v1+1, z+v2;
z	v2
2	2
2	7
5	6
select distinct sum(v1) as z from ttest group by v2 order by z+1;
z
1
4
select distinct sum(v1)+1 from ttest group by v2 order by sum(v1)+1;
sum(v1)+1
2
5
select distinct v1 as z from ttest order by v1+z;
z
1
4
DROP TABLE IF EXISTS temptest;
create table temptest (val int, val1 int);
SELECT val FROM temptest WINDOW w AS (ORDER BY val RANGE 1 PRECEDING);
val
SELECT val FROM temptest WINDOW w AS (ORDER BY val, val1 RANGE 1 PRECEDING);
Error 3587 (HY000): Window 'w' with RANGE N PRECEDING/FOLLOWING frame requires exactly one ORDER BY expression, of numeric or temporal type
select val1, avg(val1) as a from temptest group by val1 window w as (order by a);
Error 1054 (42S22): Unknown column 'a' in 'window order by'
select val1, avg(val1) as a from temptest group by val1 window w as (partition by a);
Error 1054 (42S22): Unknown column 'a' in 'window partition by'
DROP TABLE IF EXISTS tab, tab2;
CREATE TABLE tab(i INT);
CREATE TABLE tab2(j INT);
insert into tab values(1),(2),(3);
insert into tab2 values(1),(2),(3),(15);
SELECT m.i,
(SELECT COUNT(n.j)
FROM tab2 WHERE j=15) AS o
FROM tab m, tab2 n GROUP BY 1 order by m.i;
i	o
1	4
2	4
3	4
SELECT
(SELECT COUNT(n.j)
FROM tab2 WHERE j=15) AS o
FROM tab m, tab2 n order by m.i;
o
12
drop table if exists t1, t2;
create table t1 (a int, b int);
create table t2 (m int, n int);
insert into t1 values (2,2), (2,2), (3,3), (3,3), (3,3), (4,4);
insert into t2 values (1,11), (2,22), (3,32), (4,44), (4,44);
set @@sql_mode='TRADITIONAL';
select count(*) c, a,
( select group_concat(count(a)) from t2 where m = a )
from t1 group by a order by a;
c	a	( select group_concat(count(a)) from t2 where m = a )
2	2	2
3	3	3
1	4	1,1
drop table if exists t;
create table t (a int, b int);
insert into t values (1,1),(2,1),(2,2),(3,1),(3,2),(3,3);
select (select count(a)) from t;
(select count(a))
6
select (select (select (select count(a)))) from t;
(select (select (select count(a))))
6
select (select (select count(n.a)) from t m order by count(m.b)) from t n;
(select (select count(n.a)) from t m order by count(m.b))
6
select (select count(n.a) from t where count(n.a)=3) from t n;
(select count(n.a) from t where count(n.a)=3)
NULL
select (select count(a) from t where count(distinct n.a)=3) from t n;
(select count(a) from t where count(distinct n.a)=3)
6
select (select count(n.a) from t having count(n.a)=6 limit 1) from t n;
(select count(n.a) from t having count(n.a)=6 limit 1)
6
select (select count(n.a) from t having count(distinct n.b)=3 limit 1) from t n;
(select count(n.a) from t having count(distinct n.b)=3 limit 1)
6
select (select sum(distinct n.a) from t having count(distinct n.b)=3 limit 1) from t n;
(select sum(distinct n.a) from t having count(distinct n.b)=3 limit 1)
6
select (select sum(distinct n.a) from t having count(distinct n.b)=6 limit 1) from t n;
(select sum(distinct n.a) from t having count(distinct n.b)=6 limit 1)
NULL
select (select count(n.a) from t order by count(n.b) limit 1) from t n;
(select count(n.a) from t order by count(n.b) limit 1)
6
select (select count(distinct n.b) from t order by count(n.b) limit 1) from t n;
(select count(distinct n.b) from t order by count(n.b) limit 1)
3
select (select cnt from (select count(a) cnt) s) from t;
(select cnt from (select count(a) cnt) s)
6
select (select count(cnt) from (select count(a) cnt) s) from t;
(select count(cnt) from (select count(a) cnt) s)
1
select (select sum((select count(a)))) from t;
(select sum((select count(a))))
6
select (select sum((select count(a))+sum(a))) from t;
(select sum((select count(a))+sum(a)))
20
select (select count(a) from t group by count(n.a)) from t n;
(select count(a) from t group by count(n.a))
6
select (select count(distinct a) from t group by count(n.a)) from t n;
(select count(distinct a) from t group by count(n.a))
3
select sum(a) from t having (select count(a)) = 0;
sum(a)
select sum(a) from t having (select count(a)) > 0;
sum(a)
14
select count(a) from t group by b order by (select count(a));
count(a)
1
2
3
select count(a) from t group by b order by (select -count(a));
count(a)
3
2
1
select (select sum(count(a))) from t;
(select sum(count(a)))
6
select (select sum(sum(a))) from t;
(select sum(sum(a)))
14
select count(a), (select count(a)) from t;
count(a)	(select count(a))
6	6
select sum(distinct b), count(a), (select count(a)), (select cnt from (select sum(distinct b) as cnt) n) from t;
sum(distinct b)	count(a)	(select count(a))	(select cnt from (select sum(distinct b) as cnt) n)
6	6	6	6
set @@sql_mode=DEFAULT;
drop table if exists t;
create table t (a int, b int);
insert into t values (1,1);
select (select count(n.a + a) from t) from t n;
(select count(n.a + a) from t)
1
drop table if exists t;
create table t (a int, b int, c int);
insert into t values (1, 2, 3), (4, 5, 6), (7, 8, 9);
select a, count(b) from t where a = 1;
a	count(b)
1	1
select a, count(b) from t where a = 10;
a	count(b)
NULL	0
select a, c, sum(b) from t where a = 1 group by c;
a	c	sum(b)
1	3	2
select a from t where a = 1 order by count(b);
Error 3029 (HY000): Expression #1 of ORDER BY contains aggregate function and applies to the result of a non-aggregated query
select a from t where a = 1 having count(b) > 0;
a
1
drop table if exists t;
create table t (a int, b int, primary key(a,b));
select * from t where (a,b) in ((1,2),(1,2));
a	b
select * from t where (a,b) in (1,2);
Error 1241 (21000): Operand should contain 2 column(s)
select * from t where (a,b) in ((1,2),1);
Error 1241 (21000): Operand should contain 2 column(s)
drop table if exists t;
create table t (a int);
insert into t values(1),(2),(5);
select n in (1,2) from (select a in (1,2) as n from t) g;
n in (1,2)
1
1
0
select n in (1,n) from (select a in (1,2) as n from t) g;
n in (1,n)
1
1
1
drop table if exists t1, t2;
create table t1(i int primary key, j int, index idx_j(j));
create table t2(i int primary key, j int, index idx_j(j));
select t1.*, (select t2.* from t1) from t1;
Error 1051 (42S02): Unknown table 't2'
set @@tidb_partition_prune_mode='static';
drop table if exists t1;
create table t1(a int) partition by hash (a) partitions 5;
insert into t1 values (0);
select * from t1 where a not between 1 and 2;
a
0
set @@tidb_partition_prune_mode='dynamic';
drop table if exists t2;
create table t2(a int) partition by hash (a) partitions 5;
insert into t2 values (0);
select * from t2 where a not between 1 and 2;
a
0
set @@tidb_partition_prune_mode=DEFAULT;
create table tx (a int) partition by range (a) (partition p0 values less than (10), partition p1 values less than (20));
insert into tx values (1);
set @@tidb_partition_prune_mode='dynamic';
begin;
delete from tx where a in (1);
select * from tx PARTITION(p0);
a
select * from tx;
a
rollback;
drop table if exists t1;
create table `t1` (`a` enum('aa') DEFAULT NULL, KEY `k` (`a`));
insert into t1 values('aa');
insert into t1 values(null);
select a from t1 where a<=>'aa';
a
aa
select a from t1 where a<=>null;
a
NULL
CREATE TABLE IDT_MULTI15860STROBJSTROBJ (
COL1 enum('aa') DEFAULT NULL,
COL2 int(41) DEFAULT NULL,
COL3 year(4) DEFAULT NULL,
KEY U_M_COL4 (COL1,COL2),
KEY U_M_COL5 (COL3,COL2));
insert into IDT_MULTI15860STROBJSTROBJ  values("aa", 1013610488, 1982);
SELECT * FROM IDT_MULTI15860STROBJSTROBJ t1 RIGHT JOIN IDT_MULTI15860STROBJSTROBJ t2 ON t1.col1 <=> t2.col1 where t1.col1 is null and t2.col1 = "aa";
COL1	COL2	COL3	COL1	COL2	COL3
prepare stmt from "SELECT * FROM IDT_MULTI15860STROBJSTROBJ t1 RIGHT JOIN IDT_MULTI15860STROBJSTROBJ t2 ON t1.col1 <=> t2.col1 where t1.col1 is null and t2.col1 = ?";
set @a="aa";
execute stmt using @a;
COL1	COL2	COL3	COL1	COL2	COL3
drop table if exists t;
create table t(a int);
delete t from t;
delete t from planner__core__integration.t as t;
delete planner__core__integration.t from planner__core__integration.t as t;
Error 1109 (42S02): Unknown table 't' in MULTI DELETE
delete planner__core__integration.t from t;
drop database if exists db1;
create database db1;
use db1;
create table t(a int);
delete planner__core__integration.t from t;
Error 1109 (42S02): Unknown table 't' in MULTI DELETE
use planner__core__integration;
drop table if exists t;
create table t(a int primary key, b int not null, key(b));
delete /*+ use_index_merge(t) */ FROM t WHERE a=1 OR (b < SOME (SELECT /*+ use_index_merge(t)*/ b FROM t WHERE a<2 OR b<2));
drop table if exists t;
create table t(a int not null, b int not null, key(a), key(b));
delete /*+ use_index_merge(t) */ FROM t WHERE a=1 OR (b < SOME (SELECT /*+ use_index_merge(t)*/ b FROM t WHERE a<2 OR b<2));
drop table if exists t;
create table t(a int primary key, b int not null, c int, key(a), key(b,c));
delete /*+ use_index_merge(t) */ FROM t WHERE a=1 OR (a<2 and b<2);
drop table if exists t;
create table t(a int, b int, c int, d int, key(a), key(b));
insert into t values(10,1,1,10);
explain format = 'brief' select /*+ use_index_merge(t) */ * from t where a=10 or (b=10 and c=10);
id	estRows	task	access object	operator info
IndexMerge	0.02	root		type: union
â”œâ”€IndexRangeScan(Build)	10.00	cop[tikv]	table:t, index:a(a)	range:[10,10], keep order:false, stats:pseudo
â”œâ”€IndexRangeScan(Build)	10.00	cop[tikv]	table:t, index:b(b)	range:[10,10], keep order:false, stats:pseudo
â””â”€Selection(Probe)	0.02	cop[tikv]		or(eq(planner__core__integration.t.a, 10), and(eq(planner__core__integration.t.b, 10), eq(planner__core__integration.t.c, 10)))
  â””â”€TableRowIDScan	19.99	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ * from t where a=10 or (b=10 and c=10);
a	b	c	d
10	1	1	10
explain format = 'brief' select /*+ use_index_merge(t) */ * from t where (a=10 and d=10) or (b=10 and c=10);
id	estRows	task	access object	operator info
IndexMerge	0.00	root		type: union
â”œâ”€IndexRangeScan(Build)	10.00	cop[tikv]	table:t, index:a(a)	range:[10,10], keep order:false, stats:pseudo
â”œâ”€IndexRangeScan(Build)	10.00	cop[tikv]	table:t, index:b(b)	range:[10,10], keep order:false, stats:pseudo
â””â”€Selection(Probe)	0.00	cop[tikv]		or(and(eq(planner__core__integration.t.a, 10), eq(planner__core__integration.t.d, 10)), and(eq(planner__core__integration.t.b, 10), eq(planner__core__integration.t.c, 10)))
  â””â”€TableRowIDScan	19.99	cop[tikv]	table:t	keep order:false, stats:pseudo
select /*+ use_index_merge(t) */ * from t where (a=10 and d=10) or (b=10 and c=10);
a	b	c	d
10	1	1	10
drop table if exists t1;
CREATE TABLE t1 (a int(11));
SELECT @v:=(SELECT 1 FROM t1 t2 LEFT JOIN t1 ON t1.a GROUP BY t1.a) FROM t1;
@v:=(SELECT 1 FROM t1 t2 LEFT JOIN t1 ON t1.a GROUP BY t1.a)
drop table if exists t1, t2;
create table t1(a int(11));
create table t2(a decimal(40,20) unsigned, b decimal(40,20));
select count(*) as x from t1 group by a having x not in (select a from t2 where x = t2.b);
x
drop table if exists t1_no_idx;
create table t1_no_idx(id int, col_bit bit(16));
insert into t1_no_idx values(1, 0x3135);
insert into t1_no_idx values(2, 0x0f);
prepare stmt from 'select id from t1_no_idx where col_bit = ?';
set @a = 0x3135;
execute stmt using @a;
id
1
set @a = 0x0F;
execute stmt using @a;
id
2
prepare stmt from 'select id from t1_no_idx where col_bit in (?)';
set @a = 0x3135;
execute stmt using @a;
id
1
set @a = 0x0F;
execute stmt using @a;
id
2
drop table if exists t2_idx;
create table t2_idx(id int, col_bit bit(16), key(col_bit));
insert into t2_idx values(1, 0x3135);
insert into t2_idx values(2, 0x0f);
prepare stmt from 'select id from t2_idx where col_bit = ?';
set @a = 0x3135;
execute stmt using @a;
id
1
set @a = 0x0F;
execute stmt using @a;
id
2
prepare stmt from 'select id from t2_idx where col_bit in (?)';
set @a = 0x3135;
execute stmt using @a;
id
1
set @a = 0x0F;
execute stmt using @a;
id
2
drop table if exists t_varchar;
create table t_varchar(id int, col_varchar varchar(100), key(col_varchar));
insert into t_varchar values(1, '15');
prepare stmt from 'select id from t_varchar where col_varchar = ?';
set @a = 0x3135;
execute stmt using @a;
id
1
drop table if exists t1_no_idx;
create table t1_no_idx(id int, col_bit bit(16));
insert into t1_no_idx values(1, 0x3135);
insert into t1_no_idx values(2, 0x0f);
prepare stmt from 'select id from t1_no_idx where col_bit = ?';
set @a = 0b11000100110101;
execute stmt using @a;
id
1
prepare stmt from 'select id from t1_no_idx where col_bit in (?)';
set @a = 0b11000100110101;
execute stmt using @a;
id
1
drop table if exists t;
create table t (c1 float, c2 int, c3 int, primary key (c1) /*T![clustered_index] CLUSTERED */, key idx_1 (c2), key idx_2 (c3));
insert into t values(1.0,1,2),(2.0,2,1),(3.0,1,1),(4.0,2,2);
select /*+ use_index_merge(t) */ c3 from t where c3 = 1 or c2 = 1;
c3
1
1
2
drop table t;
create table t (a int, b int, c int, primary key (a,b) /*T![clustered_index] CLUSTERED */, key idx_c(c));
insert into t values (0,1,2);
select /*+ use_index_merge(t) */ c from t where c > 10 or a < 1;
c
2
drop table if exists t0, t1;
create table t0(a int, b int, c int as (a + b) virtual, unique index (c) invisible);
create table t1(a int, b int, c int as (a + b) virtual);
insert into t0(a, b) values (12, -1), (8, 7);
insert into t1(a, b) values (12, -1), (8, 7);
select /*+ stream_agg() */ count(1) from t0 where c > 10 and b < 2;
count(1)
1
select /*+ stream_agg() */ count(1) from t1 where c > 10 and b < 2;
count(1)
1
delete from t0;
insert into t0(a, b) values (5, 1);
select /*+ nth_plan(3) */ count(1) from t0 where c > 10 and b < 2;
count(1)
0
explain select /*+ stream_agg() */ count(1) from t0 where c > 10 and b < 2;
id	estRows	task	access object	operator info
StreamAgg_9	1.00	root		funcs:count(1)->Column#5
â””â”€Selection_18	3333.33	root		gt(planner__core__integration.t0.c, 10)
  â””â”€Projection_17	10000.00	root		planner__core__integration.t0.b, planner__core__integration.t0.c
    â””â”€TableReader_16	3323.33	root		data:Selection_15
      â””â”€Selection_15	3323.33	cop[tikv]		lt(planner__core__integration.t0.b, 2)
        â””â”€TableFullScan_14	10000.00	cop[tikv]	table:t0	keep order:false, stats:pseudo
drop table if exists NT_HP27193;
CREATE TABLE `NT_HP27193` (  `COL1` int(20) DEFAULT NULL,  `COL2` varchar(20) DEFAULT NULL,  `COL4` datetime DEFAULT NULL,  `COL3` bigint(20) DEFAULT NULL,  `COL5` float DEFAULT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin PARTITION BY HASH ( `COL1`%`COL3` ) PARTITIONS 10;
select col1 from NT_HP27193 where col1 is null;
col1
INSERT INTO NT_HP27193 (COL2, COL4, COL3, COL5) VALUES ('m',  '2020-05-04 13:15:27', 8,  2602);
select col1 from NT_HP27193 where col1 is null;
col1
NULL
drop table if exists NT_HP27193;
drop table if exists t;
create table t(a varbinary(10),UNIQUE KEY(a));
insert into t values(0x00A4EEF4FA55D6706ED5);
select count(*) from t where a=0x00A4EEF4FA55D6706ED5;
count(*)
1
select * from t where a=0x00A4EEF4FA55D6706ED5;
a
 ¤îôúUÖpnÕ
drop table if exists BB;
CREATE TABLE `BB` (
`col_int` int(11) DEFAULT NULL,
`col_varchar_10` varchar(10) DEFAULT NULL,
`pk` int(11) NOT NULL AUTO_INCREMENT,
`col_int_not_null` int(11) NOT NULL,
`col_decimal` decimal(10,0) DEFAULT NULL,
`col_datetime` datetime DEFAULT NULL,
`col_decimal_not_null` decimal(10,0) NOT NULL,
`col_datetime_not_null` datetime NOT NULL,
`col_varchar_10_not_null` varchar(10) NOT NULL,
PRIMARY KEY (`pk`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin AUTO_INCREMENT=2000001;
explain SELECT OUTR . col2 AS X FROM (SELECT INNR . col1 as col1, SUM( INNR . col2 ) as col2 FROM (SELECT INNR . `col_int_not_null` + 1 as col1, INNR . `pk` as col2 FROM BB AS INNR) AS INNR GROUP BY col1) AS OUTR2 INNER JOIN (SELECT INNR . col1 as col1, MAX( INNR . col2 ) as col2 FROM (SELECT INNR . `col_int_not_null` + 1 as col1, INNR . `pk` as col2 FROM BB AS INNR) AS INNR GROUP BY col1) AS OUTR ON OUTR2.col1 = OUTR.col1 GROUP BY OUTR . col1, OUTR2 . col1 HAVING X <> 'b';
Error 1055 (42000): Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column '.OUTR.' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
drop table if exists member, agent, deposit, view_member_agents;
create table member(login varchar(50) NOT NULL, agent_login varchar(100) DEFAULT NULL, PRIMARY KEY(login));
create table agent(login varchar(50) NOT NULL, data varchar(100) DEFAULT NULL, share_login varchar(50) NOT NULL, PRIMARY KEY(login));
create table deposit(id varchar(50) NOT NULL, member_login varchar(50) NOT NULL, transfer_amount int NOT NULL, PRIMARY KEY(id), KEY midx(member_login, transfer_amount));
create definer='root'@'localhost' view view_member_agents (member, share_login) as select m.login as member, a.share_login AS share_login from member as m join agent as a on m.agent_login = a.login;
select s.member_login as v1, SUM(s.transfer_amount) AS v2 FROM deposit AS s JOIN view_member_agents AS v ON s.member_login = v.member WHERE 1 = 1 AND v.share_login = 'somevalue' GROUP BY s.member_login UNION select 1 as v1, 2 as v2;
v1	v2
1	2
drop table if exists t1, t2;
create table t1 (a float default null, b smallint(6) DEFAULT NULL);
insert into t1 values (1, 1);
create table t2 (a float default null, b tinyint(4) DEFAULT NULL, key b (b));
insert into t2 values (null, 1);
explain select /*+ TIDB_INLJ(t2@sel_2) */ t1.a, t1.b from t1 where t1.a not in (select t2.a from t2 where t1.b=t2.b);
id	estRows	task	access object	operator info
IndexJoin_12	8000.00	root		anti semi join, inner:IndexLookUp_11, outer key:planner__core__integration.t1.b, inner key:planner__core__integration.t2.b, equal cond:eq(planner__core__integration.t1.b, planner__core__integration.t2.b), other cond:eq(planner__core__integration.t1.a, planner__core__integration.t2.a)
â”œâ”€TableReader_22(Build)	10000.00	root		data:TableFullScan_21
â”‚ â””â”€TableFullScan_21	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
â””â”€IndexLookUp_11(Probe)	12500.00	root		
  â”œâ”€IndexRangeScan_9(Build)	12500.00	cop[tikv]	table:t2, index:b(b)	range: decided by [eq(planner__core__integration.t2.b, planner__core__integration.t1.b)], keep order:false, stats:pseudo
  â””â”€TableRowIDScan_10(Probe)	12500.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
select /*+ TIDB_INLJ(t2@sel_2) */ t1.a, t1.b from t1 where t1.a not in (select t2.a from t2 where t1.b=t2.b);
a	b
drop table if exists t;
create table t(a int);
insert into t values(1);
select count(a) f1, row_number() over (order by count(a)) as f2 from t limit 1;
f1	f2
1	1
set names utf8mb4;
drop table if exists all_types;
CREATE TABLE `all_types` (`id` int(11) NOT NULL,`d_tinyint` tinyint(4) DEFAULT NULL,`d_smallint` smallint(6) DEFAULT NULL,`d_int` int(11) DEFAULT NULL,`d_bigint` bigint(20) DEFAULT NULL,`d_float` float DEFAULT NULL,`d_double` double DEFAULT NULL,`d_decimal` decimal(10,2) DEFAULT NULL,`d_bit` bit(10) DEFAULT NULL,`d_binary` binary(10) DEFAULT NULL,`d_date` date DEFAULT NULL,`d_datetime` datetime DEFAULT NULL,`d_timestamp` timestamp NULL DEFAULT NULL,`d_varchar` varchar(20) NULL default NULL,PRIMARY KEY (`id`));
select @@collation_connection;
@@collation_connection
utf8mb4_bin
insert into all_types values(0, 0, 1, 2, 3, 1.5, 2.2, 10.23, 12, 'xy', '2021-12-12', '2021-12-12 12:00:00', '2021-12-12 12:00:00', '123');
select collation(c) from (select d_date c from all_types union select d_int c from all_types) t;
collation(c)
utf8mb4_bin
utf8mb4_bin
select collation(c) from (select d_date c from all_types union select d_int collate binary c from all_types) t;
collation(c)
binary
binary
select collation(c) from (select d_date c from all_types union select d_float c from all_types) t;
collation(c)
utf8mb4_bin
utf8mb4_bin
select collation(c) from (select d_timestamp c from all_types union select d_float c from all_types) t;
collation(c)
utf8mb4_bin
utf8mb4_bin
drop table if exists t;
create table t (a char(65) collate utf8_unicode_ci, b text collate utf8_general_ci not null);
insert into t values ('a', 'A');
insert into t values ('b', 'B');
(select a from t) union ( select b from t);
Error 1271 (HY000): Illegal mix of collations for operation 'UNION'
(select 'a' collate utf8mb4_unicode_ci) union (select 'b' collate utf8mb4_general_ci);
Error 1271 (HY000): Illegal mix of collations for operation 'UNION'
(select a from t) union ( select b from t) union all select 'a';
Error 1271 (HY000): Illegal mix of collations for operation 'UNION'
(select a from t) union ( select b from t) union select 'a';
Error 1271 (HY000): Illegal mix of collations for operation 'UNION'
(select a from t) union ( select b from t) union select 'a' except select 'd';
Error 1271 (HY000): Illegal mix of collations for operation 'UNION'
create table tp (id int primary key) partition by range (id) (partition p0 values less than (100));
create table tn (id int primary key);
insert into tp values(1),(2);
insert into tn values(1),(2);
select * from tp,tn where tp.id=tn.id and tn.id=1 for update;
id	id
1	1
drop table if exists t;
create table t (pk int primary key auto_increment, year int, c varchar(256), index idx_year(year));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
analyze table t;
set @@tidb_opt_enable_correlation_adjustment = false;
explain format=brief select * from t use index(primary) where year=2002 limit 1;
id	estRows	task	access object	operator info
Limit	1.00	root		offset:0, count:1
â””â”€TableReader	1.00	root		data:Limit
  â””â”€Limit	1.00	cop[tikv]		offset:0, count:1
    â””â”€Selection	1.00	cop[tikv]		eq(planner__core__integration.t.year, 2002)
      â””â”€TableFullScan	3.00	cop[tikv]	table:t	keep order:false
set @@tidb_opt_enable_correlation_adjustment = true;
explain format=brief select * from t use index(primary) where year=2002 limit 1;
id	estRows	task	access object	operator info
Limit	1.00	root		offset:0, count:1
â””â”€TableReader	1.00	root		data:Limit
  â””â”€Limit	1.00	cop[tikv]		offset:0, count:1
    â””â”€Selection	1.00	cop[tikv]		eq(planner__core__integration.t.year, 2002)
      â””â”€TableFullScan	21.00	cop[tikv]	table:t	keep order:false
truncate table t;
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2000, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2001, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2002, space(256));
insert into t (year, c) values (2003, space(256));
insert into t (year, c) values (2003, space(256));
insert into t (year, c) values (2004, space(256));
insert into t (year, c) values (2004, space(256));
insert into t (year, c) values (2005, space(256));
insert into t (year, c) values (2005, space(256));
insert into t (year, c) values (2006, space(256));
insert into t (year, c) values (2006, space(256));
insert into t (year, c) values (2007, space(256));
insert into t (year, c) values (2007, space(256));
insert into t (year, c) values (2008, space(256));
insert into t (year, c) values (2008, space(256));
insert into t (year, c) values (2009, space(256));
insert into t (year, c) values (2009, space(256));
insert into t (year, c) values (2010, space(256));
insert into t (year, c) values (2010, space(256));
insert into t (year, c) values (2011, space(256));
insert into t (year, c) values (2011, space(256));
insert into t (year, c) values (2012, space(256));
insert into t (year, c) values (2012, space(256));
insert into t (year, c) values (2013, space(256));
insert into t (year, c) values (2013, space(256));
insert into t (year, c) values (2014, space(256));
insert into t (year, c) values (2014, space(256));
insert into t (year, c) values (2015, space(256));
insert into t (year, c) values (2015, space(256));
insert into t (year, c) values (2016, space(256));
insert into t (year, c) values (2016, space(256));
insert into t (year, c) values (2017, space(256));
insert into t (year, c) values (2017, space(256));
insert into t (year, c) values (2018, space(256));
insert into t (year, c) values (2018, space(256));
insert into t (year, c) values (2019, space(256));
insert into t (year, c) values (2019, space(256));
insert into t (year, c) values (2020, space(256));
insert into t (year, c) values (2020, space(256));
insert into t (year, c) values (2021, space(256));
insert into t (year, c) values (2021, space(256));
insert into t (year, c) values (2022, space(256));
insert into t (year, c) values (2022, space(256));
insert into t (year, c) values (2023, space(256));
insert into t (year, c) values (2023, space(256));
insert into t (year, c) values (2024, space(256));
insert into t (year, c) values (2024, space(256));
insert into t (year, c) values (2025, space(256));
insert into t (year, c) values (2025, space(256));
insert into t (year, c) values (2026, space(256));
insert into t (year, c) values (2026, space(256));
insert into t (year, c) values (2027, space(256));
insert into t (year, c) values (2027, space(256));
insert into t (year, c) values (2028, space(256));
insert into t (year, c) values (2028, space(256));
insert into t (year, c) values (2029, space(256));
insert into t (year, c) values (2029, space(256));
insert into t (year, c) values (2030, space(256));
insert into t (year, c) values (2030, space(256));
insert into t (year, c) values (2031, space(256));
insert into t (year, c) values (2031, space(256));
insert into t (year, c) values (2032, space(256));
insert into t (year, c) values (2032, space(256));
insert into t (year, c) values (2033, space(256));
insert into t (year, c) values (2033, space(256));
insert into t (year, c) values (2034, space(256));
insert into t (year, c) values (2034, space(256));
insert into t (year, c) values (2035, space(256));
insert into t (year, c) values (2035, space(256));
insert into t (year, c) values (2036, space(256));
insert into t (year, c) values (2036, space(256));
insert into t (year, c) values (2037, space(256));
insert into t (year, c) values (2037, space(256));
insert into t (year, c) values (2038, space(256));
insert into t (year, c) values (2038, space(256));
insert into t (year, c) values (2039, space(256));
insert into t (year, c) values (2039, space(256));
insert into t (year, c) values (2040, space(256));
insert into t (year, c) values (2040, space(256));
insert into t (year, c) values (2041, space(256));
insert into t (year, c) values (2041, space(256));
insert into t (year, c) values (2042, space(256));
insert into t (year, c) values (2042, space(256));
insert into t (year, c) values (2043, space(256));
insert into t (year, c) values (2043, space(256));
insert into t (year, c) values (2044, space(256));
insert into t (year, c) values (2044, space(256));
insert into t (year, c) values (2045, space(256));
insert into t (year, c) values (2045, space(256));
insert into t (year, c) values (2046, space(256));
insert into t (year, c) values (2046, space(256));
insert into t (year, c) values (2047, space(256));
insert into t (year, c) values (2047, space(256));
insert into t (year, c) values (2048, space(256));
insert into t (year, c) values (2048, space(256));
insert into t (year, c) values (2049, space(256));
insert into t (year, c) values (2049, space(256));
insert into t (year, c) values (2050, space(256));
insert into t (year, c) values (2050, space(256));
analyze table t;
explain format=brief select * from t use index(primary) where year=2000 limit 1;
id	estRows	task	access object	operator info
Limit	1.00	root		offset:0, count:1
â””â”€TableReader	1.00	root		data:Limit
  â””â”€Limit	1.00	cop[tikv]		offset:0, count:1
    â””â”€Selection	1.00	cop[tikv]		eq(planner__core__integration.t.year, 2000)
      â””â”€TableFullScan	51.00	cop[tikv]	table:t	keep order:false
drop table if exists t1, t2, t3;
create table t1(t1a int, t1b int, t1c int);
create table t2(t2a int, t2b int, t2c int);
create table t3(t3a int, t3b int, t3c int);
with inv as
(select t1a , t3a, sum(t2c)
from t1, t2, t3
where t2a = t1a
and t2b = t3b
and t3c = 1998
group by t1a, t3a)
select inv1.t1a, inv2.t3a
from inv inv1, inv inv2
where inv1.t1a = inv2.t1a
and inv1.t3a = 4
and inv2.t3a = 4+1;
t1a	t3a
drop table if exists t;
create table `t` (`a` int(11) default null, `b` int(11) default null, `c` int(11) default null, key `expression_index` ((case when `a` < 0 then 1 else 2 end)));
select * from t  where case when a < 0 then 1 else 2 end <= 1 order by 4;
Error 1054 (42S22): Unknown column '4' in 'order clause'
drop table if exists t6;
CREATE TABLE t6(t TIME, ts TIMESTAMP);
INSERT INTO t6 VALUES ('12:30', '2016-07-05 08:30:42');
drop view if exists v;
CREATE definer='root'@'localhost' VIEW v AS SELECT COUNT(*) OVER w0, COUNT(*) OVER w from t6 WINDOW w0 AS (), w  AS (w0 ORDER BY t);
select * from v;
COUNT(*) OVER w0	COUNT(*) OVER w
1	1
drop table if exists IDT_MC21814;
CREATE TABLE `IDT_MC21814` (`COL1` year(4) DEFAULT NULL,`COL2` year(4) DEFAULT NULL,KEY `U_M_COL` (`COL1`,`COL2`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
insert into IDT_MC21814 values(1901, 2119), (2155, 2000);
SELECT/*+ INL_JOIN(t1, t2), nth_plan(1) */ t2.* FROM IDT_MC21814 t1 LEFT JOIN IDT_MC21814 t2 ON t1.col1 = t2.col1 WHERE t2.col2 BETWEEN 2593 AND 1971 AND t1.col1 IN (2155, 1901, 1967);
COL1	COL2
SELECT/*+ INL_JOIN(t1, t2), nth_plan(2) */ t2.* FROM IDT_MC21814 t1 LEFT JOIN IDT_MC21814 t2 ON t1.col1 = t2.col1 WHERE t2.col2 BETWEEN 2593 AND 1971 AND t1.col1 IN (2155, 1901, 1967);
COL1	COL2
Level	Code	Message
Warning	1105	The parameter of nth_plan() is out of range
drop table if exists t;
create table t (a int);
insert into t values (1);
analyze table t;
set tidb_opt_limit_push_down_threshold=0;
explain format=brief select a from t order by a desc limit 10;
id	estRows	task	access object	operator info
TopN	1.00	root		planner__core__integration.t.a:desc, offset:0, count:10
â””â”€TableReader	1.00	root		data:TableFullScan
  â””â”€TableFullScan	1.00	cop[tikv]	table:t	keep order:false
set tidb_opt_limit_push_down_threshold=10;
explain format=brief select a from t order by a desc limit 10;
id	estRows	task	access object	operator info
TopN	1.00	root		planner__core__integration.t.a:desc, offset:0, count:10
â””â”€TableReader	1.00	root		data:TopN
  â””â”€TopN	1.00	cop[tikv]		planner__core__integration.t.a:desc, offset:0, count:10
    â””â”€TableFullScan	1.00	cop[tikv]	table:t	keep order:false
explain format=brief select a from t order by a desc limit 11;
id	estRows	task	access object	operator info
TopN	1.00	root		planner__core__integration.t.a:desc, offset:0, count:11
â””â”€TableReader	1.00	root		data:TableFullScan
  â””â”€TableFullScan	1.00	cop[tikv]	table:t	keep order:false
explain format=brief select /*+ limit_to_cop() */ a from t order by a desc limit 11;
id	estRows	task	access object	operator info
TopN	1.00	root		planner__core__integration.t.a:desc, offset:0, count:11
â””â”€TableReader	1.00	root		data:TopN
  â””â”€TopN	1.00	cop[tikv]		planner__core__integration.t.a:desc, offset:0, count:11
    â””â”€TableFullScan	1.00	cop[tikv]	table:t	keep order:false
drop table if exists t;
create table t(a timestamp, b datetime);
insert into t values('2020-07-29 09:07:01', '2020-07-27 16:57:36');
select greatest(a, b) from t union select null;
greatest(a, b)
NULL
2020-07-29 09:07:01
drop table if exists t1;
set tidb_cost_model_version=2;
create table t1( a enum('y','b','Abc','null'),b enum('y','b','Abc','null'),key(a));
explain format=brief select * from t1 where a like "A%";
id	estRows	task	access object	operator info
TableReader	8000.00	root		data:Selection
â””â”€Selection	8000.00	cop[tikv]		like(planner__core__integration.t1.a, "A%", 92)
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
explain format=brief select * from t1 where b like "A%";
id	estRows	task	access object	operator info
TableReader	8000.00	root		data:Selection
â””â”€Selection	8000.00	cop[tikv]		like(planner__core__integration.t1.b, "A%", 92)
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
drop table if exists t2;
create table t2( a enum('y','b','Abc','null'),b enum('y','b','Abc','null'),key(a, b));
explain format=brief select * from t2 where a like "A%";
id	estRows	task	access object	operator info
IndexReader	8000.00	root		index:Selection
â””â”€Selection	8000.00	cop[tikv]		like(planner__core__integration.t2.a, "A%", 92)
  â””â”€IndexFullScan	10000.00	cop[tikv]	table:t2, index:a(a, b)	keep order:false, stats:pseudo
explain format=brief select * from t2 where a like "A%" and b like "A%";
id	estRows	task	access object	operator info
IndexReader	8000.00	root		index:Selection
â””â”€Selection	8000.00	cop[tikv]		like(planner__core__integration.t2.a, "A%", 92), like(planner__core__integration.t2.b, "A%", 92)
  â””â”€IndexFullScan	10000.00	cop[tikv]	table:t2, index:a(a, b)	keep order:false, stats:pseudo
drop table if exists t3;
create table t3( a int,b enum('y','b','Abc','null'), c enum('y','b','Abc','null'),key(a, b, c));
explain format=brief select * from t3 where a = 1 and b like "A%";
id	estRows	task	access object	operator info
IndexReader	8.00	root		index:Selection
â””â”€Selection	8.00	cop[tikv]		like(planner__core__integration.t3.b, "A%", 92)
  â””â”€IndexRangeScan	10.00	cop[tikv]	table:t3, index:a(a, b, c)	range:[1,1], keep order:false, stats:pseudo
drop table if exists UK_MU16407;
CREATE TABLE UK_MU16407 (COL3 timestamp NULL DEFAULT NULL, UNIQUE KEY U3(COL3));
insert into UK_MU16407 values("1985-08-31 18:03:27");
SELECT COL3 FROM UK_MU16407 WHERE COL3>_utf8mb4'2039-1-19 3:14:40';
COL3
DROP TABLE UK_MU16407;
drop table if exists t28424, dt28242;
set time_zone='+00:00';
drop table if exists t28424,dt28424;
create table t28424 (t timestamp);
insert into t28424 values ("2038-01-19 03:14:07"), ("1970-01-01 00:00:01");
select * from t28424 where t != "2038-1-19 3:14:08";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t < "2038-1-19 3:14:08";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t <= "2038-1-19 3:14:08";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t >= "2038-1-19 3:14:08";
t
select * from t28424 where t > "2038-1-19 3:14:08";
t
select * from t28424 where t != "1970-1-1 0:0:0";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t < "1970-1-1 0:0:0";
t
select * from t28424 where t <= "1970-1-1 0:0:0";
t
select * from t28424 where t >= "1970-1-1 0:0:0";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t > "1970-1-1 0:0:0";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
alter table t28424 add unique index (t);
select * from t28424 where t != "2038-1-19 3:14:08";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t < "2038-1-19 3:14:08";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t <= "2038-1-19 3:14:08";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t >= "2038-1-19 3:14:08";
t
select * from t28424 where t > "2038-1-19 3:14:08";
t
select * from t28424 where t != "1970-1-1 0:0:0";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t < "1970-1-1 0:0:0";
t
select * from t28424 where t <= "1970-1-1 0:0:0";
t
select * from t28424 where t >= "1970-1-1 0:0:0";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
select * from t28424 where t > "1970-1-1 0:0:0";
t
1970-01-01 00:00:01
2038-01-19 03:14:07
create table dt28424 (dt datetime);
insert into dt28424 values ("2038-01-19 03:14:07"), ("1970-01-01 00:00:01");
insert into dt28424 values ("1969-12-31 23:59:59"), ("1970-01-01 00:00:00"), ("2038-03-19 03:14:08");
select * from t28424 right join dt28424 on t28424.t = dt28424.dt;
t	dt
NULL	1969-12-31 23:59:59
NULL	1970-01-01 00:00:00
NULL	2038-03-19 03:14:08
1970-01-01 00:00:01	1970-01-01 00:00:01
2038-01-19 03:14:07	2038-01-19 03:14:07
DROP TABLE dt28424;
DROP TABLE t28424;
create temporary table tmp1(a int, b int, c int);
insert into tmp1 values (1,1,1),(2,2,2),(3,3,3),(4,4,4);
with cte1 as (with cte2 as (select * from tmp1) select * from cte2) select * from cte1 left join tmp1 on cte1.c=tmp1.c;
a	b	c	a	b	c
1	1	1	1	1	1
2	2	2	2	2	2
3	3	3	3	3	3
4	4	4	4	4	4
with cte1 as (with cte2 as (select * from tmp1) select * from cte2) select * from cte1 t1 left join cte1 t2 on t1.c=t2.c;
a	b	c	a	b	c
1	1	1	1	1	1
2	2	2	2	2	2
3	3	3	3	3	3
4	4	4	4	4	4
WITH RECURSIVE cte(a) AS (SELECT 1 UNION SELECT a+1 FROM tmp1 WHERE a < 5) SELECT * FROM cte order by a;
a
1
2
3
4
5
SELECT @@session.tidb_partition_prune_mode;
@@session.tidb_partition_prune_mode
dynamic
set @@session.tidb_partition_prune_mode = 'static';
drop table if exists t27797;
create table t27797(a int, b int, c int, d int) partition by range columns(d) (partition p0 values less than (20),partition p1 values less than(40),partition p2 values less than(60));
insert into t27797 values(1,1,1,1), (2,2,2,2), (22,22,22,22), (44,44,44,44);
set sql_mode='';
select count(*) from (select a, b from t27797 where d > 1 and d < 60 and b > 0 group by b, c) tt;
count(*)
3
drop table if exists IDT_HP24172;
CREATE TABLE `IDT_HP24172` ( `COL1` mediumint(16) DEFAULT NULL, `COL2` varchar(20) DEFAULT NULL, `COL4` datetime DEFAULT NULL, `COL3` bigint(20) DEFAULT NULL, `COL5` float DEFAULT NULL, KEY `UM_COL` (`COL1`,`COL3`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin PARTITION BY HASH( `COL1`+`COL3` ) PARTITIONS 8;
insert into IDT_HP24172(col1) values(8388607);
select col2 from IDT_HP24172 where col1 = 8388607 and col1 in (select col1 from IDT_HP24172);
col2
NULL
set @@session.tidb_partition_prune_mode = DEFAULT;
set sql_mode=DEFAULT;
drop table if exists t;
create table t(a TEXT);
insert into t values('abc');
select * from t where from_base64('');
a
update t set a = 'def' where from_base64('');
Error 1292 (22007): Truncated incorrect DOUBLE value: ''
select * from t where from_base64('invalidbase64');
a
update t set a = 'hig' where from_base64('invalidbase64');
select * from t where from_base64('test');
a
update t set a = 'xyz' where from_base64('test');
Error 1292 (22007): Truncated incorrect DOUBLE value: 'µë-'
select * from t;
a
abc
drop table if exists t;
drop table if exists tbl_29711;
CREATE TABLE `tbl_29711` (`col_250` text COLLATE utf8_unicode_ci NOT NULL,`col_251` enum('Alice','Bob','Charlie','David') COLLATE utf8_unicode_ci NOT NULL DEFAULT 'Charlie',PRIMARY KEY (`col_251`,`col_250`(1)) NONCLUSTERED);
explain format=brief select col_250,col_251 from tbl_29711 use index (primary) where col_251 between 'Bob' and 'David' order by col_250,col_251 limit 6;
id	estRows	task	access object	operator info
TopN	6.00	root		planner__core__integration.tbl_29711.col_250, planner__core__integration.tbl_29711.col_251, offset:0, count:6
â””â”€IndexLookUp	6.00	root		
  â”œâ”€IndexRangeScan(Build)	250.00	cop[tikv]	table:tbl_29711, index:PRIMARY(col_251, col_250)	range:["Bob","David"], keep order:false, stats:pseudo
  â””â”€TopN(Probe)	6.00	cop[tikv]		planner__core__integration.tbl_29711.col_250, planner__core__integration.tbl_29711.col_251, offset:0, count:6
    â””â”€TableRowIDScan	250.00	cop[tikv]	table:tbl_29711	keep order:false, stats:pseudo
drop table if exists t29711;
CREATE TABLE `t29711` (`a` varchar(10) DEFAULT NULL,`b` int(11) DEFAULT NULL,`c` int(11) DEFAULT NULL,KEY `ia` (`a`(2)));
explain format=brief select * from t29711 use index (ia) order by a limit 10;
id	estRows	task	access object	operator info
TopN	10.00	root		planner__core__integration.t29711.a, offset:0, count:10
â””â”€IndexLookUp	10.00	root		
  â”œâ”€IndexFullScan(Build)	10000.00	cop[tikv]	table:t29711, index:ia(a)	keep order:false, stats:pseudo
  â””â”€TopN(Probe)	10.00	cop[tikv]		planner__core__integration.t29711.a, offset:0, count:10
    â””â”€TableRowIDScan	10000.00	cop[tikv]	table:t29711	keep order:false, stats:pseudo
drop table if exists t;
create table t(a varchar(100), b int, c int, index idx1(a(2), b), index idx2(a));
explain format = 'verbose' select * from t where a = 'abcdefghijk' and b > 4;
id	estRows	estCost	task	access object	operator info
IndexLookUp_11	33.33	65346.12	root		
â”œâ”€IndexRangeScan_8(Build)	33.33	9127.55	cop[tikv]	table:t, index:idx1(a, b)	range:("ab" 4,"ab" +inf], keep order:false, stats:pseudo
â””â”€Selection_10(Probe)	33.33	11066.03	cop[tikv]		eq(planner__core__integration.t.a, "abcdefghijk")
  â””â”€TableRowIDScan_9	33.33	9402.70	cop[tikv]	table:t	keep order:false, stats:pseudo
drop table if exists t30094;
create table t30094(a varchar(10));
explain format = 'brief' select * from t30094 where cast(a as float) and cast(a as char);
id	estRows	task	access object	operator info
TableReader	8000.00	root		data:Selection
â””â”€Selection	8000.00	cop[tikv]		cast(planner__core__integration.t30094.a, float BINARY), cast(planner__core__integration.t30094.a, var_string(5))
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t30094	keep order:false, stats:pseudo
explain format = 'brief' select * from t30094 where  concat(a,'1') = _binary 0xe59388e59388e59388 collate binary and concat(a,'1') = _binary 0xe598bfe598bfe598bf collate binary;
id	estRows	task	access object	operator info
TableReader	8000.00	root		data:Selection
â””â”€Selection	8000.00	cop[tikv]		eq(concat(planner__core__integration.t30094.a, "1"), "0xe59388e59388e59388"), eq(concat(planner__core__integration.t30094.a, "1"), "0xe598bfe598bfe598bf")
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t30094	keep order:false, stats:pseudo
SELECT @@session.tidb_partition_prune_mode;
@@session.tidb_partition_prune_mode
dynamic
set @@session.tidb_partition_prune_mode = 'static';
drop table if exists t;
create table t(id int) partition by hash(id) partitions 4;
insert into t values(1);
SELECT COUNT(1) FROM ( SELECT COUNT(1) FROM t b GROUP BY id) a;
COUNT(1)
1
set @@session.tidb_partition_prune_mode = DEFAULT;
drop table if exists t;
create table t(a char(10), b char(10), c char(10), index (a, b, c)) collate utf8mb4_bin;
insert into t values ('b', 'a', '1'), ('b', 'A', '2'), ('c', 'a', '3');
set names utf8mb4 collate utf8mb4_general_ci;
select * from t where (a>'a' and b='a') or (b = 'A' and a < 'd') order by a,c;
a	b	c
b	a	1
b	A	2
c	a	3
drop table if exists t1, t2;
create table t1(a int, b int);
create table t2(a int, b int);
select avg(0) over w from t1 window w as (order by (select 1));
avg(0) over w
select avg(0) over w from t1 where b > (select sum(t2.a) over w from t2) window w as (partition by t1.b);
Error 3579 (HY000): Window name 'w' is not defined.
select avg(0) over w1 from t1 where b > (select sum(t2.a) over w2 from t2 window w2 as (partition by t2.b)) window w1 as (partition by t1.b);
avg(0) over w1
drop table if exists t1;
create table t1(c1 int, c2 int);
select /*+ use_index_merge(t1) */ * from t1 where c1 < 1 or c2 < 1;
c1	c2
Level	Code	Message
Warning	1105	IndexMerge is inapplicable or disabled. No available filter or available index.
drop table if exists t1;
create table t1(c1 int, c2 int, key(c1), key(c2));
select /*+ use_index_merge(t1), no_index_merge() */ * from t1 where c1 < 1 or c2 < 1;
c1	c2
Level	Code	Message
Warning	1105	IndexMerge is inapplicable or disabled. Got no_index_merge hint or tidb_enable_index_merge is off.
drop table if exists t1;
create temporary table t1(c1 int, c2 int, key(c1), key(c2));
select /*+ use_index_merge(t1) */ * from t1 where c1 < 1 or c2 < 1;
c1	c2
Level	Code	Message
Warning	1105	IndexMerge is inapplicable or disabled. Cannot use IndexMerge on temporary table.
drop table if exists t1, t2;
CREATE TABLE t1 (a int PRIMARY KEY, b int);
CREATE TABLE t2 (a int PRIMARY KEY, b int);
INSERT INTO t1 VALUES (1,1), (2,1), (3,1), (4,2);
INSERT INTO t2 VALUES (1,2), (2,2);
explain format=brief SELECT * FROM t1 LEFT JOIN t2 ON t1.a=t2.a WHERE not(0+(t1.a=30 and t2.b=1));
id	estRows	task	access object	operator info
Selection	8000.00	root		not(plus(0, and(eq(planner__core__integration.t1.a, 30), eq(planner__core__integration.t2.b, 1))))
â””â”€MergeJoin	10000.00	root		left outer join, left key:planner__core__integration.t1.a, right key:planner__core__integration.t2.a
  â”œâ”€TableReader(Build)	8000.00	root		data:Selection
  â”‚ â””â”€Selection	8000.00	cop[tikv]		not(istrue_with_null(plus(0, and(eq(planner__core__integration.t2.a, 30), eq(planner__core__integration.t2.b, 1)))))
  â”‚   â””â”€TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
  â””â”€TableReader(Probe)	10000.00	root		data:TableFullScan
    â””â”€TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
SELECT * FROM t1 LEFT JOIN t2 ON t1.a=t2.a WHERE not(0+(t1.a=30 and t2.b=1));
a	b	a	b
1	1	1	2
2	1	2	2
3	1	NULL	NULL
4	2	NULL	NULL
drop table if exists t1;
create table t1(c1 longtext, c2 decimal(37, 4), unique key(c1(10)), unique key(c2));
insert into t1 values('çœ', -962541614831459.7458);
select * from t1 order by c2 + 10;
c1	c2
çœ	-962541614831459.7458
drop table if exists t1;
create table t1(a int, b int, c int);
insert into t1 value(10,10,10);
insert into t1 select * from t1;
insert into t1 select * from t1;
insert into t1 select * from t1;
insert into t1 select * from t1;
insert into t1 select * from t1;
insert into t1 select * from t1;
insert into t1 select * from t1;
insert into t1 value(1,1,1);
analyze table t1;
explain format = 'brief' select * from t1 where a=1 or b=1;
id	estRows	task	access object	operator info
TableReader	1.99	root		data:Selection
â””â”€Selection	1.99	cop[tikv]		or(eq(planner__core__integration.t1.a, 1), eq(planner__core__integration.t1.b, 1))
  â””â”€TableFullScan	129.00	cop[tikv]	table:t1	keep order:false
explain format = 'brief' select * from t1 where 0=1 or a=1 or b=1;
id	estRows	task	access object	operator info
TableReader	1.99	root		data:Selection
â””â”€Selection	1.99	cop[tikv]		or(0, or(eq(planner__core__integration.t1.a, 1), eq(planner__core__integration.t1.b, 1)))
  â””â”€TableFullScan	129.00	cop[tikv]	table:t1	keep order:false
explain format = 'brief' select * from t1 where null or a=1 or b=1;
id	estRows	task	access object	operator info
TableReader	1.99	root		data:Selection
â””â”€Selection	1.99	cop[tikv]		or(0, or(eq(planner__core__integration.t1.a, 1), eq(planner__core__integration.t1.b, 1)))
  â””â”€TableFullScan	129.00	cop[tikv]	table:t1	keep order:false
explain format = 'brief' select * from t1 where a=1 or false or b=1;
id	estRows	task	access object	operator info
TableReader	1.99	root		data:Selection
â””â”€Selection	1.99	cop[tikv]		or(eq(planner__core__integration.t1.a, 1), or(0, eq(planner__core__integration.t1.b, 1)))
  â””â”€TableFullScan	129.00	cop[tikv]	table:t1	keep order:false
explain format = 'brief' select * from t1 where a=1 or b=1 or "false";
id	estRows	task	access object	operator info
TableReader	1.99	root		data:Selection
â””â”€Selection	1.99	cop[tikv]		or(eq(planner__core__integration.t1.a, 1), or(eq(planner__core__integration.t1.b, 1), 0))
  â””â”€TableFullScan	129.00	cop[tikv]	table:t1	keep order:false
explain format = 'brief' select * from t1 where 1=1 or a=1 or b=1;
id	estRows	task	access object	operator info
TableReader	129.00	root		data:Selection
â””â”€Selection	129.00	cop[tikv]		or(1, or(eq(planner__core__integration.t1.a, 1), eq(planner__core__integration.t1.b, 1)))
  â””â”€TableFullScan	129.00	cop[tikv]	table:t1	keep order:false
explain format = 'brief' select * from t1 where a=1 or b=1 or 1=1;
id	estRows	task	access object	operator info
TableReader	129.00	root		data:Selection
â””â”€Selection	129.00	cop[tikv]		or(eq(planner__core__integration.t1.a, 1), or(eq(planner__core__integration.t1.b, 1), 1))
  â””â”€TableFullScan	129.00	cop[tikv]	table:t1	keep order:false
drop table if exists t1;
create database natural_join_update;
use natural_join_update;
create table t1(a int, b int);
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 b SET a.a = 2, b.b = 3;
select * from t1;
a	b
2	3
2	3
drop table t1;
create table t1 (a int primary key, b int);
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 b SET a.a = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'b'.
drop table t1;
create table t1 (a int, b int) partition by hash (a) partitions 3;
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 b SET a.a = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'b'.
drop table t1;
create table t1 (A int, b int) partition by hash (b) partitions 3;
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 B SET a.A = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'B'.
update t1 as a natural join t1 B SET a.A = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'B'.
drop table t1;
create table t1 (A int, b int) partition by RANGE COLUMNS (b) (partition `pNeg` values less than (0),partition `pPos` values less than MAXVALUE);
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 B SET a.A = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'B'.
drop table t1;
drop database natural_join_update;
use planner__core__integration;
drop table if exists t1, t2;
create table t1(id int primary key, col1 int);
create table t2(id int primary key, col1 int);
explain format='brief' SELECT /*+ merge_join(t1, t2)*/ * FROM (t1 LEFT JOIN t2 ON t1.col1=t2.id) order by t2.id;
id	estRows	task	access object	operator info
Sort	12500.00	root		planner__core__integration.t2.id
â””â”€MergeJoin	12500.00	root		left outer join, left key:planner__core__integration.t1.col1, right key:planner__core__integration.t2.id
  â”œâ”€TableReader(Build)	10000.00	root		data:TableFullScan
  â”‚ â””â”€TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
  â””â”€Sort(Probe)	10000.00	root		planner__core__integration.t1.col1
    â””â”€TableReader	10000.00	root		data:TableFullScan
      â””â”€TableFullScan	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
drop table if exists t1;
drop table if exists t2;
create table t1 (a int, b int);
create table t2 (c int, d int);
insert into t1 values(1, 1), (1,2),(2,1),(2,2);
insert into t2 values(1, 3), (1,4),(2,5),(2,6);
explain select one.a from t1 one order by (select two.d from t2 two where two.c = one.b);
id	estRows	task	access object	operator info
Projection_16	10000.00	root		planner__core__integration.t1.a
â””â”€Sort_17	10000.00	root		planner__core__integration.t2.d
  â””â”€Apply_20	10000.00	root		CARTESIAN left outer join
    â”œâ”€TableReader_22(Build)	10000.00	root		data:TableFullScan_21
    â”‚ â””â”€TableFullScan_21	10000.00	cop[tikv]	table:one	keep order:false, stats:pseudo
    â””â”€MaxOneRow_23(Probe)	10000.00	root		
      â””â”€TableReader_26	20000.00	root		data:Selection_25
        â””â”€Selection_25	20000.00	cop[tikv]		eq(planner__core__integration.t2.c, planner__core__integration.t1.b)
          â””â”€TableFullScan_24	20000000.00	cop[tikv]	table:two	keep order:false, stats:pseudo
explain select rank() over (partition by table_name) from information_schema.tables;
id	estRows	task	access object	operator info
Projection_7	10000.00	root		Column#27->Column#28
â””â”€Shuffle_11	10000.00	root		execution info: concurrency:5, data sources:[MemTableScan_9]
  â””â”€Window_8	10000.00	root		rank()->Column#27 over(partition by Column#3)
    â””â”€Sort_10	10000.00	root		Column#3
      â””â”€ShuffleReceiver_12	10000.00	root		
        â””â”€MemTableScan_9	10000.00	root	table:TABLES	
drop table if exists t;
create table deci (a decimal(65,30),b decimal(65,0));
insert into deci values (1234567890.123456789012345678901234567890,987654321098765432109876543210987654321098765432109876543210);
select a from deci union ALL select b from deci;
a
1234567890.123456789012345678901234567890
99999999999999999999999999999999999.999999999999999999999999999999
drop table if exists t;
create table t(a json);
insert into t values('{"id": "ish"}');
select t2.a from t t1 left join t t2 on t1.a=t2.a where t2.a->'$.id'='ish';
a
{"id": "ish"}
explain format = 'brief' select * from t t1 left join t t2 on t1.a=t2.a where t2.a->'$.id'='ish';
id	estRows	task	access object	operator info
Selection	8000.00	root		eq(json_extract(planner__core__integration.t.a, "$.id"), cast("ish", json BINARY))
â””â”€HashJoin	10000.00	root		left outer join, equal:[eq(planner__core__integration.t.a, planner__core__integration.t.a)]
  â”œâ”€TableReader(Build)	8000.00	root		data:Selection
  â”‚ â””â”€Selection	8000.00	cop[tikv]		not(isnull(cast(planner__core__integration.t.a, var_string(4294967295))))
  â”‚   â””â”€TableFullScan	10000.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
  â””â”€TableReader(Probe)	10000.00	root		data:TableFullScan
    â””â”€TableFullScan	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
drop table if exists t, t2;
set @@tidb_partition_prune_mode='static';
CREATE TABLE t (a int) PARTITION BY RANGE (a) (PARTITION p0 VALUES LESS THAN (6),PARTITION p1 VALUES LESS THAN (11));
insert into t values (1),(2),(3),(4),(7),(8),(9),(10);
analyze table t;
explain format='brief' select * from t;
id	estRows	task	access object	operator info
PartitionUnion	8.00	root		
â”œâ”€TableReader	4.00	root		data:TableFullScan
â”‚ â””â”€TableFullScan	4.00	cop[tikv]	table:t, partition:p0	keep order:false
â””â”€TableReader	4.00	root		data:TableFullScan
  â””â”€TableFullScan	4.00	cop[tikv]	table:t, partition:p1	keep order:false
CREATE TABLE t2 (a int) PARTITION BY RANGE (a) (PARTITION p0 VALUES LESS THAN (6),PARTITION p1 VALUES LESS THAN (11));
insert into t2 values (1),(2),(3),(4),(7),(8),(9),(10);
analyze table t2;
set @@tidb_partition_prune_mode='dynamic';
explain format='brief' select * from t;
id	estRows	task	access object	operator info
TableReader	10000.00	root	partition:all	data:TableFullScan
â””â”€TableFullScan	10000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
analyze table t;
explain format='brief' select * from t;
id	estRows	task	access object	operator info
TableReader	8.00	root	partition:all	data:TableFullScan
â””â”€TableFullScan	8.00	cop[tikv]	table:t	keep order:false
explain format='brief' select  * from t union all select * from t2;
id	estRows	task	access object	operator info
Union	10008.00	root		
â”œâ”€TableReader	8.00	root	partition:all	data:TableFullScan
â”‚ â””â”€TableFullScan	8.00	cop[tikv]	table:t	keep order:false
â””â”€TableReader	10000.00	root	partition:all	data:TableFullScan
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
set @@tidb_partition_prune_mode=DEFAULT;
drop table if exists t1, t2;
create table t1 (a int primary key, b int);
create table t2 (c int);
explain format='brief' select * from t1 where a in (10, 20, 30, 40, 50) and b > 1;
id	estRows	task	access object	operator info
Selection	1.67	root		gt(planner__core__integration.t1.b, 1)
â””â”€Batch_Point_Get	5.00	root	table:t1	handle:[10 20 30 40 50], keep order:false, desc:false
explain format='brief' select * from t1 join t2 on t1.b = t2.c where t1.a in (10, 20, 30, 40, 50);
id	estRows	task	access object	operator info
HashJoin	6.24	root		inner join, equal:[eq(planner__core__integration.t1.b, planner__core__integration.t2.c)]
â”œâ”€Selection(Build)	5.00	root		not(isnull(planner__core__integration.t1.b))
â”‚ â””â”€Batch_Point_Get	5.00	root	table:t1	handle:[10 20 30 40 50], keep order:false, desc:false
â””â”€TableReader(Probe)	9990.00	root		data:Selection
  â””â”€Selection	9990.00	cop[tikv]		not(isnull(planner__core__integration.t2.c))
    â””â”€TableFullScan	10000.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
set @@tidb_opt_range_max_size=10;
explain format='brief' select * from t1 where a in (10, 20, 30, 40, 50) and b > 1;
id	estRows	task	access object	operator info
TableReader	8000.00	root		data:Selection
â””â”€Selection	8000.00	cop[tikv]		gt(planner__core__integration.t1.b, 1), in(planner__core__integration.t1.a, 10, 20, 30, 40, 50)
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
Level	Code	Message
Warning	1105	Memory capacity of 10 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
explain format='brief' select * from t1 join t2 on t1.b = t2.c where t1.a in (10, 20, 30, 40, 50);
id	estRows	task	access object	operator info
HashJoin	10000.00	root		inner join, equal:[eq(planner__core__integration.t1.b, planner__core__integration.t2.c)]
â”œâ”€TableReader(Build)	8000.00	root		data:Selection
â”‚ â””â”€Selection	8000.00	cop[tikv]		not(isnull(planner__core__integration.t2.c))
â”‚   â””â”€TableFullScan	10000.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
â””â”€TableReader(Probe)	8000.00	root		data:Selection
  â””â”€Selection	8000.00	cop[tikv]		in(planner__core__integration.t1.a, 10, 20, 30, 40, 50), not(isnull(planner__core__integration.t1.b))
    â””â”€TableFullScan	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
Level	Code	Message
Warning	1105	Memory capacity of 10 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
drop table if exists t1, t2, t3, t4;
create table t1 (a varchar(10), b varchar(10), c varchar(10), index idx_a_b(a(2), b(2)));
create table t2 (d varchar(10));
create table t3 (pk int primary key, a int, key(a));
create table t4 (a int, b int, c int, index idx_a_b(a, b));
set @@tidb_opt_range_max_size=0;
explain format='brief' select * from t1 where a in ('aaa', 'bbb', 'ccc') and b in ('ddd', 'eee', 'fff');
id	estRows	task	access object	operator info
IndexLookUp	0.90	root		
â”œâ”€IndexRangeScan(Build)	0.90	cop[tikv]	table:t1, index:idx_a_b(a, b)	range:["aa" "dd","aa" "dd"], ["aa" "ee","aa" "ee"], ["aa" "ff","aa" "ff"], ["bb" "dd","bb" "dd"], ["bb" "ee","bb" "ee"], ["bb" "ff","bb" "ff"], ["cc" "dd","cc" "dd"], ["cc" "ee","cc" "ee"], ["cc" "ff","cc" "ff"], keep order:false, stats:pseudo
â””â”€Selection(Probe)	0.90	cop[tikv]		in(planner__core__integration.t1.a, "aaa", "bbb", "ccc"), in(planner__core__integration.t1.b, "ddd", "eee", "fff")
  â””â”€TableRowIDScan	0.90	cop[tikv]	table:t1	keep order:false, stats:pseudo
set @@tidb_opt_range_max_size=1000;
explain format='brief' select * from t1 where a in ('aaa', 'bbb', 'ccc') and b in ('ddd', 'eee', 'fff');
id	estRows	task	access object	operator info
IndexLookUp	0.09	root		
â”œâ”€IndexRangeScan(Build)	30.00	cop[tikv]	table:t1, index:idx_a_b(a, b)	range:["aa","aa"], ["bb","bb"], ["cc","cc"], keep order:false, stats:pseudo
â””â”€Selection(Probe)	0.09	cop[tikv]		in(planner__core__integration.t1.a, "aaa", "bbb", "ccc"), in(planner__core__integration.t1.b, "ddd", "eee", "fff")
  â””â”€TableRowIDScan	30.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
Level	Code	Message
Warning	1105	Memory capacity of 1000 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
set @@tidb_opt_range_max_size=0;
explain format='brief' select * from t1 join t2 on t1.c = t2.d where a in ('aaa', 'bbb', 'ccc') and b in ('ddd', 'eee', 'fff');
id	estRows	task	access object	operator info
HashJoin	1.12	root		inner join, equal:[eq(planner__core__integration.t1.c, planner__core__integration.t2.d)]
â”œâ”€IndexLookUp(Build)	0.90	root		
â”‚ â”œâ”€IndexRangeScan(Build)	0.90	cop[tikv]	table:t1, index:idx_a_b(a, b)	range:["aa" "dd","aa" "dd"], ["aa" "ee","aa" "ee"], ["aa" "ff","aa" "ff"], ["bb" "dd","bb" "dd"], ["bb" "ee","bb" "ee"], ["bb" "ff","bb" "ff"], ["cc" "dd","cc" "dd"], ["cc" "ee","cc" "ee"], ["cc" "ff","cc" "ff"], keep order:false, stats:pseudo
â”‚ â””â”€Selection(Probe)	0.90	cop[tikv]		in(planner__core__integration.t1.a, "aaa", "bbb", "ccc"), in(planner__core__integration.t1.b, "ddd", "eee", "fff"), not(isnull(planner__core__integration.t1.c))
â”‚   â””â”€TableRowIDScan	0.90	cop[tikv]	table:t1	keep order:false, stats:pseudo
â””â”€TableReader(Probe)	9990.00	root		data:Selection
  â””â”€Selection	9990.00	cop[tikv]		not(isnull(planner__core__integration.t2.d))
    â””â”€TableFullScan	10000.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
set @@tidb_opt_range_max_size=1000;
explain format='brief' select * from t1 join t2 on t1.c = t2.d where a in ('aaa', 'bbb', 'ccc') and b in ('ddd', 'eee', 'fff');
id	estRows	task	access object	operator info
HashJoin	0.11	root		inner join, equal:[eq(planner__core__integration.t1.c, planner__core__integration.t2.d)]
â”œâ”€IndexLookUp(Build)	0.09	root		
â”‚ â”œâ”€IndexRangeScan(Build)	30.00	cop[tikv]	table:t1, index:idx_a_b(a, b)	range:["aa","aa"], ["bb","bb"], ["cc","cc"], keep order:false, stats:pseudo
â”‚ â””â”€Selection(Probe)	0.09	cop[tikv]		in(planner__core__integration.t1.a, "aaa", "bbb", "ccc"), in(planner__core__integration.t1.b, "ddd", "eee", "fff"), not(isnull(planner__core__integration.t1.c))
â”‚   â””â”€TableRowIDScan	30.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
â””â”€TableReader(Probe)	9990.00	root		data:Selection
  â””â”€Selection	9990.00	cop[tikv]		not(isnull(planner__core__integration.t2.d))
    â””â”€TableFullScan	10000.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
Level	Code	Message
Warning	1105	Memory capacity of 1000 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
set @@tidb_opt_range_max_size=0;
explain format='brief' select /*+ use_index(t3, a) */ * from t3 where a in (1, 3, 5) and pk in (2, 4, 6);
id	estRows	task	access object	operator info
IndexReader	0.90	root		index:IndexRangeScan
â””â”€IndexRangeScan	0.90	cop[tikv]	table:t3, index:a(a)	range:[1 2,1 2], [1 4,1 4], [1 6,1 6], [3 2,3 2], [3 4,3 4], [3 6,3 6], [5 2,5 2], [5 4,5 4], [5 6,5 6], keep order:false, stats:pseudo
set @@tidb_opt_range_max_size=1000;
explain format='brief' select /*+ use_index(t3, a) */ * from t3 where a in (1, 3, 5) and pk in (2, 4, 6);
id	estRows	task	access object	operator info
IndexReader	0.01	root		index:Selection
â””â”€Selection	0.01	cop[tikv]		in(planner__core__integration.t3.pk, 2, 4, 6)
  â””â”€IndexRangeScan	30.00	cop[tikv]	table:t3, index:a(a)	range:[1,1], [3,3], [5,5], keep order:false, stats:pseudo
Level	Code	Message
Warning	1105	Memory capacity of 1000 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
set @@tidb_opt_range_max_size=0;
explain format='brief' select /*+ use_index(t4, idx_a_b) */ * from t4 where a in (1, 3, 5) and b = 2;
id	estRows	task	access object	operator info
IndexLookUp	0.30	root		
â”œâ”€IndexRangeScan(Build)	0.30	cop[tikv]	table:t4, index:idx_a_b(a, b)	range:[1 2,1 2], [3 2,3 2], [5 2,5 2], keep order:false, stats:pseudo
â””â”€TableRowIDScan(Probe)	0.30	cop[tikv]	table:t4	keep order:false, stats:pseudo
set @@tidb_opt_range_max_size=1000;
explain format='brief' select /*+ use_index(t4, idx_a_b) */ * from t4 where a in (1, 3, 5) and b = 2;
id	estRows	task	access object	operator info
IndexLookUp	0.03	root		
â”œâ”€Selection(Build)	0.03	cop[tikv]		eq(planner__core__integration.t4.b, 2)
â”‚ â””â”€IndexRangeScan	30.00	cop[tikv]	table:t4, index:idx_a_b(a, b)	range:[1,1], [3,3], [5,5], keep order:false, stats:pseudo
â””â”€TableRowIDScan(Probe)	0.03	cop[tikv]	table:t4	keep order:false, stats:pseudo
Level	Code	Message
Warning	1105	Memory capacity of 1000 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
set @@tidb_opt_range_max_size=DEFAULT;
set @@tidb_enable_prepared_plan_cache=1;
drop table if exists t;
create table t (a int primary key, b int);
set @@tidb_opt_range_max_size=10;
prepare stmt from 'select * from t where a in (?, ?, ?, ?, ?) and b > 1';
set @a=10, @b=20, @c=30, @d=40, @e=50;
execute stmt using @a, @b, @c, @d, @e;
a	b
execute stmt using @a, @b, @c, @d, @e;
a	b
Level	Code	Message
Warning	1105	Memory capacity of 10 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
Warning	1105	skip prepared plan-cache: in-list is too long
select @@last_plan_from_cache;
@@last_plan_from_cache
0
drop table if exists t;
create table t(a int primary key);
insert into t values (2), (4), (6);
set @@tidb_opt_range_max_size=1;
select * from t where a;
a
2
4
6
Level	Code	Message
Warning	1105	Memory capacity of 1 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
set @@tidb_opt_range_max_size=DEFAULT;
drop table if exists t1, t2;
create table t1 (a int, c int);
insert into t1 values (1, 1), (1, 2), (2, 3), (2, 4);
create table t2 (a int, c int);
insert into t2 values (1, 1), (1, 2), (2, 3), (2, 4);
select group_concat(c order by (select group_concat(c order by a) from t2 where a=t1.a)) from t1;
group_concat(c order by (select group_concat(c order by a) from t2 where a=t1.a))
2,1,4,3
select group_concat(c order by (select group_concat(c order by c) from t2 where a=t1.a), c desc) from t1;
group_concat(c order by (select group_concat(c order by c) from t2 where a=t1.a), c desc)
2,1,4,3
drop table if exists t0, t1;
CREATE TABLE t0(c0 INT);
CREATE TABLE t1(c0 INT);
INSERT INTO t0 VALUES (NULL);
SELECT t0.c0 FROM t0 LEFT JOIN t1 ON t0.c0>=t1.c0 WHERE (CONCAT_WS(t0.c0, t1.c0) IS NULL);
c0
NULL
drop table if exists t;
CREATE TABLE t(col1 enum('p5', '9a33x') NOT NULL DEFAULT 'p5',col2 tinyblob DEFAULT NULL) ENGINE = InnoDB DEFAULT CHARSET = latin1 COLLATE = latin1_bin;
(select last_value(col1) over () as r0 from t) union all (select col2 as r0 from t);
r0
CREATE TABLE `sbtest1` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `k` int(11) NOT NULL DEFAULT '0', `c` char(120) NOT NULL DEFAULT '', `pad` char(60) NOT NULL DEFAULT '', PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */ , KEY `k_1` (`k`) );
set @@tidb_opt_range_max_size = 111;
explain format='brief' select * from planner__core__integration.sbtest1 a where pad in ('1','1','1','1','1') and id in (1,1,1,1,1);
id	estRows	task	access object	operator info
TableReader	8000.00	root		data:Selection
â””â”€Selection	8000.00	cop[tikv]		in(planner__core__integration.sbtest1.id, 1, 1, 1, 1, 1), in(planner__core__integration.sbtest1.pad, "1", "1", "1", "1", "1")
  â””â”€TableFullScan	10000.00	cop[tikv]	table:a	keep order:false, stats:pseudo
Level	Code	Message
Warning	1105	Memory capacity of 111 bytes for 'tidb_opt_range_max_size' exceeded when building ranges. Less accurate ranges such as full range are chosen
set @@tidb_opt_range_max_size = DEFAULT;
drop table if exists t1, t2, t3, t4;
create table t1 (c1 int, c2 int, c3 int, primary key(c1, c2));
create table t2 (c2 int, c1 int, primary key(c2, c1));
create table t3 (c4 int, key(c4));
create table t4 (c2 varchar(20) , test_col varchar(50), gen_col varchar(50) generated always as(concat(test_col,'')) virtual not null, unique key(gen_col));
select count(1)
from   (select ( case
when count(1)
over(
partition by a.c2) >= 50 then 1
else 0
end ) alias1,
b.c2    as alias_col1
from   t1 a
left join (select c2
from   t4 f) k
on k.c2 = a.c2
inner join t2 b
on b.c1 = a.c3) alias2
where  exists (select 1
from   (select distinct alias3.c4 as c2
from   t3 alias3) alias4
where  alias4.c2 = alias2.alias_col1);
count(1)
0
drop table if exists planner__core__integration.first_range;
create table planner__core__integration.first_range(p int not null, o tinyint not null, v int not null);
insert into planner__core__integration.first_range (p, o, v) values (0, 0, 0), (1, 1, 1), (1, 2, 2), (1, 4, 4), (1, 8, 8), (2, 0, 0), (2, 3, 3), (2, 10, 10), (2, 13, 13), (2, 15, 15), (3, 1, 1), (3, 3, 3), (3, 5, 5), (3, 9, 9), (3, 15, 15), (3, 20, 20), (3, 31, 31);
select *, first_value(v) over (partition by p order by o range between 3.1 preceding and 2.9 following) as a from planner__core__integration.first_range;
p	o	v	a
0	0	0	0
1	1	1	1
1	2	2	1
1	4	4	1
1	8	8	8
2	0	0	0
2	10	10	10
2	13	13	10
2	15	15	13
2	3	3	0
3	1	1	1
3	15	15	15
3	20	20	20
3	3	3	1
3	31	31	31
3	5	5	3
3	9	9	9
set @@tidb_enable_pipelined_window_function=0;
select *, first_value(v) over (partition by p order by o range between 3.1 preceding and 2.9 following) as a from planner__core__integration.first_range;
p	o	v	a
0	0	0	0
1	1	1	1
1	2	2	1
1	4	4	1
1	8	8	8
2	0	0	0
2	10	10	10
2	13	13	10
2	15	15	13
2	3	3	0
3	1	1	1
3	15	15	15
3	20	20	20
3	3	3	1
3	31	31	31
3	5	5	3
3	9	9	9
set @@tidb_enable_pipelined_window_function=DEFAULT;
drop table if exists t;
create table t(a datetime) partition by range columns (a) (partition p1 values less than ('20000101'), partition p2 values less than ('2000-10-01'));
insert into t values ('20000201'), ('19000101');
analyze table t;
desc format='brief' select * from t where a < '2000-01-01';
id	estRows	task	access object	operator info
TableReader	1.00	root	partition:p1	data:Selection
â””â”€Selection	1.00	cop[tikv]		lt(planner__core__integration.t.a, 2000-01-01 00:00:00.000000)
  â””â”€TableFullScan	2.00	cop[tikv]	table:t	keep order:false
drop user if exists test;
create user test;
grant select on test1111 to test@'%';
Error 1046 (3D000): No database selected
grant select on * to test@'%';
Error 1046 (3D000): No database selected
revoke select on * from test@'%';
Error 1046 (3D000): No database selected
use planner__core__integration;
create table test1111 (id int);
grant select on test1111 to test@'%';
drop table if exists t;
create table t(a int primary key, b varchar(20));
insert into t values (1,1);
explain analyze select * from t where a=1;
id	estRows	actRows	task	access object	execution info	operator info	memory	disk
Point_Get_1	1.00	1	root	table:t	time:<num>, loops:<num>, RU:<num>, Get:{num_rpc:<num>, total_time:<num>}	handle:<num>	N/A	N/A
explain analyze select * from t where a in (1,2,3);
id	estRows	actRows	task	access object	execution info	operator info	memory	disk
Batch_Point_Get_1	3.00	1	root	table:t	time:<num>, loops:<num>, RU:<num>, BatchGet:{num_rpc:<num>, total_time:<num>}	handle:[1 2 3], keep order:false, desc:false	N/A	N/A
drop table if exists t;
create table t (a int, b int, unique index (a));
insert into t values (1,1);
explain analyze select * from t where a=1;
id	estRows	actRows	task	access object	execution info	operator info	memory	disk
Point_Get_1	1.00	1	root	table:t, index:a(a)	time:<num>, loops:<num>, RU:<num>, Get:{num_rpc:<num>, total_time:<num>}	NULL	N/A	N/A
explain analyze insert ignore into t values (1,1),(2,2),(3,3),(4,4);
id	estRows	actRows	task	access object	execution info	operator info	memory	disk
Insert_1	N/A	0	root	NULL	time:<num>, loops:<num>, prepare:<num>, check_insert: {total_time:<num>, mem_insert_time:<num>, prefetch:<num>, fk_check:<num>, rpc:{BatchGet:{num_rpc:<num>, total_time:<num>}}}, RU:<num>	N/A	<num> Bytes	N/A
drop table if exists t;
create table t (a int, b int);
insert into t values (1, 2);
select count(*) from t where b = 1 and b in (3);
count(*)
0
drop table t;
create table t (a int, b int as (a + 1), c int as (b + 1));
begin;
insert into t (a) values (1);
select count(*) from t where b = 1 and b in (3);
count(*)
0
select count(*) from t where c = 1 and c in (3);
count(*)
0
drop table if exists t;
drop view if exists v0;
create table t(a int, b int);
set session tidb_isolation_read_engines='tiflash,tidb';
create view v0 (a, avg_b) as select a, avg(b) from t group by a;
select * from v0;
Error 1815 (HY000): Internal : No access path for table 't' is found with 'tidb_isolation_read_engines' = 'tiflash,tidb', valid values can be 'tikv'.
set session tidb_isolation_read_engines='tikv,tiflash,tidb';
select * from v0;
a	avg_b
set session tidb_isolation_read_engines=default;
drop table if exists t1, t2;
drop view if exists v1, v2, v3, v4, v5;
create table t1 (a int, b int);
create table t2 (c int, d int);
create view v1 as select * from t1 order by a limit 5;
create view v2 as select * from ((select * from t1) union (select * from t2)) as tt order by a, b limit 5;
create view v3 as select * from v1 order by a limit 5;
create view v4 as select * from t1, t2 where t1.a = t2.c order by a, b limit 5;
create view v5 as select * from (select * from t1) as t1 order by a limit 5;
insert into t1 values (1, 2), (3, 4);
insert into t2 values (3, 5), (6, 7);
create temporary table t1 (a int, b int);
create temporary table t2 (c int, d int);
select * from t1;
a	b
select * from t2;
c	d
select * from v1;
a	b
1	2
3	4
select * from v2;
a	b
1	2
3	4
3	5
6	7
select * from v3;
a	b
1	2
3	4
select * from v4;
a	b	c	d
3	4	3	5
select * from v5;
a	b
1	2
3	4
drop table t1, t2;
drop table if exists t27949;
create table t27949 (a int, b int, key(b));
explain format = 'brief' select * from t27949 where b=1;
id	estRows	task	access object	operator info
IndexLookUp	10.00	root		
â”œâ”€IndexRangeScan(Build)	10.00	cop[tikv]	table:t27949, index:b(b)	range:[1,1], keep order:false, stats:pseudo
â””â”€TableRowIDScan(Probe)	10.00	cop[tikv]	table:t27949	keep order:false, stats:pseudo
create global binding for select * from t27949 where b=1 using select * from t27949 ignore index(b) where b=1;
explain format = 'brief' select * from t27949 where b=1;
id	estRows	task	access object	operator info
TableReader	10.00	root		data:Selection
â””â”€Selection	10.00	cop[tikv]		eq(planner__core__integration.t27949.b, 1)
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t27949	keep order:false, stats:pseudo
set @@sql_select_limit=100;
explain format = 'brief' select * from t27949 where b=1;
id	estRows	task	access object	operator info
Limit	10.00	root		offset:0, count:100
â””â”€TableReader	10.00	root		data:Limit
  â””â”€Limit	10.00	cop[tikv]		offset:0, count:100
    â””â”€Selection	10.00	cop[tikv]		eq(planner__core__integration.t27949.b, 1)
      â””â”€TableFullScan	10000.00	cop[tikv]	table:t27949	keep order:false, stats:pseudo
drop table if exists t;
create table t(a int, index idx_a(a));
create binding for select * from t  using select * from t use index(idx_a);
select * from t;
a
select @@last_plan_from_binding;
@@last_plan_from_binding
1
prepare stmt from 'select * from t';
execute stmt;
a
select @@last_plan_from_binding;
@@last_plan_from_binding
1
drop global binding for select * from t27949 where b=1;
set @@sql_select_limit=default;
drop table if exists t1, t2;
create table t1(a int, b int);
create table t2(a int, b int);
select avg(0) over w from t1 window w as (order by (select 1));
avg(0) over w
select avg(0) over w from t1 where b > (select sum(t2.a) over w from t2) window w as (partition by t1.b);
Error 3579 (HY000): Window name 'w' is not defined.
select avg(0) over w1 from t1 where b > (select sum(t2.a) over w2 from t2 window w2 as (partition by t2.b)) window w1 as (partition by t1.b);
avg(0) over w1
drop table if exists t1;
create table t1(a int, b int);
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 b SET a.a = 2, b.b = 3;
select * from t1;
a	b
2	3
2	3
drop table t1;
create table t1 (a int primary key, b int);
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 b SET a.a = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'b'.
drop table t1;
create table t1 (a int, b int) partition by hash (a) partitions 3;
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 b SET a.a = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'b'.
drop table t1;
create table t1 (A int, b int) partition by hash (b) partitions 3;
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 B SET a.A = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'B'.
update t1 as a natural join t1 B SET a.A = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'B'.
drop table t1;
create table t1 (A int, b int) partition by RANGE COLUMNS (b) (partition `pNeg` values less than (0),partition `pPos` values less than MAXVALUE);
insert into t1 values (1,1),(2,2);
update t1 as a natural join t1 B SET a.A = 2, b.b = 3;
Error 1706 (HY000): Primary key/partition key update is not allowed since the table is updated both as 'a' and 'B'.
drop table t1;
drop table if exists t1, t2, t3, t4, t5;
create table t1(a int, b int, c int, d int, index ia(a), index ib(b), index ic(c), index id(d));
create table t2(a int, b int, c int, d int, index ia(a), index ib(b), index ic(c), index id(d));
create table t3(a int, b int, c int, d int, index ia(a), index ib(b), index ic(c), index id(d));
create table t4(a int, b int, c int, d int, index ia(a), index ib(b), index ic(c), index id(d));
create table t5(a int, b int, c int, d int, index ia(a), index ib(b), index ic(c), index id(d));
select * from t3 straight_join t4 on t3.a = t4.b straight_join t2 on t3.d = t2.c straight_join t1 on t1.a = t2.b straight_join t5 on t4.c = t5.d where t2.b < 100 and t4.a = 10;
a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d	a	b	c	d
select * from information_schema.statements_summary;
drop table if exists t0;
drop view if exists v0;
CREATE TABLE t0(c0 BLOB(298) , c1 BLOB(182) , c2 NUMERIC);
CREATE VIEW v0(c0) AS SELECT t0.c1 FROM t0;
INSERT INTO t0 VALUES (-1, 'a', '2046549365');
CREATE INDEX i0 ON t0(c2);
SELECT t0.c1, t0.c2 FROM t0 GROUP BY MOD(t0.c0, DEFAULT(t0.c2));
Error 1055 (42000): Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'planner__core__integration.t0.c1' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
UPDATE t0 SET c2=1413;
drop table if exists t;
CREATE TABLE t (
a set('nwbk','r5','1ad3u','van','ir1z','y','9m','f1','z','e6yd','wfev') NOT NULL DEFAULT 'ir1z,f1,e6yd',
b enum('soo2','4s4j','qi9om','8ue','i71o','qon','3','3feh','6o1i','5yebx','d') NOT NULL DEFAULT '8ue',
c varchar(66) DEFAULT '13mdezixgcn',
PRIMARY KEY (a,b) /*T![clustered_index] CLUSTERED */,
UNIQUE KEY ib(b),
KEY ia(a)
)ENGINE=InnoDB DEFAULT CHARSET=ascii COLLATE=ascii_bin;
INSERT INTO t VALUES('ir1z,f1,e6yd','i71o','13mdezixgcn'),('ir1z,f1,e6yd','d','13mdezixgcn'),('nwbk','8ue','13mdezixgcn');
select * from t where a between 'e6yd' and 'z' or b <> '8ue';
a	b	c
ir1z,f1,e6yd	d	13mdezixgcn
ir1z,f1,e6yd	i71o	13mdezixgcn
nwbk	8ue	13mdezixgcn
select /*+ use_index_merge(t) */ * from t where a between 'e6yd' and 'z' or b <> '8ue';
a	b	c
ir1z,f1,e6yd	d	13mdezixgcn
ir1z,f1,e6yd	i71o	13mdezixgcn
nwbk	8ue	13mdezixgcn
## For now tidb doesn't support push set type to TiKV, and column a is a set type, so we shouldn't generate a IndexMerge path.
explain format='brief' select /*+ use_index_merge(t) */ * from t where a between 'e6yd' and 'z' or b <> '8ue';
id	estRows	task	access object	operator info
Selection	8000.00	root		or(and(ge(planner__core__integration.t.a, "e6yd"), le(planner__core__integration.t.a, "z")), ne(planner__core__integration.t.b, "8ue"))
â””â”€TableReader	10000.00	root		data:TableFullScan
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
drop table if exists planner__core__integration.first_range;
create table planner__core__integration.first_range(p int not null, o tinyint not null, v int not null);
insert into planner__core__integration.first_range (p, o, v) values (0, 0, 0), (1, 1, 1), (1, 2, 2), (1, 4, 4), (1, 8, 8), (2, 0, 0), (2, 3, 3), (2, 10, 10), (2, 13, 13), (2, 15, 15), (3, 1, 1), (3, 3, 3), (3, 5, 5), (3, 9, 9), (3, 15, 15), (3, 20, 20), (3, 31, 31);
select *, first_value(v) over (partition by p order by o range between 3.1 preceding and 2.9 following) as a from planner__core__integration.first_range;
p	o	v	a
0	0	0	0
1	1	1	1
1	2	2	1
1	4	4	1
1	8	8	8
2	0	0	0
2	10	10	10
2	13	13	10
2	15	15	13
2	3	3	0
3	1	1	1
3	15	15	15
3	20	20	20
3	3	3	1
3	31	31	31
3	5	5	3
3	9	9	9
set @@tidb_enable_pipelined_window_function=0;
select *, first_value(v) over (partition by p order by o range between 3.1 preceding and 2.9 following) as a from planner__core__integration.first_range;
p	o	v	a
0	0	0	0
1	1	1	1
1	2	2	1
1	4	4	1
1	8	8	8
2	0	0	0
2	10	10	10
2	13	13	10
2	15	15	13
2	3	3	0
3	1	1	1
3	15	15	15
3	20	20	20
3	3	3	1
3	31	31	31
3	5	5	3
3	9	9	9
set @@tidb_enable_pipelined_window_function=DEFAULT;
drop table if exists t1;
set tidb_enable_ordered_result_mode = on;
create table t1(c1 int);
select * from t1 group by t1.c1 having count(1) > 1 order by count(1) limit 10;
c1
set tidb_enable_ordered_result_mode = DEFAULT;
set tidb_cost_model_version=2;
drop view if exists v, v1, v2;
drop table if exists t, t1, t2, t3;
create table t(a int, b int);
create table t1(a int, b int);
create table t2(a int, b int);
create table t3(a int, b int);
create definer='root'@'localhost' view v as select t.a, t.b from t join (select count(*) as a from t1 join t2 join t3 where t1.b=t2.b and t2.a = t3.a group by t2.a) tt on t.a = tt.a;
create definer='root'@'localhost' view v1 as select t.a, t.b from t join (select count(*) as a from t1 join v on t1.b=v.b group by v.a) tt on t.a = tt.a;
create definer='root'@'localhost' view v2 as select t.a, t.b from t join (select count(*) as a from t1 join v1 on t1.b=v1.b group by v1.a) tt on t.a = tt.a;
select * from v2;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
0
create global binding for select * from v2 using select /*+ qb_name(qb_v_2, v2.v1@sel_2 .v@sel_2 .@sel_2), merge_join(t1@qb_v_2), stream_agg(@qb_v_2), qb_name(qb_v_1, v2. v1@sel_2 .v@sel_2 .@sel_1), merge_join(t@qb_v_1) */ * from v2;
select * from v2;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
1
show global bindings where original_sql like '%planner__core__integration%';
Original_sql	Bind_sql	Default_db	Status	Create_time	Update_time	Charset	Collation	Source	Sql_digest	Plan_digest
select * from `planner__core__integration` . `v2`	SELECT /*+ qb_name(`qb_v_2` , `v2`. `v1`@`sel_2`. `v`@`sel_2`. ``@`sel_2`) merge_join(`t1`@`qb_v_2`) stream_agg(@`qb_v_2`) qb_name(`qb_v_1` , `v2`. `v1`@`sel_2`. `v`@`sel_2`. ``@`sel_1`) merge_join(`t`@`qb_v_1`)*/ * FROM `planner__core__integration`.`v2`	planner__core__integration	enabled	<create_time>	<update_time>	utf8mb4	utf8mb4_general_ci	manual	d1c36cc45519f8c3ec7ffd42ebcc49b1fe160d7a93e23d1568843517ac4009e6	
drop global binding for select * from v2;
select * from v2;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
0
show global bindings where original_sql like '%planner__core__integration%';
Original_sql	Bind_sql	Default_db	Status	Create_time	Update_time	Charset	Collation	Source	Sql_digest	Plan_digest
set tidb_cost_model_version=default;
set tidb_cost_model_version=2;
drop table if exists t1;
create table t1(a int, b int, index idx_a(a));

## create binding for order_index hint
select * from t1 where a<10 order by a limit 1;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
0
create global binding for select * from t1 where a<10 order by a limit 1 using select /*+ order_index(t1, idx_a) */ * from t1 where a<10 order by a limit 1;
select * from t1 where a<10 order by a limit 1;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
1
show global bindings where original_sql like '%planner__core__integration%';
Original_sql	Bind_sql	Default_db	Status	Create_time	Update_time	Charset	Collation	Source	Sql_digest	Plan_digest
select * from `planner__core__integration` . `t1` where `a` < ? order by `a` limit ?	SELECT /*+ order_index(`t1` `idx_a`)*/ * FROM `planner__core__integration`.`t1` WHERE `a` < 10 ORDER BY `a` LIMIT 1	planner__core__integration	enabled	<create_time>	<update_time>	utf8mb4	utf8mb4_general_ci	manual	d91fc2fee71140e271779ae603bf13e793040345ad88a8e6ab1d8a5cf313e3fb	

drop global binding for select * from t1 where a<10 order by a limit 1;
select * from t1 where a<10 order by a limit 1;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
0
show global bindings where original_sql like '%planner__core__integration%';
Original_sql	Bind_sql	Default_db	Status	Create_time	Update_time	Charset	Collation	Source	Sql_digest	Plan_digest

## create binding for no_order_index hint
create global binding for select * from t1 where a<10 order by a limit 1 using select /*+ no_order_index(t1, idx_a) */ * from t1 where a<10 order by a limit 1;
select * from t1 where a<10 order by a limit 1;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
1
show global bindings where original_sql like '%planner__core__integration%';
Original_sql	Bind_sql	Default_db	Status	Create_time	Update_time	Charset	Collation	Source	Sql_digest	Plan_digest
select * from `planner__core__integration` . `t1` where `a` < ? order by `a` limit ?	SELECT /*+ no_order_index(`t1` `idx_a`)*/ * FROM `planner__core__integration`.`t1` WHERE `a` < 10 ORDER BY `a` LIMIT 1	planner__core__integration	enabled	<create_time>	<update_time>	utf8mb4	utf8mb4_general_ci	manual	d91fc2fee71140e271779ae603bf13e793040345ad88a8e6ab1d8a5cf313e3fb	

drop global binding for select * from t1 where a<10 order by a limit 1;
select * from t1 where a<10 order by a limit 1;
a	b
select @@last_plan_from_binding;
@@last_plan_from_binding
0
show global bindings where original_sql like '%planner__core__integration%';
Original_sql	Bind_sql	Default_db	Status	Create_time	Update_time	Charset	Collation	Source	Sql_digest	Plan_digest
set tidb_cost_model_version=default;
drop table if exists t;
set tidb_opt_fix_control='44262:ON';
create table t (id int, c int) partition by range (id) (partition p0 values less than (4), partition p1 values less than (7));
insert into t values(3, 3), (5, 5);
explain format = 'brief' select * from t where c = 1 and id = c;
id	estRows	task	access object	operator info
TableReader	0.01	root	partition:p0	data:Selection
â””â”€Selection	0.01	cop[tikv]		eq(planner__core__integration.t.c, 1), eq(planner__core__integration.t.id, 1)
  â””â”€TableFullScan	10000.00	cop[tikv]	table:t	keep order:false, stats:pseudo
drop table if exists sbtest;
CREATE TABLE sbtest (
id int(10) unsigned NOT NULL AUTO_INCREMENT,
k int(10) unsigned NOT NULL DEFAULT '0',
c char(120) NOT NULL DEFAULT '',
pad char(60) NOT NULL DEFAULT '',
PRIMARY KEY (id) /*T![clustered_index] CLUSTERED */,
KEY k (k)
);
set @@tidb_opt_fix_control = '46177:off';
explain format='brief'  select row_number() over(order by a.k) from (select * from sbtest where id<10) a;
id	estRows	task	access object	operator info
Projection	10.00	root		Column#6->Column#7
â””â”€Window	10.00	root		row_number()->Column#6 over(order by planner__core__integration.sbtest.k rows between current row and current row)
  â””â”€IndexReader	10.00	root		index:Selection
    â””â”€Selection	10.00	cop[tikv]		lt(planner__core__integration.sbtest.id, 10)
      â””â”€IndexFullScan	10000.00	cop[tikv]	table:sbtest, index:k(k)	keep order:true, stats:pseudo
explain format='brief' select /*+ stream_agg() */ count(1) from sbtest where id<1 group by k;
id	estRows	task	access object	operator info
StreamAgg	1.00	root		group by:planner__core__integration.sbtest.k, funcs:count(Column#6)->Column#5
â””â”€IndexReader	1.00	root		index:StreamAgg
  â””â”€StreamAgg	1.00	cop[tikv]		group by:planner__core__integration.sbtest.k, funcs:count(1)->Column#6
    â””â”€Selection	1.00	cop[tikv]		lt(planner__core__integration.sbtest.id, 1)
      â””â”€IndexFullScan	10000.00	cop[tikv]	table:sbtest, index:k(k)	keep order:true, stats:pseudo
set @@tidb_opt_fix_control = '46177:on';
explain format='brief'  select row_number() over(order by a.k) from (select * from sbtest where id<10) a;
id	estRows	task	access object	operator info
Projection	10.00	root		Column#6->Column#7
â””â”€Window	10.00	root		row_number()->Column#6 over(order by planner__core__integration.sbtest.k rows between current row and current row)
  â””â”€Sort	10.00	root		planner__core__integration.sbtest.k
    â””â”€TableReader	10.00	root		data:TableRangeScan
      â””â”€TableRangeScan	10.00	cop[tikv]	table:sbtest	range:[0,10), keep order:false, stats:pseudo
explain format='brief' select /*+ stream_agg() */ count(1) from sbtest where id<1 group by k;
id	estRows	task	access object	operator info
StreamAgg	1.00	root		group by:planner__core__integration.sbtest.k, funcs:count(1)->Column#5
â””â”€Sort	1.00	root		planner__core__integration.sbtest.k
  â””â”€TableReader	1.00	root		data:TableRangeScan
    â””â”€TableRangeScan	1.00	cop[tikv]	table:sbtest	range:[0,1), keep order:false, stats:pseudo
set @@tidb_opt_fix_control = default;
create table sys.t (id int);
insert into sys.t values (1),(2);
set tidb_isolation_read_engines='tiflash';
select * from sys.t;
id
1
2
drop table sys.t;
set tidb_isolation_read_engines=DEFAULT;
drop table if exists t;
create table t (col TEXT);
select 1 from (select t.col as c0, 46578369 as c1 from t) as t where
case when (
t.c0 in (t.c0, cast((cast(1 as unsigned) - cast(t.c1 as signed)) as char))
) then 1 else 2 end;
1
