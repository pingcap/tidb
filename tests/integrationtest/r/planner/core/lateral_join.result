drop table if exists t1, t2;
create table t1 (a int);
create table t2 (a int, b varchar(10));
insert into t1 values (1), (2), (3);
insert into t2 values (1, 'a'), (1, 'b'), (2, 'c'), (3, 'd'), (3, 'e');
select * from t1, lateral (select b from t2 where t2.a = t1.a limit 1) as lat order by t1.a;
a	b
1	a
2	c
3	d
select * from t1, lateral (select b from t2 where t2.a = t1.a order by b limit 1) as lat order by t1.a;
a	b
1	a
2	c
3	d
select * from t1, lateral (select count(*) as cnt from t2 where t2.a = t1.a) as lat order by t1.a;
a	cnt
1	2
2	1
3	2
drop table if exists t1, t2;
create table t1 (a int);
create table t2 (a int, b varchar(10));
insert into t1 values (1), (2), (3), (4);
insert into t2 values (1, 'a'), (1, 'b'), (2, 'c'), (3, 'd');
select * from t1 left join lateral (select b from t2 where t2.a = t1.a limit 1) as lat on true order by t1.a;
a	b
1	a
2	c
3	d
4	NULL
select * from t1 left join lateral (select b from t2 where t2.a = t1.a and t2.a = 99) as lat on true order by t1.a;
a	b
1	NULL
2	NULL
3	NULL
4	NULL
drop table if exists t1, t2;
create table t1 (a int);
create table t2 (a int, b varchar(10));
explain format='brief' select * from t1, lateral (select b from t2 where t2.a = t1.a) as lat;
id	estRows	task	access object	operator info
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
explain format='brief' select * from t1 left join lateral (select b from t2 where t2.a = t1.a) as lat on true;
id	estRows	task	access object	operator info
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
<id>	<estRows>	<task>	<access_object>	<operator_info>
drop table if exists t2;
create table t2 (a int, b varchar(10));
insert into t2 values (1, 'a'), (1, 'b'), (2, 'c'), (3, 'd');
with recursive tr (level, b_col) as (
select 1, ''
union all
select level + 1, lat.result_col
from tr, lateral (select b as result_col from t2 where a = level order by b limit 1) as lat
where level < 3
)
select * from tr where level > 0 order by level;
level	b_col
1	
2	
3	
with recursive tr (level, b_col) as (
select 1, cast(null as char(10))
union all
select level + 1, lat.result_col
from tr, lateral (select b as result_col from t2 where a = level order by b limit 1) as lat
where level < 3
)
select * from tr where level > 0 order by level;
level	b_col
1	NULL
2	a
3	c
drop table if exists t1, t2, t3;
create table t1 (a int);
create table t2 (a int, b int);
create table t3 (b int, c varchar(10));
insert into t1 values (1), (2);
insert into t2 values (1, 10), (1, 20), (2, 30);
insert into t3 values (10, 'x'), (20, 'y'), (30, 'z');
select * from t1, t2, lateral (select c from t3 where t3.b = t2.b limit 1) as lat
where t1.a = t2.a order by t1.a, t2.b;
a	a	b	c
1	1	10	x
1	1	20	y
2	2	30	z
drop table if exists t1, t2;
create table t1 (a int);
create table t2 (a int, b int);
insert into t1 values (1), (2);
insert into t2 values (1, 100), (1, 200), (2, 300);
select * from t1, lateral (
select sum(b) as total from t2 where t2.a = t1.a
) as lat order by t1.a;
a	total
1	300
2	300
drop table if exists t1, t2;
create table t1 (a int);
create table t2 (b int);
insert into t1 values (1), (2);
insert into t2 values (10), (20);
select * from t1, lateral (select b from t2 limit 1) as lat order by t1.a;
a	b
1	10
2	10
drop table if exists t1, t2;
create table t1 (a int);
create table t2 (a int, b int);
select * from t1 right join lateral (select b from t2 where t2.a = t1.a) as lat on true;
Error 3809 (HY000): Invalid use of LATERAL: LATERAL cannot be used with RIGHT JOIN
