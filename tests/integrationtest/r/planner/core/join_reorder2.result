drop table if exists t1, t2, t3, t4, t5;
create table t1(id int not null primary key, name varchar(100));
create table t2(id int not null primary key, name varchar(100));
create table t3(id int not null primary key, name varchar(100));
create table t4(id int not null primary key, name varchar(100));
create table t5(id int not null primary key, name varchar(100));
set @@tidb_opt_join_reorder_through_sel = 0;
explain format = 'brief' select /*+ leading(t1, t2) */ * from t1 inner join t3 on t1.id=t3.id left join t4 on t4.id=t3.id join t2 on t1.id=t2.id where t3.name like 'test3' or t4.name like 'test4';
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t3.id, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name, planner__core__join_reorder2.t2.id, planner__core__join_reorder2.t2.name
└─HashJoin	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t2.id, planner__core__join_reorder2.t1.id)]
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t3.name, "test3", 92), like(planner__core__join_reorder2.t4.name, "test4", 92))
    └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t3.id, right key:planner__core__join_reorder2.t4.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t3.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
explain format = 'brief' select /*+ leading(t3, t4, t1, t2) */ * from t1 inner join t3 on t1.id=t3.id left join t4 on t4.id=t3.id join t2 on t1.id=t2.id where t3.name like 'test3' or t4.name like 'test4';
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t3.id, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name, planner__core__join_reorder2.t2.id, planner__core__join_reorder2.t2.name
└─HashJoin	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t2.id, planner__core__join_reorder2.t1.id)]
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:false, stats:pseudo
  └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t3.name, "test3", 92), like(planner__core__join_reorder2.t4.name, "test4", 92))
    └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t3.id, right key:planner__core__join_reorder2.t4.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t3.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 1;
explain format = 'brief' select /*+ leading(t1, t2) */ * from t1 inner join t3 on t1.id=t3.id left join t4 on t4.id=t3.id join t2 on t1.id=t2.id where t3.name like 'test3' or t4.name like 'test4';
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t3.id, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name, planner__core__join_reorder2.t2.id, planner__core__join_reorder2.t2.name
└─Selection	15625.00	root		or(like(planner__core__join_reorder2.t3.name, "test3", 92), like(planner__core__join_reorder2.t4.name, "test4", 92))
  └─MergeJoin	19531.25	root		left outer join, left key:planner__core__join_reorder2.t3.id, right key:planner__core__join_reorder2.t4.id
    ├─TableReader(Build)	10000.00	root		data:TableFullScan
    │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:true, stats:pseudo
    └─MergeJoin(Probe)	15625.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t3.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
explain format = 'brief' select /*+ leading(t3, t4, t1, t2) */ * from t1 inner join t3 on t1.id=t3.id left join t4 on t4.id=t3.id join t2 on t1.id=t2.id where t3.name like 'test3' or t4.name like 'test4';
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t3.id, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name, planner__core__join_reorder2.t2.id, planner__core__join_reorder2.t2.name
└─MergeJoin	15625.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
  └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t3.id, right key:planner__core__join_reorder2.t1.id
    ├─TableReader(Build)	10000.00	root		data:TableFullScan
    │ └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
    └─Selection(Probe)	10000.00	root		or(like(planner__core__join_reorder2.t3.name, "test3", 92), like(planner__core__join_reorder2.t4.name, "test4", 92))
      └─MergeJoin	12500.00	root		left outer join, left key:planner__core__join_reorder2.t3.id, right key:planner__core__join_reorder2.t4.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 0;
explain format = 'brief' select /*+ leading(t1@sel_2, t4, t2@sel_2, t3@sel_2) */ * from
(select t1.id, t1.name as n1, t2.name as n2, t3.name as n3 from t1 inner join t2 on t1.id=t2.id left join t3 on t2.id=t3.id where t2.name like 'test2' or t3.name like 'test3') sub
inner join t4 on sub.id=t4.id;
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t2.name, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name
└─HashJoin	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t1.id)]
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:false, stats:pseudo
  └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t2.name, "test2", 92), like(planner__core__join_reorder2.t3.name, "test3", 92))
    └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 1;
explain format = 'brief' select /*+ leading(t1@sel_2, t4, t2@sel_2, t3@sel_2) */ * from
(select t1.id, t1.name as n1, t2.name as n2, t3.name as n3 from t1 inner join t2 on t1.id=t2.id left join t3 on t2.id=t3.id where t2.name like 'test2' or t3.name like 'test3') sub
inner join t4 on sub.id=t4.id;
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t2.name, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name
└─Selection	15625.00	root		or(like(planner__core__join_reorder2.t2.name, "test2", 92), like(planner__core__join_reorder2.t3.name, "test3", 92))
  └─MergeJoin	19531.25	root		left outer join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
    ├─TableReader(Build)	10000.00	root		data:TableFullScan
    │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
    └─MergeJoin(Probe)	15625.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t4.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 0;
explain format = 'brief' select * from t1 where exists (
select 1
from t2 inner join t3 on t2.id=t3.id left join t4 on t4.id=t3.id join t5 on t2.id=t5.id
where (t3.name like 'test3' or t4.name like 'test4') and t2.id = t1.id
);
id	estRows	task	access object	operator info
HashJoin	8000.00	root		semi join, equal:[eq(planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t2.id)]
├─HashJoin(Build)	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t5.id, planner__core__join_reorder2.t2.id)]
│ ├─TableReader(Build)	10000.00	root		data:TableFullScan
│ │ └─TableFullScan	10000.00	cop[tikv]	table:t5	keep order:false, stats:pseudo
│ └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t3.name, "test3", 92), like(planner__core__join_reorder2.t4.name, "test4", 92))
│   └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t3.id, right key:planner__core__join_reorder2.t4.id
│     ├─TableReader(Build)	10000.00	root		data:TableFullScan
│     │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:true, stats:pseudo
│     └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
│       ├─TableReader(Build)	10000.00	root		data:TableFullScan
│       │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
│       └─TableReader(Probe)	10000.00	root		data:TableFullScan
│         └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
└─TableReader(Probe)	10000.00	root		data:TableFullScan
  └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 1;
explain format = 'brief' select * from t1 where exists (
select 1
from t2 inner join t3 on t2.id=t3.id left join t4 on t4.id=t3.id join t5 on t2.id=t5.id
where (t3.name like 'test3' or t4.name like 'test4') and t2.id = t1.id
);
id	estRows	task	access object	operator info
HashJoin	8000.00	root		semi join, equal:[eq(planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t2.id)]
├─HashJoin(Build)	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t2.id, planner__core__join_reorder2.t5.id)]
│ ├─TableReader(Build)	10000.00	root		data:TableFullScan
│ │ └─TableFullScan	10000.00	cop[tikv]	table:t5	keep order:false, stats:pseudo
│ └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t3.name, "test3", 92), like(planner__core__join_reorder2.t4.name, "test4", 92))
│   └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t3.id, right key:planner__core__join_reorder2.t4.id
│     ├─TableReader(Build)	10000.00	root		data:TableFullScan
│     │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:true, stats:pseudo
│     └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
│       ├─TableReader(Build)	10000.00	root		data:TableFullScan
│       │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
│       └─TableReader(Probe)	10000.00	root		data:TableFullScan
│         └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
└─TableReader(Probe)	10000.00	root		data:TableFullScan
  └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:false, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 0;
explain format = 'brief' select /*+ leading(t1@sel_2, t4, t2@sel_2, t3@sel_2) */ * from
(select t1.id, t1.name as n1, t2.name as n2, t3.name as n3 from t1 inner join t2 on t1.id=t2.id left join t3 on t2.id=t3.id where t2.name like 'test2' or t3.name like 'test3' or rand() < 0.5) sub
inner join t4 on sub.id=t4.id;
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t2.name, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name
└─HashJoin	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t1.id)]
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:false, stats:pseudo
  └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t2.name, "test2", 92), or(like(planner__core__join_reorder2.t3.name, "test3", 92), lt(rand(), 0.5)))
    └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 1;
explain format = 'brief' select /*+ leading(t1@sel_2, t4, t2@sel_2, t3@sel_2) */ * from
(select t1.id, t1.name as n1, t2.name as n2, t3.name as n3 from t1 inner join t2 on t1.id=t2.id left join t3 on t2.id=t3.id where t2.name like 'test2' or t3.name like 'test3' or rand() < 0.5) sub
inner join t4 on sub.id=t4.id;
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t2.name, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name
└─HashJoin	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t1.id)]
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:false, stats:pseudo
  └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t2.name, "test2", 92), or(like(planner__core__join_reorder2.t3.name, "test3", 92), lt(rand(), 0.5)))
    └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 0;
explain format = 'brief' select /*+ leading(t1@sel_2, t4, t2@sel_2, t3@sel_2) */ * from
(select t1.id, t1.name as n1, t2.name as n2, t3.name as n3 from t1 inner join t2 on t1.id=t2.id left join t3 on t2.id=t3.id where t2.name like 'test2' or t3.name like 'test3' or sleep(0) = 0) sub
inner join t4 on sub.id=t4.id;
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t2.name, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name
└─HashJoin	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t1.id)]
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:false, stats:pseudo
  └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t2.name, "test2", 92), or(like(planner__core__join_reorder2.t3.name, "test3", 92), eq(sleep(0), 0)))
    └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 1;
explain format = 'brief' select /*+ leading(t1@sel_2, t4, t2@sel_2, t3@sel_2) */ * from
(select t1.id, t1.name as n1, t2.name as n2, t3.name as n3 from t1 inner join t2 on t1.id=t2.id left join t3 on t2.id=t3.id where t2.name like 'test2' or t3.name like 'test3' or sleep(0) = 0) sub
inner join t4 on sub.id=t4.id;
id	estRows	task	access object	operator info
Projection	15625.00	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t2.name, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t4.name
└─HashJoin	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t1.id)]
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:false, stats:pseudo
  └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t2.name, "test2", 92), or(like(planner__core__join_reorder2.t3.name, "test3", 92), eq(sleep(0), 0)))
    └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
        └─TableReader(Probe)	10000.00	root		data:TableFullScan
          └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 0;
explain format = 'brief' select /*+ leading(t1@sel_3, t5, t4@sel_2, t2@sel_3, t3@sel_3) */ * from
(select sub1.id, sub1.n1, sub1.n2, sub1.n3, t4.name as n4 from
(select t1.id, t1.name as n1, t2.name as n2, t3.name as n3 from t1 inner join t2 on t1.id=t2.id left join t3 on t2.id=t3.id where t2.name like 'test2' or t3.name like 'test3') sub1
inner join t4 on sub1.id=t4.id
) sub2
inner join t5 on sub2.id=t5.id;
id	estRows	task	access object	operator info
Projection	19531.25	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t2.name, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.name, planner__core__join_reorder2.t5.id, planner__core__join_reorder2.t5.name
└─HashJoin	19531.25	root		inner join, equal:[eq(planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t5.id)]
  ├─TableReader(Build)	10000.00	root		data:TableFullScan
  │ └─TableFullScan	10000.00	cop[tikv]	table:t5	keep order:false, stats:pseudo
  └─HashJoin(Probe)	15625.00	root		inner join, equal:[eq(planner__core__join_reorder2.t4.id, planner__core__join_reorder2.t1.id)]
    ├─TableReader(Build)	10000.00	root		data:TableFullScan
    │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:false, stats:pseudo
    └─Selection(Probe)	12500.00	root		or(like(planner__core__join_reorder2.t2.name, "test2", 92), like(planner__core__join_reorder2.t3.name, "test3", 92))
      └─MergeJoin	15625.00	root		left outer join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
        └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
          ├─TableReader(Build)	10000.00	root		data:TableFullScan
          │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
          └─TableReader(Probe)	10000.00	root		data:TableFullScan
            └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
set @@tidb_opt_join_reorder_through_sel = 1;
explain format = 'brief' select /*+ leading(t1@sel_3, t5, t4@sel_2, t2@sel_3, t3@sel_3) */ * from
(select sub1.id, sub1.n1, sub1.n2, sub1.n3, t4.name as n4 from
(select t1.id, t1.name as n1, t2.name as n2, t3.name as n3 from t1 inner join t2 on t1.id=t2.id left join t3 on t2.id=t3.id where t2.name like 'test2' or t3.name like 'test3') sub1
inner join t4 on sub1.id=t4.id
) sub2
inner join t5 on sub2.id=t5.id;
id	estRows	task	access object	operator info
Projection	19531.25	root		planner__core__join_reorder2.t1.id, planner__core__join_reorder2.t1.name, planner__core__join_reorder2.t2.name, planner__core__join_reorder2.t3.name, planner__core__join_reorder2.t4.name, planner__core__join_reorder2.t5.id, planner__core__join_reorder2.t5.name
└─Selection	19531.25	root		or(like(planner__core__join_reorder2.t2.name, "test2", 92), like(planner__core__join_reorder2.t3.name, "test3", 92))
  └─MergeJoin	24414.06	root		left outer join, left key:planner__core__join_reorder2.t2.id, right key:planner__core__join_reorder2.t3.id
    ├─TableReader(Build)	10000.00	root		data:TableFullScan
    │ └─TableFullScan	10000.00	cop[tikv]	table:t3	keep order:true, stats:pseudo
    └─MergeJoin(Probe)	19531.25	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t2.id
      ├─TableReader(Build)	10000.00	root		data:TableFullScan
      │ └─TableFullScan	10000.00	cop[tikv]	table:t2	keep order:true, stats:pseudo
      └─MergeJoin(Probe)	15625.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t4.id
        ├─TableReader(Build)	10000.00	root		data:TableFullScan
        │ └─TableFullScan	10000.00	cop[tikv]	table:t4	keep order:true, stats:pseudo
        └─MergeJoin(Probe)	12500.00	root		inner join, left key:planner__core__join_reorder2.t1.id, right key:planner__core__join_reorder2.t5.id
          ├─TableReader(Build)	10000.00	root		data:TableFullScan
          │ └─TableFullScan	10000.00	cop[tikv]	table:t5	keep order:true, stats:pseudo
          └─TableReader(Probe)	10000.00	root		data:TableFullScan
            └─TableFullScan	10000.00	cop[tikv]	table:t1	keep order:true, stats:pseudo
