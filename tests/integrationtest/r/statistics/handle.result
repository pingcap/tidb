set @@tidb_partition_prune_mode='dynamic';
drop table if exists t;
create table t (a int, b int) partition by range (a) (partition p0 values less than (10), partition p1 values less than (20), partition p2 values less than maxvalue);
alter table t add index idx((a+5));
analyze table t;
drop table if exists t1;
create table t1 (a int, b int as (a+1) virtual, c int) partition by range (a) (partition p0 values less than (10), partition p1 values less than (20), partition p2 values less than maxvalue);
alter table t1 add index idx((a+5));
analyze table t1;
set @@tidb_partition_prune_mode=default;
set @@tidb_partition_prune_mode='static';
drop table if exists t;
delete from mysql.stats_fm_sketch;
create table t(a int, index(a));
insert into t values (1), (2), (3);
analyze table t;
select count(*) from mysql.stats_fm_sketch;
count(*)
0
create table tp(a int, index(a)) partition by hash(a) partitions 3;
insert into tp values (1), (2), (3);
analyze table tp;
select count(*) from mysql.stats_fm_sketch;
count(*)
6
set @@tidb_partition_prune_mode='dynamic';
analyze table t;
select count(*) from mysql.stats_fm_sketch;
count(*)
6
analyze table tp;
select count(*) from mysql.stats_fm_sketch;
count(*)
6
insert into t values (10), (20), (30), (12), (23), (23), (4344);
analyze table tp;
select count(*) from mysql.stats_fm_sketch;
count(*)
6
set @@tidb_partition_prune_mode=default;
select @@tidb_config like '%index-usage-sync-lease%';
@@tidb_config like '%index-usage-sync-lease%'
0
drop table if exists t;
set time_zone = '+08:00';
create table t(a int);
alter table t add column ts timestamp DEFAULT '1970-01-01 08:00:01';
drop table if exists t;
set time_zone = '+09:00';
create table t(a int);
alter table t add column ts timestamp DEFAULT '1970-01-01 08:00:01';
Error 1067 (42000): Invalid default value for 'ts'
drop table if exists t;
set time_zone = default;
