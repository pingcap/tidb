drop table if exists t;
set @@session.tidb_analyze_version = 2;
create table t(a longtext);
insert into t value(repeat("a",65536));
insert into t value(repeat("b",65536));
analyze table t with 0 topn;
set @@session.tidb_analyze_version = default;
drop table if exists t1;
drop table if exists t2;
create table t1(a int);
create table t2(a int);
insert into t1 values(null), (null), (null), (null);
insert into t2 values(null), (null);
analyze table t1 all columns;
analyze table t2 all columns;
explain format = 'plan_tree' select * from t1 left join t2 on t1.a=t2.a order by t1.a, t2.a;
id	task	access object	operator info
Sort	root		statistics__integration.t1.a, statistics__integration.t2.a
└─HashJoin	root		left outer join, left side:TableReader, equal:[eq(statistics__integration.t1.a, statistics__integration.t2.a)]
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		not(isnull(statistics__integration.t2.a))
  │   └─TableFullScan	cop[tikv]	table:t2	keep order:false
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:false
explain format = 'plan_tree' select * from t2 left join t1 on t1.a=t2.a order by t1.a, t2.a;
id	task	access object	operator info
Sort	root		statistics__integration.t1.a, statistics__integration.t2.a
└─HashJoin	root		left outer join, left side:TableReader, equal:[eq(statistics__integration.t2.a, statistics__integration.t1.a)]
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		not(isnull(statistics__integration.t1.a))
  │   └─TableFullScan	cop[tikv]	table:t1	keep order:false
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t2	keep order:false
explain format = 'plan_tree' select * from t1 right join t2 on t1.a=t2.a order by t1.a, t2.a;
id	task	access object	operator info
Sort	root		statistics__integration.t1.a, statistics__integration.t2.a
└─HashJoin	root		right outer join, left side:TableReader, equal:[eq(statistics__integration.t1.a, statistics__integration.t2.a)]
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		not(isnull(statistics__integration.t1.a))
  │   └─TableFullScan	cop[tikv]	table:t1	keep order:false
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t2	keep order:false
explain format = 'plan_tree' select * from t2 right join t1 on t1.a=t2.a order by t1.a, t2.a;
id	task	access object	operator info
Sort	root		statistics__integration.t1.a, statistics__integration.t2.a
└─HashJoin	root		right outer join, left side:TableReader, equal:[eq(statistics__integration.t2.a, statistics__integration.t1.a)]
  ├─TableReader(Build)	root		data:Selection
  │ └─Selection	cop[tikv]		not(isnull(statistics__integration.t2.a))
  │   └─TableFullScan	cop[tikv]	table:t2	keep order:false
  └─TableReader(Probe)	root		data:TableFullScan
    └─TableFullScan	cop[tikv]	table:t1	keep order:false
drop table if exists t;
set @@session.tidb_analyze_version = 2;
create table t(a int, b int, index idx_a(a), unique index uidx_b(b));
insert into t values (1,1),(1,2),(2,3);
analyze table t with 5 topn;
show stats_topn where table_name = 't';
Db_name	Table_name	Partition_name	Column_name	Is_index	Value	Count
statistics__integration	t		a	0	1	2
statistics__integration	t		a	0	2	1
statistics__integration	t		idx_a	1	1	2
statistics__integration	t		idx_a	1	2	1
set @@session.tidb_analyze_version = default;
drop table if exists t,t1,t2;
