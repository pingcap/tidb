set @@global.tidb_enable_global_index = 1;
drop database if exists test_sd;
create database test_sd softdelete = RETENTION 7 DAY;
show create database test_sd;
Database	Create Database
test_sd	CREATE DATABASE `test_sd` /*!40100 DEFAULT CHARACTER SET utf8mb4 */ /*T![softdelete] SOFTDELETE=RETENTION 7 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='24h' */
drop database test_sd;
create database test_sd softdelete retention 7 DAY softdelete_job_enable = 'ON' softdelete_job_interval = '1h';
show create database test_sd;
Database	Create Database
test_sd	CREATE DATABASE `test_sd` /*!40100 DEFAULT CHARACTER SET utf8mb4 */ /*T![softdelete] SOFTDELETE=RETENTION 7 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='1h' */
alter database test_sd softdelete = 'OFF';
show create database test_sd;
Database	Create Database
test_sd	CREATE DATABASE `test_sd` /*!40100 DEFAULT CHARACTER SET utf8mb4 */
alter database test_sd softdelete_job_interval = '3h';
Error 8200 (HY000): Unsupported must sepecify SOFTDELETE = RETENTION xxx
alter database test_sd softdelete retention 8 DAY softdelete_job_interval = '3h';
show create database test_sd;
Database	Create Database
test_sd	CREATE DATABASE `test_sd` /*!40100 DEFAULT CHARACTER SET utf8mb4 */ /*T![softdelete] SOFTDELETE=RETENTION 8 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='3h' */
drop database test_sd;
create database test_sd;
use test_sd;
create table t1 (id int primary key, name varchar(50)) softdelete = retention 7 day;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin /*T![softdelete] SOFTDELETE=RETENTION 7 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='24h' */
create table t2 (id int primary key, name varchar(50)) softdelete retention 7 hour;
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin /*T![softdelete] SOFTDELETE=RETENTION 7 HOUR */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='24h' */
create table t3 (id int primary key, name varchar(50)) softdelete retention 4 hour softdelete_job_interval = '2h' softdelete_job_enable = 'ON';
show create table t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin /*T![softdelete] SOFTDELETE=RETENTION 4 HOUR */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='2h' */
alter database test_sd softdelete retention 7 hour;
create table t4 (id int primary key, name varchar(50));
show create table t4;
Table	Create Table
t4	CREATE TABLE `t4` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin /*T![softdelete] SOFTDELETE=RETENTION 7 HOUR */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='24h' */
drop table if exists t4_gi;
create table t4_gi (id int primary key) /*T![softdelete] SOFTDELETE=RETENTION 7 DAY */ partition by hash(id) partitions 4;
alter table t4_gi add index i1(_tidb_softdelete_time) global;
show create table t4_gi;
Table	Create Table
t4_gi	CREATE TABLE `t4_gi` (
  `id` int NOT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
  /*T![softdelete] , KEY `i1` (`_tidb_softdelete_time`) GLOBAL */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
PARTITION BY HASH (`id`) PARTITIONS 4 /*T![softdelete] SOFTDELETE=RETENTION 7 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='24h' */
drop table if exists t4_gi;
alter database test_sd softdelete = 'off';
create table t5 (id int primary key, name varchar(50)) /*T![active_active] ACTIVE_ACTIVE='ON' */ /*T![softdelete] SOFTDELETE=RETENTION 7 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='24h' */;
show create table t5;
Table	Create Table
t5	CREATE TABLE `t5` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin /*T![active_active] ACTIVE_ACTIVE='ON' */ /*T![softdelete] SOFTDELETE=RETENTION 7 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='24h' */
create table t6 (id int primary key, name varchar(50)) softdelete_job_interval = '2h' softdelete_job_enable = 'ON' softdelete = 'OFF';
Error 8200 (HY000): Unsupported having SOFTDELETE options but SOFTDELETE = 'OFF'
create table t6 (id int primary key, name varchar(50)) softdelete_job_interval = '2h' softdelete_job_enable = 'ON';
Error 8200 (HY000): Unsupported must sepecify SOFTDELETE = RETENTION xxx
alter table t4 softdelete retention 30 DAY;
show create table t4;
Table	Create Table
t4	CREATE TABLE `t4` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin /*T![softdelete] SOFTDELETE=RETENTION 30 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='ON' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='24h' */
alter table t4 drop column _tidb_softdelete_time;
Error 8200 (HY000): Unsupported can not drop internal columns
alter table t4 softdelete_job_enable = 'OFF' softdelete_job_interval = '9h';
show create table t4;
Table	Create Table
t4	CREATE TABLE `t4` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin /*T![softdelete] SOFTDELETE=RETENTION 30 DAY */ /*T![softdelete] SOFTDELETE_JOB_ENABLE='OFF' */ /*T![softdelete] SOFTDELETE_JOB_INTERVAL='9h' */
alter table t4 softdelete = 'OFF';
alter table t4 drop column _tidb_softdelete_time;
show create table t4;
Table	Create Table
t4	CREATE TABLE `t4` (
  `id` int NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`) /*T![clustered_index] CLUSTERED */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
alter database test_sd softdelete = 'INVALID';
Error 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 45 near ""The SOFTDELETE option must be RETENTION XXX or 'OFF' 
create table t5 (id int) softdelete = 'YES';
Error 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 43 near ""The SOFTDELETE option must be RETENTION XXX or 'OFF' 
alter table t1 softdelete_job_enable = 'MAYBE';
Error 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 46 near ""The SOFTDELETE_JOB_ENABLE option must be 'ON' or 'OFF' 
create table t6 (id int) softdelete = retention 'invalid_duration' DAY;
Error 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 66 near "'invalid_duration' DAY" 
create global temporary table tmp_aa (id int) on commit delete rows active_active = 'ON' softdelete = retention 7 day;
Error 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 81 near "active_active = 'ON' softdelete = retention 7 day" 
create temporary table tmp_sd2 (id int) softdelete = retention 7 day;
Error 8200 (HY000): Unsupported SOFTDELETE and ACTIVE_ACTIVE is unspported on temp table
create table parent_fk (id int primary key);
create table child_fk (id int primary key, pid int);
alter table child_fk add constraint fk_child foreign key(pid) references parent_fk(id);
alter table parent_fk softdelete retention 7 day;
Error 8200 (HY000): Unsupported SOFTDELETE is unspported on referenced foreign key table
alter table child_fk softdelete retention 7 day;
Error 8200 (HY000): Unsupported SOFTDELETE is unspported on table with foreign key
create global temporary table tmp_sd3 (id int) on commit delete rows;
alter table tmp_sd3 softdelete retention 7 day;
Error 8200 (HY000): Unsupported SOFTDELETE and ACTIVE_ACTIVE is unspported on temp table
create temporary table tmp_sd4 (id int);
alter table tmp_sd4 softdelete retention 7 day;
Error 8200 (HY000): TiDB doesn't support ALTER TABLE for local temporary table
drop database test_sd;
set @@global.tidb_enable_global_index = default;
