set tidb_enable_global_index=true;
drop table if exists t;
CREATE TABLE `t` (
`a` int(11) DEFAULT NULL,
`b` int(11) DEFAULT NULL,
`c` int(11) DEFAULT NULL,
UNIQUE KEY `idx` ((`c` + 1)),
UNIQUE KEY `idx1` (`c`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
PARTITION BY HASH (`b`) PARTITIONS 4;
insert into t values (1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,5,5);
insert into t(a) values (1), (2);
analyze table t;
#Test special global index
explain select c+1 from t where (c+1)>3;
id	estRows	task	access object	operator info
IndexReader_7	3.00	root	partition:all	index:IndexRangeScan_5
└─IndexRangeScan_5	3.00	cop[tikv]	table:t, index:idx(`c` + 1)	range:(3,+inf], keep order:false
explain select c+1 from t where (c+1)>4;
id	estRows	task	access object	operator info
IndexReader_7	2.00	root	partition:all	index:IndexRangeScan_5
└─IndexRangeScan_5	2.00	cop[tikv]	table:t, index:idx(`c` + 1)	range:(4,+inf], keep order:false
#Test normal global index
explain select c from t where c > 2;
id	estRows	task	access object	operator info
IndexReader_7	3.00	root	partition:all	index:IndexRangeScan_5
└─IndexRangeScan_5	3.00	cop[tikv]	table:t, index:idx1(c)	range:(2,+inf], keep order:false
explain select c from t where c > 3;
id	estRows	task	access object	operator info
IndexReader_7	2.00	root	partition:all	index:IndexRangeScan_5
└─IndexRangeScan_5	2.00	cop[tikv]	table:t, index:idx1(c)	range:(3,+inf], keep order:false
show stats_histograms where table_name='t' and Db_name='globalindex__analyze';
Db_name	Table_name	Partition_name	Column_name	Is_index	Update_time	Distinct_count	Null_count	Avg_col_size	Correlation	Load_status	Total_mem_usage	Hist_mem_usage	Topn_mem_usage	Cms_mem_usage
globalindex__analyze	t	global	c	0	<update_time>	5	2	<avg_col_size>	0	allLoaded	237	0	237	0
globalindex__analyze	t	global	idx	1	<update_time>	5	2	<avg_col_size>	0	allLoaded	237	0	237	0
globalindex__analyze	t	global	idx1	1	<update_time>	5	2	<avg_col_size>	0	allLoaded	237	0	237	0
globalindex__analyze	t	p0	c	0	<update_time>	1	2	<avg_col_size>	1	allLoaded	73	0	73	0
globalindex__analyze	t	p0	idx1	1	<update_time>	1	2	<avg_col_size>	0	allLoaded	73	0	73	0
globalindex__analyze	t	p1	c	0	<update_time>	2	0	<avg_col_size>	1	allLoaded	114	0	114	0
globalindex__analyze	t	p1	idx1	1	<update_time>	2	0	<avg_col_size>	0	allLoaded	114	0	114	0
globalindex__analyze	t	p2	c	0	<update_time>	1	0	<avg_col_size>	1	allLoaded	73	0	73	0
globalindex__analyze	t	p2	idx1	1	<update_time>	1	0	<avg_col_size>	0	allLoaded	73	0	73	0
globalindex__analyze	t	p3	c	0	<update_time>	1	0	<avg_col_size>	1	allLoaded	73	0	73	0
globalindex__analyze	t	p3	idx1	1	<update_time>	1	0	<avg_col_size>	0	allLoaded	73	0	73	0
