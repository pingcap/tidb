# IntHandle
drop table if exists t;
CREATE TABLE `t` (
`a` int(11) DEFAULT NULL,
`b` int(11) DEFAULT NULL,
UNIQUE KEY `idx` (`a`) GLOBAL,
UNIQUE KEY `idx1` (`b`) GLOBAL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
PARTITION BY HASH (`a`) PARTITIONS 5;
insert into t values (1, 2), (2, 3), (3, 4), (4, 5);
begin;
insert into t values (5, 1);
explain format='plan_tree' select * from t use index(idx1) where b > 2;
id	task	access object	operator info
Projection	root		globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b
└─UnionScan	root		gt(globalindex__mem_index_lookup.t.b, 2)
  └─IndexLookUp	root	partition:all	
    ├─IndexRangeScan(Build)	cop[tikv]	table:t, index:idx1(b)	range:(2,+inf], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t use index(idx1) where b > 2;
a	b
2	3
3	4
4	5
explain format='plan_tree' select * from t partition(p0) use index(idx1) where b <= 2;
id	task	access object	operator info
Projection	root	NULL	globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b
└─UnionScan	root	NULL	le(globalindex__mem_index_lookup.t.b, 2)
  └─IndexLookUp	root	partition:p0	NULL
    ├─Selection(Build)	cop[tikv]	NULL	in(globalindex__mem_index_lookup.t._tidb_tid, tid0)
    │ └─IndexRangeScan	cop[tikv]	table:t, index:idx1(b)	range:[-inf,2], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p0) use index(idx1) where b <= 2;
a	b
5	1
explain format='plan_tree' select * from t partition(p1) use index(idx1) where b <= 2 and a = 10;
id	task	access object	operator info
Projection	root		globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b
└─UnionScan	root		eq(globalindex__mem_index_lookup.t.a, 10), le(globalindex__mem_index_lookup.t.b, 2)
  └─IndexLookUp	root	partition:dual	
    ├─Selection(Build)	cop[tikv]		in(globalindex__mem_index_lookup.t._tidb_tid, dual)
    │ └─IndexRangeScan	cop[tikv]	table:t, index:idx1(b)	range:[-inf,2], keep order:false, stats:pseudo
    └─Selection(Probe)	cop[tikv]		eq(globalindex__mem_index_lookup.t.a, 10)
      └─TableRowIDScan	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p1) use index(idx1) where b <= 2 and a = 10;
a	b
explain format='plan_tree' select * from t partition(p0, p1) use index(idx1) where b <= 2;
id	task	access object	operator info
Projection	root	NULL	globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b
└─UnionScan	root	NULL	le(globalindex__mem_index_lookup.t.b, 2)
  └─IndexLookUp	root	partition:p0,p1	NULL
    ├─Selection(Build)	cop[tikv]	NULL	in(globalindex__mem_index_lookup.t._tidb_tid, tid0, tid1)
    │ └─IndexRangeScan	cop[tikv]	table:t, index:idx1(b)	range:[-inf,2], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p0, p1) use index(idx1) where b <= 2;
a	b
1	2
5	1
explain format='plan_tree' select * from t use index(idx) where a > 2;
id	task	access object	operator info
Projection	root		globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b
└─UnionScan	root		gt(globalindex__mem_index_lookup.t.a, 2)
  └─IndexLookUp	root	partition:all	
    ├─IndexRangeScan(Build)	cop[tikv]	table:t, index:idx(a)	range:(2,+inf], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t use index(idx) where a > 2;
a	b
3	4
4	5
5	1
explain format='plan_tree' select * from t partition(p0) use index(idx) where a <= 2;
id	task	access object	operator info
Projection	root	NULL	globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b
└─UnionScan	root	NULL	le(globalindex__mem_index_lookup.t.a, 2)
  └─IndexLookUp	root	partition:p0	NULL
    ├─Selection(Build)	cop[tikv]	NULL	in(globalindex__mem_index_lookup.t._tidb_tid, tid0)
    │ └─IndexRangeScan	cop[tikv]	table:t, index:idx(a)	range:[-inf,2], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p0) use index(idx) where a <= 2;
a	b
explain format='plan_tree' select * from t partition(p0, p1) use index(idx) where a <= 2;
id	task	access object	operator info
Projection	root	NULL	globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b
└─UnionScan	root	NULL	le(globalindex__mem_index_lookup.t.a, 2)
  └─IndexLookUp	root	partition:p0,p1	NULL
    ├─Selection(Build)	cop[tikv]	NULL	in(globalindex__mem_index_lookup.t._tidb_tid, tid0, tid1)
    │ └─IndexRangeScan	cop[tikv]	table:t, index:idx(a)	range:[-inf,2], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p0, p1) use index(idx) where a <= 2;
a	b
1	2
rollback;
# CommonHandle
drop table if exists t;
CREATE TABLE `t` (
`a` year(4) primary key clustered,
`b` int(11) DEFAULT NULL,
`c` int(11) DEFAULT NULL,
UNIQUE KEY `idx1` (`b`) GLOBAL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
PARTITION BY HASH (`a`) PARTITIONS 5;
insert into t(a, b) values (2001, 2), (2002, 3), (2003, 4), (2004, 5);
begin;
insert into t(a, b) values (2005, 1);
explain format='plan_tree' select * from t use index(idx1) where b > 2;
id	task	access object	operator info
Projection	root		globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b, globalindex__mem_index_lookup.t.c
└─UnionScan	root		gt(globalindex__mem_index_lookup.t.b, 2)
  └─IndexLookUp	root	partition:all	
    ├─IndexRangeScan(Build)	cop[tikv]	table:t, index:idx1(b)	range:(2,+inf], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t use index(idx1) where b > 2;
a	b	c
2002	3	NULL
2003	4	NULL
2004	5	NULL
explain format='plan_tree' select * from t partition(p0) use index(idx1) where b <= 2;
id	task	access object	operator info
Projection	root	NULL	globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b, globalindex__mem_index_lookup.t.c
└─UnionScan	root	NULL	le(globalindex__mem_index_lookup.t.b, 2)
  └─IndexLookUp	root	partition:p0	NULL
    ├─Selection(Build)	cop[tikv]	NULL	in(globalindex__mem_index_lookup.t._tidb_tid, tid0)
    │ └─IndexRangeScan	cop[tikv]	table:t, index:idx1(b)	range:[-inf,2], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p0) use index(idx1) where b <= 2;
a	b	c
2005	1	NULL
explain format='plan_tree' select * from t partition(p1) use index(idx1) where b <= 2 and a = 2010;
id	task	access object	operator info
Projection	root		globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b, globalindex__mem_index_lookup.t.c
└─UnionScan	root		eq(globalindex__mem_index_lookup.t.a, 2010), le(globalindex__mem_index_lookup.t.b, 2)
  └─IndexLookUp	root	partition:dual	
    ├─Selection(Build)	cop[tikv]		eq(globalindex__mem_index_lookup.t.a, 2010), in(globalindex__mem_index_lookup.t._tidb_tid, dual)
    │ └─IndexRangeScan	cop[tikv]	table:t, index:idx1(b)	range:[-inf,2], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p1) use index(idx1) where b <= 2 and a = 2010;
a	b	c
explain format='plan_tree' select * from t partition(p0, p1) use index(idx1) where b <= 2;
id	task	access object	operator info
Projection	root	NULL	globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b, globalindex__mem_index_lookup.t.c
└─UnionScan	root	NULL	le(globalindex__mem_index_lookup.t.b, 2)
  └─IndexLookUp	root	partition:p0,p1	NULL
    ├─Selection(Build)	cop[tikv]	NULL	in(globalindex__mem_index_lookup.t._tidb_tid, tid0, tid1)
    │ └─IndexRangeScan	cop[tikv]	table:t, index:idx1(b)	range:[-inf,2], keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p0, p1) use index(idx1) where b <= 2;
a	b	c
2001	2	NULL
2005	1	NULL
explain format='plan_tree' select * from t use index(idx) where a > 2002;
id	task	access object	operator info
Projection	root		globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b, globalindex__mem_index_lookup.t.c
└─UnionScan	root		gt(globalindex__mem_index_lookup.t.a, 2002)
  └─IndexLookUp	root	partition:all	
    ├─Selection(Build)	cop[tikv]		gt(globalindex__mem_index_lookup.t.a, 2002)
    │ └─IndexFullScan	cop[tikv]	table:t, index:idx1(b)	keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t use index(idx) where a > 2002;
a	b	c
2003	4	NULL
2004	5	NULL
2005	1	NULL
explain format='plan_tree' select * from t partition(p0) use index(idx) where a <= 2002;
id	task	access object	operator info
Projection	root	NULL	globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b, globalindex__mem_index_lookup.t.c
└─UnionScan	root	NULL	le(globalindex__mem_index_lookup.t.a, 2002)
  └─IndexLookUp	root	partition:p0	NULL
    ├─Selection(Build)	cop[tikv]	NULL	in(globalindex__mem_index_lookup.t._tidb_tid, tid0), le(globalindex__mem_index_lookup.t.a, 2002)
    │ └─IndexFullScan	cop[tikv]	table:t, index:idx1(b)	keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p0) use index(idx) where a <= 2002;
a	b	c
explain format='plan_tree' select * from t partition(p0, p1) use index(idx) where a <= 2002;
id	task	access object	operator info
Projection	root	NULL	globalindex__mem_index_lookup.t.a, globalindex__mem_index_lookup.t.b, globalindex__mem_index_lookup.t.c
└─UnionScan	root	NULL	le(globalindex__mem_index_lookup.t.a, 2002)
  └─IndexLookUp	root	partition:p0,p1	NULL
    ├─Selection(Build)	cop[tikv]	NULL	in(globalindex__mem_index_lookup.t._tidb_tid, tid0, tid1), le(globalindex__mem_index_lookup.t.a, 2002)
    │ └─IndexFullScan	cop[tikv]	table:t, index:idx1(b)	keep order:false, stats:pseudo
    └─TableRowIDScan(Probe)	cop[tikv]	table:t	keep order:false, stats:pseudo
select * from t partition(p0, p1) use index(idx) where a <= 2002;
a	b	c
2001	2	NULL
rollback;
