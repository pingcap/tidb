create table t (id int primary key clustered) softdelete retention 7 day;
insert into t(id) values (1), (2);
delete from t where id = 1;
insert into t(id) values (1), (2), (3);
Error 1062 (23000): Duplicate entry '2' for key 't.PRIMARY'
set tidb_translate_softdelete_sql = false;
select id from t;
id
1
2
set tidb_translate_softdelete_sql = true;
select id from t;
id
2
select * from t;
id
2
insert into t(id) values (1), (3);
select id from t;
id
1
2
3
drop table t;
create table t (id int primary key nonclustered) softdelete retention 7 day;
insert into t(id) values (1), (2);
delete from t where id = 1;
insert into t(id) values (1), (2), (3);
Error 1062 (23000): Duplicate entry '2' for key 't.PRIMARY'
select id from t;
id
2
set tidb_translate_softdelete_sql = false;
select id from t;
id
1
2
set tidb_translate_softdelete_sql = true;
insert into t(id) values (1), (3);
select id from t;
id
2
1
3
