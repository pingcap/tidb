create table message (id int primary key, text varchar(10)) softdelete retention 7 day;
set @@tidb_translate_softdelete_sql = true;
insert into message values (1, '24h'), (2, '24h');
delete from message where id = 1;
set @@tidb_translate_softdelete_sql = false;
set @ts1 = (select _tidb_softdelete_time from message where id = 1);
select id, _tidb_softdelete_time is not null as is_deleted from message where id = 1;
id	is_deleted
1	1
set @@tidb_translate_softdelete_sql = true;
delete from message where id = 1;
set @@tidb_translate_softdelete_sql = false;
set @ts2 = (select _tidb_softdelete_time from message where id = 1);
select id, _tidb_softdelete_time is not null as is_deleted from message where id = 1;
id	is_deleted
1	1
select @ts1 = @ts2 as timestamp_unchanged;
timestamp_unchanged
1
set @@tidb_translate_softdelete_sql = true;
drop table message;
create table message (id int primary key nonclustered, text varchar(10)) softdelete retention 7 day;
insert into message values (1, '24h'), (2, '24h');
delete from message where id = 1;
set @@tidb_translate_softdelete_sql = false;
set @ts1 = (select _tidb_softdelete_time from message where id = 1);
select id, _tidb_softdelete_time is not null as is_deleted from message where id = 1;
id	is_deleted
1	1
set @@tidb_translate_softdelete_sql = true;
delete from message where id = 1;
set @@tidb_translate_softdelete_sql = false;
set @ts2 = (select _tidb_softdelete_time from message where id = 1);
select id, _tidb_softdelete_time is not null as is_deleted from message where id = 1;
id	is_deleted
1	1
select @ts1 = @ts2 as timestamp_unchanged;
timestamp_unchanged
1
set @@tidb_translate_softdelete_sql = true;
drop table message;
