drop table if exists t;
create table t (utf8_bin_c varchar(10) charset utf8 collate utf8_bin, utf8_gen_c varchar(10) charset utf8 collate utf8_general_ci, bin_c binary, num_c int, abin char collate ascii_bin, lbin char collate latin1_bin, u4bin char collate utf8mb4_bin, u4ci char collate utf8mb4_general_ci);
insert into t values ('a', 'b', 'c', 4, 'a', 'a', 'a', 'a');
select collation(null), charset(null);
collation(null)	charset(null)
binary	binary
select collation(2), charset(2);
collation(2)	charset(2)
binary	binary
select collation(2 + 'a'), charset(2 + 'a');
collation(2 + 'a')	charset(2 + 'a')
binary	binary
select collation(2 + utf8_gen_c), charset(2 + utf8_gen_c) from t;
collation(2 + utf8_gen_c)	charset(2 + utf8_gen_c)
binary	binary
select collation(2 + utf8_bin_c), charset(2 + utf8_bin_c) from t;
collation(2 + utf8_bin_c)	charset(2 + utf8_bin_c)
binary	binary
select collation(concat(utf8_bin_c, 2)), charset(concat(utf8_bin_c, 2)) from t;
collation(concat(utf8_bin_c, 2))	charset(concat(utf8_bin_c, 2))
utf8_bin	utf8
select collation(concat(utf8_gen_c, 'abc')), charset(concat(utf8_gen_c, 'abc')) from t;
collation(concat(utf8_gen_c, 'abc'))	charset(concat(utf8_gen_c, 'abc'))
utf8_general_ci	utf8
select collation(concat(utf8_gen_c, null)), charset(concat(utf8_gen_c, null)) from t;
collation(concat(utf8_gen_c, null))	charset(concat(utf8_gen_c, null))
utf8_general_ci	utf8
select collation(concat(utf8_gen_c, num_c)), charset(concat(utf8_gen_c, num_c)) from t;
collation(concat(utf8_gen_c, num_c))	charset(concat(utf8_gen_c, num_c))
utf8_general_ci	utf8
select collation(concat(utf8_bin_c, utf8_gen_c)), charset(concat(utf8_bin_c, utf8_gen_c)) from t;
collation(concat(utf8_bin_c, utf8_gen_c))	charset(concat(utf8_bin_c, utf8_gen_c))
utf8_bin	utf8
select collation(upper(utf8_bin_c)), charset(upper(utf8_bin_c)) from t;
collation(upper(utf8_bin_c))	charset(upper(utf8_bin_c))
utf8_bin	utf8
select collation(upper(utf8_gen_c)), charset(upper(utf8_gen_c)) from t;
collation(upper(utf8_gen_c))	charset(upper(utf8_gen_c))
utf8_general_ci	utf8
select collation(upper(bin_c)), charset(upper(bin_c)) from t;
collation(upper(bin_c))	charset(upper(bin_c))
binary	binary
select collation(concat(abin, bin_c)), charset(concat(abin, bin_c)) from t;
collation(concat(abin, bin_c))	charset(concat(abin, bin_c))
binary	binary
select collation(concat(lbin, bin_c)), charset(concat(lbin, bin_c)) from t;
collation(concat(lbin, bin_c))	charset(concat(lbin, bin_c))
binary	binary
select collation(concat(utf8_bin_c, bin_c)), charset(concat(utf8_bin_c, bin_c)) from t;
collation(concat(utf8_bin_c, bin_c))	charset(concat(utf8_bin_c, bin_c))
binary	binary
select collation(concat(utf8_gen_c, bin_c)), charset(concat(utf8_gen_c, bin_c)) from t;
collation(concat(utf8_gen_c, bin_c))	charset(concat(utf8_gen_c, bin_c))
binary	binary
select collation(concat(u4bin, bin_c)), charset(concat(u4bin, bin_c)) from t;
collation(concat(u4bin, bin_c))	charset(concat(u4bin, bin_c))
binary	binary
select collation(concat(u4ci, bin_c)), charset(concat(u4ci, bin_c)) from t;
collation(concat(u4ci, bin_c))	charset(concat(u4ci, bin_c))
binary	binary
select collation(concat(abin, u4bin)), charset(concat(abin, u4bin)) from t;
collation(concat(abin, u4bin))	charset(concat(abin, u4bin))
utf8mb4_bin	utf8mb4
select collation(concat(lbin, u4bin)), charset(concat(lbin, u4bin)) from t;
collation(concat(lbin, u4bin))	charset(concat(lbin, u4bin))
utf8mb4_bin	utf8mb4
select collation(concat(utf8_bin_c, u4bin)), charset(concat(utf8_bin_c, u4bin)) from t;
collation(concat(utf8_bin_c, u4bin))	charset(concat(utf8_bin_c, u4bin))
utf8mb4_bin	utf8mb4
select collation(concat(utf8_gen_c, u4bin)), charset(concat(utf8_gen_c, u4bin)) from t;
collation(concat(utf8_gen_c, u4bin))	charset(concat(utf8_gen_c, u4bin))
utf8mb4_bin	utf8mb4
select collation(concat(u4ci, u4bin)), charset(concat(u4ci, u4bin)) from t;
collation(concat(u4ci, u4bin))	charset(concat(u4ci, u4bin))
utf8mb4_bin	utf8mb4
select collation(concat(abin, u4ci)), charset(concat(abin, u4ci)) from t;
collation(concat(abin, u4ci))	charset(concat(abin, u4ci))
utf8mb4_general_ci	utf8mb4
select collation(concat(lbin, u4ci)), charset(concat(lbin, u4ci)) from t;
collation(concat(lbin, u4ci))	charset(concat(lbin, u4ci))
utf8mb4_general_ci	utf8mb4
select collation(concat(utf8_bin_c, u4ci)), charset(concat(utf8_bin_c, u4ci)) from t;
collation(concat(utf8_bin_c, u4ci))	charset(concat(utf8_bin_c, u4ci))
utf8mb4_general_ci	utf8mb4
select collation(concat(utf8_gen_c, u4ci)), charset(concat(utf8_gen_c, u4ci)) from t;
collation(concat(utf8_gen_c, u4ci))	charset(concat(utf8_gen_c, u4ci))
utf8mb4_general_ci	utf8mb4
select collation(concat(abin, utf8_bin_c)), charset(concat(abin, utf8_bin_c)) from t;
collation(concat(abin, utf8_bin_c))	charset(concat(abin, utf8_bin_c))
utf8_bin	utf8
select collation(concat(lbin, utf8_bin_c)), charset(concat(lbin, utf8_bin_c)) from t;
collation(concat(lbin, utf8_bin_c))	charset(concat(lbin, utf8_bin_c))
utf8_bin	utf8
select collation(concat(utf8_gen_c, utf8_bin_c)), charset(concat(utf8_gen_c, utf8_bin_c)) from t;
collation(concat(utf8_gen_c, utf8_bin_c))	charset(concat(utf8_gen_c, utf8_bin_c))
utf8_bin	utf8
select collation(concat(abin, utf8_gen_c)), charset(concat(abin, utf8_gen_c)) from t;
collation(concat(abin, utf8_gen_c))	charset(concat(abin, utf8_gen_c))
utf8_general_ci	utf8
select collation(concat(lbin, utf8_gen_c)), charset(concat(lbin, utf8_gen_c)) from t;
collation(concat(lbin, utf8_gen_c))	charset(concat(lbin, utf8_gen_c))
utf8_general_ci	utf8
select collation(concat(abin, lbin)), charset(concat(abin, lbin)) from t;
collation(concat(abin, lbin))	charset(concat(abin, lbin))
latin1_bin	latin1
set names utf8mb4 collate utf8mb4_bin;
select collation('a'), charset('a');
collation('a')	charset('a')
utf8mb4_bin	utf8mb4
set names utf8mb4 collate utf8mb4_general_ci;
select collation('a'), charset('a');
collation('a')	charset('a')
utf8mb4_general_ci	utf8mb4
set names utf8mb4 collate utf8mb4_general_ci;
set @test_collate_var = 'a';
select collation(@test_collate_var), charset(@test_collate_var);
collation(@test_collate_var)	charset(@test_collate_var)
utf8mb4_general_ci	utf8mb4
set @test_collate_var = concat("a", "b" collate utf8mb4_bin);
select collation(@test_collate_var), charset(@test_collate_var);
collation(@test_collate_var)	charset(@test_collate_var)
utf8mb4_bin	utf8mb4
select locate('1', '123' collate utf8mb4_bin, 2 collate `binary`);
locate('1', '123' collate utf8mb4_bin, 2 collate `binary`)
0
select 1 in ('a' collate utf8mb4_bin, 'b' collate utf8mb4_general_ci);
1 in ('a' collate utf8mb4_bin, 'b' collate utf8mb4_general_ci)
0
select left('abc' collate utf8mb4_bin, 2 collate `binary`);
left('abc' collate utf8mb4_bin, 2 collate `binary`)
ab
select right('abc' collate utf8mb4_bin, 2 collate `binary`);
right('abc' collate utf8mb4_bin, 2 collate `binary`)
bc
select repeat('abc' collate utf8mb4_bin, 2 collate `binary`);
repeat('abc' collate utf8mb4_bin, 2 collate `binary`)
abcabc
select trim(both 'abc' collate utf8mb4_bin from 'c' collate utf8mb4_general_ci);
trim(both 'abc' collate utf8mb4_bin from 'c' collate utf8mb4_general_ci)
c
select substr('abc' collate utf8mb4_bin, 2 collate `binary`);
substr('abc' collate utf8mb4_bin, 2 collate `binary`)
bc
select replace('abc' collate utf8mb4_bin, 'b' collate utf8mb4_general_ci, 'd' collate utf8mb4_unicode_ci);
replace('abc' collate utf8mb4_bin, 'b' collate utf8mb4_general_ci, 'd' collate utf8mb4_unicode_ci)
adc
set names default;
drop table if exists t;
create table t (a char(10) charset gbk collate gbk_chinese_ci, b time);
insert into t values ('08:00:00', '08:00:00');
select t1.a, t2.b from t as t1 right join t as t2 on t1.a = t2.b;
a	b
08:00:00	08:00:00
select coercibility(1) ;
coercibility(1)
5
select coercibility(null) ;
coercibility(null)
6
select coercibility('abc') ;
coercibility('abc')
4
select coercibility(version()) ;
coercibility(version())
3
select coercibility(user()) ;
coercibility(user())
3
select coercibility(database()) ;
coercibility(database())
3
select coercibility(current_role()) ;
coercibility(current_role())
3
select coercibility(current_user()) ;
coercibility(current_user())
3
select coercibility(1+null) ;
coercibility(1+null)
5
select coercibility(null+'abcde') ;
coercibility(null+'abcde')
5
select coercibility(concat(null, 'abcde')) ;
coercibility(concat(null, 'abcde'))
4
select coercibility(rand()) ;
coercibility(rand())
5
select coercibility(now()) ;
coercibility(now())
5
select coercibility(sysdate()) ;
coercibility(sysdate())
5
drop table if exists t;
create table t (i int, r real, d datetime, t timestamp, c char(10), vc varchar(10), b binary(10), vb binary(10));
insert into t values (null, null, null, null, null, null, null, null);
select coercibility(i) from t;
coercibility(i)
5
select coercibility(r) from t;
coercibility(r)
5
select coercibility(d) from t;
coercibility(d)
5
select coercibility(t) from t;
coercibility(t)
5
select coercibility(c) from t;
coercibility(c)
2
select coercibility(b) from t;
coercibility(b)
2
select coercibility(vb) from t;
coercibility(vb)
2
select coercibility(vc) from t;
coercibility(vc)
2
select coercibility(i+r) from t;
coercibility(i+r)
5
select coercibility(i*r) from t;
coercibility(i*r)
5
select coercibility(cos(r)+sin(i)) from t;
coercibility(cos(r)+sin(i))
5
select coercibility(d+2) from t;
coercibility(d+2)
5
select coercibility(t*10) from t;
coercibility(t*10)
5
select coercibility(concat(c, vc)) from t;
coercibility(concat(c, vc))
2
select coercibility(replace(c, 'x', 'y')) from t;
coercibility(replace(c, 'x', 'y'))
2
SELECT COERCIBILITY(@straaa);
COERCIBILITY(@straaa)
2
drop table if exists charset_test;
create table charset_test(id int auto_increment primary key, c1 varchar(255) character set ascii);
insert into charset_test(c1) values ('aaaï¿½abcdef');
Error 1366: Incorrect string value '\xEF\xBF\xBD' for column 'c1'
insert into charset_test(c1) values ('aaaï¿½');
Error 1366: Incorrect string value '\xEF\xBF\xBD' for column 'c1'
drop table if exists t_ci;
create table t_ci(a varchar(10) collate utf8mb4_general_ci, unique key(a));
insert into t_ci values ('a');
select * from t_ci;
a
a
select * from t_ci;
a
a
select * from t_ci where a='a';
a
a
select * from t_ci where a='A';
a
a
select * from t_ci where a='a   ';
a
a
select * from t_ci where a='a                    ';
a
a
drop table if exists t;
create table t (a varchar(10) primary key,b int);
insert into t values ('a', 1), ('b', 3), ('a', 2) on duplicate key update b = b + 1;
set autocommit=0;
insert into t values ('a', 1), ('b', 3), ('a', 2) on duplicate key update b = b + 1;
select * from t;
a	b
a	4
b	4
set autocommit=1;
select * from t;
a	b
a	4
b	4
drop table if exists t;
create table t (a varchar(10),b int, key tk (a));
insert into t values ('', 1), ('', 3);
set autocommit=0;
update t set b = b + 1;
select * from t;
a	b
	2
	4
set autocommit=1;
select * from t;
a	b
	2
	4
drop table t_ci;
create table t_ci(id bigint primary key, a varchar(10) collate utf8mb4_general_ci, unique key(a, id));
insert into t_ci values (1, 'a');
select a from t_ci;
a
a
select a from t_ci;
a
a
select a from t_ci where a='a';
a
a
select a from t_ci where a='A';
a
a
select a from t_ci where a='a   ';
a
a
select a from t_ci where a='a                    ';
a
a
drop table if exists t;
create table t(c set('A', 'B') collate utf8mb4_general_ci);
insert into t values('a');
insert into t values('B');
select c from t where c = 'a';
c
A
select c from t where c = 'A';
c
A
select c from t where c = 'b';
c
B
select c from t where c = 'B';
c
B
drop table if exists t1;
CREATE TABLE `t1` (  `COL1` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,  PRIMARY KEY (`COL1`(5)) clustered);
INSERT INTO `t1` VALUES ('È†');
select * from t1 where col1 not in (0xc484, 0xe5a4bc, 0xc3b3);
COL1
È†
select * from t1 where col1 >= 0xc484 and col1 <= 0xc3b3;
COL1
È†
select collation(IF('a' < 'B' collate utf8mb4_general_ci, 'smaller', 'greater' collate utf8mb4_unicode_ci));
collation(IF('a' < 'B' collate utf8mb4_general_ci, 'smaller', 'greater' collate utf8mb4_unicode_ci))
utf8mb4_unicode_ci
drop table if exists t;
create table t(a char(10));
insert into t values ('a');
select * from t where a in ('b' collate utf8mb4_general_ci, 'A', 3);
a
a
drop table if exists t;
create table t(`COL2` tinyint(16) DEFAULT NULL);
insert into t values(0);
select * from t WHERE COL2 IN (0xfc);
COL2
select * from t WHERE COL2 = 0xfc;
COL2
set autocommit=default;
drop table if exists t;
create table t (a varchar(10) collate utf8mb4_general_ci);
insert into t values ('a');
insert into t values ('A');
insert into t values ('b');
insert into t values ('B');
insert into t values ('a');
insert into t values ('A');
insert into t values ('ÃŸ');
insert into t values ('sa');
create index idx on t(a);
select * from t order by a;
a
a
A
a
A
b
B
ÃŸ
sa
drop table if exists t;
create table t (a varchar(10) collate utf8mb4_unicode_ci);
insert into t values ('a');
insert into t values ('A');
insert into t values ('b');
insert into t values ('B');
insert into t values ('a');
insert into t values ('A');
insert into t values ('ÃŸ');
insert into t values ('sa');
create index idx on t(a);
select * from t order by a;
a
a
A
a
A
b
B
sa
ÃŸ
select 'a' collate utf8mb4_bin = 'a' collate utf8mb4_general_ci;
Error 1267: Illegal mix of collations (utf8mb4_bin,EXPLICIT) and (utf8mb4_general_ci,EXPLICIT) for operation '='
drop table if exists t;
create table t (
mb4general varchar(10) charset utf8mb4 collate utf8mb4_general_ci,
mb4unicode varchar(10) charset utf8mb4 collate utf8mb4_unicode_ci,
mb4bin     varchar(10) charset utf8mb4 collate utf8mb4_bin,
general    varchar(10) charset utf8 collate utf8_general_ci,
unicode    varchar(10) charset utf8 collate utf8_unicode_ci,
utfbin     varchar(10) charset utf8 collate utf8_bin,
bin        varchar(10) charset binary collate binary,
latin1_bin varchar(10) charset latin1 collate latin1_bin,
ascii_bin  varchar(10) charset ascii collate ascii_bin,
i          int
);
insert into t values ('s', 's', 's', 's', 's', 's', 's', 's', 's', 1);
set names utf8mb4 collate utf8mb4_general_ci;
select * from t where mb4unicode = 's' collate utf8mb4_unicode_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select * from t t1, t t2 where t1.mb4unicode = t2.mb4general collate utf8mb4_general_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i	mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1	s	s	s	s	s	s	s	s	s	1
select * from t t1, t t2 where t1.mb4general = t2.mb4unicode collate utf8mb4_general_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i	mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1	s	s	s	s	s	s	s	s	s	1
select * from t t1, t t2 where t1.mb4general = t2.mb4unicode collate utf8mb4_unicode_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i	mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1	s	s	s	s	s	s	s	s	s	1
select * from t t1, t t2 where t1.mb4unicode = t2.mb4general collate utf8mb4_unicode_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i	mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1	s	s	s	s	s	s	s	s	s	1
select * from t where mb4general = mb4bin collate utf8mb4_general_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select * from t where mb4unicode = mb4general collate utf8mb4_unicode_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select * from t where mb4general = mb4unicode collate utf8mb4_unicode_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select * from t where mb4unicode = 's' collate utf8mb4_unicode_ci;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select * from t where mb4unicode = mb4bin;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select * from t where general = mb4unicode;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select * from t where unicode = mb4unicode;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select * from t where mb4unicode = mb4unicode;
mb4general	mb4unicode	mb4bin	general	unicode	utfbin	bin	latin1_bin	ascii_bin	i
s	s	s	s	s	s	s	s	s	1
select collation(concat(mb4unicode, mb4general collate utf8mb4_unicode_ci)) from t;
collation(concat(mb4unicode, mb4general collate utf8mb4_unicode_ci))
utf8mb4_unicode_ci
select collation(concat(mb4general, mb4unicode, mb4bin)) from t;
collation(concat(mb4general, mb4unicode, mb4bin))
utf8mb4_bin
select coercibility(concat(mb4general, mb4unicode, mb4bin)) from t;
coercibility(concat(mb4general, mb4unicode, mb4bin))
1
select collation(concat(mb4unicode, mb4bin, concat(mb4general))) from t;
collation(concat(mb4unicode, mb4bin, concat(mb4general)))
utf8mb4_bin
select coercibility(concat(mb4unicode, mb4bin)) from t;
coercibility(concat(mb4unicode, mb4bin))
2
select collation(concat(mb4unicode, mb4bin)) from t;
collation(concat(mb4unicode, mb4bin))
utf8mb4_bin
select coercibility(concat(mb4bin, concat(mb4general))) from t;
coercibility(concat(mb4bin, concat(mb4general)))
2
select collation(concaT(mb4bin, cOncAt(mb4general))) from t;
collation(concaT(mb4bin, cOncAt(mb4general)))
utf8mb4_bin
select coercibility(concat(mb4unicode, mb4bin, concat(mb4general))) from t;
coercibility(concat(mb4unicode, mb4bin, concat(mb4general)))
2
select collation(concat(mb4unicode, mb4bin, concat(mb4general))) from t;
collation(concat(mb4unicode, mb4bin, concat(mb4general)))
utf8mb4_bin
select coercibility(concat(mb4unicode, mb4general)) from t;
coercibility(concat(mb4unicode, mb4general))
1
select collation(coalesce(mb4unicode, mb4general)) from t;
collation(coalesce(mb4unicode, mb4general))
utf8mb4_bin
select coercibility(coalesce(mb4unicode, mb4general)) from t;
coercibility(coalesce(mb4unicode, mb4general))
1
select collation(CONCAT(concat(mb4unicode), concat(mb4general))) from t;
collation(CONCAT(concat(mb4unicode), concat(mb4general)))
utf8mb4_bin
select coercibility(cONcat(unicode, general)) from t;
coercibility(cONcat(unicode, general))
1
select collation(concAt(unicode, general)) from t;
collation(concAt(unicode, general))
utf8_bin
select collation(concat(bin, mb4general)) from t;
collation(concat(bin, mb4general))
binary
select coercibility(concat(bin, mb4general)) from t;
coercibility(concat(bin, mb4general))
2
select collation(concat(mb4unicode, ascii_bin)) from t;
collation(concat(mb4unicode, ascii_bin))
utf8mb4_unicode_ci
select coercibility(concat(mb4unicode, ascii_bin)) from t;
coercibility(concat(mb4unicode, ascii_bin))
2
select collation(concat(mb4unicode, mb4unicode)) from t;
collation(concat(mb4unicode, mb4unicode))
utf8mb4_unicode_ci
select coercibility(concat(mb4unicode, mb4unicode)) from t;
coercibility(concat(mb4unicode, mb4unicode))
2
select collation(concat(bin, bin)) from t;
collation(concat(bin, bin))
binary
select coercibility(concat(bin, bin)) from t;
coercibility(concat(bin, bin))
2
select collation(concat(latin1_bin, ascii_bin)) from t;
collation(concat(latin1_bin, ascii_bin))
latin1_bin
select coercibility(concat(latin1_bin, ascii_bin)) from t;
coercibility(concat(latin1_bin, ascii_bin))
2
select collation(concat(mb4unicode, bin)) from t;
collation(concat(mb4unicode, bin))
binary
select coercibility(concat(mb4unicode, bin)) from t;
coercibility(concat(mb4unicode, bin))
2
select collation(mb4general collate utf8mb4_unicode_ci) from t;
collation(mb4general collate utf8mb4_unicode_ci)
utf8mb4_unicode_ci
select coercibility(mb4general collate utf8mb4_unicode_ci) from t;
coercibility(mb4general collate utf8mb4_unicode_ci)
0
select collation(concat(concat(mb4unicode, mb4general), concat(unicode, general))) from t;
collation(concat(concat(mb4unicode, mb4general), concat(unicode, general)))
utf8mb4_bin
select coercibility(concat(concat(mb4unicode, mb4general), concat(unicode, general))) from t;
coercibility(concat(concat(mb4unicode, mb4general), concat(unicode, general)))
1
select collation(concat(i, 1)) from t;
collation(concat(i, 1))
utf8mb4_general_ci
select coercibility(concat(i, 1)) from t;
coercibility(concat(i, 1))
4
select collation(concat(i, user())) from t;
collation(concat(i, user()))
utf8mb4_bin
select coercibility(concat(i, user())) from t;
coercibility(concat(i, user()))
3
select * from t where mb4unicode = mb4general;
Error 1267: Illegal mix of collations (utf8mb4_unicode_ci,IMPLICIT) and (utf8mb4_general_ci,IMPLICIT) for operation '='
select * from t where unicode = general;
Error 1267: Illegal mix of collations (utf8_unicode_ci,IMPLICIT) and (utf8_general_ci,IMPLICIT) for operation '='
select concat(mb4general) = concat(mb4unicode) from t;
Error 1267: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='
select * from t t1, t t2 where t1.mb4unicode = t2.mb4general;
Error 1267: Illegal mix of collations (utf8mb4_unicode_ci,IMPLICIT) and (utf8mb4_general_ci,IMPLICIT) for operation '='
select field('s', mb4general, mb4unicode, mb4bin) from t;
Error 1271: Illegal mix of collations for operation 'field'
select concat(mb4unicode, mb4general) = mb4unicode from t;
Error 1267: Illegal mix of collations (utf8mb4_bin,NONE) and (utf8mb4_unicode_ci,IMPLICIT) for operation '='
set names default;
drop table if exists t;
create table t(name char(255) primary key, b int, c int, index idx(name), unique index uidx(name));
insert into t values("aaaa", 1, 1), ("bbb", 2, 2), ("ccc", 3, 3);
admin check table t;

drop table if exists t;
set tidb_enable_clustered_index=ON;
create table t(d double primary key, a int, name varchar(255), index idx(name(2)), index midx(a, name));
insert into t values(2.11, 1, "aa"), (-1, 0, "abcd"), (9.99, 0, "aaaa");
select d from t use index(idx) where name="aa";
d
2.11
set tidb_enable_clustered_index=default;
drop table if exists t;
create table t (a varchar(2) binary, index (a));
insert into t values ('a ');
select hex(a) from t;
hex(a)
6120
select hex(a) from t use index (a);
hex(a)
6120
drop table if exists t;
create table t(a varchar(10) binary);
show create table t;
Table	Create Table
t	CREATE TABLE `t` (
  `a` varchar(10) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
drop table if exists t;
create table t(a varchar(10) binary) collate utf8_general_ci;
show create table t;
Table	Create Table
t	CREATE TABLE `t` (
  `a` varchar(10) COLLATE utf8_bin DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci
drop table if exists t;
create table t(a varchar(10) binary collate utf8_general_ci);
show create table t;
Table	Create Table
t	CREATE TABLE `t` (
  `a` varchar(10) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
drop table if exists t;
create table t(a varchar(10) binary charset utf8 collate utf8_general_ci);
show create table t;
Table	Create Table
t	CREATE TABLE `t` (
  `a` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
drop table if exists t;
create table t(a varchar(10) binary charset utf8mb4 collate utf8mb4_unicode_ci) charset utf8 collate utf8_general_ci;
show create table t;
Table	Create Table
t	CREATE TABLE `t` (
  `a` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci
drop table if exists t;
create table t(a varchar(10) binary charset binary);
show create table t;
Table	Create Table
t	CREATE TABLE `t` (
  `a` varbinary(10) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
drop table if exists t;
create table t(a TINYTEXT collate UTF8MB4_GENERAL_CI, UNIQUE KEY `a`(`a`(10)));
insert into t (a) values ('A');
select * from t t1 inner join t t2 on t1.a = t2.a where t1.a = 'A';
a	a
A	A
update t set a = 'B';
admin check table t;

drop table if exists t;
set tidb_enable_clustered_index=ON;
create table t(a int, b char(10) collate utf8mb4_bin, c char(10) collate utf8mb4_general_ci,d varchar(10) collate utf8mb4_bin, e varchar(10) collate utf8mb4_general_ci, f char(10) collate utf8mb4_unicode_ci, g varchar(10) collate utf8mb4_unicode_ci, primary key(a, b, c, d, e, f, g), key a(a), unique key ua(a), key b(b), unique key ub(b), key c(c), unique key uc(c),key d(d), unique key ud(d),key e(e), unique key ue(e), key f(f), key g(g), unique key uf(f), unique key ug(g));
insert into t values (1, 'å•Š  ', 'å•Š  ', 'å•Š  ', 'å•Š  ', 'å•Š  ', 'å•Š  ');
select * from t;
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(a);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(ua);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(b);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(ub);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(c);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(uc);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(d);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(ud);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(e);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(ue);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(f);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(uf);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(g);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
select * from t use index(ug);
a	b	c	d	e	f	g
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  
alter table t add column h varchar(10) collate utf8mb4_general_ci default 'ðŸ¸';
alter table t add column i varchar(10) collate utf8mb4_general_ci default 'ðŸ¸';
alter table t add index h(h);
alter table t add unique index uh(h);
select * from t use index(h);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(uh);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(a);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(ua);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(b);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(ub);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(c);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(uc);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(d);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(ud);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(e);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
select * from t use index(ue);
a	b	c	d	e	f	g	h	i
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸
admin check table t;

admin recover index t a;
ADDED_COUNT	SCAN_COUNT
0	1
alter table t add column n char(10) COLLATE utf8mb4_unicode_ci;
alter table t add index n(n);
update t set n = 'å§';
select * from t;
a	b	c	d	e	f	g	h	i	n
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸	å§
select * from t use index(n);
a	b	c	d	e	f	g	h	i	n
1	å•Š	å•Š	å•Š  	å•Š  	å•Š	å•Š  	ðŸ¸	ðŸ¸	å§
admin check table t;

drop table if exists t;
create table t (a varchar(255) COLLATE utf8_general_ci primary key clustered, b int) partition by range columns(a) (partition p0 values less than ('0'), partition p1 values less than MAXVALUE);
alter table t add index b(b);
insert into t values ('0', 1);
select * from t use index(b);
a	b
0	1
select * from t use index();
a	b
0	1
admin check table t;

set tidb_enable_clustered_index=default;
drop table if exists t;
set tidb_enable_clustered_index=ON;
CREATE TABLE `t` (`a` char(10) COLLATE utf8mb4_unicode_ci NOT NULL,`b` char(20) COLLATE utf8mb4_general_ci NOT NULL,`c` int(11) NOT NULL,PRIMARY KEY (`a`,`b`,`c`),KEY `idx` (`a`));
begin;
insert into t values ('a6', 'b6', 3);
select * from t;
a	b	c
a6	b6	3
select * from t where a='a6';
a	b	c
a6	b6	3
delete from t;
select * from t;
a	b	c
commit;
select * from t;
a	b	c
drop table if exists t;
create table t(`a` char(10) COLLATE utf8mb4_unicode_ci NOT NULL key);
insert into t values ('&');
replace into t values ('&');
select * from t;
a
&
set tidb_enable_clustered_index=default;
drop table if exists t1, t2;
create table t1(a int, b char(10), key(b)) collate utf8mb4_general_ci;
create table t2(a int, b char(10), key(b)) collate ascii_bin;
insert into t1 values (1, 'a');
insert into t2 values (1, 'A');
select /*+ inl_join(t1) */ t1.b, t2.b from t1 join t2 where t1.b=t2.b;
b	b
a	A
select /*+ hash_join(t1) */ t1.b, t2.b from t1 join t2 where t1.b=t2.b;
b	b
a	A
select /*+ merge_join(t1) */ t1.b, t2.b from t1 join t2 where t1.b=t2.b;
b	b
a	A
select /*+ inl_hash_join(t1) */ t1.b, t2.b from t1 join t2 where t1.b=t2.b;
b	b
a	A
select /*+ inl_hash_join(t2) */ t1.b, t2.b from t1 join t2 where t1.b=t2.b;
b	b
a	A
show warnings;
Level	Code	Message
select /*+ inl_merge_join(t1) */ t1.b, t2.b from t1 join t2 where t1.b=t2.b;
b	b
a	A
select /*+ inl_merge_join(t2) */ t1.b, t2.b from t1 join t2 where t1.b=t2.b;
b	b
a	A
show warnings;
Level	Code	Message
drop table if exists a, b;
create table a(i int, k varbinary(40), v int, primary key(i, k) clustered);
create table b(i int, k varchar(40), v int, primary key(i, k) clustered);
insert into a select 3, 'nice mccarthy', 10;
select * from a, b where a.i = b.i and a.k = b.k;
i	k	v	i	k	v
drop table if exists a, b;
create table a(i int  NOT NULL, k varbinary(40)  NOT NULL, v int, key idx1(i, k));
create table b(i int  NOT NULL, k varchar(40)  NOT NULL, v int, key idx1(i, k));
insert into a select 3, 'nice mccarthy', 10;
select /*+ inl_join(b) */ b.i from a, b where a.i = b.i and a.k = b.k;
i
drop table if exists t;
CREATE TABLE `t` (  `col_10` blob DEFAULT NULL,  `col_11` decimal(17,5) NOT NULL,  `col_13` varchar(381) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'Yr',  PRIMARY KEY (`col_13`,`col_11`) CLUSTERED,  KEY `idx_4` (`col_10`(3))) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
insert into t values ('a', 12523, 'A');
insert into t values ('A', 2, 'a');
insert into t values ('a', 23, 'A');
insert into t values ('a', 23, 'h2');
insert into t values ('a', 23, 'h3');
insert into t values ('a', 23, 'h4');
insert into t values ('a', 23, 'h5');
insert into t values ('a', 23, 'h6');
insert into t values ('a', 23, 'h7');
select /*+ MERGE_JOIN(t) */ t.* from t where col_13 in ( select col_10 from t where t.col_13 in ( 'a', 'b' ) ) order by col_10 ;
col_10	col_11	col_13
A	2.00000	a
a	23.00000	A
a	12523.00000	A
select 'a' like 'A' collate utf8mb4_unicode_ci;
'a' like 'A' collate utf8mb4_unicode_ci
1
select 'a' collate utf8mb4_bin like 'A' collate utf8mb4_unicode_ci;
Error 1267: Illegal mix of collations (utf8mb4_bin,EXPLICIT) and (utf8mb4_unicode_ci,EXPLICIT) for operation 'like'
select 'ðŸ˜›' collate utf8mb4_general_ci like 'ðŸ˜‹';
'ðŸ˜›' collate utf8mb4_general_ci like 'ðŸ˜‹'
1
select 'ðŸ˜›' collate utf8mb4_general_ci = 'ðŸ˜‹';
'ðŸ˜›' collate utf8mb4_general_ci = 'ðŸ˜‹'
1
select 'ðŸ˜›' collate utf8mb4_unicode_ci like 'ðŸ˜‹';
'ðŸ˜›' collate utf8mb4_unicode_ci like 'ðŸ˜‹'
0
select 'ðŸ˜›' collate utf8mb4_unicode_ci = 'ðŸ˜‹';
'ðŸ˜›' collate utf8mb4_unicode_ci = 'ðŸ˜‹'
1
drop table if exists t;
create table t (k char(20), v int, primary key (k(4)) clustered, key (k)) collate utf8mb4_general_ci;
insert into t values('01233', 1);
create index idx on t(k(2));
select * from t use index(k_2);
k	v
01233	1
select * from t use index(idx);
k	v
01233	1
admin check table t;

drop table if exists t;
CREATE TABLE t (`COL1` tinyblob NOT NULL,  `COL2` binary(1) NOT NULL,  `COL3` bigint(11) NOT NULL,  PRIMARY KEY (`COL1`(5),`COL2`,`COL3`) /*T![clustered_index] CLUSTERED */);
insert into t values(0x1E,0xEC,6966939640596047133);
select * from t where col1 not in (0x1B,0x20) order by col1;
COL1	COL2	COL3
	ì	6966939640596047133
drop table if exists t;
create table t(a varchar(10));
insert into t values('aaaaaaaaa'),('å¤©çŽ‹ç›–åœ°è™Žå®å¡”é•‡æ²³å¦–');
select * from t;
a
aaaaaaaaa
å¤©çŽ‹ç›–åœ°è™Žå®å¡”é•‡æ²³å¦–
select collation(a) from (select null as a) aaa;
collation(a)
binary
select collation(a) from (select a from t limit 1) aaa;
collation(a)
utf8mb4_bin
select * from (select null as a union all select a from t) aaa order by a;
a
NULL
aaaaaaaaa
å¤©çŽ‹ç›–åœ°è™Žå®å¡”é•‡æ²³å¦–
select * from (select a from t) aaa union all select null as a order by a;
a
NULL
aaaaaaaaa
å¤©çŽ‹ç›–åœ°è™Žå®å¡”é•‡æ²³å¦–
