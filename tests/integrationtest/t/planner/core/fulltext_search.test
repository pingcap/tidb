# Test cases for MATCH...AGAINST to LIKE conversion

# Setup
set tidb_cost_model_version=1;
set @@tidb_opt_fulltext_search_fallback='like';
drop table if exists articles;
create table articles (id int primary key, title varchar(200), body text);
insert into articles values
  (1, 'MySQL Tutorial', 'This tutorial provides a basic MySQL tutorial'),
  (2, 'How To Use MySQL Well', 'After you went through a MySQL tutorial'),
  (3, 'Optimizing MySQL', 'In this tutorial we will show how to optimize MySQL'),
  (4, 'MySQL vs. PostgreSQL', 'This article compares MySQL and PostgreSQL'),
  (5, 'MySQL Security', 'How to secure your MySQL database');

# Test 1: Natural Language Mode - Single Column
select id, title from articles where match(title) against('MySQL tutorial');

# Test 2: Natural Language Mode - Multiple Columns
select id, title from articles where match(title, body) against('MySQL tutorial');

# Test 3: Boolean Mode - Required Terms
select id, title from articles where match(title) against('+MySQL +tutorial' in boolean mode);

# Test 4: Boolean Mode - Excluded Terms
select id, title from articles where match(title) against('+MySQL -tutorial' in boolean mode);

# Test 5: Boolean Mode - Prefix Wildcard
select id, title from articles where match(title) against('Optim*' in boolean mode);

# Test 6: Boolean Mode - Exact Phrase
select id, title from articles where match(title, body) against('"MySQL tutorial"' in boolean mode);

# Test 7: Boolean Mode - Complex Query
select id, title from articles where match(title, body) against('+MySQL +database -PostgreSQL' in boolean mode);

# Test 8: Boolean Mode - Optional Terms
select id, title from articles where match(title) against('tutorial security' in boolean mode);

# Test 9: Empty Search String
select id, title from articles where match(title) against('');

# Test 10: Test with error mode
set @@tidb_opt_fulltext_search_fallback='error';
-- error 1235
select id, title from articles where match(title) against('MySQL');

# Test 11: Switch back to like mode
set @@tidb_opt_fulltext_search_fallback='like';
select id, title from articles where match(title) against('MySQL');

# Test 12: Natural Language Mode with single word
select id, title from articles where match(title) against('PostgreSQL');

# Test 13: Test escaping of special LIKE characters
drop table if exists special_chars;
create table special_chars (id int primary key, content varchar(200));
insert into special_chars values
  (1, 'Progress is at 100%'),
  (2, 'Progress is at 50%'),
  (3, 'File name is test_file.txt'),
  (4, 'Path is C:\\Windows\\System32'),
  (5, 'Normal text without special chars');

# Test searching for literal % character
select id, content from special_chars where match(content) against('100%');

# Test searching for literal _ character
select id, content from special_chars where match(content) against('test_file');

# Test searching for literal \ character
select id, content from special_chars where match(content) against('C:\\Windows');

# Test Boolean mode with special characters
select id, content from special_chars where match(content) against('+100% +Progress' in boolean mode);

drop table if exists special_chars;

# Test 14: Boolean mode - only excluded terms (no required/optional)
select id, title from articles where match(title) against('-PostgreSQL -Security' in boolean mode);

# Test 15: Boolean mode - unclosed quote (should treat as phrase)
select id, title from articles where match(title) against('"MySQL tutorial' in boolean mode);

# Test 16: Boolean mode - mixed whitespace (tabs and newlines)
select id, title from articles where match(title) against('+MySQL	+tutorial
-Security' in boolean mode);

# Test 17: Boolean mode - empty word after operator removal (+* should be ignored)
select id, title from articles where match(title) against('+MySQL +* tutorial' in boolean mode);

# Test 18: Boolean mode - multiple excluded terms
select id, title from articles where match(title) against('+MySQL -PostgreSQL -Security -Well' in boolean mode);

# Test 19: Boolean mode - all term types combined
select id, title from articles where match(title) against('+MySQL -Security tutorial "How To" Optim*' in boolean mode);

# Test 20: Natural language mode - only whitespace
select id, title from articles where match(title) against('
  ');

# Test 21: Natural language mode - multiple spaces between words
select id, title from articles where match(title) against('MySQL     tutorial    PostgreSQL');

# Cleanup
drop table if exists articles;
