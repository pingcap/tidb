drop table if exists t;
create table t (id int primary key, v int);
insert into t values (1, 1), (2, 2), (3, 3);
insert into t values (4, 4);

# basic point get
explain format = 'brief' select _tidb_commit_ts, id from t where id = 1;
--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id = 1;

# basic batch point get
explain format = 'brief' select _tidb_commit_ts, id from t where id in (1, 2, 3);
--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id in (1, 2, 3);

--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id in (3, 4) order by _tidb_commit_ts desc;

# point get inside txn
begin;
--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id = 1;
--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id in (1, 2, 3);

insert into t values (5, 5);
insert into t values (6, 6);

--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id = 1;
--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id = 5;

--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id in (1, 2, 3);
--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id in (1, 2, 3, 5, 6);
rollback;

# on temporary table, cached table
create temporary table tmp (id int primary key, v int);
insert into tmp values (1, 1), (2, 2), (3, 3), (4, 4);
--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id = 1;
--replace_regex /^[1-9][0-9]+/TSO/
select _tidb_commit_ts, id from t where id in (1, 2, 3);

# The test is not quite stable depends on cache is cached or not.
# alter table t cache;
# explain format = 'brief' select _tidb_commit_ts, id from t where id = 1;
# --replace_regex /^[1-9][0-9]+/TSO/
# select _tidb_commit_ts, id from t where id = 1;
# sleep(1);
# --replace_regex /^[1-9][0-9]+/TSO/
# select _tidb_commit_ts, id from t where id = 1;

# basic batch point get
# explain format = 'brief' select _tidb_commit_ts, id from t where id in (1, 2, 3);
# --replace_regex /^[1-9][0-9]+/TSO/
# select _tidb_commit_ts, id from t where id in (1, 2, 3);

--echo # TODO
--echo # coprocessor is not supported yet
# explain format = 'brief' select _tidb_commit_ts, id from t;
# select _tidb_commit_ts, id from t;
# select _tidb_commit_ts, id from t where id < 5;
