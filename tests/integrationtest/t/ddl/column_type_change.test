# TestColumnTypeChangeBetweenInteger
drop table if exists t;
create table t (a int null, b int null);
alter table t modify column b int not null;
insert into t(a, b) values (null, 1);
-- error 1265
alter table t modify column a int not null;
-- error 1265
alter table t modify column a tinyint not null;
-- error 1265
alter table t modify column a bigint not null;
drop table if exists t;
create table t (a int not null, b int not null);
alter table t modify column b int null;
insert into t(a, b) values (1, null);
alter table t modify column a int null;
drop table if exists t;
create table t (a int unsigned, b int signed);
insert into t(a, b) values (1, 1);
alter table t modify column a int signed;
alter table t modify column b int unsigned;
drop table if exists t;
create table t (a tinyint);
alter table t modify column a smallint;
drop table if exists t;
create table t (a tinyint);
insert into t(a) values (127);
alter table t modify column a smallint;
alter table t modify column a mediumint;
alter table t modify column a int;
alter table t modify column a bigint;
drop table if exists t;
create table t (a bigint);
alter table t modify column a int;
alter table t modify column a mediumint;
alter table t modify column a smallint;
alter table t modify column a tinyint;
drop table if exists t;
create table t (a bigint);
insert into t(a) values (9223372036854775807);
-- error 1690
alter table t modify column a int;
-- error 1690
alter table t modify column a mediumint;
-- error 1690
alter table t modify column a smallint;
-- error 1690
alter table t modify column a tinyint;
admin check table t;

# TestColumnTypeChangeFromIntegerToOthers
drop table if exists t;
create table t(a tinyint, b smallint, c mediumint, d int, e bigint, f bigint);
insert into t values(1, 11, 111, 1111, 11111, 111111);
alter table t modify a varchar(10);
show create table t;
select a from t;
alter table t modify b char(10);
show create table t;
select b from t;
alter table t modify c binary(10);
show create table t;
select hex(c) from t;
alter table t modify d varbinary(10);
show create table t;
select d from t;
alter table t modify e blob(10);
show create table t;
select e from t;
alter table t modify f text(10);
show create table t;
select f from t;
drop table if exists t;
create table t(a tinyint, b smallint, c mediumint, d int, e bigint, f bigint);
insert into t values(1, 11, 111, 1111, 11111, 111111);
alter table t modify a decimal(2,1);
show create table t;
select a from t;
alter table t modify b year;
show create table t;
select b from t;
alter table t modify c time;
show create table t;
select c from t;
alter table t modify d date;
show create table t;
select d from t;
alter table t modify e timestamp;
set @@session.time_zone=UTC;
show create table t;
select e from t;
alter table t modify f datetime;
show create table t;
select f from t;
drop table if exists t;
create table t(a tinyint, b smallint, c mediumint, d int, e bigint, f bigint);
insert into t values(1, 11, 111, 1111, 11111, 111111);
alter table t modify a float;
show create table t;
select a from t;
alter table t modify b double;
show create table t;
select b from t;
alter table t modify c bit(10);
show create table t;
select hex(c) from t;
alter table t modify d json;
show create table t;
select d from t;
drop table if exists t;
create table t(a tinyint, b smallint, c mediumint, d int, e bigint);
insert into t values(1, 1, 1, 11111, 11111);
alter table t modify a enum("a", "b");
show create table t;
select a from t;
alter table t modify b set("a", "b");
show create table t;
select b from t;
-- error 1265
alter table t modify d enum("11111", "22222");
-- error 1265
alter table t modify e set("11111", "22222");
set @@session.time_zone=default;

# TestColumnTypeChangeBetweenVarcharAndNonVarchar
# https://github.com/pingcap/tidb/issues/23624
drop table if exists t;
create table t(b varchar(10));
insert into t values ('aaa   ');
alter table t change column b b char(10);
alter table t add index idx(b);
alter table t change column b b varchar(10);
select b from t use index(idx);
select b from t ignore index(idx);
admin check table t;

# https://github.com/pingcap/tidb/pull/23688#issuecomment-810166597
drop table if exists t;
create table t (a varchar(10));
insert into t values ('aaa   ');
select a from t;
alter table t modify column a char(10);
select a from t;

# TestColumnTypeChangeFromStringToOthers
set @@session.time_zone=UTC;
drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('123', '123', '123', '123', '123', '123', '123', '123');
alter table t modify c tinyint;
alter table t modify vc tinyint;
alter table t modify bny tinyint;
alter table t modify vbny tinyint;
alter table t modify bb tinyint;
alter table t modify txt tinyint;
alter table t modify e tinyint;
alter table t modify s tinyint;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('17305', '17305', '17305', '17305', '17305', '17305', '123', '123');
alter table t modify c int;
alter table t modify vc int;
alter table t modify bny int;
alter table t modify vbny int;
alter table t modify bb int;
alter table t modify txt int;
alter table t modify e int;
alter table t modify s int;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('17305867', '17305867', '17305867', '17305867', '17305867', '17305867', '123', '123');
alter table t modify c bigint;
alter table t modify vc bigint;
alter table t modify bny bigint;
alter table t modify vbny bigint;
alter table t modify bb bigint;
alter table t modify txt bigint;
alter table t modify e bigint;
alter table t modify s bigint;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('1', '1', '1', '1', '1', '1', '123', '123');
-- error 8200
alter table t modify c bit;
-- error 8200
alter table t modify vc bit;
-- error 8200
alter table t modify bny bit;
-- error 8200
alter table t modify vbny bit;
-- error 8200
alter table t modify bb bit;
-- error 8200
alter table t modify txt bit;
alter table t modify e bit;
alter table t modify s bit;
select hex(c),hex(vc),hex(bny),hex(vbny),hex(bb),hex(txt),hex(e),hex(s) from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('123.45', '123.45', '123.45', '123.45', '123.45', '123.45', '123', '123');
alter table t modify c decimal(7, 4);
alter table t modify vc decimal(7, 4);
-- error 1292
alter table t modify bny decimal(7, 4);
alter table t modify vbny decimal(7, 4);
alter table t modify bb decimal(7, 4);
alter table t modify txt decimal(7, 4);
alter table t modify e decimal(7, 4);
alter table t modify s decimal(7, 4);
select hex(c),hex(vc),hex(bny),hex(vbny),hex(bb),hex(txt),hex(e),hex(s) from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('123.45', '123.45', '123.45', '123.45', '123.45', '123.45', '123', '123');
alter table t modify c double(7, 4);
alter table t modify vc double(7, 4);
alter table t modify bny double(7, 4);
alter table t modify vbny double(7, 4);
alter table t modify bb double(7, 4);
alter table t modify txt double(7, 4);
alter table t modify e double(7, 4);
alter table t modify s double(7, 4);
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('20200826', '2008261', '20200826', '200826', '2020-08-26', '08-26 19:35:41', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888');
alter table t modify c date;
alter table t modify vc date;
alter table t modify bny date;
alter table t modify vbny date;
alter table t modify bb date;
-- error 1292
alter table t modify txt date;
-- error 8200
alter table t modify e date;
-- error 8200
alter table t modify s date;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('19:35:41', '19:35:41', '19:35:41', '19:35:41', '19:35:41.45678', '19:35:41.45678', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888');
alter table t modify c time;
alter table t modify vc time;
alter table t modify bny time;
alter table t modify vbny time;
alter table t modify bb time;
alter table t modify txt time;
-- error 8200
alter table t modify e time;
-- error 8200
alter table t modify s time;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
alter table t modify c char(23);
alter table t modify vc varchar(23);
alter table t modify bny binary(23);
alter table t modify vbny varbinary(23);
insert into t values ('2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888');
alter table t modify c datetime;
alter table t modify vc datetime;
alter table t modify bny datetime;
alter table t modify vbny datetime;
alter table t modify bb datetime;
alter table t modify txt datetime;
-- error 8200
alter table t modify e datetime;
-- error 8200
alter table t modify s datetime;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
alter table t modify c char(23);
alter table t modify vc varchar(23);
alter table t modify bny binary(23);
alter table t modify vbny varbinary(23);
insert into t values ('2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888');
alter table t modify c timestamp;
alter table t modify vc timestamp;
alter table t modify bny timestamp;
alter table t modify vbny timestamp;
alter table t modify bb timestamp;
alter table t modify txt timestamp;
-- error 8200
alter table t modify e timestamp;
-- error 8200
alter table t modify s timestamp;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('2020', '91', '2', '2020', '20', '99', '2020-07-15 18:32:17.888', '2020-07-15 18:32:17.888');
alter table t modify c year;
alter table t modify vc year;
alter table t modify bny year;
alter table t modify vbny year;
alter table t modify bb year;
alter table t modify txt year;
alter table t modify e year;
alter table t modify s year;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
alter table t modify c char(15);
alter table t modify vc varchar(15);
alter table t modify bny binary(15);
alter table t modify vbny varbinary(15);
insert into t values ('{"k1": "value"}', '{"k1": "value"}', '{"k1": "value"}', '{"k1": "value"}', '{"k1": "value"}', '{"k1": "value"}', '{"k1": "value"}', '{"k1": "value"}');
alter table t modify c json;
alter table t modify vc json;
alter table t modify bny json;
alter table t modify vbny json;
alter table t modify bb json;
alter table t modify txt json;
alter table t modify e json;
alter table t modify s json;
select * from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
insert into t values ('123x', 'x123', 'abc', 'datetime', 'timestamp', 'date', '123', '123');
-- error 1292
alter table t modify c int;
-- error 1292
alter table t modify vc smallint;
-- error 1292
alter table t modify bny bigint;
-- error 1292
alter table t modify vbny datetime;
-- error 1292
alter table t modify bb timestamp;
-- error 1292
alter table t modify txt date;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
alter table t modify vc varchar(20);
insert into t(c, vc) values ('1x', '20200915110836');
-- error 1292
alter table t modify c year;
alter table t modify vc time;
select vc from t;

drop table if exists t;
create table t (
	c char(8),
	vc varchar(8),
	bny binary(8),
	vbny varbinary(8),
	bb blob,
	txt text,
	e enum('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}'),
	s set('123', '2020-07-15 18:32:17.888', 'str', '{"k1": "value"}')
);
alter table t modify c char(15);
insert into t(c) values ('{"k1": "value"');
insert into t(e, s) values ('str', 'str');
-- error 3140
alter table t modify c json;
-- error 3140
alter table t modify e json;
-- error 3140
alter table t modify s json;
insert into t(vc) values ('abc');
-- error 1292
alter table t modify vc decimal(5,3);
set @@session.time_zone=default;

# TestColumnTypeChangeFromNumericToOthers
set @@session.time_zone=UTC;
drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
-- error 1690
alter table t modify d tinyint;
-- error 1690
alter table t modify n tinyint;
-- error 1690
alter table t modify r tinyint;
-- error 1690
alter table t modify db tinyint;
alter table t modify f32 tinyint;
-- error 1690
alter table t modify f64 tinyint;
alter table t modify b tinyint;
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
alter table t modify d int;
alter table t modify n int;
alter table t modify r int;
alter table t modify db int;
alter table t modify f32 int;
-- error 1690
alter table t modify f64 int;
alter table t modify b int;
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
alter table t modify d bigint;
alter table t modify n bigint;
alter table t modify r bigint;
alter table t modify db bigint;
alter table t modify f32 bigint;
alter table t modify f64 bigint;
alter table t modify b bigint;
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
-- error 1690
alter table t modify d bigint unsigned;
alter table t modify n bigint unsigned;
alter table t modify r bigint unsigned;
alter table t modify db bigint unsigned;
-- error 1690
alter table t modify f32 bigint unsigned;
-- error 1690
alter table t modify f64 bigint unsigned;
alter table t modify b int;
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
alter table t modify d char(20);
alter table t modify n char(20);
alter table t modify r char(20);
alter table t modify db char(20);
alter table t modify f32 char(20);
alter table t modify f64 char(20);
alter table t modify b char(20);
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
alter table t modify d varchar(30);
alter table t modify n varchar(30);
alter table t modify r varchar(30);
alter table t modify db varchar(30);
alter table t modify f32 varchar(30);
alter table t modify f64 varchar(30);
alter table t modify b varchar(30);
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
-- error 1265
alter table t modify d binary(10);
alter table t modify n binary(10);
-- error 1265
alter table t modify r binary(10);
-- error 1265
alter table t modify db binary(10);
-- error 1265
alter table t modify f32 binary(10);
-- error 1265
alter table t modify f64 binary(10);
alter table t modify b binary(10);
select hex(d),hex(n),hex(r),hex(db),hex(f32),hex(f64),hex(b) from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
alter table t modify d varbinary(30);
alter table t modify n varbinary(30);
alter table t modify r varbinary(30);
alter table t modify db varbinary(30);
alter table t modify f32 varbinary(30);
alter table t modify f64 varbinary(30);
alter table t modify b varbinary(30);
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
alter table t modify d blob;
alter table t modify n blob;
alter table t modify r blob;
alter table t modify db blob;
alter table t modify f32 blob;
alter table t modify f64 blob;
alter table t modify b blob;
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
alter table t modify d text;
alter table t modify n text;
alter table t modify r text;
alter table t modify db text;
alter table t modify f32 text;
alter table t modify f64 text;
alter table t modify b text;
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.111, -222222222222.222222222222222, b'10101');
-- error 8200
alter table t modify d enum('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify n enum('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify r enum('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify db enum('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify f32 enum('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify f64 enum('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify b enum('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.111, -222222222222.222222222222222, b'10101');
-- error 8200
alter table t modify d set('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify n set('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify r set('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify db set('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify f32 set('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify f64 set('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
-- error 8200
alter table t modify b set('-258.12345', '333.33', '2000000.20000002', '323232323.3232323232', '-111.111', '-222222222222.222222222222222', b'10101');
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (200805.11, 307.333, 20200805.11111111, 20200805111307.11111111, 200805111307.11111111, 20200805111307.11111111, b'10101');
-- error 8200
alter table t modify d datetime;
-- error 8200
alter table t modify n datetime;
-- error 8200
alter table t modify r datetime;
-- error 8200
alter table t modify db datetime;
-- error 8200
alter table t modify f32 datetime;
-- error 8200
alter table t modify f64 datetime;
-- error 8200
alter table t modify b datetime;
select hex(d),hex(n),hex(r),hex(db),hex(f32),hex(f64),hex(b) from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (200805.11, 307.333, 20200805.11111111, 20200805111307.11111111, 200805111307.11111111, 20200805111307.11111111, b'10101');
alter table t modify d time;
alter table t modify n time;
-- error 1292
alter table t modify r time;
alter table t modify db time;
alter table t modify f32 time;
alter table t modify f64 time;
-- error 8200
alter table t modify b time;
select hex(d),hex(n),hex(r),hex(db),hex(f32),hex(f64),hex(b) from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (200805.11, 307.333, 20200805.11111111, 20200805111307.11111111, 200805111307.11111111, 20200805111307.11111111, b'10101');
-- error 8200
alter table t modify d date;
-- error 8200
alter table t modify n date;
-- error 8200
alter table t modify r date;
-- error 8200
alter table t modify db date;
-- error 8200
alter table t modify f32 date;
-- error 8200
alter table t modify f64 date;
-- error 8200
alter table t modify b date;
select hex(d),hex(n),hex(r),hex(db),hex(f32),hex(f64),hex(b) from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (200805.11, 307.333, 20200805.11111111, 20200805111307.11111111, 200805111307.11111111, 20200805111307.11111111, b'10101');
-- error 8200
alter table t modify d timestamp;
-- error 8200
alter table t modify n timestamp;
-- error 8200
alter table t modify r timestamp;
-- error 8200
alter table t modify db timestamp;
-- error 8200
alter table t modify f32 timestamp;
-- error 8200
alter table t modify f64 timestamp;
-- error 8200
alter table t modify b timestamp;
select hex(d),hex(n),hex(r),hex(db),hex(f32),hex(f64),hex(b) from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (200805.11, 307.333, 2.55555, 98.1111111, 2154.00001, 20200805111307.11111111, b'10101');
-- error 1264
alter table t modify d year;
-- error 1264
alter table t modify n year;
alter table t modify r year;
alter table t modify db year;
alter table t modify f32 year;
-- error 1264
alter table t modify f64 year;
alter table t modify b year;
select * from t;

drop table if exists t;
create table t (
	d decimal(13, 7),
	n numeric(5, 2),
	r real(20, 12),
	db real(32, 11),
	f32 float(23),
	f64 double,
	b bit(5)
);
insert into t values (-258.12345, 333.33, 2000000.20000002, 323232323.3232323232, -111.11111111, -222222222222.222222222222222, b'10101');
alter table t modify d json;
alter table t modify n json;
alter table t modify r json;
alter table t modify db json;
alter table t modify f32 json;
alter table t modify f64 json;
alter table t modify b json;
select * from t;
set @@session.time_zone=default;

# TestColumnTypeChangeFromDateTimeTypeToOthers
set @@session.time_zone=UTC;
drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
-- error 1690
alter table t modify d tinyint;
-- error 1690
alter table t modify t tinyint;
-- error 1690
alter table t modify dt tinyint;
-- error 1690
alter table t modify tmp tinyint;
-- error 1690
alter table t modify y tinyint;
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d int;
alter table t modify t int;
-- error 1690
alter table t modify dt int;
-- error 1690
alter table t modify tmp int;
alter table t modify y int;
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d bigint;
alter table t modify t bigint;
alter table t modify dt bigint;
alter table t modify tmp bigint;
alter table t modify y bigint;
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
-- error 8200
alter table t modify d bit;
-- error 8200
alter table t modify t bit;
-- error 8200
alter table t modify dt bit;
-- error 8200
alter table t modify tmp bit;
-- error 8200
alter table t modify y bit;
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d decimal;
alter table t modify t decimal(10, 4);
alter table t modify dt decimal(20, 6);
alter table t modify tmp decimal(22, 8);
alter table t modify y decimal;
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d double;
alter table t modify t double(10, 4);
alter table t modify dt double(20, 6);
alter table t modify tmp double(22, 8);
alter table t modify y double;
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d char(30);
alter table t modify t char(30);
alter table t modify dt char(30);
alter table t modify tmp char(30);
alter table t modify y char(30);
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d varchar(30);
alter table t modify t varchar(30);
alter table t modify dt varchar(30);
alter table t modify tmp varchar(30);
alter table t modify y varchar(30);
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d binary(30);
alter table t modify t binary(30);
alter table t modify dt binary(30);
alter table t modify tmp binary(30);
alter table t modify y binary(30);
select hex(d), hex(t), hex(dt), hex(tmp), hex(y) from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d varbinary(30);
alter table t modify t varbinary(30);
alter table t modify dt varbinary(30);
alter table t modify tmp varbinary(30);
alter table t modify y varbinary(30);
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d text;
alter table t modify t text;
alter table t modify dt text;
alter table t modify tmp text;
alter table t modify y text;
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d blob;
alter table t modify t blob;
alter table t modify dt blob;
alter table t modify tmp blob;
alter table t modify y blob;
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
-- error 8200
alter table t modify d enum('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
-- error 8200
alter table t modify t enum('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
-- error 8200
alter table t modify dt enum('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
-- error 8200
alter table t modify tmp enum('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
-- error 8200
alter table t modify y enum('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
-- error 8200
alter table t modify d set('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
-- error 8200
alter table t modify t set('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
-- error 8200
alter table t modify dt set('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
-- error 8200
alter table t modify tmp set('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
-- error 8200
alter table t modify y set('2020-10-30', '19:38:25.001', '20201030082133.455555', '2020');
select * from t;

drop table if exists t;
create table t (
    d date,
    t time(3),
    dt datetime(6),
    tmp timestamp(6),
    y year
);
insert into t values ('2020-10-30', '19:38:25.001', 20201030082133.455555, 20201030082133.455555, 2020);
alter table t modify d json;
alter table t modify t json;
alter table t modify dt json;
alter table t modify tmp json;
alter table t modify y json;
select * from t;
set @@session.time_zone=default;

# TestColumnTypeChangeFromJsonToOthers
set @@session.time_zone=UTC;
drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 1292
alter table t modify obj tinyint;
-- error 1292
alter table t modify arr tinyint;
-- error 1292
alter table t modify nil tinyint;
alter table t modify t tinyint;
alter table t modify f tinyint;
alter table t modify i tinyint;
alter table t modify ui tinyint;
-- error 1690
alter table t modify f64 tinyint;
-- error 1292
alter table t modify str tinyint;
alter table t modify nul tinyint;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 1292
alter table t modify obj int;
-- error 1292
alter table t modify arr int;
-- error 1292
alter table t modify nil int;
alter table t modify t int;
alter table t modify f int;
alter table t modify i int;
alter table t modify ui int;
alter table t modify f64 int;
-- error 1292
alter table t modify str int;
alter table t modify nul int;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 1292
alter table t modify obj bigint;
-- error 1292
alter table t modify arr bigint;
-- error 1292
alter table t modify nil bigint;
alter table t modify t bigint;
alter table t modify f bigint;
alter table t modify i bigint;
alter table t modify ui bigint;
alter table t modify f64 bigint;
-- error 1292
alter table t modify str bigint;
alter table t modify nul bigint;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 1292
alter table t modify obj bigint unsigned;
-- error 1292
alter table t modify arr bigint unsigned;
-- error 1292
alter table t modify nil bigint unsigned;
alter table t modify t bigint unsigned;
alter table t modify f bigint unsigned;
-- error 1690
alter table t modify i bigint unsigned;
alter table t modify ui bigint unsigned;
alter table t modify f64 bigint unsigned;
-- error 1292
alter table t modify str bigint unsigned;
alter table t modify nul bigint unsigned;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 8200
alter table t modify obj bit;
-- error 8200
alter table t modify arr bit;
-- error 8200
alter table t modify nil bit;
-- error 8200
alter table t modify t bit;
-- error 8200
alter table t modify f bit;
-- error 8200
alter table t modify i bit;
-- error 8200
alter table t modify ui bit;
-- error 8200
alter table t modify f64 bit;
-- error 8200
alter table t modify str bit;
-- error 8200
alter table t modify nul bit;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 1292
alter table t modify obj decimal(20, 10);
-- error 1292
alter table t modify arr decimal(20, 10);
-- error 1292
alter table t modify nil decimal(20, 10);
alter table t modify t decimal(20, 10);
alter table t modify f decimal(20, 10);
alter table t modify i decimal(20, 10);
alter table t modify ui decimal(20, 10);
alter table t modify f64 decimal(20, 10);
-- error 1292
alter table t modify str decimal(20, 10);
alter table t modify nul decimal(20, 10);
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 1292
alter table t modify obj double;
-- error 1292
alter table t modify arr double;
-- error 1292
alter table t modify nil double;
alter table t modify t double;
alter table t modify f double;
alter table t modify i double;
alter table t modify ui double;
alter table t modify f64 double;
-- error 1292
alter table t modify str double;
alter table t modify nul double;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
alter table t modify obj char(20);
alter table t modify arr char(20);
alter table t modify nil char(20);
alter table t modify t char(20);
alter table t modify f char(20);
alter table t modify i char(20);
alter table t modify ui char(20);
alter table t modify f64 char(20);
alter table t modify str char(20);
alter table t modify nil char(20);
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
alter table t modify obj varchar(20);
alter table t modify arr varchar(20);
alter table t modify nil varchar(20);
alter table t modify t varchar(20);
alter table t modify f varchar(20);
alter table t modify i varchar(20);
alter table t modify ui varchar(20);
alter table t modify f64 varchar(20);
alter table t modify str varchar(20);
alter table t modify nul varchar(20);
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
alter table t modify obj binary(20);
alter table t modify arr binary(20);
alter table t modify nil binary(20);
alter table t modify t binary(20);
alter table t modify f binary(20);
alter table t modify i binary(20);
alter table t modify ui binary(20);
alter table t modify f64 binary(20);
alter table t modify str binary(20);
alter table t modify nul binary(20);
select hex(obj), hex(arr), hex(nil), hex(t), hex(f), hex(i), hex(ui), hex(f64), hex(str), hex(nul) from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
alter table t modify obj varbinary(20);
alter table t modify arr varbinary(20);
alter table t modify nil varbinary(20);
alter table t modify t varbinary(20);
alter table t modify f varbinary(20);
alter table t modify i varbinary(20);
alter table t modify ui varbinary(20);
alter table t modify f64 varbinary(20);
alter table t modify str varbinary(20);
alter table t modify nul varbinary(20);
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
alter table t modify obj blob;
alter table t modify arr blob;
alter table t modify nil blob;
alter table t modify t blob;
alter table t modify f blob;
alter table t modify i blob;
alter table t modify ui blob;
alter table t modify f64 blob;
alter table t modify str blob;
alter table t modify nul blob;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
alter table t modify obj text;
alter table t modify arr text;
alter table t modify nil text;
alter table t modify t text;
alter table t modify f text;
alter table t modify i text;
alter table t modify ui text;
alter table t modify f64 text;
alter table t modify str text;
alter table t modify nul text;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 8200
alter table t modify obj enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify arr enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify nil enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify t enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify f enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify i enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify ui enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify f64 enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify str enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify nul enum('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"', null);
-- error 8200
alter table t modify obj set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify arr set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify nil set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify t set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify f set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify i set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify ui set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify f64 set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify str set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
-- error 8200
alter table t modify nul set('{"obj": 100}', '[-1]', 'null', 'true', 'false', '-22', '22', '323232323.3232323232', '"json string"');
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '20200826173501', '20201123', '20200826173501.123456', '"2020-08-26 17:35:01.123456"', null);
-- error 1292
alter table t modify obj datetime;
-- error 1292
alter table t modify arr datetime;
-- error 1292
alter table t modify nil datetime;
-- error 1292
alter table t modify t datetime;
-- error 1292
alter table t modify f datetime;
alter table t modify i datetime;
alter table t modify ui datetime;
alter table t modify f64 datetime;
alter table t modify str datetime;
alter table t modify nul datetime;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '200805', '1111', '200805.11', '"19:35:41"', null);
-- error 1292
alter table t modify obj time;
-- error 1292
alter table t modify arr time;
-- error 1292
alter table t modify nil time;
-- error 1292
alter table t modify t time;
-- error 1292
alter table t modify f time;
alter table t modify i time;
alter table t modify ui time;
alter table t modify f64 time;
alter table t modify str time;
alter table t modify nul time;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '20200826173501', '20201123', '20200826173501.123456', '"2020-08-26 17:35:01.123456"', null);
-- error 1292
alter table t modify obj date;
-- error 1292
alter table t modify arr date;
-- error 1292
alter table t modify nil date;
-- error 1292
alter table t modify t date;
-- error 1292
alter table t modify f date;
alter table t modify i date;
alter table t modify ui date;
alter table t modify f64 date;
alter table t modify str date;
alter table t modify nul date;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '20200826173501', '20201123', '20200826173501.123456', '"2020-08-26 17:35:01.123456"', null);
-- error 1292
alter table t modify obj timestamp;
-- error 1292
alter table t modify arr timestamp;
-- error 1292
alter table t modify nil timestamp;
-- error 1292
alter table t modify t timestamp;
-- error 1292
alter table t modify f timestamp;
alter table t modify i timestamp;
alter table t modify ui timestamp;
alter table t modify f64 timestamp;
alter table t modify str timestamp;
alter table t modify nul timestamp;
select * from t;

drop table if exists t;
create table t (
	obj json,
	arr json,
	nil json,
	t json,
	f json,
	i json,
	ui json,
	f64 json,
	str json,
	nul json
);
insert into t values ('{"obj": 100}', '[-1, 0, 1]', 'null', 'true', 'false', '2020', '91', '9', '"2020"', null);
-- error 1292
alter table t modify obj year;
-- error 1292
alter table t modify arr year;
-- error 1292
alter table t modify nil year;
alter table t modify t year;
alter table t modify f year;
alter table t modify i year;
alter table t modify ui year;
alter table t modify f64 year;
alter table t modify str year;
alter table t modify nul year;
select * from t;
set @@session.time_zone=default;

# TestUpdateDataAfterChangeTimestampToDate
drop table if exists t, t1;
create table t (col timestamp default '1971-06-09' not null, col1 int default 1, unique key(col1));
alter table t modify column col date not null;
update t set col = '2002-12-31';
update t set col = '2002-12-31' where col1 = 1;
create table t1 (col timestamp default '1971-06-09' not null, col1 int default 1, unique key(col1));
insert into t1 value('2001-01-01', 1);
alter table t1 add column col2 timestamp default '2020-06-02' not null;
alter table t1 modify column col2 date not null;
update t1 set col = '2002-11-22';
update t1 set col = '2002-12-31' where col1 = 1;

# TestChangingAttributeOfColumnWithFK
drop table if exists users, orders;
CREATE TABLE users (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, doc JSON);
CREATE TABLE orders (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, user_id INT NOT NULL, doc JSON, FOREIGN KEY fk_user_id (user_id) REFERENCES users(id));
alter table orders modify user_id int null;
show create table orders;

drop table if exists users, orders;
CREATE TABLE users (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, doc JSON);
CREATE TABLE orders (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, user_id INT NOT NULL, doc JSON, FOREIGN KEY fk_user_id (user_id) REFERENCES users(id));
alter table orders change user_id user_id2 int null;
show create table orders;

drop table if exists users, orders;
CREATE TABLE users (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, doc JSON);
CREATE TABLE orders (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, user_id INT NOT NULL, doc JSON, FOREIGN KEY fk_user_id (user_id) REFERENCES users(id));
alter table orders modify user_id int default -1 comment "haha";
show create table orders;

drop table if exists users, orders;
CREATE TABLE users (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, doc JSON);
CREATE TABLE orders (id INT NOT NULL PRIMARY KEY AUTO_INCREMENT, user_id INT NOT NULL, doc JSON, FOREIGN KEY fk_user_id (user_id) REFERENCES users(id));
-- error 3780
alter table orders modify user_id bigint;
drop table if exists orders, users;

# TestAlterPrimaryKeyToNull
drop table if exists t, t1;
create table t(a int not null, b int not null, primary key(a, b));
-- error 1171
alter table t modify a bigint null;
-- error 1171
alter table t change column a a bigint null;
create table t1(a int not null, b int not null, primary key(a));
-- error 1171
alter table t modify a bigint null;
-- error 1171
alter table t change column a a bigint null;

# TestChangeUnsignedIntToDatetime
# https://github.com/pingcap/tidb/issues/24839
drop table if exists t;
create table t (a int(10) unsigned default null, b bigint unsigned, c tinyint unsigned);
insert into t values (1, 1, 1);
-- error 1292
alter table t modify column a datetime;
-- error 1292
alter table t modify column b datetime;
-- error 1292
alter table t modify column c datetime;
drop table if exists t;
create table t (a int(10) unsigned default null, b bigint unsigned, c tinyint unsigned);
insert into t values (4294967295, 18446744073709551615, 255);
-- error 1292
alter table t modify column a datetime;
-- error 1292
alter table t modify column b datetime;
-- error 1292
alter table t modify column c datetime;

# TestChangeIntToBitWillPanicInBackfillIndexes
# issue #24253
drop table if exists t;
CREATE TABLE `t` (  `a` int(11) DEFAULT NULL,  `b` varchar(10) DEFAULT NULL,  `c` decimal(10,2) DEFAULT NULL,  KEY `idx1` (`a`),  UNIQUE KEY `idx2` (`a`),  KEY `idx3` (`a`,`b`),  KEY `idx4` (`a`,`b`,`c`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
insert into t values(19,1,1),(17,2,2);
alter table t modify a bit(5) not null;
show create table t;
--sorted_result
select hex(a), hex(b), hex(c) from t;

# TestCTCShouldCastTheDefaultValue
# issue #24971, #24973, #24974
drop table if exists t;
create table t(a int);
insert into t values(1);
alter table t add column b bit(51) default 1512687856625472;
-- error 1690
alter table t modify column b decimal(30,18);
drop table if exists t;
create table tbl_1 (col int);
insert into tbl_1 values (9790);
alter table tbl_1 add column col1 blob(6) collate binary not null;
select col1 from tbl_1;
-- error 1292
alter table tbl_1 change column col1 col2 int;
select col1 from tbl_1;
drop table if exists t;
create table tbl(col_214 decimal(30,8));
replace into tbl values (89687.448);
alter table tbl add column col_279 binary(197) collate binary default 'RAWTdm' not null;
select hex(col_279) from tbl;
-- error 1292
alter table tbl change column col_279 col_287 int;
select hex(col_279) from tbl;

# TestCTCCastBitToBinary
# Close issue #25037
# 1: for default value of binary of create-table, it should append the \0 as the suffix to meet flen.
# 2: when cast the bit to binary, we should consider to convert it to uint then cast uint to string, rather than taking the bit to string directly.
drop table if exists t;
create table t(a binary(10) default 't');
show create table t;
drop table if exists t;
create table t(a bit(13) not null) collate utf8mb4_general_ci;
insert into t values ( 4047 );
alter table t change column a a binary(248) collate binary default 't';
show create table t;
select hex(a) from t;
drop table if exists t;
create table t(a bit(13) not null) collate utf8mb4_general_ci;
insert into t values ( 4047 );
alter table t change column a a varbinary(248) collate binary default 't';
show create table t;
select * from t;

# TestChangePrefixedIndexColumnToNonPrefixOne
drop table if exists t;
create table t (a text, unique index idx(a(2)));
alter table t modify column a int;
show create table t;
drop table if exists t;
create table t (a char(255), unique index idx(a(2)));
alter table t modify column a float;
show create table t;
drop table if exists t;
create table t (a char(255), b text, unique index idx(a(2), b(10)));
alter table t modify column b int;
show create table t;
drop table if exists t;
create table t(a char(250), unique key idx(a(10)));
alter table t modify a char(9);
show create table t;
drop table if exists t;
create table t(a varchar(700), key(a(700)));
-- error 1170
alter table t change column a a tinytext;

# TestCastToTimeStampDecodeError
# https://github.com/pingcap/tidb/issues/25469
drop table if exists t;
CREATE TABLE `t` (  `a` datetime DEFAULT '1764-06-11 02:46:14') ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_bin COMMENT='7b84832e-f857-4116-8872-82fc9dcc4ab3';
insert into `t` values();
-- error 1292
alter table `t` change column `a` `b` TIMESTAMP NULL DEFAULT '2015-11-14 07:12:24';
drop table if exists t;
CREATE TABLE `t` (  `a` date DEFAULT '1764-06-11 02:46:14') ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_bin COMMENT='7b84832e-f857-4116-8872-82fc9dcc4ab3';
insert into `t` values();
-- error 1292
alter table `t` change column `a` `b` TIMESTAMP NULL DEFAULT '2015-11-14 07:12:24';
drop table if exists t;
select timestamp(cast('1000-11-11 12-3-1' as date));

# TestCastFromZeroIntToTimeError
# https://github.com/pingcap/tidb/issues/25285
drop table if exists t;
create table t (a int);
insert into t values (0);
set @@sql_mode = 'STRICT_TRANS_TABLES';
select date(0);
select time(0);
-- error 1292
alter table t modify column a date;
-- error 1292
alter table t modify column a datetime;
-- error 1292
alter table t modify column a timestamp;
drop table if exists t;
create table t (a int);
insert into t values (0);
set @@sql_mode = 'STRICT_ALL_TABLES';
select date(0);
select time(0);
-- error 1292
alter table t modify column a date;
-- error 1292
alter table t modify column a datetime;
-- error 1292
alter table t modify column a timestamp;
drop table if exists t;
create table t (a int);
insert into t values (0);
set @@sql_mode = 'NO_ZERO_IN_DATE';
select date(0);
select time(0);
alter table t modify column a date;
drop table if exists t;
create table t (a int);
insert into t values (0);
alter table t modify column a datetime;
drop table if exists t;
create table t (a int);
insert into t values (0);
alter table t modify column a timestamp;
drop table if exists t;
create table t (a int);
insert into t values (0);
set @@sql_mode = 'NO_ZERO_DATE';
select date(0);
select time(0);
alter table t modify column a date;
drop table if exists t;
create table t (a int);
insert into t values (0);
alter table t modify column a datetime;
drop table if exists t;
create table t (a int);
insert into t values (0);
alter table t modify column a timestamp;
drop table if exists t;
create table t (a int);
insert into t values (0);
set @@sql_mode = 'ALLOW_INVALID_DATES';
select date(0);
select time(0);
alter table t modify column a date;
drop table if exists t;
create table t (a int);
insert into t values (0);
alter table t modify column a datetime;
drop table if exists t;
create table t (a int);
insert into t values (0);
alter table t modify column a timestamp;
drop table if exists t;
create table t (a int);
insert into t values (0);
set @@sql_mode = '';
select date(0);
select time(0);
alter table t modify column a date;
drop table if exists t;
create table t (a int);
insert into t values (0);
alter table t modify column a datetime;
drop table if exists t;
create table t (a int);
insert into t values (0);
alter table t modify column a timestamp;
drop table if exists t;
set @@sql_mode = default;

# TestChangeFromTimeToYear
drop table if exists t;
create table t (a time default 0);
insert into t values ();
insert into t values (NULL);
insert into t values ('12');
insert into t values ('00:19:59');
insert into t values ('00:20:13');
alter table t modify column a year;
select a from t;
drop table if exists t;
create table t (id bigint primary key, a time);
replace into t values (1, '10:10:10');
-- error 1264
alter table t modify column a year;
replace into t values (1, '12:13:14');
-- error 1264
alter table t modify column a year;
set @@sql_mode = '';
alter table t modify column a year;
show warnings;
set @@sql_mode = default;

# TestChangeFromUnsignedIntToTime
# https://github.com/pingcap/tidb/issues/25282
drop table if exists t;
create table t (a mediumint unsigned);
insert into t values (180857);
alter table t modify column a time;
select a from t;
drop table if exists t;

# TestChangeFromBitToStringInvalidUtf8ErrMsg
# See https://github.com/pingcap/tidb/issues/25287.
# Revised according to https://github.com/pingcap/tidb/pull/31031#issuecomment-1001404832.
drop table if exists t;
create table t (a bit(45));
insert into t values (1174717);
alter table t modify column a varchar(31) collate utf8mb4_general_ci;
select a from t;

# TestForIssue24621
drop table if exists t;
create table t(a char(250));
insert into t values('0123456789abc');
-- error 1265
alter table t modify a char(12) null;

# TestChangeNullValueFromOtherTypeToTimestamp
drop table if exists t;
create table t(a int null);
insert into t values();
select * from t;
alter table t modify column a timestamp NOT NULL;
select count(*) from t where a = null;
drop table if exists t;
create table t(a int null);
insert into t values();
select * from t;
-- error 1265
alter table t change column a a1 time NOT NULL;
drop table if exists t;
create table t(a timestamp null);
insert into t values();
select * from t;
-- error 1265
alter table t modify column a timestamp NOT NULL;
drop table if exists t;
create table t(a timestamp NOT NULL);
-- error 1364
insert into t values();
-- error 1048
insert into t values(null);

# TestColumnTypeChangeBetweenFloatAndDouble
# issue #31372
drop table if exists t;
create table t (a float(6,2));
insert into t values (36.43), (24.1);
alter table t modify a double(6,2);
select a from t;
drop table if exists t;
create table t (a float(6,2));
insert into t values (36.43), (24.1);
alter table t modify a float(6,1);
select a from t;
drop table if exists t;
create table t (a double(6,2));
insert into t values (36.43), (24.1);
alter table t modify a double(6,1);
select a from t;
alter table t modify a float(6,1);
select a from t;

# TestColumnTypeChangeTimestampToInt
drop table if exists t;
create table t(id int primary key auto_increment, c1 timestamp default '2020-07-10 01:05:08');
insert into t values();
select * from t;
alter table t modify column c1 bigint;
select * from t;
alter table t modify c1 timestamp;
set @@session.time_zone=UTC;
select * from t;
set time_zone = '+00:00';
drop table if exists t;
create table t(id int primary key auto_increment, c1 timestamp default '2020-07-10 01:05:08', index idx(c1));
insert into t values();
select * from t;
alter table t modify column c1 bigint;
alter table t add index idx1(id, c1);
select * from t;
admin check table t;
set @@session.time_zone='+5:00';
alter table t modify c1 timestamp;
select * from t;
set @@session.time_zone='-8:00';
select * from t;
admin check table t;
drop table if exists t;
create table t(id int primary key auto_increment, c1 timestamp default '2020-07-10 01:05:08', index idx(c1));
insert into t values();
select * from t;
alter table t modify column c1 bigint;
alter table t add index idx1(id, c1);
select * from t;
admin check table t;
set @@session.time_zone= default;
alter table t modify c1 timestamp;
select * from t;
set @@session.time_zone='SYSTEM';
select * from t;
admin check table t;
drop table if exists t;
set @@session.time_zone=UTC;
create table t(id int primary key auto_increment, c1 timestamp default '1990-04-15 18:00:00');
insert into t values();
select * from t;
set @@session.time_zone='Asia/Shanghai';
alter table t modify column c1 bigint;
select * from t;
alter table t modify c1 timestamp default '1990-04-15 18:00:00';
set @@session.time_zone=UTC;
insert into t values();
select * from t;
drop table if exists t;
set @@session.time_zone='-8:00';
create table t(id int primary key auto_increment, c1 timestamp default '2016-03-13 02:30:00', index idx(c1));
insert into t values();
select * from t;
set @@session.time_zone='America/Los_Angeles';
alter table t modify column c1 bigint;
select * from t;
alter table t add index idx1(id, c1);
admin check table t;
set @@session.time_zone=default;

# TestFixDDLTxnWillConflictWithReorgTxn
drop table if exists t;
create table t (a int);
alter table t add index(a);
set @@sql_mode='';
insert into t values(128),(129);
alter table t modify column a tinyint;
show warnings;
set @@sql_mode=default;

# issue #52748, alter table should respect SQL_MODE and result a valid timestamp value
drop table if exists t;
create table t (a date);
insert into t values('9999-01-01');
set @@sql_mode='ALLOW_INVALID_DATES';
alter table t modify a timestamp;
select * from t;

drop table if exists t;
create table t (a date);
insert into t values('9999-01-01');
set @@sql_mode='ALLOW_INVALID_DATES,STRICT_TRANS_TABLES';
--error 1292
alter table t modify a timestamp;
select * from t;

# issue #52509, generated column should also return a valid timestamp value.
drop table t;
CREATE TABLE t (a date, b timestamp AS (a));
set @@sql_mode='';
insert into t (a) values('9999-01-01');
select * from t;

