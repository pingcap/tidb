drop database if exists db_read_only;
create database db_read_only;
drop database if exists db_read_only_1;
create database db_read_only_1;
use db_read_only;
create table s(a int primary key);
create table t(id int primary key auto_increment, a int, b int, c varchar(1), index b(b), foreign key fk_a(b) references s(a));
create table members (
    id int,
    fname varchar(255),
    lname varchar(255),
    dob date,
    data json
)
partition by range (year(dob)) (
 partition pBefore1950 values less than (1950),
 partition p1950 values less than (1960),
 partition p1960 values less than (1970),
 partition p1970 values less than (1980),
 partition p1980 values less than (1990),
 partition p1990 values less than (2000));


# DDL can NOT be executed in read-only mode
alter schema db_read_only read only 1;

alter database db_read_only charset gbk;
alter database db_read_only collate utf8mb4_roman_ci;
create placement policy p1 followers=4; 
alter database db_read_only placement policy p1;
alter database db_read_only set tiflash replica 1;
drop database db_read_only;

create table t1(c1 int);
create table t2 like t;
create table pt (a int, b int) partition by hash(a) partitions 4;

alter table t add column c int not null;
alter table t add index (a);
create index c1 on t(a);
alter table t alter index b invisible;
alter table t change c bigint;
alter table t compact tiflash replica;
alter table t drop column c;
alter table t drop index b;
drop index b on t;
alter table t modify column c varchar(10);
alter table t rename index b to b_1;
alter table t drop foreign key fk_a;
alter table t add foreign key fk_a1(b) references s(a);
alter table t partition by hash(a) partitions 4;
alter table members drop partition p1990;
alter table members truncate partition p1980;
alter table members add partition (partition `p1990to2010` values less than (2010));
alter table members reorganize partition `p1990to2010` into
(partition p1990 values less than (2000),
 partition p2000 values less than (2010),
 partition p2010 values less than (2020),
 partition p2020 values less than (2030),
 partition pMax values less than (maxvalue));

rename table t to t_old;
-- db_read_only is read only
rename table db_read_only.t to db_read_only_1.t;
alter schema db_read_only read only 0;
alter schema db_read_only_1 read only 1;
--db_read_only_1 is read only
rename table db_read_only.t to db_read_only_1.t;
alter schema db_read_only read only 1;

truncate table t;
drop table t;
drop view v1;
load data local infile '' into table t;
import into t from '';
create view v as select * from t;
create or replace view v as select * from t;
alter table t auto_increment = 10000;

# DDL can be executed in read-only mode
create temporary table t(a INT);
drop temporary table t;
create global temporary table t(a INT) on commit delete rows;
drop global temporary table t;
