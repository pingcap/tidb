create table t (id int primary key clustered, v int) softdelete retention 7 day;
# soft delete (1, 1)
insert into t (id, v) values (1, 1), (2, 2);
update t set _tidb_softdelete_time = now() where id = 1;

replace into t (id, v) values (1, 11), (2, 12), (3, 13);
# (2, 12) conflicts with the old row (2, 2), it should be updated.
select id, v from t where _tidb_softdelete_time is null;
drop table t;



-- echo # test again with nonclustered
create table t (id int primary key nonclustered, v int) softdelete retention 7 day;
# soft delete (1, 1)
insert into t (id, v) values (1, 1), (2, 2);
update t set _tidb_softdelete_time = now() where id = 1;

replace into t (id, v) values (1, 11), (2, 12), (3, 13);
# (2, 12) conflicts with the old row (2, 2), it should be updated.
select id, v from t where _tidb_softdelete_time is null;
